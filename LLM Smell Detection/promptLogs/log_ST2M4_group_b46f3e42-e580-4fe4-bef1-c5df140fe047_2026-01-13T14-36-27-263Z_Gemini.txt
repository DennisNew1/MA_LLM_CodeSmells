--- DATE: 13.1.2026, 15:36:27 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\MailAddress.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
9: 
10: import javax.persistence.Embeddable;
11: import java.util.regex.Matcher;
12: import java.util.regex.Pattern;
13: 
14: @Getter
15: @Embeddable
16: @EqualsAndHashCode
17: @NoArgsConstructor(access = AccessLevel.PROTECTED)
18: public class MailAddress implements MailAddressType {
19:     private String mailAddressString;
20: 
21:     private MailAddress(String mailAddressString){
22:         this.mailAddressString = mailAddressString;
23:     }
24: 
25:     public static MailAddress of( String mailAddressAsString ){
26:         if (mailAddressAsString == null) throw new ShopException("Mail address must not be null!");
27:         String regex = "^[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+)*@"
28:                 + "[^-][A-Za-z0-9-]*(\\.[A-Za-z0-9-]+)*(\\.[deatcomrgh]+)$";
29:         Pattern pattern = Pattern.compile(regex);
30:         Matcher matcher = pattern.matcher(mailAddressAsString);
31:         if(!matcher.matches()){
32:             throw new ShopException("No valid Mail Address!");
33:         }
34:         return new MailAddress(mailAddressAsString);
35:     }
36: 
37:     @Override
38:     public String toString(){
39:         return mailAddressString;
40:     }
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
9: 
10: import javax.persistence.Embeddable;
11: import java.util.Arrays;
12: 
13: @Getter
14: @Embeddable
15: @EqualsAndHashCode
16: @NoArgsConstructor(access = AccessLevel.PROTECTED)
17: public class Money implements MoneyType {
18:     private Float amount;
19:     private String currency;
20: 
21: 
22:     private Money(Float amount, String currency){
23:         this.amount = amount;
24:         this.currency = currency;
25:     }
26: 
27:     public static Money of(Float amount, String currency ){
28:         if (amount == null) throw new ShopException("Amount must not be null");
29:         if (amount < 0) throw new ShopException("Amount must be over zero");
30:         if (currency == null) throw new ShopException("Currency must not be null");
31:         String[] allowedValues = {"EUR", "CHF"};
32:         if (!Arrays.asList(allowedValues).contains(currency))throw new ShopException("Currency is not available");
33:         return new Money(amount, currency);
34:     }
35: 
36:     @Override
37:     public MoneyType add(MoneyType otherMoney) {
38:         if (otherMoney == null) throw new ShopException("Other money is null");
39:         if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
40:         return Money.of(this.getAmount()+ otherMoney.getAmount(), this.getCurrency());
41:     }
42: 
43:     @Override
44:     public MoneyType subtract(MoneyType otherMoney) {
45:         if (otherMoney == null) throw new ShopException("Other money is null");
46:         if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
47:         if (otherMoney.getAmount() > this.getAmount()) throw new ShopException("Invalid Amount");
48:         return Money.of(this.getAmount() - otherMoney.getAmount(), this.getCurrency());
49:     }
50: 
51:     @Override
52:     public MoneyType multiplyBy(int factor) {
53:         if (factor < 0)throw new ShopException("Factor must not be negative");
54:         return Money.of(this.getAmount() * factor, this.getCurrency());
55:     }
56: 
57:     @Override
58:     public boolean largerThan(MoneyType otherMoney) {
59:         if (otherMoney == null) throw new ShopException("Other money is null");
60:         if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
61:         if (otherMoney.getAmount() < this.getAmount()) return true;
62:         else return false;
63:     }
64: }
65: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PersonalAddress.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
10: 
11: import javax.persistence.Embeddable;
12: import javax.persistence.Embedded;
13: 
14: @Getter
15: @Embeddable
16: @EqualsAndHashCode
17: @NoArgsConstructor(access = AccessLevel.PROTECTED)
18: public class PersonalAddress implements PersonalAddressType{
19:     private String street;
20:     private String city;
21:     @Embedded
22:     private ZipCode zipCode;
23: 
24:     private PersonalAddress(String street, String city, ZipCodeType zipCode){
25:         this.street = street;
26:         this.city = city;
27:         this.zipCode = (ZipCode) zipCode;
28:     }
29: 
30:     public static PersonalAddress of( String street, String city, ZipCodeType zipCode ){
31:         if (street == null || street.isEmpty()) throw new ShopException("Street is null or empty");
32:         if (city == null || city.isEmpty()) throw new ShopException("City is null or empty");
33:         if (zipCode == null) throw new ShopException("Zip code is null");
34:         return new PersonalAddress(street, city, zipCode);
35:     }
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
9: 
10: import javax.persistence.Embeddable;
11: import java.util.regex.Matcher;
12: import java.util.regex.Pattern;
13: 
14: @Getter
15: @Embeddable
16: @EqualsAndHashCode
17: @NoArgsConstructor(access = AccessLevel.PROTECTED)
18: public class ZipCode implements ZipCodeType {
19:     private String content;
20: 
21:     private ZipCode(String content){
22:         this.content = content;
23:     }
24: 
25:     public static ZipCodeType of( String zipCodeAsString ){
26:         if (zipCodeAsString == null) throw new ShopException("Zip code must not be null");
27:         String regex = "^[0-9]{5}";
28:         Pattern pattern = Pattern.compile(regex);
29:         Matcher matcher = pattern.matcher(zipCodeAsString);
30:         if(!matcher.matches()){
31:             throw new ShopException("No valid zip code!");
32:         }
33:         if(zipCodeAsString.endsWith("0000")) throw new ShopException("No valid zip code");
34:         return new ZipCode(zipCodeAsString);
35:     }
36: 
37:     @Override
38:     public String toString(){
39:         return content;
40:     }
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static MailAddressType instantiateMailAddress( String mailAddressAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for MailAddressType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, mailAddressAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + mailAddressAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (MailAddressType) instance;
48:     }
49: 
50: 
51:     public static PersonalAddressType instantiatePersonalAddress(
52:             String street, String city, ZipCodeType zipCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, ZipCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for PersonalAddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, zipCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + zipCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (PersonalAddressType) instance;
79:     }
80: 
81: 
82:     public static ZipCodeType instantiateZipCode( String zipCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for ZipCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, zipCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + zipCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (ZipCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * users and things. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] USER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static MailAddressType[] USER_EMAIL = new MailAddressType[] {
40:             FactoryMethodInvoker.instantiateMailAddress( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateMailAddress( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateMailAddress( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateMailAddress( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateMailAddress( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateMailAddress( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateMailAddress( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateMailAddress( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateMailAddress( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateMailAddress( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static PersonalAddressType[] USER_ADDRESS = new PersonalAddressType[] {
53:             FactoryMethodInvoker.instantiatePersonalAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiateZipCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiatePersonalAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiateZipCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiatePersonalAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiateZipCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiatePersonalAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiateZipCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiatePersonalAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiateZipCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiatePersonalAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiateZipCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiatePersonalAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiateZipCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiatePersonalAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiateZipCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiatePersonalAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiateZipCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiatePersonalAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiateZipCode( "45127" ) )
83:     };
84: 
85:     public final static UserType[] mockUsers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] THING_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private UserRegistrationUseCases userRegistrationUseCases;
135:     private ThingCatalogUseCases thingCatalogUseCases;
136:     private StockManagementUseCases stockManagementUseCases;
137:     private ShoppingCartUseCases shoppingCartUseCases;
138: 
139: 
140:     // thing 0 is out of stock, thing 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random stock between 5 and 100
142:     public static final Map<UUID, Integer> THING_STOCK = new HashMap<>();
143: 
144:     static {
145:         mockUsers = new UserType[USER_NAME.length];
146:         for ( int i = 0; i < USER_NAME.length; i++ ) {
147:             mockUsers[i] = new MockUser(
148:                     USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] thingData : THING_DATA ) {
152:             THING_STOCK.put( (UUID) thingData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         THING_STOCK.put( (UUID) THING_DATA[0][0], 0 );
155:         THING_STOCK.put( (UUID) THING_DATA[1][0], 10 );
156:         THING_STOCK.put( (UUID) THING_DATA[2][0], 20 );
157:         THING_STOCK.put( (UUID) THING_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             UserRegistrationUseCases userRegistrationUseCases,
181:             ThingCatalogUseCases thingCatalogUseCases,
182:             StockManagementUseCases stockManagementUseCases,
183:             ShoppingCartUseCases shoppingCartUseCases ) {
184:         this.userRegistrationUseCases = userRegistrationUseCases;
185:         this.thingCatalogUseCases = thingCatalogUseCases;
186:         this.stockManagementUseCases = stockManagementUseCases;
187:         this.shoppingCartUseCases = shoppingCartUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingCartUseCases.deleteAllOrders();
193:         thingCatalogUseCases.deleteThingCatalog();
194:         userRegistrationUseCases.deleteAllUsers();
195:     }
196: 
197: 
198:     public void registerAllUsers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.USER_NAME.length; i++ ) {
200:             registerUser( InitialMasterDataCreator.USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerUser( String name, MailAddressType mailAddress, PersonalAddressType personalAddress ) {
206:         userRegistrationUseCases.register( name, mailAddress, personalAddress );
207:     }
208: 
209:     public void addAllThings() {
210:         for ( Object[] thingData : THING_DATA ) {
211:             addThingDataToCatalog( thingData );
212:         }
213:     }
214: 
215:     public void addThingDataToCatalog( Object[] thingData ) {
216:         thingCatalogUseCases.addThingToCatalog( (UUID) thingData[0], (String) thingData[1], (String) thingData[2],
217:                 (Float) thingData[3], (MoneyType) thingData[4], (MoneyType) thingData[5] );
218:     }
219: 
220: 
221:     public Object[] getThingDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] thingData = THING_DATA[1];
223:         Object[] thingDataInvalid = new Object[thingData.length];
224:         System.arraycopy( thingData, 0, thingDataInvalid, 0, thingData.length );
225:         thingDataInvalid[index] = thingData[index].getClass().cast(
226:                 reason.getInvalidValue( thingData[index] ) );
227:         return thingDataInvalid;
228:     }
229: 
230: 
231:     public void stockUpAllThings() {
232:         for ( Object[] thingData : THING_DATA ) {
233:             if ( THING_STOCK.get( thingData[0] ) > 0 )
234:                 stockManagementUseCases.addToStock( (UUID) thingData[0], THING_STOCK.get( thingData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockUser.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.UserType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockUser implements UserType {
12:     private String name;
13:     private MailAddressType mailAddress;
14:     private PersonalAddressType personalAddress;
15: 
16: 
17:     public MockUser( String name, MailAddressType mailAddress, PersonalAddressType personalAddress) {
18:         this.name = name;
19:         this.mailAddress = mailAddress;
20:         this.personalAddress = personalAddress;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public MailAddressType getMailAddress() {
30:         return mailAddress;
31:     }
32: 
33:     @Override
34:     public PersonalAddressType getPersonalAddress() {
35:         return personalAddress;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockUser ) ) return false;
42:         MockUser that = (MockUser) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( mailAddress, that.mailAddress ) && Objects.equals( personalAddress, that.personalAddress );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), mailAddress, personalAddress );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllUsers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\core\domain\AbstractUser.java ---
1: package thkoeln.archilab.ecommerce.solution.core.domain;
2: 
3: import lombok.Getter;
4: import lombok.Setter;
5: import thkoeln.archilab.ecommerce.usecases.UserType;
6: 
7: import javax.persistence.Entity;
8: import javax.persistence.Id;
9: import java.util.UUID;
10: 
11: @Entity
12: @Getter
13: @Setter
14: public abstract class AbstractUser implements UserType {
15:     @Id
16:     final UUID id = UUID.randomUUID();
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryRecipientService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.UserType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: 
6: public interface DeliveryRecipientService {
7:     public UserType findUserByMail(MailAddressType userMailAddress);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
6: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
7: import thkoeln.archilab.ecommerce.solution.user.domain.User;
8: import thkoeln.archilab.ecommerce.usecases.UserType;
9: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
12: 
13: import java.util.HashMap;
14: import java.util.List;
15: import java.util.Map;
16: import java.util.UUID;
17: 
18: @Service
19: public class DeliveryService implements DeliveryUseCases {
20: 
21:     @Autowired
22:     private DeliveryRecipientService deliveryRecipientService;
23:     @Autowired
24:     private DeliveryRepository deliveryRepository;
25: 
26:     @Override
27:     public UUID triggerDelivery(UserType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
28:         if (deliveryRecipient == null) throw new ShopException("Delivery recipient is null");
29:         if (deliveryRecipient.getMailAddress() == null || deliveryRecipient.getName() == null ||
30:                 deliveryRecipient.getName().isBlank() || deliveryRecipient.getPersonalAddress() == null)
31:                     throw new ShopException("Content in delivery recipient is empty");
32:         int totalQuantity = 0;
33:         for (Integer quantity : deliveryContent.values()){
34:             totalQuantity += quantity;
35:             if (totalQuantity > 20) throw new ShopException("To many items");
36:         }
37:         Delivery delivery = new Delivery(
38:                 (User) deliveryRecipientService.findUserByMail(deliveryRecipient.getMailAddress()), deliveryContent);
39:         deliveryRepository.save(delivery);
40:         return delivery.getId();
41:     }
42: 
43:     @Override
44:     public Map<UUID, Integer> getDeliveryHistory(MailAddressType userMailAddress) {
45:         if (userMailAddress == null) throw new ShopException("User mail address is null");
46:         List<Delivery> userDeliveries =
47:                 deliveryRepository.findByDeliveryRecipient
48:                         ((User) deliveryRecipientService.findUserByMail(userMailAddress));
49:         Map<UUID, Integer> deliveryHistory = new HashMap<>();
50:         for (Delivery delivery : userDeliveries) {
51:             Map<UUID, Integer> deliveryContent = delivery.getDeliveryContent();
52:             for (Map.Entry<UUID, Integer> entry : deliveryContent.entrySet()){
53:                 if (deliveryHistory.containsKey(entry.getKey())){
54:                     deliveryHistory.replace(entry.getKey(), deliveryHistory.get(entry.getKey())+entry.getValue());
55:                     continue;
56:                 }
57:                 deliveryHistory.put(entry.getKey(), entry.getValue());
58:             }
59:         }
60:         return deliveryHistory;
61:     }
62: 
63:     @Override
64:     public void deleteDeliveryHistory() {
65:         deliveryRepository.deleteAll();
66:     }
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
8: 
9: import javax.persistence.ElementCollection;
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: import javax.persistence.ManyToOne;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: 
17: 
18: @Entity
19: @Getter
20: @Setter
21: @NoArgsConstructor(access = AccessLevel.PROTECTED)
22: public class Delivery {
23:     @Id
24:     final UUID id = UUID.randomUUID();
25: 
26:     @ManyToOne
27:     public AbstractUser deliveryRecipient;
28: 
29:     @ElementCollection
30:     Map<UUID, Integer> deliveryContent;
31: 
32:     public Delivery(AbstractUser deliveryRecipient, Map<UUID, Integer> deliveryContent){
33:         this.deliveryRecipient = deliveryRecipient;
34:         this.deliveryContent = deliveryContent;
35:     }
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
6: import java.util.List;
7: import java.util.UUID;
8: 
9: @Repository
10: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
11:     public List<Delivery> findByDeliveryRecipient(AbstractUser deliveryUser);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
10: 
11: import java.util.ArrayList;
12: import java.util.UUID;
13: 
14: @Setter
15: @Getter
16: @AllArgsConstructor
17: @NoArgsConstructor
18: public class OrderDTO {
19:     private UUID orderId;
20:     private MailAddress mailAddress;
21:     private Money price;
22:     private ArrayList<OrderPositionDTO> orderPositions;
23: }
24: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: 
10: @Setter
11: @Getter
12: @AllArgsConstructor
13: @NoArgsConstructor
14: public class OrderPositionDTO {
15:     private UUID thingId;
16:     private int quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.HttpStatus;
5: import org.springframework.http.ResponseEntity;
6: import org.springframework.web.bind.annotation.*;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
10: import java.util.ArrayList;
11: 
12: @RestController
13: public class OrderRESTController {
14:     private OrderService orderService;
15: 
16:     @Autowired
17:     public OrderRESTController(OrderService orderService){
18:         this.orderService = orderService;
19:     }
20: 
21:     @GetMapping(value = "/orders")
22:     @ResponseBody
23:     public ResponseEntity<ArrayList<OrderDTO>> getOrders(@RequestParam(required = false) String mailAddress,
24:                                                          @RequestParam(required = false) String filter){
25:         if (mailAddress == null || mailAddress.isEmpty())
26:             return ResponseEntity.ok().body(new ArrayList<>());
27:         try{
28:             MailAddress mailAddressObject = MailAddress.of(mailAddress);
29:             ArrayList<OrderDTO> userOrders = orderService.findByUserAsDTO(mailAddressObject);
30:             if ("latest".equals(filter)){
31:                 ArrayList<OrderDTO> latestOrder = new ArrayList<>();
32:                 if (userOrders.size() != 0) latestOrder.add(userOrders.get(userOrders.size()-1));
33:                 return ResponseEntity.ok().body(latestOrder);
34:             }
35:             return ResponseEntity.ok().body(userOrders);
36:         }catch(ShopException shopException){
37:             return ResponseEntity.ok().body(new ArrayList<>());
38:         }
39:     }
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
10: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
11: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
12: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
13: import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
14: import thkoeln.archilab.ecommerce.solution.user.domain.User;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
16: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
17: 
18: import java.util.*;
19: 
20: @Service
21: public class OrderService {
22:     @Autowired
23:     private OrderRepository orderRepository;
24:     @Autowired
25:     private ThingCatalogService thingCatalogService;
26:     @Autowired
27:     private OrderUserService orderUserService;
28: 
29:     public List<Order> findByUser(MailAddressType userMailAddress){
30:         return orderRepository.findByUser((User) orderUserService.findUserByMail(userMailAddress));
31:     }
32: 
33:     public ArrayList<OrderDTO> findByUserAsDTO(MailAddressType userMailAddress){
34:         try{
35:             orderUserService.findUserByMail(userMailAddress);
36:         }
37:         catch (ShopException shopException) {
38:             return new ArrayList<>();
39:         }
40:         Iterable<Order> foundUserOrders =
41:                 findByUser(userMailAddress);
42:         ArrayList<OrderDTO> foundDTOs = new ArrayList<>();
43:         ModelMapper modelMapper = new ModelMapper();
44:         for (Order order : foundUserOrders){
45:             Iterable<OrderPosition> orderPositions = order.getOrderPositions();
46:             OrderDTO dto = modelMapper.map(order, OrderDTO.class);
47:             dto.setMailAddress((MailAddress) order.getUser().getMailAddress());
48:             dto.setPrice((Money) getFullPrice(order));
49:             ArrayList<OrderPositionDTO> orderPositionDTOS = new ArrayList<>();
50:             for (OrderPosition op: orderPositions){
51:                 OrderPositionDTO orderPositionDTO = modelMapper.map(op, OrderPositionDTO.class);
52:                 orderPositionDTOS.add(orderPositionDTO);
53:             }
54:             dto.setOrderPositions(orderPositionDTOS);
55:             foundDTOs.add(dto);
56:         }
57:         return foundDTOs;
58:     }
59: 
60:     public Iterable<Order> findAll(){
61:         return orderRepository.findAll();
62:     }
63: 
64:     public ArrayList<OrderDTO> findAllAsDTO(){
65:         Iterable<Order> allOrders = findAll();
66:         ArrayList allDTOs = new ArrayList<OrderDTO>();
67:         ModelMapper modelMapper = new ModelMapper();
68:         for (Order order : allOrders){
69:             allDTOs.add(modelMapper.map(order, OrderDTO.class));
70:         }
71:         return allDTOs;
72:     }
73: 
74:     private MoneyType getFullPrice(Order order){
75:         MoneyType fullPrice = Money.of(0.0f, "EUR");
76:         for (OrderPosition op: order.getOrderPositions()) {
77:             fullPrice = fullPrice.add(op.getThing().getSellingPrice().multiplyBy(op.getQuantity()));
78:         }
79:         return fullPrice;
80:     }
81: 
82:     public Order initializeOrder(MailAddressType userMail){
83:         Order order = new Order((User) orderUserService.findUserByMail(userMail));
84:         orderRepository.save(order);
85:         return order;
86:     }
87: 
88:     public void addToOrder(Order order, UUID thingId, int quantity, String comment){
89:         order.getOrderPositions().add(
90:                 new OrderPosition(quantity,
91:                         thingCatalogService.findThingInCatalog(thingId),
92:                         comment));
93:         orderRepository.save(order);
94:     }
95: 
96:     public void deleteAll() {
97:         orderRepository.deleteAll();
98:     }
99: }
100: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.UserType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: 
6: public interface OrderUserService {
7:     public UserType findUserByMail(MailAddressType userMailAddress);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
8: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
9: import javax.persistence.*;
10: import java.util.HashSet;
11: import java.util.Set;
12: import java.util.UUID;
13: 
14: @Entity
15: @Getter
16: @Setter
17: @NoArgsConstructor(access = AccessLevel.PROTECTED)
18: @Table(name = "neuername")
19: public class Order {
20: 
21:     @Id
22:     final UUID id = UUID.randomUUID();
23: 
24:     @ManyToOne
25:     private AbstractUser user;
26: 
27:     @ElementCollection( targetClass = OrderPosition.class, fetch = FetchType.EAGER)
28:     private Set<OrderPosition> orderPositions = new HashSet<>();
29: 
30:     public void addOrderPosition(Thing thing, int quantity, String comment){
31:         orderPositions.add(new OrderPosition(quantity, thing, comment));
32:     }
33: 
34:     public Order(AbstractUser user){
35:         this.user = user;
36:         this.orderPositions = new HashSet<OrderPosition>();
37:     }
38: 
39: }
40: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.*;
4: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
5: 
6: import javax.persistence.Embeddable;
7: import javax.persistence.OneToOne;
8: import java.util.UUID;
9: 
10: @Embeddable
11: @Getter
12: @AllArgsConstructor
13: @NoArgsConstructor(access = AccessLevel.PROTECTED)
14: public class OrderPosition {
15: 
16:     private int quantity;
17: 
18:     @OneToOne
19:     private Thing thing;
20: 
21:     private String comment;
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
6: import java.util.List;
7: import java.util.UUID;
8: 
9: @Repository
10: public interface OrderRepository extends CrudRepository<Order, UUID> {
11:     public List<Order> findByUser(AbstractUser user);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
7: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
8: import thkoeln.archilab.ecommerce.solution.user.domain.User;
9: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import java.util.List;
15: import java.util.UUID;
16: 
17: @Service
18: public class PaymentService implements PaymentUseCases {
19:     @Autowired
20:     private PaymentUserService paymentUserService;
21:     @Autowired
22:     private PaymentRepository paymentRepository;
23: 
24: 
25:     @Override
26:     public UUID authorizePayment(MailAddressType userMailAddress, MoneyType amount) {
27:         if (userMailAddress == null) throw new ShopException("Mail is empty");
28:         if (amount == null || amount.getAmount() <= 0.00)throw new ShopException("Amount must not be 0 or lower");
29:         if (amount.getAmount() > 500.00)throw new ShopException("Amount is over the limit");
30:         Payment payment = new Payment(
31:                 (User) paymentUserService.findUserByMail(userMailAddress), (Money) amount);
32:         paymentRepository.save(payment);
33:         return payment.getId();
34:     }
35: 
36:     @Override
37:     public MoneyType getPaymentTotal(MailAddressType userMailAddress) {
38:         if (userMailAddress == null)
39:             throw new ShopException("User mail address is null or empty");
40:         List<Payment> userPayments =
41:                 paymentRepository.findByDeliveryRecipient(
42:                         (User) paymentUserService.findUserByMail(userMailAddress));
43:         if (userPayments.isEmpty()) return null;
44:         MoneyType total = Money.of(0.00F, userPayments.get(0).getAmount().getCurrency());
45:         for (Payment userPayment : userPayments){
46:             total = total.add(userPayment.getAmount());
47:         }
48:         return total;
49:     }
50: 
51:     @Override
52:     public void deletePaymentHistory() {
53:         paymentRepository.deleteAll();
54:     }
55: }
56: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.UserType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: 
6: public interface PaymentUserService {
7:     public UserType findUserByMail(MailAddressType userMailAddress);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: import javax.persistence.ManyToOne;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @Setter
18: @NoArgsConstructor(access = AccessLevel.PROTECTED)
19: public class Payment {
20: 
21:     @Id
22:     final UUID id = UUID.randomUUID();
23: 
24:     @ManyToOne
25:     private AbstractUser deliveryRecipient;
26: 
27:     private Money amount;
28: 
29:     public Payment(AbstractUser deliveryRecipient, Money amount){
30:         this.deliveryRecipient = deliveryRecipient;
31:         this.amount = amount;
32:     }
33: }
34: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
6: import java.util.List;
7: import java.util.UUID;
8: 
9: @Repository
10: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
11:     public List<Payment> findByDeliveryRecipient(AbstractUser deliveryUser);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartAppService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPositionRepository;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
9: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
10: import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
11: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
13: 
14: import java.util.List;
15: import java.util.Map;
16: import java.util.UUID;
17: @Service
18: public class ShoppingCartAppService {
19:     @Autowired
20:     public ShoppingCartService shoppingCartService;
21:     @Autowired
22:     public ShoppingCartRepository shoppingCartRepository;
23:     @Autowired
24:     public CartPositionRepository cartPositionRepository;
25:     @Autowired
26:     private ThingCatalogService thingCatalogService;
27: 
28:     public ShoppingCart findById(UUID shoppingCartId){
29:         if (shoppingCartId == null || shoppingCartRepository.findById(shoppingCartId).isEmpty()){
30:             throw new ShopException("ShoppingCart id does not exists");
31:         }
32:         return shoppingCartRepository.findById(shoppingCartId).get();
33:     }
34: 
35:     public Integer getTotalQuantityOfOneCar(MailAddressType mailAddress){
36:         Map<UUID, Integer> things = shoppingCartService.getShoppingCartAsMap(mailAddress);
37:         Integer totalquantity = 0;
38:         for (Integer quantity : things.values()) {
39:             totalquantity += quantity;
40:         }
41:         return totalquantity;
42:     }
43: 
44:     public CartPosition getCartPositionOfThing(ShoppingCart shoppingCart, UUID thingId){
45:         Thing thing= thingCatalogService.findThingInCatalog(thingId);
46:         List<CartPosition> cartPositions = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
47:         if(cartPositions.size()==0)throw new ShopException("Thing is not in your Cart!");
48:         return cartPositions.get(0);
49:     }
50: 
51:     public void deleteCartPositionOfThing(ShoppingCart shoppingCart, UUID thingId){
52:         CartPosition cartPosition = getCartPositionOfThing(shoppingCart, thingId);
53:         shoppingCartService.removeThingFromShoppingCart(shoppingCart.getUser().getMailAddress(),
54:                                                         thingId,
55:                                                         cartPosition.getQuantity());
56:         cartPositionRepository.delete(cartPosition);
57:     }
58: }
59: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
8: 
9: import java.util.UUID;
10: 
11: @Setter
12: @Getter
13: @AllArgsConstructor
14: @NoArgsConstructor
15: public class ShoppingCartDTO {
16:     private UUID id;
17:     private MailAddress mailAddress;
18:     private Integer totalQuantity;
19: }
20: 
21: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDTOMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
8: import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
10: 
11: import java.util.UUID;
12: 
13: @Service
14: public class ShoppingCartDTOMapperService {
15:     @Autowired
16:     public ShoppingCartService shoppingCartService;
17:     @Autowired
18:     public ShoppingCartAppService shoppingCartAppService;
19:     @Autowired
20:     public ThingCatalogService thingCatalogService;
21:     public ShoppingCartDTO findByIdAsDTO(UUID shoppingCartId){
22:         ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
23:         ModelMapper modelMapper = new ModelMapper();
24:         return modelMapper.map(shoppingCart, ShoppingCartDTO.class);
25:     }
26: 
27:     public ShoppingCartDTO findShoppingCartByUserAsDTO(MailAddressType mailAddressType){
28:         ShoppingCart shoppingCart = shoppingCartService.findShoppingCartByUser(mailAddressType);
29:         ModelMapper modelMapper = new ModelMapper();
30:         ShoppingCartDTO dto = modelMapper.map(shoppingCart, ShoppingCartDTO.class);
31:         dto.setTotalQuantity(shoppingCartAppService.getTotalQuantityOfOneCar(mailAddressType));
32:         return dto;
33:     }
34: 
35:     public ShoppingCartPositionDTO getCartPositionAsDTO(ShoppingCart shoppingCart, UUID thingId){
36:         CartPosition cartPosition = shoppingCartAppService.getCartPositionOfThing(shoppingCart, thingId);
37:         ModelMapper modelMapper = new ModelMapper();
38:         return modelMapper.map(cartPosition, ShoppingCartPositionDTO.class);
39:     }
40: 
41:     public CartPosition getDTOAsCartPosition(ShoppingCartPositionDTO dto){
42:         ModelMapper modelMapper = new ModelMapper();
43:         CartPosition cartPosition = modelMapper.map(dto, CartPosition.class);
44:         cartPosition.setThing(thingCatalogService.findThingInCatalog(dto.getThingId()));
45:         return cartPosition;
46:     }
47: }
48: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: 
10: @Getter
11: @Setter
12: @AllArgsConstructor
13: @NoArgsConstructor
14: public class ShoppingCartPositionDTO {
15:     private UUID thingId;
16:     private Integer quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.junit.platform.commons.function.Try;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.dao.DataIntegrityViolationException;
6: import org.springframework.http.HttpStatus;
7: import org.springframework.http.ResponseEntity;
8: import org.springframework.web.bind.annotation.*;
9: import org.springframework.web.util.NestedServletException;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
12: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
13: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
14: import thkoeln.archilab.ecommerce.solution.user.application.UserService;
15: import thkoeln.archilab.ecommerce.solution.user.domain.User;
16: 
17: import javax.transaction.Transactional;
18: import java.util.UUID;
19: 
20: @RestController
21: @Transactional
22: public class ShoppingCartRESTController {
23:     private ShoppingCartService shoppingCartService;
24:     private ShoppingCartDTOMapperService shoppingCartDTOMapperService;
25:     private ShoppingCartAppService shoppingCartAppService;
26: 
27:     private UserService userService;
28: 
29:     @Autowired
30:     public ShoppingCartRESTController
31:             (ShoppingCartService shoppingCartService,
32:              ShoppingCartDTOMapperService shoppingCartDTOMapperService,
33:              ShoppingCartAppService shoppingCartAppService,
34:              UserService userService){
35:         this.shoppingCartService = shoppingCartService;
36:         this.shoppingCartDTOMapperService = shoppingCartDTOMapperService;
37:         this.shoppingCartAppService = shoppingCartAppService;
38:         this.userService = userService;
39:     }
40: 
41:     @GetMapping("/shoppingCarts")
42:     @ResponseBody
43:     public ResponseEntity<ShoppingCartDTO> getShoppingCartByUserMail(
44:             @RequestParam String mailAddress
45:     ){
46:         ShoppingCartDTO shoppingCartDTO;
47:         try {
48:             MailAddress mailAddressObject = MailAddress.of(mailAddress);
49:             shoppingCartDTO = shoppingCartDTOMapperService.findShoppingCartByUserAsDTO(mailAddressObject);
50:         } catch (ShopException shopException){
51:             return new ResponseEntity<>(HttpStatus.NOT_FOUND);
52:         }
53:         return ResponseEntity.ok().body(shoppingCartDTO);
54:     }
55: 
56:     @PostMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions")
57:     public ResponseEntity addShoppingCartPosition(@PathVariable UUID shoppingCartId,
58:                                                   @RequestBody ShoppingCartPositionDTO shoppingCartPositionDTO){
59:         ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
60:         CartPosition cartPosition = shoppingCartDTOMapperService.getDTOAsCartPosition(shoppingCartPositionDTO);
61: 
62:         if (cartPosition.getQuantity() < 0){
63:             CartPosition shoppingCartPosition = shoppingCartAppService.getCartPositionOfThing(
64:                     shoppingCart, cartPosition.getThing().getId());
65:             shoppingCartPosition.setComment(cartPosition.getComment());
66:             try {
67:                 shoppingCartService.removeThingFromShoppingCart(
68:                         shoppingCart.getUser().getMailAddress(),
69:                         cartPosition.getThing().getId(),
70:                         Math.abs(cartPosition.getQuantity()));
71:             }
72:             catch (ShopException shopException){
73:                 return new ResponseEntity<>(HttpStatus.CONFLICT);
74:             }
75: //            shoppingCartService.removeThingFromShoppingCart(
76: //                    shoppingCart.getUser().getMailAddress(),
77: //                    cartPosition.getThing().getId(),
78: //                    Math.abs(cartPosition.getQuantity()));
79:             if (shoppingCartAppService.getCartPositionOfThing(
80:                     shoppingCart, cartPosition.getThing().getId())
81:                     .getQuantity() == 0){
82:                 shoppingCartAppService.deleteCartPositionOfThing(shoppingCart, cartPosition.getThing().getId());
83:             }
84:             return new ResponseEntity(HttpStatus.CREATED);
85:         }
86:         try {
87:             shoppingCartService.addThingToShoppingCart(
88:                     shoppingCart.getUser().getMailAddress(),
89:                     cartPosition.getThing().getId(),
90:                     cartPosition.getQuantity());
91:         } catch (ShopException shopException){
92:             return new ResponseEntity<>(HttpStatus.CONFLICT);
93:         }
94:         CartPosition newCartPosition = shoppingCartAppService.getCartPositionOfThing(shoppingCart, cartPosition.getThing().getId());
95:         newCartPosition.setComment(cartPosition.getComment());
96:         return new ResponseEntity(HttpStatus.CREATED);
97:     }
98: 
99:     @DeleteMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions/{thingId}")
100:     public ResponseEntity deleteShoppingCartPositionForThing(@PathVariable UUID shoppingCartId,
101:                                                              @PathVariable UUID thingId){
102:         try{
103:             ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
104:             shoppingCartAppService.deleteCartPositionOfThing(shoppingCart, thingId);
105:         }catch (ShopException shopException){
106:             return new ResponseEntity(HttpStatus.NOT_FOUND);
107:         }
108:         return new ResponseEntity(HttpStatus.OK);
109:     }
110: 
111:     @GetMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions/{thingId}")
112:     public ResponseEntity<ShoppingCartPositionDTO> getShoppingCartPosition(@PathVariable UUID shoppingCartId,
113:                                                                            @PathVariable UUID thingId){
114:         try{
115:             ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
116:             ShoppingCartPositionDTO shoppingCartPositionDTO = shoppingCartDTOMapperService.getCartPositionAsDTO(
117:                     shoppingCart, thingId
118:             );
119:         }catch (ShopException shopException){
120:             return new ResponseEntity(HttpStatus.NOT_FOUND);
121:         }
122:         ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
123:         ShoppingCartPositionDTO shoppingCartPositionDTO = shoppingCartDTOMapperService.getCartPositionAsDTO(
124:                 shoppingCart, thingId
125:         );
126:         if (shoppingCartPositionDTO != null) {
127:             return ResponseEntity.ok().body(shoppingCartPositionDTO);
128:         } else {
129:             return ResponseEntity.notFound().build();
130:         }
131:     }
132: 
133:     @PutMapping("/shoppingCarts/{shoppingCartId}/checkout")
134:     public ResponseEntity shoppingCartCheckout(@PathVariable UUID shoppingCartId){
135:         try{
136:             ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
137:         }catch (ShopException shopException){
138:             return new ResponseEntity(HttpStatus.NOT_FOUND);
139:         }
140:         try{
141:             ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
142:             shoppingCartService.checkout(shoppingCart.getUser().getMailAddress());
143:         }catch (ShopException shopException){
144:             return new ResponseEntity(HttpStatus.CONFLICT);
145:         }
146: 
147:         return new ResponseEntity(HttpStatus.OK);
148:     }
149: }
150: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
9: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
10: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
11: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
12: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
13: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;
14: import thkoeln.archilab.ecommerce.solution.thing.application.ShoppingCartCorrections;
15: import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
16: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
17: import thkoeln.archilab.ecommerce.solution.user.application.ShoppingCartFactory;
18: import thkoeln.archilab.ecommerce.solution.user.application.UserService;
19: import thkoeln.archilab.ecommerce.solution.user.domain.User;
20: import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
21: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
22: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
23: 
24: import java.util.*;
25: 
26: @Service
27: public class ShoppingCartService implements ShoppingCartUseCases, ShoppingCartFactory,
28:                                             ShoppingCartCorrections {
29: 
30:     @Autowired
31:     private ShoppingCartRepository shoppingCartRepository;
32:     @Autowired
33:     private UserService userService;
34:     @Autowired
35:     private ThingCatalogService thingCatalogService;
36:     @Autowired
37:     private OrderService orderService;
38:     @Autowired
39:     private CartPositionRepository cartPositionRepository;
40:     @Autowired
41:     private DeliveryService deliveryService;
42:     @Autowired
43:     private PaymentService paymentService;
44: 
45:     public ShoppingCart findShoppingCartByUser(MailAddressType mailAddress){
46:         return shoppingCartRepository.findByUser((User) userService.findUserByMail(mailAddress));
47:     }
48: 
49:     private void quantityCheck(int quantity) {
50:         if (quantity < 0) throw new ShopException("Quantity must not be negative");
51:     }
52: 
53:     private void authorizePayment(MailAddressType userMailAddress){
54:         shoppingCartRepository.findByUser((User)userService.findUserByMail(userMailAddress)).setPaymentAuthorized(true);
55:     }
56: 
57:     private void triggerDelivery(MailAddressType userMailAddress){
58:         shoppingCartRepository.findByUser((User)userService.findUserByMail(userMailAddress)).setDeliveryTriggered(true);
59:     }
60: 
61:     @Override
62:     public void createShoppingCart(MailAddressType userMailAddress) {
63:         ShoppingCart shoppingCart = new ShoppingCart((User) userService.findUserByMail(userMailAddress));
64:         shoppingCart.setStatus(ShoppingCartFillingStatus.EMPTY);
65:         shoppingCartRepository.save(shoppingCart);
66:     }
67: 
68:     @Override
69:     public void deleteAllCarts() {
70:         shoppingCartRepository.deleteAll();
71:     }
72: 
73:     @Override
74:     public void removeStockCartCorrection(UUID thingId, Integer removedQuantity) {
75:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
76:         List<CartPosition> cartPositionList = cartPositionRepository.findByThing(thing);
77:         int remainingQuantity = removedQuantity-thing.getStockQuantity();
78:         while (remainingQuantity != 0){
79:             for (CartPosition cP : cartPositionList){
80:                 ShoppingCart sC = cP.getShoppingCart();
81:                 int cPQuantity = cP.getQuantity();
82:                 if (cPQuantity == 0)continue;
83:                 if (cPQuantity >= remainingQuantity){
84:                     cP.setQuantity(cPQuantity-remainingQuantity);
85:                     thing.removeFromStock(remainingQuantity);
86:                     thing.removeReservation(remainingQuantity);
87:                     remainingQuantity = 0;
88:                     cartPositionRepository.save(cP);
89:                     thingCatalogService.saveChanges(thingId);
90:                     break;
91:                 }
92:                 cP.setQuantity(0);
93:                 thing.removeFromStock(cPQuantity);
94:                 thing.removeReservation(cPQuantity);
95:                 cartPositionRepository.save(cP);
96:                 thingCatalogService.saveChanges(thingId);
97:                 remainingQuantity -= cPQuantity;
98:             }
99:         }
100:     }
101: 
102:     @Override
103:     public void changeStockCartCorrection(UUID thingId, Integer newTotalQuantity) {
104:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
105:         int diff = thing.getReservedQuantity()-newTotalQuantity;
106:         List<CartPosition> cartPositionList = cartPositionRepository.findByThing(thing);
107:         while(diff != 0){
108:             for (CartPosition cP : cartPositionList){
109:                 ShoppingCart sC = cP.getShoppingCart();
110:                 int cPQuantity = cP.getQuantity();
111:                 if (cPQuantity == 0)continue;
112:                 if (cPQuantity >= diff){
113:                     cP.setQuantity(cPQuantity-diff);
114:                     thing.removeReservation(diff);
115:                     diff = 0;
116:                     cartPositionRepository.save(cP);
117:                     thingCatalogService.saveChanges(thingId);
118:                     break;
119:                 }
120:                 cP.setQuantity(0);
121:                 thing.removeFromStock(cPQuantity);
122:                 thing.removeReservation(cPQuantity);
123:                 cartPositionRepository.save(cP);
124:                 thingCatalogService.saveChanges(thingId);
125:                 diff -= cPQuantity;
126:             }
127:         }
128:         thing.setStockQuantity(0);
129:         thingCatalogService.saveChanges(thingId);
130:     }
131: 
132: 
133:     @Override
134:     public void addThingToShoppingCart(MailAddressType userMailAddress, UUID thingId, int quantity) {
135:         User user = (User) userService.findUserByMail(userMailAddress);
136:         quantityCheck(quantity);
137:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
138:         if (thing.getStockQuantity() < quantity){
139:             throw new ShopException("the thing is not available in the requested quantity");
140:         }
141:         ShoppingCart shoppingCart = shoppingCartRepository.findByUser(user);
142:         if(cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing).isEmpty()){
143:             CartPosition cartPosition = new CartPosition(thing, quantity, shoppingCart);
144:             cartPositionRepository.save(cartPosition);
145:         }else{
146:             List<CartPosition> cartPositions = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
147:             CartPosition cartPosition = cartPositions.get(0);
148:             cartPosition.setQuantity(cartPosition.getQuantity()+quantity);
149:             cartPositionRepository.save(cartPosition);
150:         }
151:         shoppingCart.setStatus(ShoppingCartFillingStatus.FILLED);
152:         thing.reserve(quantity);
153:     }
154: 
155:     @Override
156:     public void removeThingFromShoppingCart(MailAddressType userMailAddress, UUID thingId, int quantity) {
157:         quantityCheck(quantity);
158:         User user = (User) userService.findUserByMail(userMailAddress);
159:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
160:         if (cartPositionRepository.findByShoppingCartAndThing(shoppingCartRepository.findByUser(user), thing).isEmpty())
161:             throw new ShopException("The thing is not in your cart");
162:         List<CartPosition>cartPositionList =
163:                 cartPositionRepository.findByShoppingCartAndThing(shoppingCartRepository.findByUser(user), thing);
164:         if (cartPositionList.get(0).getQuantity() < quantity){
165:             throw new ShopException("So many things are not in your cart");
166:         }if (quantity == cartPositionList.get(0).getQuantity()) cartPositionList.get(0).setQuantity(0);
167:         else cartPositionList.get(0).setQuantity(cartPositionList.get(0).getQuantity()-quantity);
168:         cartPositionRepository.save(cartPositionList.get(0));
169:         if (cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user)).isEmpty())
170:             shoppingCartRepository.findByUser(user).setStatus(ShoppingCartFillingStatus.EMPTY);
171:         shoppingCartRepository.save(shoppingCartRepository.findByUser(user));
172:         thing.removeReservation(quantity);
173:     }
174: 
175:     @Override
176:     public void setCommentForShoppingCartPosition(MailAddressType userMailAddress, UUID thingId, String comment) {
177:         ShoppingCart shoppingCart =
178:                 shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
179:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
180:         List<CartPosition> cartPositionList = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
181:         if (cartPositionList.isEmpty() || cartPositionList.get(0).getQuantity() == 0)
182:             throw new ShopException("Thing is not in shopping cart!");
183:         cartPositionList.get(0).setComment(comment);
184:     }
185: 
186:     @Override
187:     public String getCommentForShoppingCartPosition(MailAddressType userMailAddress, UUID thingId) {
188:         ShoppingCart shoppingCart =
189:                 shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
190:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
191:         List<CartPosition> cartPositionList = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
192:         if (cartPositionList.isEmpty() || cartPositionList.get(0).getQuantity() == 0)
193:             throw new ShopException("Thing is not in shopping cart!");
194:         return cartPositionList.get(0).getComment();
195:     }
196: 
197:     @Override
198:     public Map<UUID, Integer> getShoppingCartAsMap(MailAddressType userMailAddress) {
199:         User user = (User) userService.findUserByMail(userMailAddress);
200:         List<CartPosition>cartPositionList =
201:                 cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
202:         HashMap<UUID, Integer> things = new HashMap<>();
203:         for(CartPosition c: cartPositionList){
204:             things.put(c.getThing().getId(), c.getQuantity());
205:         }
206:         return things;
207:     }
208: 
209:     @Override
210:     public MoneyType getShoppingCartAsMoneyValue(MailAddressType userMailAddress) {
211:         User user = (User) userService.findUserByMail(userMailAddress);
212:         List<CartPosition>cartPositionList =
213:                 cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
214:         MoneyType value = Money.of(0.00F, cartPositionList.get(0).getThing().getSellingPrice().getCurrency());
215:         for (CartPosition c: cartPositionList){
216:             value = value.add(c.getThing().getSellingPrice().multiplyBy(c.getQuantity()));
217:         }
218:         return value;
219:     }
220: 
221:     @Override
222:     public int getReservedStockInShoppingCarts(UUID thingId) {
223:         Thing thing = thingCatalogService.findThingInCatalog(thingId);
224:         return thing.getReservedQuantity();
225:     }
226: 
227:     @Override
228:     public boolean isEmpty(MailAddressType userMailAddress) {
229:         ShoppingCart shoppingCart =
230:                 shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
231:         return shoppingCart.getStatus().equals(ShoppingCartFillingStatus.EMPTY);
232:     }
233: 
234:     @Override
235:     public boolean isPaymentAuthorized(MailAddressType userMailAddress) {
236:         ShoppingCart shoppingCart = shoppingCartRepository.findByUser
237:                 ((User) userService.findUserByMail(userMailAddress));
238:         return shoppingCart.paymentAuthorized;
239:     }
240: 
241:     private Map<UUID, Integer> areCartPositionsEmpty(MailAddress userMailAddress){
242:         int temp = 0;
243:         HashMap<UUID, Integer> cartPositions = (HashMap<UUID, Integer>) getShoppingCartAsMap(userMailAddress);
244:         for (int quantity : cartPositions.values()){
245:             if (quantity == 0){
246:                 temp++;
247:                 if (temp == cartPositions.size()) throw new ShopException("Error");
248:             }else break;
249:         }
250:         return cartPositions;
251:     }
252: 
253:     @Override
254:     public void checkout(MailAddressType userMailAddress) {
255:         User user = (User) userService.findUserByMail(userMailAddress);
256:         if (isEmpty(userMailAddress)){
257:             throw new ShopException("Cart is empty!");
258:         }
259:         List<CartPosition> cartPositions =
260:                 cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
261:         paymentService.authorizePayment(userMailAddress, getShoppingCartAsMoneyValue(userMailAddress));
262:         authorizePayment(userMailAddress);
263:         deliveryService.triggerDelivery(user, getShoppingCartAsMap(userMailAddress));
264:         triggerDelivery(userMailAddress);
265:         cartPositionRepository.deleteAll(
266:                 cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user)));
267:         emptyCart(userMailAddress);
268:         Order order = orderService.initializeOrder(userMailAddress);
269:         for (CartPosition cp:cartPositions){
270:             orderService.addToOrder(order, cp.getThing().getId(), cp.getQuantity(), cp.getComment());
271:         }
272:     }
273: 
274:     @Override
275:     public Map<UUID, Integer> getOrderHistory(MailAddressType userMailAddress) {
276:         userService.findUserByMail(userMailAddress);
277:         HashMap<UUID, Integer> orderHistory = new HashMap<>();
278:         List<Order>orders = orderService.findByUser(userMailAddress);
279:         Set<OrderPosition> orderPositions = new HashSet<>();
280:         for (Order order : orders){
281:             orderPositions.addAll(order.getOrderPositions());
282:         }
283:         for (OrderPosition oP: orderPositions) {
284:             if (orderHistory.containsKey(oP.getThing().getId())){
285:                 int oldValue = orderHistory.get(oP.getThing().getId());
286:                 orderHistory.replace(oP.getThing().getId(), oldValue+oP.getQuantity());
287:                 continue;
288:             }
289:             orderHistory.put(oP.getThing().getId(), oP.getQuantity());
290:         }
291:         return orderHistory;
292:     }
293: 
294:     private void emptyCart(MailAddressType userMailAddress){
295:         ShoppingCart shoppingCart =
296:                 shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
297:         shoppingCart.setStatus(ShoppingCartFillingStatus.EMPTY);
298:         shoppingCart.setPaymentAuthorized(false);
299:         shoppingCart.setDeliveryTriggered(false);
300:         shoppingCartRepository.save(shoppingCart);
301:     }
302: 
303:     @Override
304:     public void deleteAllOrders() {
305:         shoppingCartRepository.deleteAll();
306:         cartPositionRepository.deleteAll();
307:         orderService.deleteAll();
308:     }
309: }
310: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\CartPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: 
4: import lombok.AccessLevel;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import lombok.Setter;
8: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: import javax.persistence.ManyToOne;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @Setter
18: @NoArgsConstructor(access = AccessLevel.PROTECTED)
19: public class CartPosition {
20: 
21:     @Id
22:     final UUID id = UUID.randomUUID();
23: 
24:     private int quantity;
25: 
26:     @ManyToOne
27:     private ShoppingCart shoppingCart;
28: 
29:     @ManyToOne
30:     private Thing thing;
31: 
32:     private String comment;
33: 
34:     public CartPosition(Thing thing, int quantity, ShoppingCart shoppingCart) {
35:         this.thing = thing;
36:         this.quantity = quantity;
37:         this.shoppingCart = shoppingCart;
38:     }
39: 
40: 
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\CartPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
6: 
7: import java.util.List;
8: import java.util.UUID;
9: 
10: @Repository
11: public interface CartPositionRepository extends CrudRepository<CartPosition, UUID> {
12:     public List<CartPosition> findByThing(Thing thing);
13:     public List<CartPosition> findByShoppingCart(ShoppingCart shoppingCart);
14:     public List<CartPosition> findByShoppingCartAndThing(ShoppingCart shoppingCart, Thing thing);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: 
4: import lombok.AccessLevel;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import lombok.Setter;
8: import thkoeln.archilab.ecommerce.solution.user.domain.User;
9: 
10: import javax.persistence.*;
11: import java.util.*;
12: 
13: @Entity
14: @Getter
15: @Setter
16: @NoArgsConstructor(access = AccessLevel.PROTECTED)
17: public class ShoppingCart {
18:     @Id
19:     final UUID id = UUID.randomUUID();
20: 
21:     @OneToOne
22:     private User user;
23: 
24:     @Enumerated(EnumType.STRING)
25:     private ShoppingCartFillingStatus status;
26: 
27:     public boolean paymentAuthorized = false;
28: 
29:     public boolean deliveryTriggered = false;
30: 
31:     private int totalQuantity;
32: 
33:     public ShoppingCart(User user){
34:         this.user = user;
35:     }
36: 
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartFillingStatus.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: public enum ShoppingCartFillingStatus {
4:     EMPTY, FILLED
5: }
6: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.user.domain.User;
6: 
7: 
8: import java.util.UUID;
9: 
10: @Repository
11: public interface ShoppingCartRepository extends CrudRepository<ShoppingCart, UUID> {
12:     public ShoppingCart findByUser(User user);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\ShoppingCartCorrections.java ---
1: package thkoeln.archilab.ecommerce.solution.thing.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ShoppingCartCorrections {
6:     public void removeStockCartCorrection (UUID thingId, Integer removedQuantity);
7:     public void changeStockCartCorrection (UUID thingId, Integer newTotalQuantity);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\StockManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.thing.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
6: import thkoeln.archilab.ecommerce.solution.thing.domain.ThingRepository;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: import java.util.UUID;
10: 
11: @Service
12: public class StockManagementService implements StockManagementUseCases {
13:     @Autowired
14:     private ThingRepository thingRepository;
15:     @Autowired
16:     private ShoppingCartCorrections shoppingCartCorrections;
17: 
18:     public void thingIdCheck(UUID thingId){
19:         if (thingRepository.findById(thingId).isEmpty()) throw new ShopException("Thing does not exists");
20:     }
21: 
22:     @Override
23:     public void addToStock(UUID thingId, int addedQuantity) {
24:         thingIdCheck(thingId);
25:         if(addedQuantity <= 0){
26:             throw new ShopException("Added quantity must not be negative!");
27:         }
28:         Thing thing = thingRepository.findById(thingId).get();
29:         thing.addToStock(addedQuantity);
30:     }
31: 
32:     @Override
33:     public void removeFromStock(UUID thingId, int removedQuantity) {
34:         thingIdCheck(thingId);
35:         Thing thing = thingRepository.findById(thingId).get();
36:         if(removedQuantity <= 0){
37:             throw new ShopException("Removed quantity must not be negative!");
38:         }
39:         if (thing.getStockQuantity()+thing.getReservedQuantity() < removedQuantity){
40:             throw new ShopException("Stock quantity too low!");
41:         }
42:         if (thing.getStockQuantity() < removedQuantity){
43:             shoppingCartCorrections.removeStockCartCorrection(thingId, removedQuantity);
44:         }
45:         thing.removeFromStock(removedQuantity);
46:     }
47: 
48:     @Override
49:     public void changeStockTo(UUID thingId, int newTotalQuantity) {
50:         thingIdCheck(thingId);
51:         Thing thing = thingRepository.findById(thingId).get();
52:         if(newTotalQuantity < 0){
53:             throw new ShopException("New total quantity must not be negative!");
54:         }
55:         if (thing.getReservedQuantity() > newTotalQuantity){
56:             shoppingCartCorrections.changeStockCartCorrection(thingId, newTotalQuantity);
57:         }
58:         else {
59:             thing.setStockQuantity(newTotalQuantity-thing.getReservedQuantity());
60:             thingRepository.save(thing);
61:         }
62: 
63:     }
64: 
65:     @Override
66:     public int getAvailableStock(UUID thingId) {
67:         thingIdCheck(thingId);
68:         return thingRepository.findById(thingId).get().getStockQuantity();
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\ThingCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.thing.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
7: import thkoeln.archilab.ecommerce.solution.thing.domain.ThingRepository;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.usecases.ThingCatalogUseCases;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.UUID;
13: 
14: @Service
15: public class ThingCatalogService implements ThingCatalogUseCases {
16:     @Autowired
17:     private ThingRepository thingRepository;
18: 
19:     public Thing findThingInCatalog(UUID thingId){
20:         if (thingId == null || thingRepository.findById(thingId).isEmpty()){
21:             throw new ShopException("Thing id does not exists");
22:         }
23: 
24:         return thingRepository.findById(thingId).get();
25:     }
26: 
27:     @Override
28:     public void addThingToCatalog(UUID thingId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellingPrice) {
29:         if (thingId == null){
30:             throw new ShopException("Invalid id");
31:         }
32:         if (thingRepository.findById(thingId).isPresent()){
33:             throw new ShopException("Id is already taken!");
34:         }
35:         if ( name == null  || name.isEmpty() || description == null || description.isEmpty()){
36:             throw new ShopException("Invalid data in name or description");
37:         }
38:         if (purchasePrice == null || purchasePrice.getAmount() <= 0.0){
39:             throw new ShopException("Invalid purchase price");
40:         }
41:         if (sellingPrice == null || sellingPrice.getAmount() <= 0.0 || purchasePrice.largerThan(sellingPrice)){
42:             throw new ShopException("Invalid selling price");
43:         }
44:         if (size == null){
45:             Thing thing = new Thing(thingId, name, description, (Money) purchasePrice, (Money) sellingPrice);
46:             thingRepository.save(thing);
47:         }
48:         else{
49:             if (size <= 0){
50:                 throw new ShopException("Invalid size");
51:             }
52:             Thing thing = new Thing(thingId, name, description, size, (Money) purchasePrice, (Money) sellingPrice);
53:             thingRepository.save(thing);
54:         }
55:     }
56: 
57:     @Override
58:     public void removeThingFromCatalog(UUID thingId) {
59:         Thing thing = findThingInCatalog(thingId);
60:         if (thing.getStockQuantity() > 0){
61:             throw new ShopException("Thing is still in stock");
62:         }
63:         if (thingRepository.findById(thingId).get().getReservedQuantity() > 0){
64:             throw new ShopException("Thing is currently reserved");
65:         }
66:         
67:         thingRepository.delete(thing);
68:     }
69: 
70:     @Override
71:     public MoneyType getSellingPrice(UUID thingId) {
72:         if (thingRepository.findById(thingId).isEmpty()){
73:             throw new ShopException("Thing id does not exists");
74:         }
75: 
76:         Thing thing = thingRepository.findById(thingId).get();
77:         return thing.getSellingPrice();
78:     }
79: 
80:     public void saveChanges(UUID thingId){
81:         thingRepository.save(findThingInCatalog(thingId));
82:     }
83: 
84:     @Override
85:     public void deleteThingCatalog() {
86:         thingRepository.deleteAll();
87:     }
88: }
89: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\domain\Thing.java ---
1: package thkoeln.archilab.ecommerce.solution.thing.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import javax.persistence.*;
10: 
11: import java.util.UUID;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor(access = AccessLevel.PROTECTED)
16: public class Thing {
17: 
18: 
19:     @Id
20:     private UUID id;
21:     @Setter
22:     private String name;
23:     @Setter
24:     private String description;
25:     @Setter
26:     private float size;
27:     @Setter
28:     @Embedded
29:     @AttributeOverrides({
30:             @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
31:             @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
32:     })
33:     private Money purchasePrice;
34:     @Setter
35:     @Embedded
36:     @AttributeOverrides({
37:             @AttributeOverride(name="amount", column= @Column(name="sellingAmount")),
38:             @AttributeOverride(name="currency", column= @Column(name="sellingCurrency"))
39:     })
40:     private Money sellingPrice;
41:     @Setter
42:     private int stockQuantity;
43:     @Setter
44:     private int reservedQuantity;
45: 
46:     public Thing(UUID id, String name, String description, float size, Money purchasePrice, Money sellingPrice){
47:         this.id = id;
48:         this.name = name;
49:         this.description = description;
50:         this.size = size;
51:         this.purchasePrice = purchasePrice;
52:         this.sellingPrice= sellingPrice;
53:     }
54: 
55:     public Thing(UUID id, String name, String description, Money purchasePrice, Money sellingPrice){
56:         this.id = id;
57:         this.name = name;
58:         this.description = description;
59:         this.purchasePrice = purchasePrice;
60:         this.sellingPrice= sellingPrice;
61:     }
62: 
63:     public void addToStock(int quantity){
64:         stockQuantity += quantity;
65:     }
66: 
67:     public void removeFromStock(int quantity){
68:         stockQuantity -= quantity;
69:     }
70: 
71:     public void reserve(int quantity) {
72:         removeFromStock(quantity);
73:         reservedQuantity += quantity;
74:     }
75: 
76:     public void removeReservation(int quantity) {
77:         addToStock(quantity);
78:         reservedQuantity -= quantity;
79:     }
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\domain\ThingRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.thing.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: 
6: import java.util.UUID;
7: 
8: @Repository
9: public interface ThingRepository extends CrudRepository<Thing, UUID> {
10:     public Thing findByName(String name);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\ShoppingCartFactory.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
4: 
5: public interface ShoppingCartFactory {
6:     public void createShoppingCart(MailAddressType userMailAddress);
7:     public void deleteAllCarts();
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.dao.DataIntegrityViolationException;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
7: import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
8: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryRecipientService;
9: import thkoeln.archilab.ecommerce.solution.order.application.OrderUserService;
10: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentUserService;
11: import thkoeln.archilab.ecommerce.solution.user.domain.User;
12: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
13: import thkoeln.archilab.ecommerce.ShopException;
14: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
15: import thkoeln.archilab.ecommerce.usecases.UserType;
16: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
17: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
18: 
19: @Service
20: public class UserService implements UserRegistrationUseCases, DeliveryRecipientService, OrderUserService,
21:                                     PaymentUserService {
22:     @Autowired
23:     private UserRepository userRepository;
24:     @Autowired
25:     private ShoppingCartFactory shoppingCartFactory;
26: 
27: 
28:     @Override
29:     public UserType findUserByMail(MailAddressType userMailAddress){
30:         if (userMailAddress == null) throw new ShopException("Mail address must not be null");
31:         try {
32:             if (userRepository.findByMailAddress((MailAddress) userMailAddress) != null) {
33:                 return (UserType) userRepository.findByMailAddress((MailAddress) userMailAddress);
34:             }
35:             else throw new ShopException("User does not exists");
36:         } catch (DataIntegrityViolationException dataIntegrityViolationException){
37:             throw new ShopException("No users left");
38:         }
39:     }
40: 
41:     @Override
42:     public void register(String name, MailAddressType mailAddress, PersonalAddressType personalAddress) {
43:         if (mailAddress == null){
44:             throw new ShopException("Invalid data");
45:         }
46:         if (name == null || name.isEmpty()){
47:             throw new ShopException("Invalid data");
48:         }
49:         if (personalAddress == null) throw new ShopException("Invalid data");
50:         if (userRepository.findByMailAddress((MailAddress) mailAddress) != null) {
51:             throw new ShopException("Your mail is already registered");
52:         }
53:         User user = new User((MailAddress) mailAddress, name, (PersonalAddress) personalAddress);
54:         userRepository.save(user);
55:         shoppingCartFactory.createShoppingCart(user.getMailAddress());
56:     }
57: 
58:     @Override
59:     public void changeAddress(MailAddressType userMailAddress, PersonalAddressType personalAddress) {
60:         if (userMailAddress == null || personalAddress == null) {
61:             throw new ShopException("Invalid data");
62:         }
63:         User user = (User) findUserByMail(userMailAddress);
64:         user.changeAddress((PersonalAddress) personalAddress);
65:     }
66: 
67:     @Override
68:     public UserType getUserData(MailAddressType userMailAddress) {
69:         try{
70:             return findUserByMail(userMailAddress);
71:         }
72:         catch (DataIntegrityViolationException dataIntegrityViolationException) {
73:             throw new ShopException("No users left");
74:         }
75:     }
76: 
77:     @Override
78:     public void deleteAllUsers() {
79:         shoppingCartFactory.deleteAllCarts();
80:         userRepository.deleteAll();
81:     }
82: }
83: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain;
2: 
3: import lombok.*;
4: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
5: import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
6: import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
7: import thkoeln.archilab.ecommerce.usecases.UserType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
9: 
10: import javax.persistence.Embedded;
11: import javax.persistence.Entity;
12: import javax.persistence.Id;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @Setter
18: @NoArgsConstructor(access = AccessLevel.PROTECTED)
19: public class User extends AbstractUser {
20: 
21:     @Id
22:     final UUID id = UUID.randomUUID();
23: 
24:     @Embedded
25:     private MailAddress mailAddress;
26: 
27:     private String name;
28: 
29:     @Embedded
30:     private PersonalAddress address;
31: 
32:     public User(MailAddress mailAddress, String name, PersonalAddress personalAddress) {
33:         this.mailAddress = mailAddress;
34:         this.name = name;
35:         this.address = personalAddress;
36:     }
37: 
38:     public void changeAddress(PersonalAddress personalAddress){
39:         address = personalAddress;
40:     }
41: 
42:     @Override
43:     public PersonalAddressType getPersonalAddress() {
44:         return address;
45:     }
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\UserRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
6: import thkoeln.archilab.ecommerce.solution.user.domain.User;
7: 
8: import java.util.Optional;
9: import java.util.UUID;
10: 
11: @Repository
12: public interface UserRepository extends CrudRepository<User, UUID> {
13:     public User findByMailAddress(MailAddress mailAddress);
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of things to a user. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a thing to a user. The thing is identified by its id, and the user by
16:      * his/her name, street, city and zip code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of thing ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of things in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( UserType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which things have been delivered to a user, and how many of each thing
31:      *
32:      * @param userMailAddress
33:      * @return the delivery history of the user (map is empty if the user has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - mailAddress is null
36:      *      - the user with the given mail address does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( MailAddressType userMailAddress );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MailAddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MailAddressType {
6:     /**
7:      * @return the mail address as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an mail address, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param mailAddressAsString - the mail address as a string.
18:      *      We will use a much simplified validation method to check if the mail address is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new MailAddressType object matching the given mail address
27:      * @throws ShopException if ...
28:      *      - mailAddressAsString is null
29:      *      - mailAddressAsString is not a valid mail address (see above)
30:      */
31:      // public static MailAddressType of( String mailAddressAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PersonalAddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PersonalAddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the zip code
18:      */
19:     public ZipCodeType getZipCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an zip code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param zipCode the zip code
30:      * @return the personalAddress object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - zipCode is null
35:      */
36:      // public static PersonalAddressType of( String street, String city, ZipCodeType zipCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\ZipCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface ZipCodeType {
6:     /**
7:      * @return the zip code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an zip code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param zipCodeAsString - the zip code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new zip code object matching the given string
22:      * @throws ShopException if ...
23:      *      - zipCodeAsString is null
24:      *      - zipCodeAsString is not a valid zip code (see above)
25:      */
26:      // public static ZipCodeType of( String zipCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a bank card for a given amount
16:      *
17:      * @param userMailAddress
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - userMailAddress is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( MailAddressType userMailAddress, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a user
31:      * (identified by his/her mail address)
32:      *
33:      * @param userMailAddress
34:      * @return the total amount of payments made using this bank card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - userMailAddress is null
38:      */
39:     public MoneyType getPaymentTotal( MailAddressType userMailAddress );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all users.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingCartUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping cart.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingCartUseCases {
15:     /**
16:      * Adds a thing to the shopping cart of a user
17:      *
18:      * @param userMailAddress
19:      * @param thingId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the user with the given mailAddress does not exist,
23:      *      - the thing does not exist,
24:      *      - the quantity <= 0,
25:      *      - the thing is not available in the requested quantity
26:      */
27:     public void addThingToShoppingCart( MailAddressType userMailAddress, UUID thingId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a thing from the shopping cart of a user
32:      *
33:      * @param userMailAddress
34:      * @param thingId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - userMailAddress is null,
38:      *      - the user with the given mailAddress does not exist,
39:      *      - the thing does not exist
40:      *      - the quantity <= 0,
41:      *      - the thing is not in the shopping cart in the requested quantity
42:      */
43:     public void removeThingFromShoppingCart( MailAddressType userMailAddress, UUID thingId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping cart position containing a thing
48:      *
49:      * @param userMailAddress
50:      * @param thingId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - userMailAddress is null,
54:      *      - the user with the given mailAddress does not exist,
55:      *      - the thing does not exist
56:      *      - the thing is not in the shopping cart
57:      */
58:     public void setCommentForShoppingCartPosition( MailAddressType userMailAddress, UUID thingId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping cart position containing a thing
63:      *
64:      * @param userMailAddress
65:      * @param thingId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - userMailAddress is null,
69:      *      - the user with the given mailAddress does not exist,
70:      *      - the thing does not exist
71:      *      - the thing is not in the shopping cart
72:      */
73:     public String getCommentForShoppingCartPosition( MailAddressType userMailAddress, UUID thingId );
74: 
75: 
76:     /**
77:      * Returns a map showing which things are in the shopping cart of a user and how many of each thing
78:      *
79:      * @param userMailAddress
80:      * @return the shopping cart of the user (map is empty if the shopping cart is empty)
81:      * @throws ShopException if ...
82:      *      - userMailAddress is null,
83:      *      - the user with the given mailAddress does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingCartAsMap( MailAddressType userMailAddress );
86: 
87: 
88:     /**
89:      * Returns the current value of all things in the shopping cart of a user
90:      *
91:      * @param userMailAddress
92:      * @return the value of shopping cart of the user
93:      * @throws ShopException if ...
94:      *      - userMailAddress is null,
95:      *      - the user with the given mailAddress does not exist
96:      */
97:     public MoneyType getShoppingCartAsMoneyValue( MailAddressType userMailAddress );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific thing that are currently reserved in the shopping carts of all users
103:      * @param thingId
104:      * @return the number of reserved things of that type in all shopping carts
105:      * @throws ShopException
106:      *      - thingId is null
107:      *      - if the thing id does not exist
108:      */
109:     public int getReservedStockInShoppingCarts( UUID thingId );
110: 
111: 
112:     /**
113:      * Checks if the shopping cart of a user is empty
114:      *
115:      * @param userMailAddress
116:      * @return true if the shopping cart is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - userMailAddress is null
119:      *    - the user with the given mail address does not exist
120:      */
121:     public boolean isEmpty( MailAddressType userMailAddress );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping cart of a user has been authorized to be paid,
126:      * i.e. the shopping cart is not empty, the user has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the user's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param userMailAddress
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - userMailAddress is null
134:      *      - the user with the given mail address does not exist
135:      */
136:     public boolean isPaymentAuthorized( MailAddressType userMailAddress );
137: 
138: 
139:     /**
140:      * Checks out the shopping cart of a user
141:      *
142:      * @param userMailAddress
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - userMailAddress is null
146:      *      - the user with the given mail address does not exist
147:      *      - the shopping cart is empty
148:      */
149:     public void checkout( MailAddressType userMailAddress );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which things have been ordered by a user, and how many of each thing
156:      *
157:      * @param userMailAddress
158:      * @return the order history of the user (map is empty if the user has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the mail address is null
162:      *      - the user with the given mail address does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( MailAddressType userMailAddress );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping carts in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping carts), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\StockManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop stock,
10:  * i.e. adding and removing things in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface StockManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given thing to the stock
16:      * @param thingId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - thingId is null
20:      *      - the thing with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToStock( UUID thingId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given thing from the stock.
28:      * If the new total quantity is lower than the currently reserved things, some of currently reserved things
29:      * (in the users' shopping baskets) are removed. This means that some of the reserved things are lost for
30:      * the user. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
31:      * or some of the things were stolen from the warehouse, are broken, etc.)
32:      * @param thingId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - thingId is null
36:      *      - the thing with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current stock and the currently reserved things together
39:      */
40:     public void removeFromStock( UUID thingId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given thing in the stock.
45:      * If the new total quantity is lower than the currently reserved things, some of currently reserved things
46:      * (in the users' shopping baskets) are removed. This means that some of the reserved things are lost for
47:      * the user. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
48:      * or some of the things were stolen from the warehouse, are broken, etc.)
49:      * @param thingId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - thingId is null
53:      *      - the thing with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeStockTo( UUID thingId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total stock of a given thing, including the currently reserved things
61:      * @param thingId
62:      * @return the current total stock of the thing
63:      * @throws ShopException if ...
64:      *      - thingId is null
65:      *      - the thing with that id does not exist
66:      */
67:     public int getAvailableStock( UUID thingId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\ThingCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the thing catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface ThingCatalogUseCases {
15:     /**
16:      * Adds a new thing to the shop catalog
17:      * @param thingId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param sellingPrice
23:      * @throws ShopException if ...
24:      *      - thingId is null,
25:      *      - the thing with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the selling price is null,
30:      *      - the selling price is lower than the purchase price
31:      */
32:     public void addThingToCatalog( UUID thingId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType sellingPrice );
34: 
35: 
36:     /**
37:      * Removes a thing from the shop catalog
38:      * @param thingId
39:      * @throws ShopException if
40:      *      - thingId is null,
41:      *      - the thing with that id does not exist
42:      *      - the thing is still in stock
43:      *      - the thing is still reserved in a shopping cart, or part of a completed order
44:      */
45:     public void removeThingFromCatalog( UUID thingId );
46: 
47: 
48:     /**
49:      * Get the selling price of a given thing
50:      * @param thingId
51:      * @return the selling price
52:      * @throws ShopException if ...
53:      *      - thingId is null,
54:      *      - the thing with that id does not exist
55:      */
56:     public MoneyType getSellingPrice( UUID thingId );
57: 
58: 
59:     /**
60:      * Clears the thing catalog, i.e. removes all things from the catalog, including all the stock,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteThingCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\UserRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a user.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface UserRegistrationUseCases {
12:     /**
13:      * Registers a new user
14:      *
15:      * @param name
16:      * @param mailAddress
17:      * @param personalAddress
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - mailAddress is null
21:      *      - user with the given mail address already exists
22:      *      - personalAddress is null
23:      */
24:     public void register( String name, MailAddressType mailAddress, PersonalAddressType personalAddress );
25: 
26: 
27:     /**
28:      * Changes the personalAddress of a user
29:      *
30:      * @param userMailAddress
31:      * @param personalAddress
32:      * @throws ShopException if ...
33:      *      - mailAddress is null
34:      *      - user with the given mail address already exists
35:      *      - personalAddress is null
36:      */
37:     public void changeAddress( MailAddressType userMailAddress, PersonalAddressType personalAddress );
38: 
39: 
40:     /**
41:      * Returns the data of a user
42:      * @param userMailAddress
43:      * @return the user data
44:      * @throws ShopException if ...
45:      *      - mailAddress is null
46:      *      - the user with the given mail address does not exist
47:      */
48:     public UserType getUserData( MailAddressType userMailAddress );
49: 
50: 
51: 
52:     /**
53:      * Deletes all users, including all orders and shopping carts
54:      */
55:     public void deleteAllUsers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\UserType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop user
8:  */
9: public interface UserType {
10:     public String getName();
11:     public MailAddressType getMailAddress();
12:     public PersonalAddressType getPersonalAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Thing" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"user", "shoppingcart", "thing", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "User",
21:             "UserRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingCart",
25:             "ShoppingCartRepository",
26:             "Thing",
27:             "ThingRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private MailAddressType nonExistingMailAddress;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllThings();
45:         initialMasterDataCreator.stockUpAllThings();
46:         initialMasterDataCreator.registerAllUsers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingMailAddress = instantiateMailAddress( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?mailAddress=" + nonExistingMailAddress ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?mailAddress=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?mailAddress=" + USER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String mailAddressString = USER_EMAIL[6].toString();
76: 
77:         UUID thingId2 = (UUID) THING_DATA[2][0];
78:         UUID thingId4 = (UUID) THING_DATA[4][0];
79:         UUID thingId6 = (UUID) THING_DATA[6][0];
80:         Float thingMoneyAmount2 = ((MoneyType) THING_DATA[2][5]).getAmount() * 2;
81:         Float thingMoneyAmount4 = ((MoneyType) THING_DATA[4][5]).getAmount() * 4;
82:         Float thingMoneyAmount6 = ((MoneyType) THING_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?mailAddress=" + mailAddressString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForUser( mailAddressString, thingId2, 2 );
89:         restHelper.makeOrderForUser( mailAddressString, thingId4, 4 );
90:         restHelper.makeOrderForUser( mailAddressString, thingId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].mailAddress.mailAddressString" ).value( mailAddressString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].mailAddress.mailAddressString" ).value( mailAddressString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( thingMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].mailAddress.mailAddressString" ).value( mailAddressString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( thingMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String mailAddressString = USER_EMAIL[3].toString();
118:         UUID thingId3 = (UUID) THING_DATA[3][0];
119:         UUID thingId4 = (UUID) THING_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float thingMoneyAmount =
123:                 ((MoneyType) THING_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) THING_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingCartId = restHelper.getShoppingCartId( mailAddressString );
128:         restHelper.addThingToShoppingCart( shoppingCartId, thingId3, quantity3 );
129:         restHelper.addThingToShoppingCart( shoppingCartId, thingId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?mailAddress=" + mailAddressString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingCartRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingCartRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private MailAddressType nonExistingMailAddress;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllThings();
47:         initialMasterDataCreator.stockUpAllThings();
48:         initialMasterDataCreator.registerAllUsers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingMailAddress = instantiateMailAddress( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingCart() throws Exception {
57:         // given
58:         String validUri = "/shoppingCarts?mailAddress=" + USER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingCarts?mailAddress=" + nonExistingMailAddress.toString();
60:         String invalidUri2 = "/shoppingCarts?mailAddress=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID thingId = (UUID) THING_DATA[3][0];
78:         String userEmailString = USER_EMAIL[4].toString();
79:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
80: 
81:         String invalidPostUri = "/shoppingCarts/" + UUID.randomUUID() + "/shoppingCartPositions";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingCarts/" + UUID.randomUUID().toString() + "/shoppingCartPositions/" + thingId;
86:         String invalidCheckoutUri1 = "/shoppingCarts/" + shoppingCartId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingCarts/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingThing() throws Exception {
107:         // given
108:         UUID thingId = (UUID) THING_DATA[3][0];
109:         String userEmailString = USER_EMAIL[7].toString();
110:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
111:         String invalidUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/" + thingId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingCart() throws Exception {
121:         // given
122:         UUID thingId1 = (UUID) THING_DATA[1][0];
123:         String userEmailString9 = USER_EMAIL[9].toString();
124:         String userEmailString7 = USER_EMAIL[7].toString();
125: 
126:         UUID shoppingCartId9 = restHelper.getShoppingCartId( userEmailString9 );
127:         UUID shoppingCartId7 = restHelper.getShoppingCartId( userEmailString7 );
128: 
129:         String baseUri9 = "/shoppingCarts/" + shoppingCartId9 + "/shoppingCartPositions/";
130:         String checkoutUri9 = "/shoppingCarts/" + shoppingCartId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingCarts/" + shoppingCartId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleThingsToShoppingCart( userEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingCartPositions(
137:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + thingId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingCartPositions(
142:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" thing
145:         restHelper.addThingToShoppingCart( shoppingCartId7, thingId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingCart() throws Exception {
160:         // given
161:         String userEmailString = USER_EMAIL[2].toString();
162:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
163:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingCartPositions(
170:                 userEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingCart() throws Exception {
182:         // given
183:         String userEmailString = USER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInStock() throws Exception {
195:         // given
196:         String userEmailString = USER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String userEmailString = USER_EMAIL[5].toString();
210:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
211:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String userEmailString = USER_EMAIL[1].toString();
229:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
230:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String userEmailString = USER_EMAIL[8].toString();
245:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
246:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleThingsToShoppingCart( userEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingCart() throws Exception {
259:         // given
260:         String userEmailString = USER_EMAIL[9].toString();
261:         UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
262:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForUser( String mailAddressString, UUID thingId, Integer quantity ) throws Exception {
36:         UUID shoppingCartId = getShoppingCartId( mailAddressString );
37:         addThingToShoppingCart( shoppingCartId, thingId, quantity );
38:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingCartId( String mailAddressString ) throws Exception {
43:         // get the shopping cart and extract its id ...
44:         MvcResult shoppingCart = mockMvc.perform( get( "/shoppingCarts?mailAddress=" + mailAddressString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingCart.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addThingToShoppingCart( UUID shoppingCartId, UUID thingId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( thingId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addThingToShoppingCart( UUID shoppingCartId, UUID thingId, Integer quantity )
67:             throws Exception {
68:         addThingToShoppingCart( shoppingCartId, thingId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleThingsToShoppingCart(
74:             String userEmailString, Integer[] thingIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingCartId = getShoppingCartId( userEmailString );
77:         String shoppingCartUri = "shoppingCarts?mailAddress=" + userEmailString;
78:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/";
79: 
80:         // add all the things to the shopping cart ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < thingIndices.length; i++ ) {
84:             UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
85:             addThingToShoppingCart( shoppingCartId, thingId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( thingIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( thingIndices[i], 0 ) );
89:                 commentMap.put( thingIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleThingsToShoppingCart(
96:             String userEmailString, Integer[] thingIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[thingIndices.length];
99:         for ( int i = 0; i < thingIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleThingsToShoppingCart( userEmailString, thingIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingCartPositions( String userEmailString,
108:                                                          Integer[] thingIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingCartId = getShoppingCartId( userEmailString );
111:         String shoppingCartUri = "/shoppingCarts?mailAddress=" + userEmailString;
112:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/";
113: 
114:         // check that the shopping cart contains all the things ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < thingIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingCartUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each thing has the correct quantity and comment ...
126:         for ( int i = 0; i < thingIndices.length; i++ ) {
127:             UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + thingId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + thingId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingCartPositions( String userEmailString,
142:                                                          Integer[] thingIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[thingIndices.length];
145:         for ( int i = 0; i < thingIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingCartPositions( userEmailString, thingIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPositionsInLatestOrder(
155:             String userEmailString, Integer[] thingIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?mailAddress=" + userEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < thingIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) THING_DATA[thingIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].mailAddress.mailAddressString" ).value( userEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < thingIndices.length; i++ ) {
173:             UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderPositions.length()" ).value( thingIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderPositions[?(@.thingId == '" + thingId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderPositions[?(@.thingId == '" + thingId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID thingId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID thingId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID thingId, Integer quantity, String comment ) {
24:         this.thingId = thingId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMailAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMailAddressTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         MailAddressType instance = instantiateMailAddress( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateMailAddress( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateMailAddress( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateMailAddress( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateMailAddress( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateMailAddress( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateMailAddress( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateMailAddress( null ) );
48:         assertThrows( ShopException.class, () -> instantiateMailAddress( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateMailAddress( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateMailAddress( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         MailAddressType instance1 = instantiateMailAddress( "test@example.com" );
67:         MailAddressType instance2 = instantiateMailAddress( "test@example.com" );
68:         MailAddressType instance3 = instantiateMailAddress( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         MailAddressType instance = instantiateMailAddress( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setMailAddress", String.class );
84:             fail( "setMailAddress method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPersonalAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionPersonalAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         ZipCodeType plz = instantiateZipCode( "12345" );
19: 
20:         // when
21:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getZipCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         ZipCodeType plz = instantiateZipCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiatePersonalAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         ZipCodeType plz = instantiateZipCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         ZipCodeType plz = instantiateZipCode( "12345" );
63: 
64:         // when
65:         PersonalAddressType instance1 = instantiatePersonalAddress( street, city, plz );
66:         PersonalAddressType instance2 = instantiatePersonalAddress( street, city, plz );
67:         PersonalAddressType instance3 = instantiatePersonalAddress( "Anderestr. 12", city, plz );
68:         PersonalAddressType instance4 = instantiatePersonalAddress( street, "AndereStadt", plz );
69:         PersonalAddressType instance5 = instantiatePersonalAddress( street, city, instantiateZipCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         ZipCodeType plz = instantiateZipCode( "12345" );
84: 
85:         // when
86:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setZipCode", ZipCodeType.class );
104:             fail( "setZipCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionZipCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionZipCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         ZipCodeType instance = instantiateZipCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateZipCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiateZipCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiateZipCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiateZipCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiateZipCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         ZipCodeType instance1 = instantiateZipCode( "12345" );
48:         ZipCodeType instance2 = instantiateZipCode( "12345" );
49:         ZipCodeType instance3 = instantiateZipCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         ZipCodeType instance = instantiateZipCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setzipCode", String.class );
65:             fail( "setzipCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionStockManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_STOCK;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionStockManagementTest {
20: 
21:     @Autowired
22:     private StockManagementUseCases stockManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllThings();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToStock() {
37:         // given
38:         initialMasterDataCreator.stockUpAllThings();
39:         UUID thingId8 = (UUID) THING_DATA[8][0];
40: 
41:         // when
42:         int stock8before = stockManagementUseCases.getAvailableStock( thingId8 );
43:         assertEquals( THING_STOCK.get( thingId8 ), stock8before );
44:         stockManagementUseCases.addToStock( thingId8, 22 );
45:         int stock8after = stockManagementUseCases.getAvailableStock( thingId8 );
46:         stockManagementUseCases.addToStock( thingId8, 1 );
47:         int stock8after2 = stockManagementUseCases.getAvailableStock( thingId8 );
48: 
49:         // then
50:         assertEquals( stock8before + 22, stock8after );
51:         assertEquals( stock8after + 1, stock8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromStock() {
57:         // given
58:         initialMasterDataCreator.stockUpAllThings();
59:         UUID thingId6 = (UUID) THING_DATA[6][0];
60:         int stock6before = THING_STOCK.get( thingId6 );
61:         UUID thingId9 = (UUID) THING_DATA[9][0];
62:         int stock9before = THING_STOCK.get( thingId9 );
63:         UUID thingId1 = (UUID) THING_DATA[1][0];
64:         int stock1before = THING_STOCK.get( thingId1 );
65: 
66:         // when
67:         stockManagementUseCases.removeFromStock( thingId6, 1 );
68:         int stock6after = stockManagementUseCases.getAvailableStock( thingId6 );
69:         stockManagementUseCases.removeFromStock( thingId1, 3 );
70:         int stock1after = stockManagementUseCases.getAvailableStock( thingId1 );
71:         stockManagementUseCases.removeFromStock( thingId9, stock9before );
72:         int stock9after = stockManagementUseCases.getAvailableStock( thingId9 );
73: 
74:         // then
75:         assertEquals( stock6before - 1, stock6after );
76:         assertEquals( stock1before - 3, stock1after );
77:         assertEquals( 0, stock9after );
78:     }
79: 
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionThingCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.ThingCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionThingCatalogTest {
22: 
23:     @Autowired
24:     private ThingCatalogUseCases thingCatalogUseCases;
25:     @Autowired
26:     private StockManagementUseCases stockManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddThingToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllThings();
41: 
42:         // when
43:         MoneyType sellingPrice = thingCatalogUseCases.getSellingPrice( (UUID) THING_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( THING_DATA[4][5], sellingPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveThingFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllThings();
53:         UUID thingId = (UUID) THING_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> thingCatalogUseCases.getSellingPrice( thingId ) );
57:         thingCatalogUseCases.removeThingFromCatalog( thingId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> thingCatalogUseCases.getSellingPrice( thingId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveThingThatIsInStock() {
68:         // given
69:         initialMasterDataCreator.addAllThings();
70:         UUID thingId = (UUID) THING_DATA[4][0];
71:         stockManagementUseCases.addToStock( thingId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> thingCatalogUseCases.removeThingFromCatalog( thingId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearThingCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllThings();
83: 
84:         // when
85:         thingCatalogUseCases.deleteThingCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> thingCatalogUseCases.getSellingPrice( (UUID) THING_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionUserRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.UserType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionUserRegistrationTest {
25: 
26:     @Autowired
27:     private UserRegistrationUseCases userRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private MailAddressType nonExistingMailAddress;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingMailAddress = instantiateMailAddress( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllUsersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllUsers();
44: 
45:         // when
46:         UserType user3 = userRegistrationUseCases.getUserData( USER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.USER_NAME[3], user3.getName() );
50:         Assertions.assertEquals( USER_EMAIL[3], user3.getMailAddress() );
51:         Assertions.assertEquals( USER_ADDRESS[3], user3.getPersonalAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterUserWithDuplicateMailAddress() {
57:         // given
58:         initialMasterDataCreator.registerAllUsers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 userRegistrationUseCases.register( "Gandalf The Grey", USER_EMAIL[5],
64:                         USER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterUserWithDuplicateNameOrPersonalAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllUsers();
71:         MailAddressType newMailAddress = instantiateMailAddress( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 userRegistrationUseCases.register( initialMasterDataCreator.USER_NAME[2], newMailAddress,
77:                         USER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteUsersNoMoreUsers() {
83:         // given
84:         initialMasterDataCreator.registerAllUsers();
85: 
86:         // when
87:         userRegistrationUseCases.deleteAllUsers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> userRegistrationUseCases.getUserData( USER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

[RESPONSE]:
Hier sind die gefundenen Code Smells basierend auf den definierten Regeln:

thkoeln.archilab.ecommerce.domainprimitives.Money.java
[Money.java] [45-46]: [Duplication] [38-39] : Die Prüfung auf `null` und die Währung ist identisch zur `add`-Methode.
[Money.java] [59-60]: [Duplication] [38-39] : Die Prüfung auf `null` und die Währung ist identisch zur `add`-Methode.

thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.java
[FactoryMethodInvoker.java] [51-79]: [Duplication] [23-48] : Die Logik zur Reflektion, Methodenfindung und Instanziierung ist fast identisch zu `instantiateMailAddress`, nur die Parameter unterscheiden sich.
[FactoryMethodInvoker.java] [82-107]: [Duplication] [23-48] : Die Logik zur Reflektion, Methodenfindung und Instanziierung ist fast identisch zu `instantiateMailAddress`.
[FactoryMethodInvoker.java] [110-135]: [Duplication] [23-48] : Die Logik zur Reflektion, Methodenfindung und Instanziierung ist fast identisch zu `instantiateMailAddress`.

thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser.java
-Anemic Entity-

thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery.java
-Anemic Entity-

thkoeln.archilab.ecommerce.solution.order.application.OrderRESTController.java
[OrderRESTController.java] [32]: [negative conditionals] : `userOrders.size() != 0` ist eine doppelte Verneinung (nicht null). Besser wäre `!userOrders.isEmpty()` oder eine positive Formulierung.

thkoeln.archilab.ecommerce.solution.order.application.OrderService.java
[OrderService.java] [60-62]: [dead code] : Die Methode `findAll` wird weder in der Klasse noch im Controller verwendet.
[OrderService.java] [64-72]: [dead code] : Die Methode `findAllAsDTO` wird nicht verwendet (der Controller nutzt nur `findByUserAsDTO`).

thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition.java
-Anemic Entity-

thkoeln.archilab.ecommerce.solution.payment.domain.Payment.java
-Anemic Entity-

thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartRESTController.java
[ShoppingCartRESTController.java] [56-97]: [missplaced resonsibility] : Der Controller enthält massive Geschäftslogik (Prüfung negativer Mengen, Entfernen von Items, Löschen von Positionen bei Menge 0). Dies gehört in den Application Service oder die Domain.
[ShoppingCartRESTController.java] [59-60]: [layer violation] : Der Controller ruft Domain-Entities (`ShoppingCart`, `CartPosition`) ab und arbeitet direkt mit diesen (z.B. Zeile 62, 68). Ein Controller sollte mit DTOs arbeiten und die Verarbeitung an den Service delegieren.
[ShoppingCartRESTController.java] [114-119]: [dead code] : Dieser Code-Block führt Logik aus und erstellt Variablen, die sofort verfallen, da sie lokal im `try`-Block sind oder danach überschrieben werden. Der Code wird in Zeile 122 fast identisch wiederholt.
[ShoppingCartRESTController.java] [123-126]: [Duplication] [115-119] : Der Aufruf zum Holen der DTOs ist doppelt vorhanden (bzw. der erste Block war unnötig).
[ShoppingCartRESTController.java] [136-137]: [dead code] : Der `ShoppingCart` wird abgerufen, aber nicht verwendet. Der Block endet danach.
[ShoppingCartRESTController.java] [141-142]: [Duplication] [136-137] : Erneuter Abruf des `ShoppingCart`, identisch zum vorherigen Block.

thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService.java
[ShoppingCartService.java] [106-127]: [Duplication] [76-98] : Die Logik zur Iteration durch `CartPositions` und Anpassung der Mengen (Schleife, Berechnung, Speichern) ist fast identisch zur Methode `removeStockCartCorrection`.
[ShoppingCartService.java] [241-251]: [dead code] : Die private Methode `areCartPositionsEmpty` wird innerhalb der Klasse nicht aufgerufen.

thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition.java
-Anemic Entity-

thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart.java
-Anemic Entity-

ENDE
Generated by gemini-3-pro-preview
-----------------------------------