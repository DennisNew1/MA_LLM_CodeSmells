--- DATE: 8.1.2026, 19:20:50 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
    Architektur: 4-Layer (Eric Evans).
    Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
    Regeln:
    1. Begründe kurz jeden Fund.
    4. Gruppiere nach Datei (mit Pfad). 
    2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
    3. Keine Code-Wiederholung, nur Referenzen.
    5. Wenn fertig, schreibe "ENDE".



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
package thkoeln.archilab.ecommerce.domainprimitives;


import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.Setter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;

import javax.persistence.Embeddable;
import javax.persistence.Embedded;
import java.util.Objects;

@EqualsAndHashCode
@Getter
@Embeddable
public class Address implements AddressType {
    private String street;
    private String city;
    @Embedded
    private PostalCode postalCode;

    public Address(String street, String city, PostalCode postalCode) {

        if (street == null || street.isEmpty() || city == null || city.isEmpty() || postalCode == null) {
            throw new ShopException("Invalid address");
        }
        this.street = street;
        this.city= city;
        this.postalCode = postalCode;
    }

    public Address() {

    }


    public static AddressType of(String street, String city, PostalCodeType postalCode) {
        if (postalCode == null) {
            throw new ShopException("PostalCode is null");
        }
        if (!(postalCode instanceof PostalCode)) {
            throw new ShopException("wrong PostalCode type");
        }

        PostalCode code = (PostalCode) postalCode;
        return new Address(street, city, code);
    }

    @Override
    public String getStreet() {
        return street;
    }

    @Override
    public String getCity() {
        return city;
    }

    @Override
    public PostalCodeType getPostalCode() {
        return postalCode;
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.persistence.Embeddable;
import java.io.Serializable;
@EqualsAndHashCode
@Getter
@Embeddable
public class Email implements EmailType , Serializable {

    private String emailString;

    public Email(String email){
        if ( email == null || email.isEmpty()) {
            throw new ShopException("Invalid customer data");
        }
        this.emailString=email;
    }

    public Email() {

    }

    public static EmailType of (String emailAsString){

        if ( emailAsString == null || emailAsString.isEmpty()) {
            throw new ShopException("Invalid customer data");
        }
        if ( !emailAsString.contains("@")) {
            throw new ShopException("Kein @");
        }

        int positionOfAt = emailAsString.indexOf('@');
        String beforeAt = emailAsString.substring(0,positionOfAt);
        String afterAt = emailAsString.substring(positionOfAt+1);

        if ( emailAsString.contains(" ")) {
            throw new ShopException("contains Leerzeichen");
        }
        if(beforeAt.isEmpty()||afterAt.isEmpty()){
            throw new ShopException("before or after @ is empty");
        }

        for (char c : beforeAt.toCharArray()) {
            if (!(Character.isLetterOrDigit(c) || c == '.')) {
                throw new ShopException("no valid char");
            }
        }

        for (char c : afterAt.toCharArray()) {
            if (!(Character.isLetterOrDigit(c) || c == '.')) {
                throw new ShopException("no valid char");
            }
        }/*
        if(!beforeAt.contains(".")||!afterAt.contains(".")){
            throw new ShopException("no dots existent");
        }
        */
        if(emailAsString.contains("..")){
            throw new ShopException("2 dots in a row");
        }
        if (!(afterAt.endsWith(".de") || afterAt.endsWith(".at") ||
                afterAt.endsWith(".ch") || afterAt.endsWith(".com") || afterAt.endsWith(".org"))) {
            throw new ShopException("no valid ending of email");
        }

        return new Email(emailAsString);
    }
    @Override
    public String toString() {
        return emailString;
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.EqualsAndHashCode;
import lombok.Getter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.persistence.Embeddable;

@EqualsAndHashCode
@Getter
@Embeddable
public class Money implements MoneyType {
    private Float amount;
    private String currency;

    public Money(Float amount, String currency) {
        this.amount = amount;
        this.currency = currency;
    }

    public Money() {

    }

    @Override
    public MoneyType add(MoneyType otherMoney) {
        checkEqualCurrency(otherMoney);
        return new Money(amount + otherMoney.getAmount(), currency);
    }

    @Override
    public MoneyType subtract(MoneyType otherMoney) {
        checkEqualCurrency(otherMoney);
        if (amount < otherMoney.getAmount()) {
            throw new ShopException("negative result");
        }
        return new Money(amount - otherMoney.getAmount(), currency);
    }

    @Override
    public MoneyType multiplyBy(int factor) {
        if (factor < 0) {
            throw new ShopException("negative result");
        }
        return new Money(amount * factor, currency);
    }

    @Override
    public boolean largerThan(MoneyType otherMoney) {
        checkEqualCurrency(otherMoney);
        return amount > otherMoney.getAmount();
    }

    private void checkEqualCurrency(MoneyType otherMoney) {
        if (!currency.equals(otherMoney.getCurrency())) {
            throw new ShopException("diifferent Currencies");
        }
    }

    public static MoneyType of(Float amount, String currency) {
        if (amount==null|| amount < 0||currency==null||!currency.equals("EUR") && !currency.equals("CHF")) {
            throw new ShopException("Money or Moneytype invalid");
        }
        return new Money(amount, currency);
    }
}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PostalCode.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.EqualsAndHashCode;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;

import javax.persistence.Embeddable;

@Embeddable
public class PostalCode implements PostalCodeType {
    private String postalCodeAsString;

    public PostalCode (String code){

        this.postalCodeAsString = code;
    }

    public PostalCode() {

    }

    public static PostalCodeType of(String postalCodeAsString){

        if (postalCodeAsString == null || postalCodeAsString.length()!=5|| postalCodeAsString.substring(1).equals("0000")) {
            throw new ShopException("Invalid address data");
        }
        return new PostalCode(postalCodeAsString);

    }
    @Override
    public String toString() {
        return postalCodeAsString;
    }
    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null || getClass() != obj.getClass()) {
            return false;
        }
        PostalCode other = (PostalCode) obj;
        return postalCodeAsString.equals(other.postalCodeAsString);
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
package thkoeln.archilab.ecommerce.masterdata;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.io.File;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.net.URL;
import java.net.URLDecoder;
import java.nio.charset.StandardCharsets;
import java.util.Enumeration;

import static org.junit.jupiter.api.Assertions.*;

public class FactoryMethodInvoker {

    public static EmailType instantiateEmail( String emailAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for EmailType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, emailAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
        }
        assertNotNull( instance );
        return (EmailType) instance;
    }


    public static AddressType instantiateAddress(
            String street, String city, PostalCodeType postalCode ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of",
                    String.class, String.class, PostalCodeType.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for AddressType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, street, city, postalCode );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" +
                    street + "', '" + city + "', '" + postalCode + "'", e );
        }
        assertNotNull( instance );
        return (AddressType) instance;
    }


    public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for PostalCodeType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, postalCodeAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
        }
        assertNotNull( instance );
        return (PostalCodeType) instance;
    }


    public static MoneyType instantiateMoney( Float amount, String currency ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for MoneyType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, amount, currency );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
        }
        assertNotNull( instance );
        return (MoneyType) instance;
    }


    private static Class<?> findImplementation( Class<?> interfaceClass ) {
        Method factoryMethod = null;
        try {
            String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
            Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
            assertNotNull( implementingClass );
            return implementingClass;
        } catch (Exception e) {
            fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
            return null; // This line will never be reached, but it's necessary to satisfy the compiler
        }
    }


    private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
            throws ClassNotFoundException, IOException {
        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        String path = packageName.replace( '.', '/' );
        Enumeration<URL> resources = classLoader.getResources( path );
        int count = 0;
        Class<?> result = null;
        while (resources.hasMoreElements()) {
            URL resource = resources.nextElement();
            File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
            File[] files = directory.listFiles();
            for ( File file : files ) {
                if ( file.getName().endsWith( ".class" ) ) {
                    String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
                    Class<?> clazz = Class.forName( className );
                    if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
                        count++;
                        result = clazz;
                    }
                }
            }
        }
        assertEquals( 1, count, "There should be exactly one implementing class" );
        return result;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;
import thkoeln.archilab.ecommerce.usecases.*;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;
import java.util.UUID;


/**
 * This class is used to create the initial master data for the application. This includes
 * customers and items. It is executed on application startup, and is used for testing purposes.
 */
@Component
@SuppressWarnings("PMD")
public class InitialMasterDataCreator {

    public final static String[] CUSTOMER_NAME = new String[]{
            "Max Müller",
            "Sophie Schmitz",
            "Irene Mihalic",
            "Emilia Fischer",
            "Filiz Polat",
            "Lina Wagner",
            "Leon Becker",
            "Agnieszka Kalterer",
            "Felix Bauer",
            "Lara Schulz"
    };
    public final static EmailType[] CUSTOMER_EMAIL = new EmailType[] {
            FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
            FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
            FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
            FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
    };

    public final static AddressType[] CUSTOMER_ADDRESS = new AddressType[] {
            FactoryMethodInvoker.instantiateAddress(
                    "Hauptstraße 1", "Berlin",
                    FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Bahnhofstraße 12", "München",
                    FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Kirchplatz 3", "Hamburg",
                    FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Goethestraße 7", "Frankfurt am Main",
                    FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Mühlenweg 15", "Köln",
                    FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Schulstraße 9", "Düsseldorf",
                    FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Dorfstraße 21", "Stuttgart",
                    FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Marktstraße 5", "Leipzig",
                    FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Rosenweg 14", "Dortmund",
                    FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
            FactoryMethodInvoker.instantiateAddress(
                    "Wiesenstraße 6", "Essen",
                    FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
    };

    public final static CustomerType[] mockCustomers;

    public static final String EUR = "EUR";

    public static final Object[][] ITEM_DATA = new Object[][]{
            {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
                    1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
            {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
                    0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
            {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
                    7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
            {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
                    null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
            {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
                    null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
            {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
                    1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
            {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
                    null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
            {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
                    6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
            {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
                    3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
            {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
                    5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
            {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
                    4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
            {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
                    null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
            {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
                    null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
            {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
                    3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
    };

    private CustomerRegistrationUseCases customerRegistrationUseCases;
    private ItemCatalogUseCases itemCatalogUseCases;
    private InventoryManagementUseCases inventoryManagementUseCases;
    private ShoppingCartUseCases shoppingCartUseCases;


    // item 0 is out of inventory, item 1 and 2 have fixed quantities of 10 and 20, respectively, and the
    // others have a random inventory between 5 and 100
    public static final Map<UUID, Integer> ITEM_INVENTORY = new HashMap<>();

    static {
        mockCustomers = new CustomerType[CUSTOMER_NAME.length];
        for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
            mockCustomers[i] = new MockCustomer(
                    CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i]);
        }
        Random random = new Random();
        for ( Object[] itemData : ITEM_DATA ) {
            ITEM_INVENTORY.put( (UUID) itemData[0], random.nextInt( 100 ) + 20 );
        }
        ITEM_INVENTORY.put( (UUID) ITEM_DATA[0][0], 0 );
        ITEM_INVENTORY.put( (UUID) ITEM_DATA[1][0], 10 );
        ITEM_INVENTORY.put( (UUID) ITEM_DATA[2][0], 20 );
        ITEM_INVENTORY.put( (UUID) ITEM_DATA[3][0], 30 );

    }


    public enum InvalidReason {
        NULL, EMPTY;

        public Object getInvalidValue( Object originalValue ) {
            switch (this) {
                case NULL:
                    return null;
                case EMPTY:
                    return "";
                default:
                    return null;
            }
        }
    }


    @Autowired
    public InitialMasterDataCreator(
            CustomerRegistrationUseCases customerRegistrationUseCases,
            ItemCatalogUseCases itemCatalogUseCases,
            InventoryManagementUseCases inventoryManagementUseCases,
            ShoppingCartUseCases shoppingCartUseCases ) {
        this.customerRegistrationUseCases = customerRegistrationUseCases;
        this.itemCatalogUseCases = itemCatalogUseCases;
        this.inventoryManagementUseCases = inventoryManagementUseCases;
        this.shoppingCartUseCases = shoppingCartUseCases;
    }


    public void deleteAll() {
        shoppingCartUseCases.deleteAllOrders();
        itemCatalogUseCases.deleteItemCatalog();
        customerRegistrationUseCases.deleteAllCustomers();
    }


    public void registerAllCustomers() {
        for ( int i = 0; i < InitialMasterDataCreator.CUSTOMER_NAME.length; i++ ) {
            registerCustomer( InitialMasterDataCreator.CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i] );
        }
    }


    public void registerCustomer( String name, EmailType email, AddressType address ) {
        customerRegistrationUseCases.register( name, email, address );
    }

    public void addAllItems() {
        for ( Object[] itemData : ITEM_DATA ) {
            addItemDataToCatalog( itemData );
        }
    }

    public void addItemDataToCatalog( Object[] itemData ) {
        itemCatalogUseCases.addItemToCatalog( (UUID) itemData[0], (String) itemData[1], (String) itemData[2],
                (Float) itemData[3], (MoneyType) itemData[4], (MoneyType) itemData[5] );
    }


    public Object[] getItemDataInvalidAtIndex( int index, InvalidReason reason ) {
        Object[] itemData = ITEM_DATA[1];
        Object[] itemDataInvalid = new Object[itemData.length];
        System.arraycopy( itemData, 0, itemDataInvalid, 0, itemData.length );
        itemDataInvalid[index] = itemData[index].getClass().cast(
                reason.getInvalidValue( itemData[index] ) );
        return itemDataInvalid;
    }


    public void inventoryUpAllItems() {
        for ( Object[] itemData : ITEM_DATA ) {
            if ( ITEM_INVENTORY.get( itemData[0] ) > 0 )
                inventoryManagementUseCases.addToInventory( (UUID) itemData[0], ITEM_INVENTORY.get( itemData[0] ) );
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockCustomer.java ---
package thkoeln.archilab.ecommerce.masterdata;

import lombok.Setter;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;

import java.util.Objects;

@Setter
public class MockCustomer implements CustomerType {
    private String name;
    private EmailType email;
    private AddressType address;


    public MockCustomer( String name, EmailType email, AddressType address) {
        this.name = name;
        this.email = email;
        this.address = address;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public EmailType getEmail() {
        return email;
    }

    @Override
    public AddressType getAddress() {
        return address;
    }

    @Override
    public boolean equals( Object o ) {
        if ( this == o ) return true;
        if ( !( o instanceof MockCustomer ) ) return false;
        MockCustomer that = (MockCustomer) o;
        return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( address, that.address );
    }

    @Override
    public int hashCode() {
        return Objects.hash( getName(), email, address );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;

@Component
@Profile("!test")
public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
    private Logger logger = LoggerFactory.getLogger( StartupListener.class );

    private InitialMasterDataCreator initialMasterDataCreator;

    @Autowired
    public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
        this.initialMasterDataCreator = initialMasterDataCreator;
    }

    @Override
    public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
        logger.info( "Initializing master data..." );
        initialMasterDataCreator.registerAllCustomers();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
package thkoeln.archilab.ecommerce;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;


@SpringBootApplication
public class ProjectApplication {

	/**
	 * Entry method
	 * @param args
	 */
	public static void main(String[] args) {
		SpringApplication.run(ProjectApplication.class, args);
	}
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
package thkoeln.archilab.ecommerce;

public class ShopException extends RuntimeException {
    public ShopException( String message ) {
        super( message );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerOrderService.java ---
package thkoeln.archilab.ecommerce.solution.customer.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.solution.order.application.OrderCustomerService;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
import thkoeln.archilab.ecommerce.usecases.CustomerType;

@Service
public class CustomerOrderService implements OrderCustomerService {
    CustomerRepository customerRepository;

    @Autowired
    public CustomerOrderService(CustomerRepository customerRepository) {
        this.customerRepository = customerRepository;
    }

    @Override
    public AbstractCustomer findByEmail(Email email) {
        return customerRepository.findByEmailEmailString(email.getEmailString());
    }

    @Override
    public Customer findByEmailEmailString(String email) {
        return null;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerPaymentService.java ---
package thkoeln.archilab.ecommerce.solution.customer.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.solution.payment.application.PaymentCustomerService;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
@Service
public class CustomerPaymentService implements PaymentCustomerService {
    CustomerRepository customerRepository;

    @Autowired
    public CustomerPaymentService(CustomerRepository customerRepository){
        this.customerRepository = customerRepository;

    }
    @Override
    public CustomerType findByEmail(Email email) {
        return customerRepository.findByEmailEmailString(email.getEmailString());
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerRegistrationService.java ---
package thkoeln.archilab.ecommerce.solution.customer.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.domainprimitives.PostalCode;
import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.sql.Date;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.UUID;

@Service
public class CustomerRegistrationService implements CustomerRegistrationUseCases {

    @Autowired
    private CustomerRepository customerRepository;
    @Autowired
    ShoppingCartRepository shoppingCartRepository;


    @Override
    public void register(String name, EmailType email, AddressType address) {
        if (email == null|| address==null) {
            throw new ShopException("invalid input");
        }
        Email customerEmail = (Email) email;
        PostalCode postalCode = (PostalCode) PostalCode.of(address.getPostalCode().toString());
        Address customerAddress = (Address) Address.of(address.getStreet(), address.getCity(), postalCode);
        Customer c = new Customer(UUID.randomUUID(),name,customerEmail,customerAddress);

        if (customerRepository.findByEmailEmailString(customerEmail.getEmailString()) != null) {
            throw new ShopException("Email vorhanden");
        }
        customerRepository.save(c);
        ShoppingCart shoppingCart = new ShoppingCart(UUID.randomUUID(),new ArrayList<>(),c,0);
        shoppingCartRepository.save(shoppingCart);




    }

    @Override
    public void changeAddress(EmailType customerEmail, AddressType address) {
        if (customerEmail == null|| address==null) {
            throw new ShopException("invalid input");
        }
        Email email = (Email) customerEmail;

        if (customerRepository.findByEmailEmailString(email.getEmailString()) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        PostalCode postalCode = (PostalCode) PostalCode.of(address.getPostalCode().toString());
        Address customerAddress = (Address) Address.of(address.getCity(), address.getStreet(), postalCode);
        customerRepository.findByEmailEmailString(email.getEmailString()).setAddress(customerAddress);
    }

    @Override
    public CustomerType getCustomerData(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        if (customerRepository.findByEmailEmailString(email.getEmailString()) ==null) {
            throw new ShopException("Email nicht vorhanden");
        }
        /*return new String[]{a.getName(), a.getEmail().toString(), a.getAddress().getCity(),
                a.getAddress().getStreet(),a.getAddress().getPostalCode().toString()};

         */
        return customerRepository.findByEmailEmailString(email.getEmailString());
    }


    @Override
    public void deleteAllCustomers() {
        shoppingCartRepository.deleteAll();
        customerRepository.deleteAll();
    }
/*

    @Override
    public void register(String name, String email, String street, String city, PostalCode postalCode) {

        Email customerEmail = (Email) Email.of(email);
        Address customerAddress = new Address(street,city,postalCode);
        Customer c = new Customer(UUID.randomUUID(),name,customerEmail,customerAddress);

        if (customerRepository.findByEmail(customerEmail) != null) {
            throw new ShopException("Email vorhanden");
        }
        customerRepository.save(c);
    }

    @Override
    public void changeAddress(String customerEmail, String street, String city, PostalCode postalCode) {
        Email email = (Email) Email.of(customerEmail);

        if (customerRepository.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        Address customerAddress = new Address(street,city,postalCode);
        customerRepository.findByEmail(email).setAddress(customerAddress);
    }

    @Override
    public void register(String name, String email, String street, String city, PostalCode postalCode) {

        Address a = new Address(street,city,postalCode);
        Customer c = new Customer(name,email,a);

        if (customerRepository.findByEmail(email) != null) {
            throw new ShopException("Email vorhanden");
        }
        customerRepository.save(c);
    }

    @Override
    public void changeAddress(String customerEmail, String street, String city, PostalCode postalCode) {

        Address a = new Address(street,city,postalCode);
        if (customerRepository.findByEmail(customerEmail) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        customerRepository.findByEmail(customerEmail).setAddress(a);
    }

    @Override
    public String[] getCustomerData(String customerEmail) {

        if (customerRepository.findByEmail(customerEmail) ==null) {
            throw new ShopException("Email nicht vorhanden");
        }
        Customer a= customerRepository.findByEmail(customerEmail);
        return new String[]{a.getName(), a.getEmail().toString(), a.getAddress().getCity(),
                            a.getAddress().getStreet(),a.getAddress().getPostalCode().toString()};
    }


 */

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerShoppingCartService.java ---
package thkoeln.archilab.ecommerce.solution.customer.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCustomerService;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
@Service
public class CustomerShoppingCartService implements ShoppingCustomerService {


    CustomerRepository customerRepository;

    @Autowired
    public CustomerShoppingCartService(CustomerRepository customerRepository){
        this.customerRepository = customerRepository;

    }

    @Override
    public CustomerType findByEmail(Email email) {
        return customerRepository.findByEmailEmailString(email.getEmailString());
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java ---
package thkoeln.archilab.ecommerce.solution.customer.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.usecases.CustomerType;


import javax.persistence.*;
import java.util.List;
import java.util.UUID;

@NoArgsConstructor
@Getter
@Entity

public class Customer extends AbstractCustomer implements CustomerType  {
    @Setter
    private String name;
    @OneToOne(mappedBy = "customer", cascade = CascadeType.REMOVE)
    private ShoppingCart shoppingCart;
    @OneToMany
    private List<Order> orders;
    @Id
    private UUID customerId;
    @Setter
    @Embedded
    private Email email;
    @Setter
    @Embedded
    private Address address;

    public Customer(UUID customerId, String name, Email email, Address address) {
        super(customerId, email);
        if (name == null || name.isEmpty() || email == null || address == null ) {
            throw new ShopException("Invalid customer data");
        }

        this.name = name;
        this.customerId = customerId;
        this.email = email;
        this.address = address;
    }
    public void setCustomerId(UUID itemId) {
        if (this.customerId != null) {
            throw new ShopException("customerId can´t be changed");
        }
        this.customerId = itemId;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\CustomerRepository.java ---
package thkoeln.archilab.ecommerce.solution.customer.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import javax.persistence.Id;
import java.util.UUID;
@Repository
public interface CustomerRepository extends CrudRepository<Customer, Id> {

    Customer findByEmailEmailString(String email);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\DeliveryRecipientClass.java ---
package thkoeln.archilab.ecommerce.solution.customer.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.PostalCode;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;

import javax.persistence.Embeddable;
import javax.persistence.Embedded;

@Getter
@NoArgsConstructor
@Embeddable
public class DeliveryRecipientClass extends Customer {

    @Setter
    private String name;
    @Setter
    @Embedded
    private Email email;
    @Setter
    private Address address;

    public DeliveryRecipientClass(String name, Email email, Address address) {
        if (name == null || name.isEmpty() || email == null || address == null) {
            throw new ShopException("Invalid deliveryRecipient data");
        }
        if (address.getCity() == null || address.getCity().isEmpty() || address.getStreet() == null || address.getStreet().isEmpty()
                || address.getPostalCode() == null) {
            throw new ShopException("Invalid deliveryRecipient data");
        }

        this.name = name;
        this.email = email;
        this.address = address;
    }

    public DeliveryRecipientClass(String name, Email email, String city, String street, PostalCode postalCode) {
        this(name, email, new Address(city, street, postalCode));
    }

    public String getName() {
        return this.name;
    }

    @Override
    public Email getEmail() {
        return this.email;
    }

}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
package thkoeln.archilab.ecommerce.solution.delivery.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
import thkoeln.archilab.ecommerce.solution.customer.domain.DeliveryRecipientClass;
import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
import thkoeln.archilab.ecommerce.solution.item.domain.Item;
import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@Service
public class DeliveryService implements DeliveryUseCases {
    @Autowired
    DeliveryRepository deliveryRepository;
    @Autowired
    ItemRepository itemRepository;

    @Override
    public UUID triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
        if (deliveryRecipient == null || deliveryContent==null||deliveryContent.isEmpty() ) {
            throw new ShopException("Invalid payment data");
        }
        int totalItems = 0;
        for (Integer itemCount : deliveryContent.values()) {
            totalItems += itemCount;
        }
        if (totalItems > 20) {
            throw new ShopException("Too many items in the delivery");
        }
        Map<Item, Integer> itemHash = new HashMap<>();
        for (Map.Entry<UUID, Integer> entry : deliveryContent.entrySet()) {
            UUID itemId = entry.getKey();
            Integer quantity = entry.getValue();

            Item item = itemRepository.findByItemId(itemId);

            itemHash.put(item, quantity);
        }
        UUID id = UUID.randomUUID();
        Email email = (Email) Email.of(deliveryRecipient.getEmail().toString());
        //Address customerAddress = (Address) Address.of(deliveryRecipient.getAddress().getCity(), deliveryRecipient.getAddress().getStreet(), deliveryRecipient.getAddress().getPostalCode());
        deliveryRepository.save(new Delivery(id,email,itemHash));
        return id;
    }
/*
    public UUID triggerDeliveryCheck(DeliveryRecipientClass deliveryRecipient, Map<UUID, Integer> deliverableItems) {
        if (deliveryRecipient == null || deliveryContent==null||deliveryContent.isEmpty() ) {
            throw new ShopException("Invalid payment data");
        }
        int totalItems = 0;
        for (Integer itemCount : deliveryContent.values()) {
            totalItems += itemCount;
        }
        if (totalItems > 20) {
            throw new ShopException("Too many items in the delivery");
        }
        UUID id = UUID.randomUUID();        deliveryRepository.save(new Delivery(id,deliveryRecipient,deliverableItems));
        return id;
    }


 */
    @Override
    public Map<UUID, Integer> getDeliveryHistory(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        List<Delivery> userDelivery = deliveryRepository.findAllByEmail(email);
        if(userDelivery == null || userDelivery.isEmpty()) throw new ShopException("Email nicht vorhanden");

        Map<UUID, Integer> history = new HashMap<>();
        for (Delivery delivery : userDelivery) {
            for (Map.Entry<Item, Integer> entry : delivery.getItemHash().entrySet()) {
                UUID itemId = entry.getKey().getItemId();
                Integer quantity = entry.getValue();
                history.put(itemId, history.getOrDefault(itemId, 0) + quantity);
            }
        }
        return history;
    }

    @Override
    public void deleteDeliveryHistory() {
        deliveryRepository.deleteAll();
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryShoppingService.java ---
package thkoeln.archilab.ecommerce.solution.delivery.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingDeliveryService;
import thkoeln.archilab.ecommerce.usecases.CustomerType;

import java.util.Map;
import java.util.UUID;

@Service
public class DeliveryShoppingService implements ShoppingDeliveryService {
    DeliveryService deliveryService;

    @Autowired
    public DeliveryShoppingService(DeliveryService deliveryService){
        this.deliveryService=deliveryService;
    }
    @Override
    public void triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
        deliveryService.triggerDelivery(deliveryRecipient,deliveryContent);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.dom4j.tree.AbstractEntity;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.customer.domain.DeliveryRecipientClass;
import thkoeln.archilab.ecommerce.solution.item.domain.Item;

import javax.persistence.ElementCollection;
import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.Id;
import java.util.Map;
import java.util.UUID;

@Getter
@Entity
@NoArgsConstructor
public class Delivery extends AbstractEntity {
    @Id
    UUID deliveryId;
    @Setter
    @Embedded
    private Email email;
    @Setter
    @ElementCollection
    private Map<Item, Integer> itemHash;

    public Delivery(UUID deliveryId, Email email, Map<Item,Integer> itemHash){
        if (deliveryId == null || email == null || itemHash.isEmpty()) {
            throw new ShopException("Invalid Delivery data");
        }
        this.deliveryId=deliveryId;
        this.email=email;
        this.itemHash =itemHash;
    }
    public void setDeliveryId(UUID itemId) {
        if (this.deliveryId != null) {
            throw new ShopException("deliveryId can´t be changed");
        }
        this.deliveryId = itemId;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.List;
import java.util.UUID;

public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
    List<Delivery> findAllByEmail(Email email);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryItemService.java ---
package thkoeln.archilab.ecommerce.solution.inventory.application;

import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import java.util.UUID;

public interface InventoryItemService {
    AbstractItem findByItemId(UUID itemId);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryManagementService.java ---
package thkoeln.archilab.ecommerce.solution.inventory.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService;
import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;

import java.util.UUID;

@Service

public class InventoryManagementService implements InventoryManagementUseCases {
    @Autowired
    private InventoryRepository inventoryRepository;

    @Autowired
    private ShoppingCartService shoppingCartService;

    @Autowired
    private InventoryItemService inventoryItemService;


    @Override
    public void addToInventory(UUID itemId, int addedQuantity) {

        if (inventoryItemService.findByItemId(itemId)==null) throw new ShopException ("id nicht vorhanden") ;
        if (addedQuantity<=0) throw new ShopException("Menge negativ");

        int quantity = inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity() + addedQuantity;
        inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(quantity);

    }

    @Override
    public void removeFromInventory(UUID itemId, int removedQuantity) {

        if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");
        if ( removedQuantity<=0) throw new ShopException("keine negativen Abzüge");

        int quantityInventory = inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity();
        int quantityShoppingCart = shoppingCartService.getReservedInventoryInShoppingCarts(itemId);
        int quantityOverall = quantityInventory+quantityShoppingCart;
        if (quantityOverall<removedQuantity) throw new ShopException("nicht genug vorhanden");

        if(removedQuantity<=quantityInventory){
            inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(quantityInventory-removedQuantity);
        }
        else{
            inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(0);
            int rest = removedQuantity-quantityInventory;
            shoppingCartService.adjustInventory(itemId,rest);
        }
    }

    @Override
    public void changeInventoryTo(UUID itemId, int newTotalQuantity) {

        if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");
        if (newTotalQuantity<0) throw new ShopException("keine negativen Mengen");

        inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(newTotalQuantity);
        if(newTotalQuantity< shoppingCartService.getReservedInventoryInShoppingCarts(itemId)){
            int rest = shoppingCartService.getReservedInventoryInShoppingCarts(itemId)-newTotalQuantity;
            shoppingCartService.adjustInventory(itemId,rest);
        }
    }

    @Override
    public int getAvailableInventory(UUID itemId) {

        if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");

        return inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryShoppingCartService.java ---
package thkoeln.archilab.ecommerce.solution.inventory.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryElement;
import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingInventoryService;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;

import java.util.List;
import java.util.UUID;

@Service
public class InventoryShoppingCartService implements ShoppingInventoryService {

    InventoryRepository inventoryRepository;

    @Autowired
    public InventoryShoppingCartService(InventoryRepository inventoryRepository){
        this.inventoryRepository= inventoryRepository;
    }
    /*@Override
    public InventoryElement findByItem(Item item) {
        return inventoryRepository.findByItem(item);
    }

     */

    @Override
    public Integer getQuantity(AbstractItem item) {
        return inventoryRepository.findByItem(item).getQuantity();
    }

    @Override
    public void setQuantity(AbstractItem item, Integer quantity) {
        InventoryElement inventoryElement = inventoryRepository.findByItem(item);
        inventoryElement.setQuantity(quantity);
        inventoryRepository.save(inventoryElement);
    }

    @Override
    public void isOrdered(List<ShoppingCartPart> items) {
        for(ShoppingCartPart shoppingCartItem:items){
            InventoryElement inventoryElement = inventoryRepository.findByItem(shoppingCartItem.getItem());
            inventoryElement.setOrdered(true);
            inventoryRepository.save(inventoryElement);
        }

    }




}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryElement.java ---
package thkoeln.archilab.ecommerce.solution.inventory.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.dom4j.tree.AbstractEntity;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.OneToOne;
import java.util.UUID;

@Getter
@NoArgsConstructor
@Entity
public class InventoryElement extends AbstractEntity {
    @Id
    UUID inventoryElementId;
    @OneToOne
    @JoinColumn(name = "item_item_id", nullable = false)
    @Setter
    private AbstractItem item;
    @Setter
    private Integer quantity;
    @Setter
    private Boolean ordered;

    public InventoryElement(UUID inventoryElementId , AbstractItem item, Integer quantity){
        if (item == null ||quantity == null || quantity <0) throw new ShopException("id nicht vorhanden");

        this.inventoryElementId = inventoryElementId;
        this.item = item;
        this.quantity = quantity;
        this.ordered = false;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryRepository.java ---
package thkoeln.archilab.ecommerce.solution.inventory.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import java.util.UUID;
@Repository
public interface InventoryRepository extends CrudRepository<InventoryElement,UUID> {

    InventoryElement findByItem(AbstractItem item);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemCatalogService.java ---
package thkoeln.archilab.ecommerce.solution.item.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryElement;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService;
import thkoeln.archilab.ecommerce.solution.item.domain.Item;
import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPartRepository;
import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;
@Service
public class ItemCatalogService implements ItemCatalogUseCases {
    @Autowired
     ItemRepository itemRepository;
    @Autowired
    InventoryRepository inventoryRepository;
    @Autowired
     ShoppingCartPartRepository shoppingCartPartRepository;
    @Autowired
     ShoppingCartService shoppingCartService;


    @Override
    public void addItemToCatalog(UUID itemId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellPrice) {
        if (purchasePrice == null||sellPrice==null) {
            throw new ShopException("price==null");
        }
        Money purchase = (Money) Money.of(purchasePrice.getAmount(),purchasePrice.getCurrency());
        Money sell = (Money) Money.of(sellPrice.getAmount(),sellPrice.getCurrency());

        Item item = new Item(itemId,name,description,size,purchase,sell);

        itemRepository.save(item);
            InventoryElement element = new InventoryElement(UUID.randomUUID(),itemRepository.findByItemId(itemId),0);
            inventoryRepository.save(element);

    }

    @Override
    public void removeItemFromCatalog(UUID itemId) {

        if (itemRepository.findByItemId(itemId) == null) {
            throw new ShopException("ID nicht vorhanden");
        }
        Item item = itemRepository.findByItemId(itemId);

        if (inventoryRepository.findByItem(item).getQuantity()>0){
            throw new ShopException("Item still in inventory");
        }
        if(shoppingCartPartRepository.findAllByItem(itemRepository.findByItemId(itemId))!=null && shoppingCartService.getReservedInventoryInShoppingCarts(itemId)>0){
            throw new ShopException("Item still in Shopping Cart");
        }
        if(inventoryRepository.findByItem(item).getOrdered())throw new ShopException("Item is ordered");
        inventoryRepository.delete(inventoryRepository.findByItem(item));
        itemRepository.delete(item);
    }

    @Override
    public MoneyType getSellPrice(UUID itemId) {
        Item item = itemRepository.findByItemId(itemId);
        if (itemRepository.findByItemId(itemId) == null) {
            throw new ShopException("ID nicht vorhanden");
        }
        return item.getSellPrice();
    }


    @Override
    public void deleteItemCatalog() {
        inventoryRepository.deleteAll();
        itemRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemInventoryService.java ---
package thkoeln.archilab.ecommerce.solution.item.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.inventory.application.InventoryItemService;
import thkoeln.archilab.ecommerce.solution.item.domain.Item;
import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;

import java.util.UUID;

@Service
public class ItemInventoryService implements InventoryItemService {
    ItemRepository itemRepository;

    @Autowired
    public ItemInventoryService(ItemRepository itemRepository){
        this.itemRepository=itemRepository;
    }
    @Override
    public Item findByItemId(UUID itemId) {
        return itemRepository.findByItemId(itemId);
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemShoppingCartService.java ---
package thkoeln.archilab.ecommerce.solution.item.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingItemService;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import java.util.UUID;
@Service
public class ItemShoppingCartService implements ShoppingItemService {
    ItemRepository itemRepository;

    @Autowired
    public ItemShoppingCartService(ItemRepository itemRepository){
        this.itemRepository = itemRepository;
    }

    @Override
    public AbstractItem findByItemId(UUID itemId) {
        return itemRepository.findByItemId(itemId);
    }

    @Override
    public UUID getItemId(AbstractItem item) {
        return item.getItemId();
    }

    @Override
    public Money getSellPrice(AbstractItem item) {
        return item.getSellPrice();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\Item.java ---
package thkoeln.archilab.ecommerce.solution.item.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import javax.persistence.*;
import java.util.UUID;

@Getter
@NoArgsConstructor
@Entity

public class Item extends AbstractItem {

    @Setter
    private String name;
    @Setter
    private String description;
    @Setter
    private Float size;
    @Setter
    @Embedded
    private Money purchasePrice;


    public Item(UUID itemId, String name, String description, Float size, Money purchasePrice, Money sellPrice) {
        super(itemId, sellPrice);

        if (name == null || name.isEmpty() || description == null || description.isEmpty() || itemId == null || purchasePrice == null
                || purchasePrice.getAmount() <= 0 || sellPrice == null || sellPrice.getAmount() <= purchasePrice.getAmount() )  {
            throw new ShopException("Invalid item data");
        }

        this.name = name;
        this.description = description;
        this.size = size;
        this.purchasePrice = purchasePrice;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\ItemRepository.java ---
package thkoeln.archilab.ecommerce.solution.item.domain;

import org.springframework.data.repository.CrudRepository;

import java.util.UUID;

public interface ItemRepository extends CrudRepository <Item, UUID> {
    Item findByItemId(UUID itemId);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.http.ResponseEntity;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.*;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;

import java.util.*;
@RestController
@RequestMapping
@Transactional
public class OrderController {
    OrderRepository orderRepository;
    OrderService orderService;

    public OrderController(OrderRepository orderRepository){
        this.orderRepository= orderRepository;
    }

    @GetMapping("/orders")
    public ResponseEntity<List<OrderDto>> getOrdersByMail(
            @RequestParam(value = "email", required = false) String email,
            @RequestParam(value = "filter",  required = false) String filter) {
        List<OrderDto> orderDtos = new ArrayList<>();

        if (StringUtils.isEmpty(email)) {
            return ResponseEntity.ok(orderDtos);
        }

        List<Order> orders = orderRepository.findByCustomerEmailEmailString(email);

        if (Objects.equals(filter, "latest")) {
            if (orders == null || orders.isEmpty())
            {
                return ResponseEntity.ok(orderDtos);
            }
            orders = List.of(orderRepository.findFirstByCustomerEmailEmailStringOrderBySubmissionDateDesc(email));
        }
        List<OrderDto> allOrderDtos = new ArrayList<>();
        for (Order order: orders){
            allOrderDtos.add(OrderDtoMapperService.mapToDto(order));
        }

        return ResponseEntity.ok(allOrderDtos);
    }

/*
    //Create
    @PostMapping("/orders")
    public ResponseEntity<OrderDto> createOrder(@RequestAttribute OrderDto orderDto){


        Order order= orderService.createOrderFromDto(orderDto);
        for(OrderPart orderPart: orderDto.getOrderParts()){
            shoppingCartService.addItemToShoppingCart(order.getCustomer().getEmail(),orderPart.getItem().getItemId(),orderPart.getQuantity());
        }
        shoppingCartService.checkout(order.getCustomer().getEmail());
        URI returnUri = ServletUriComponentsBuilder.fromCurrentRequest().path("/id")
                        .buildAndExpand(order.getOrderId()).toUri();
        OrderDto createdOrderDto = OrderDtoMapper.mapToDto(order);
        return ResponseEntity.created(returnUri).body(createdOrderDto);
    }

 */
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderCustomerService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
import thkoeln.archilab.ecommerce.usecases.CustomerType;

public interface OrderCustomerService {
    AbstractCustomer findByEmail(Email email);
    AbstractCustomer findByEmailEmailString(String email);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDto.java ---
package thkoeln.archilab.ecommerce.solution.order.application;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;

import java.sql.Date;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class OrderDto {
    private UUID id;
    private Email email;
    private Money price;
    private List<OrderPartDto> orderParts;
    private LocalDateTime submissionDate;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapperService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;

import java.util.ArrayList;
import java.util.List;
@Service
public class OrderDtoMapperService {
    @Autowired
    OrderCustomerService orderCustomerService;

    public static OrderDto mapToDto(Order order) {

        OrderDto orderDto = new OrderDto();
        orderDto.setId(order.getOrderId());

        orderDto.setEmail(order.getCustomer().getEmail());
        orderDto.setPrice(order.getMoney());
        /*List<OrderPartDto> orderPartDtos =  order.getOrderParts().stream()
                        .map(orderPart -> new OrderPartDto(orderPart.getItem().getItemId(),orderPart.getQuantity(),orderPart.getComment()))
                                .collect(Collectors.toList());

         */
        List<OrderPartDto> orderPartDtos= mapOrderPartsToDto(order.getOrderParts());

        orderDto.setOrderParts(orderPartDtos);
        orderDto.setSubmissionDate(order.getSubmissionDate());


        return orderDto;
    }
/*
    public static Order mapToEntity(OrderDto orderDto) {
        UUID orderId = orderDto.getId();
        Customer customer= customerRepository.findByEmail_EmailAsString(orderDto.getEmailString());
        Money money = new Money(orderDto.getMoneyAmount(),"");
        List<OrderPart> orderParts = orderDto.getOrderParts();

        return new Order(orderId, orderParts, customer, money,orderDto.getSubmissionDate());
    }


 */
    public static List<OrderPartDto> mapOrderPartsToDto(List<OrderPart> orderParts) {
        List<OrderPartDto> orderPartDtos = new ArrayList<>();
        for (OrderPart orderPart : orderParts) {
            OrderPartDto orderPartDto = new OrderPartDto(
                    orderPart.getItem().getItemId(),
                    orderPart.getQuantity(),
                    orderPart.getComment()
            );
            orderPartDtos.add(orderPartDto);
        }
        return orderPartDtos;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderExceptions.java ---
package thkoeln.archilab.ecommerce.solution.order.application;


public class OrderExceptions {
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPartDto.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class OrderPartDto {
    private UUID itemId;
    private int quantity;
    private String comment;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPartRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;

import java.sql.Date;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;
@Service
public class OrderService {

    @Autowired
    private ShoppingCartRepository shoppingCartRepository;
    @Autowired
    private OrderPartRepository orderPartRepository;
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private OrderCustomerService orderCustomerService;
/*
    public Order createOrderFromDto(OrderDto orderDto){
        Order order = OrderDtoMapper.mapToEntity(orderDto);
        orderRepository.save(order);
        return order;
    }

 */

    public void instantiateOrder(Email email, Money money) {
        Order order = new Order(UUID.randomUUID(), new ArrayList<>(), orderCustomerService.findByEmailEmailString(email.getEmailString()), money, LocalDateTime.now());
        orderRepository.save(order);
    }


    public void persistOrder(Email email, Money money, List<ShoppingCartPart> usersList) {
        List<OrderPart> orderParts = new ArrayList<>();
        Order order = new Order(UUID.randomUUID(), new ArrayList<>(), orderCustomerService.findByEmailEmailString(email.getEmailString()), money,LocalDateTime.now());
        for (ShoppingCartPart item : usersList) {
            UUID id = UUID.randomUUID();
            OrderPart part = new OrderPart(id, item.getItem(), item.getEmail(), item.getQuantity(),"");

            orderPartRepository.save(part);
            orderParts.add(part);

        }
        orderRepository.save(order);

    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderShoppingService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPartRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingOrderService;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;

import java.sql.Date;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.*;


@Service
public class OrderShoppingService implements ShoppingOrderService {
    OrderRepository orderRepository;
    OrderPartRepository orderPartRepository;
    OrderCustomerService orderCustomerService;

    @Autowired
    public OrderShoppingService(OrderRepository orderRepository, OrderPartRepository orderPartRepository, OrderCustomerService orderCustomerService){
        this.orderRepository=orderRepository;
        this.orderPartRepository=orderPartRepository;
        this.orderCustomerService=orderCustomerService;
    }


    @Override
    public void instantiateOrder(Email email, Money money) {
        if(orderRepository.findByCustomerEmailEmailString(email.getEmailString())==null){
            Order order = new Order(UUID.randomUUID(),new ArrayList<>()
                    ,orderCustomerService.findByEmailEmailString(email.getEmailString()),money, LocalDateTime.now());
            orderRepository.save(order);
        }
    }

    @Override
    public void persistOrder(Email email, Money money, List<ShoppingCartPart> usersList) {
        List<OrderPart> orderParts = new ArrayList<>();
        Order order = new Order(UUID.randomUUID(), orderParts, orderCustomerService.findByEmail(email), money,LocalDateTime.now());
        for (ShoppingCartPart item : usersList) {
            UUID id = UUID.randomUUID();
            OrderPart part = new OrderPart(id, item.getItem(), item.getEmail(), item.getQuantity(),item.getComment());

            orderPartRepository.save(part);
            orderParts.add(part);

        }
        orderRepository.save(order);

    }

    @Override
    public Map<UUID,Integer> getOrderParts(Email email) {
        Map<UUID,Integer> history= new HashMap<>();
        List<Order> orders = orderRepository.findByCustomerEmailEmailString(email.getEmailString());
        for(Order order: orders){
            List<OrderPart> userOrders = order.getOrderParts();
            for(OrderPart orderPart : userOrders){
                int count = history.getOrDefault(orderPart.getItem().getItemId(), 0);
                history.put(orderPart.getItem().getItemId(), count + orderPart.getQuantity());
            }
        }
        return history;
    }

    @Override
    public void deleteAll() {
        orderRepository.deleteAll();
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
    package thkoeln.archilab.ecommerce.solution.order.domain;

    import lombok.Generated;
    import lombok.Getter;
    import lombok.Setter;
    import thkoeln.archilab.ecommerce.ShopException;
    import thkoeln.archilab.ecommerce.domainprimitives.Email;
    import thkoeln.archilab.ecommerce.domainprimitives.Money;
    import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;


    import java.sql.Date;
    import java.time.LocalDateTime;
    import java.util.List;
    import java.util.UUID;


    import lombok.NoArgsConstructor;
    import org.dom4j.tree.AbstractEntity;
    import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;

    import javax.persistence.*;

    @Getter
    @NoArgsConstructor
    @Entity
    @Table(name = "TabelleOrder")
    public class Order extends AbstractEntity {

        @Id
        private UUID orderId;

        @OneToMany
        @JoinColumn(name = "order_id")
        @Setter
        private List<OrderPart> orderParts;
        @Setter
        @ManyToOne(cascade = CascadeType.REMOVE)
        private AbstractCustomer customer;
        @Embedded
        @Setter
        private Money money;
        private LocalDateTime submissionDate;


        // Weitere Attribute der Bestellung (z. B. Datum, Kunde, Versandinformationen) können hier hinzugefügt werden

        public Order(UUID orderId, List<OrderPart> orderParts,AbstractCustomer customer, Money money, LocalDateTime submissionDate) {
            this.orderId = orderId;
            this.orderParts = orderParts;
            this.customer =customer;
            this.money=money;
            this.submissionDate=submissionDate;
        }
        public void setOrderId(UUID itemId) {
            if (this.orderId != null) {
                throw new ShopException("OrderId can´t be changed");
            }
            this.orderId = itemId;
        }
    }


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import org.yaml.snakeyaml.events.Event;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.List;
import java.util.UUID;
@Repository
public interface OrderRepository extends CrudRepository<Order, Event.ID> {
    List<Order> findByCustomerEmailEmailString(String email);
    Order findByOrderId(UUID uuid);
    Order findFirstByCustomerEmailEmailStringOrderBySubmissionDateDesc(String email);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\application\OrderPartDto.java ---
package thkoeln.archilab.ecommerce.solution.orderpart.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import javax.persistence.Embedded;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class OrderPartDto {
    private AbstractItem item;
    private Email email;
    private Integer quantity;


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\domain\OrderPart.java ---
package thkoeln.archilab.ecommerce.solution.orderpart.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.dom4j.tree.AbstractEntity;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import javax.persistence.*;
import java.util.UUID;
@Getter
@NoArgsConstructor
@Entity
public class OrderPart extends AbstractEntity {
    @Id
    private UUID orderPartId;
    @Setter
    @OneToOne
    private AbstractItem item;
    @Setter
    @Embedded
    private Email email;
    @Setter
    private Integer quantity;
    @Setter
    private String comment;


    public OrderPart(UUID orderPartId, AbstractItem item, Email email,  Integer quantity, String comment){

        this.orderPartId=orderPartId;
        this.item = item;
        this.email=email;
        this.quantity=quantity;
        this.comment=comment;
    }
    public void setOrderPartId(UUID itemId) {
        if (this.orderPartId != null) {
            throw new ShopException("OrderId can´t be changed");
        }
        this.orderPartId = itemId;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\domain\OrderPartRepository.java ---
package thkoeln.archilab.ecommerce.solution.orderpart.domain;

import org.springframework.data.repository.CrudRepository;
import org.yaml.snakeyaml.events.Event;


public interface OrderPartRepository extends CrudRepository<OrderPart, Event.ID> {

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentCustomerService.java ---
package thkoeln.archilab.ecommerce.solution.payment.application;

import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.usecases.CustomerType;

public interface PaymentCustomerService {
    CustomerType findByEmail(Email email);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
package thkoeln.archilab.ecommerce.solution.payment.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.List;
import java.util.UUID;

@Service
public class PaymentService implements PaymentUseCases {
    @Autowired
    PaymentRepository paymentRepository;
    @Autowired
    PaymentCustomerService paymentCustomerService;

    @Override
    public UUID authorizePayment(EmailType customerEmail, MoneyType amount) {
        if (customerEmail == null ||  amount == null ) {
            throw new ShopException("Invalid payment data");
        }
        if( amount.getAmount() <= 0.0f || amount.getAmount() > 500.00){
            System.out.println("amount:"+amount.getAmount());
            throw new ShopException("Invalid payment amount");
        }
        Email email = (Email) Email.of(customerEmail.toString());
        if (paymentCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");

        Money money = new Money(amount.getAmount(), amount.getCurrency());
        Payment payment = new Payment(UUID.randomUUID(), email, money);

        //ein unbezahltes Payment wird ersetzt
        //if(paymentRepository.findByEmailAndPayed(customerEmail,false)==null){
        paymentRepository.save(payment);
        return UUID.randomUUID();
    }

    @Override
    public MoneyType getPaymentTotal(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        if (customerEmail.toString().isEmpty()) throw new ShopException("Email nicht vorhanden");
        if (paymentCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");

        List<Payment> payments = paymentRepository.findAllByEmail(email);
        float totalPaymentAmount = 0.0f;
        for (Payment payment : payments) {
            totalPaymentAmount += payment.getMoney().getAmount();
        }

        return new Money(totalPaymentAmount,payments.get(0).getMoney().getCurrency());
    }


    @Override
    public void deletePaymentHistory() {
        paymentRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.dom4j.tree.AbstractEntity;
import org.springframework.beans.factory.annotation.Autowired;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;

import javax.persistence.*;
import java.util.UUID;

@NoArgsConstructor
@Getter
@Entity
public class Payment extends AbstractEntity {

    @Id
    private UUID paymentId;
    private Email email;
    @Setter
    @Embedded
    private Money money;
    @Setter
    @Column(columnDefinition = "boolean default false")
    private Boolean payed;

    public Payment(UUID paymentId, Email email, Money money){
        if (paymentId == null ||  email == null || money.getAmount() == null ) {
            throw new ShopException("Invalid payment data");
        }
        this.paymentId = paymentId;
        this.email = email;
        this.money= new Money(money.getAmount(), money.getCurrency());
        this.payed = false;
    }
    public void setPaymentId(UUID itemId) {
        if (this.paymentId != null) {
            throw new ShopException("PaymentId can´t be changed");
        }
        this.paymentId = itemId;
    }
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.List;
import java.util.UUID;

public interface PaymentRepository extends CrudRepository<Payment, UUID> {
    Payment findByPaymentId(UUID paymentId);
    List<Payment> findAllByEmail(Email email);
    Payment findByEmailAndPayed(Email email,Boolean payed);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartController.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;

import java.util.List;
import java.util.Optional;
import java.util.UUID;
import java.util.stream.Collectors;

@RestController
@RequestMapping
public class ShoppingCartController {

    private final ShoppingCartService shoppingCartService;
    ShoppingCartRepository shoppingCartRepository;
    ShoppingCustomerService shoppingCustomerService;
    ShoppingCartPartRepository shoppingCartPartRepository;
    ShoppingItemService shoppingItemService;
    ShoppingCartItemDtoMapperService shoppingCartItemDtoMapperService;


    public ShoppingCartController(ShoppingCartService shoppingCartService, ShoppingCartRepository shoppingCartRepository
            ,ShoppingCustomerService shoppingCustomerService, ShoppingCartPartRepository shoppingCartPartRepository
            ,ShoppingItemService shoppingItemService, ShoppingCartItemDtoMapperService shoppingCartItemDtoMapperService         ) {
        this.shoppingCartService = shoppingCartService;
        this.shoppingCartRepository= shoppingCartRepository;
        this.shoppingCustomerService = shoppingCustomerService;
        this.shoppingCartPartRepository = shoppingCartPartRepository;
        this.shoppingItemService=shoppingItemService;
        this.shoppingCartItemDtoMapperService = shoppingCartItemDtoMapperService;

    }

    @GetMapping("/shoppingCarts")
    public ResponseEntity<ShoppingCartDto> getShoppingCartsByEmail(@RequestParam(value = "email",required = false) String email) {

            Optional<ShoppingCart> optionalShoppingCart = Optional.ofNullable(shoppingCartRepository.findByCustomerEmailEmailString(email));
            if (optionalShoppingCart.isPresent()) {
                ShoppingCart shoppingCart = optionalShoppingCart.get();
                ShoppingCartDto shoppingCartDto = ShoppingCartDtoMapperService.mapToDto(shoppingCart);
                return ResponseEntity.ok(shoppingCartDto);
            } else {
                return ResponseEntity.notFound().build();
            }

    }

    @GetMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts/{itemId}")
    public ResponseEntity<ShoppingCartItemDto> getShoppingCartItem(
            @PathVariable("shoppingCartId") UUID shoppingCartId,
            @PathVariable("itemId") UUID itemId) {
        ShoppingCart shoppingCart= shoppingCartRepository.findByShoppingCartId(shoppingCartId);

        if (shoppingCart!=null) {

            Optional<ShoppingCartPart> optionalShoppingCartPart = shoppingCart.getShoppingCartItems().stream()
                    .filter(item -> item.getItem().getItemId().equals(itemId))
                    .findFirst();

            if (optionalShoppingCartPart.isPresent()) {
                ShoppingCartPart shoppingCartPart = optionalShoppingCartPart.get();
                ShoppingCartItemDto shoppingCartItemDto = new ShoppingCartItemDto(
                        shoppingCartPart.getItem().getItemId(),
                        shoppingCartPart.getQuantity(),
                        shoppingCartPart.getComment()
                );
                if(shoppingCartPart.getQuantity()==null||shoppingCartPart.getComment()==null)return ResponseEntity.notFound().build();
                return ResponseEntity.ok(shoppingCartItemDto);
            }
        }
        return ResponseEntity.notFound().build();
    }



    @PostMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts")
    public ResponseEntity<Void> addOrUpdateShoppingCartPart(
            @PathVariable("shoppingCartId") UUID shoppingCartId,
            @RequestBody ShoppingCartItemDto shoppingCartItemDto) {
        ShoppingCartPart shoppingCartPart = shoppingCartItemDtoMapperService.mapToEntity(shoppingCartItemDto,shoppingCartId);
        ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
        if(shoppingCart!=null){
            try {
                shoppingCartService.updateItemInShoppingCart(shoppingCart.getCustomer().getEmail(),
                        shoppingCartPart.getItem().getItemId(), shoppingCartPart.getQuantity(), shoppingCartPart.getComment());
                return ResponseEntity.status(HttpStatus.CREATED).build();
            }catch (ShopException shopException){
            shopException.printStackTrace();
            return ResponseEntity.status(HttpStatus.CONFLICT).build();
            }
        }
        return ResponseEntity.notFound().build();

    }

    @DeleteMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts/{itemId}")
    public ResponseEntity<Void> removeShoppingCartPart(
            @PathVariable("shoppingCartId") UUID shoppingCartId,
            @PathVariable("itemId") UUID itemId) {
        ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
        if (shoppingCart != null) {
            String email = shoppingCart.getCustomer().getEmail().getEmailString();
            List<ShoppingCartPart> deletedList = shoppingCart.getShoppingCartItems();
            boolean bool = deletedList.stream().anyMatch(shoppingCartPart -> shoppingCartPart.getItem().getItemId().equals(itemId));
            if (!bool) return ResponseEntity.notFound().build();

            List<ShoppingCartPart> newList = deletedList.stream().filter(shoppingCartPart -> !shoppingCartPart.getItem().getItemId().equals(itemId)).collect(Collectors.toList());
            shoppingCart.setShoppingCartItems(newList);
            shoppingCartRepository.findByShoppingCartId(shoppingCartId).setTotalQuantity(
                    shoppingCartRepository.findByShoppingCartId(shoppingCartId).getTotalQuantity() -
                            shoppingCartPartRepository.findByEmailEmailStringAndItem(
                                    email, shoppingItemService.findByItemId(itemId)).getQuantity());
            shoppingCartRepository.findByShoppingCartId(shoppingCartId).setShoppingCartItems(newList);

            return ResponseEntity.ok().build();

        }
        return ResponseEntity.notFound().build();
    }

    @PutMapping("/shoppingCarts/{shoppingCartId}/checkout")
    public ResponseEntity<Void> checkoutShoppingCart(@PathVariable("shoppingCartId") UUID shoppingCartId) {

        ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
        if(shoppingCart==null) return ResponseEntity.notFound().build();
        if(shoppingCart.getShoppingCartItems().isEmpty()){
            return ResponseEntity.status(HttpStatus.CONFLICT).build();
        }
        try{
            shoppingCartService.checkout(shoppingCart.getCustomer().getEmail());
            return ResponseEntity.ok().build();
        }catch (ShopException shopException){
            shopException.printStackTrace();
            return ResponseEntity.status(HttpStatus.CONFLICT).build();
        }

    }
}



    /*
@RestController
@Transactional
public class ShoppingCartController {
    private ShoppingCartRepository shoppingCartRepository;
    private ShoppingCartDtoMapper shoppingCartDtoMapper;
    private ShoppingCartService shoppingCartService;

    @Autowired
    public ShoppingCartController(ShoppingCartRepository shoppingCartRepository) {
        this.shoppingCartRepository = shoppingCartRepository;
        this.shoppingCartDtoMapper = new ShoppingCartDtoMapper();
    }


    // Get all shopping carts
    @GetMapping("/shoppingCarts")
    public Iterable<ShoppingCartDto> getAllShoppingCarts() {
        Iterable<ShoppingCart> allShoppingCarts = shoppingCartRepository.findAll();
        List<ShoppingCartDto> allShoppingCartDtos = new ArrayList<>();
        for (ShoppingCart shoppingCart : allShoppingCarts) {
            allShoppingCartDtos.add(shoppingCartDtoMapper.mapToDto(shoppingCart));
        }
        return allShoppingCartDtos;
    }

    // Get one shopping cart
    @GetMapping("/shoppingCarts/{shoppingCart-id}")
    public ShoppingCartDto getOneShoppingCart(@PathVariable("shoppingCart-id") UUID id) {
        ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(id);
        ShoppingCartDto shoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
        return shoppingCartDto;
    }
    @GetMapping("/shoppingCarts?email")
    public ShoppingCartDto getOneShoppingCart(@RequestParam("email") String emailString) {
        Email email = (Email) Email.of(emailString);
        ShoppingCart shoppingCart = shoppingCartRepository.findByEmail(email);
        ShoppingCartDto shoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
        return shoppingCartDto;
    }
    // Create shopping cart
    @PostMapping("/shoppingCarts")
    public ResponseEntity<ShoppingCartDto> createShoppingCart(@RequestBody ShoppingCartDto shoppingCartDto) {
        ShoppingCart shoppingCart = shoppingCartService.createShoppingCartFromDto(shoppingCartDto);
        URI returnUri = ServletUriComponentsBuilder.fromCurrentRequest().path("/{shoppingCart-id}")
                .buildAndExpand(shoppingCart.getShoppingCartId()).toUri();
        ShoppingCartDto createdShoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
        return ResponseEntity.created(returnUri).body(createdShoppingCartDto);
    }
    // Delete shopping cart part for an item
    @DeleteMapping("/shoppingCarts/{cartId}/shoppingCartParts/{itemId}")
    public ResponseEntity<?> deleteShoppingCartPart(
            @PathVariable UUID cartId,
            @PathVariable UUID itemId
    ) {
        // Handle shopping cart part deletion logic here
        List<ShoppingCartItem> deletedList= shoppingCartRepository.findByShoppingCartId(cartId).getShoppingCartItems();
        deletedList.remove(itemId);
        shoppingCartRepository.findByShoppingCartId(cartId).setShoppingCartItems(deletedList);
        return ResponseEntity.noContent().build();
    }

    // Add/remove quantity of items to a shopping cart
    @PostMapping("/shoppingCarts/{cartId}/shoppingCartParts")
    public ResponseEntity<ShoppingCartDto> updateShoppingCart(
            @PathVariable UUID cartId,
            @RequestParam UUID itemId,
            @RequestParam Integer quantity,
            @RequestParam(required = false) String comment
    ) {
        // Handle add/remove quantity logic here
        ShoppingCart updatedShoppingCart = shoppingCartService.updateShoppingCart(cartId, itemId, quantity, comment);
        ShoppingCartDto updatedShoppingCartDto = shoppingCartDtoMapper.mapToDto(updatedShoppingCart);
        return ResponseEntity.ok(updatedShoppingCartDto);
    }

 */







--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDto.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.UUID;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class ShoppingCartDto {
    private UUID id;
    @JsonProperty
    private Email emailString;
    private Integer totalQuantity;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDtoMapperService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;

import java.util.*;
@Service
public class ShoppingCartDtoMapperService {
    @Autowired
    ShoppingCartRepository shoppingCartRepository;


    public static ShoppingCartDto mapToDto(ShoppingCart shoppingCart) {
        ShoppingCartDto shoppingCartDto = new ShoppingCartDto();
        shoppingCartDto.setId(shoppingCart.getShoppingCartId());
        shoppingCartDto.setEmailString(shoppingCart.getCustomer().getEmail());
        shoppingCartDto.setTotalQuantity(shoppingCart.getTotalQuantity());
        return shoppingCartDto;

    }

    public ShoppingCart mapToEntity(ShoppingCartDto shoppingCartDto) {
        UUID shoppingCartId = shoppingCartDto.getId();
        Email email = shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer().getEmail();
        Integer totalQuantity = shoppingCartDto.getTotalQuantity();
        return new ShoppingCart(shoppingCartId, shoppingCartRepository.findByShoppingCartId(shoppingCartId).getShoppingCartItems(),
                shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer(), totalQuantity);

    }




}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartExistsExeption.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;
import thkoeln.archilab.ecommerce.ShopException;

@ResponseStatus(code = HttpStatus.UNPROCESSABLE_ENTITY, reason = "ShoppingCartID already exists")
public class ShoppingCartExistsExeption extends ShopException {

    public ShoppingCartExistsExeption(String message) {
        super(message);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartItemDto.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.UUID;
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class ShoppingCartItemDto {
    private UUID itemId;
    private int quantity;
    private String comment;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartItemDtoMapperService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPartRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;

import java.util.UUID;
@Service
public class ShoppingCartItemDtoMapperService {
    @Autowired
    ShoppingItemService shoppingItemService;
    @Autowired
    ShoppingCartRepository shoppingCartRepository;
    @Autowired
    ShoppingCartPartRepository shoppingCartPartRepository;



    public ShoppingCartItemDto mapToDto(ShoppingCartPart item, UUID shoppingCartId) {
        ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
        Integer quantity = 0;
        String comment = "";
        for(ShoppingCartPart shoppingCartItem: shoppingCart.getShoppingCartItems()){
            if(shoppingCartItem.getItem().getItemId()==item.getItem().getItemId()){
                quantity = shoppingCartItem.getQuantity();
                comment = shoppingCartItem.getComment();
                return new ShoppingCartItemDto(item.getShoppingCartItemId(),quantity,comment);
            }
        }
        return null;

    }

    public ShoppingCartPart mapToEntity(ShoppingCartItemDto dto, UUID shoppingCartId) {
        // Da `ShoppingCartItemId` von der `ShoppingCartItem`-Klasse festgelegt wird und nicht vom DTO,
        // wird der `ShoppingCartItem` direkt erstellt, ohne die ID im Konstruktor zu setzen.
        ShoppingCartPart shoppingCartPart = new ShoppingCartPart(UUID.randomUUID()
                                    , shoppingItemService.findByItemId(dto.getItemId())
                                    , shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer().getEmail()
                                    , dto.getQuantity()
                                    , dto.getComment());
        return shoppingCartPart;
    }
}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;

import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;
import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.*;

@Service
public class ShoppingCartService implements ShoppingCartUseCases {

    @Autowired
    ShoppingCustomerService shoppingCustomerService;
    @Autowired
    ShoppingItemService shoppingItemService;
    @Autowired
    ShoppingInventoryService shoppingInventoryService;
    @Autowired
    ShoppingCartPartRepository shoppingCartPartRepository;
    @Autowired
    ShoppingCartRepository shoppingCartRepository;
    @Autowired
    PaymentRepository paymentRepository;
    @Autowired
    PaymentService paymentService;
    @Autowired
    ShoppingDeliveryService shoppingDeliveryService;
    @Autowired
    ShoppingOrderService shoppingOrderService;
    @Autowired
    ShoppingCartDtoMapperService shoppingCartDtoMapperService;


    public ShoppingCart createShoppingCartFromDto(ShoppingCartDto shoppingCartDto){
        ShoppingCart shoppingCart = shoppingCartDtoMapperService.mapToEntity(shoppingCartDto);
        shoppingCartPartRepository.saveAll(shoppingCart.getShoppingCartItems());
        shoppingCartRepository.save(shoppingCart);
        return shoppingCart;
    }

    public void updateItemInShoppingCart(EmailType customerEmail, UUID itemId, int quantity, String comment) {
        AbstractItem item = shoppingItemService.findByItemId(itemId);
        Email email = (Email) customerEmail;
        if(quantity>0){
            if(shoppingInventoryService.getQuantity(item)<quantity){
                adjustInventory(itemId,shoppingInventoryService.getQuantity(item)+getReservedInventoryInShoppingCarts(itemId));
            }
            addItemToShoppingCart(customerEmail,itemId,quantity);
        }
        else {
            removeItemFromShoppingCart(customerEmail, itemId, -quantity);
        }
        if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(),item)!=null){
            shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(),item).setComment(comment);
        }


    }

    @Override
    public void addItemToShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
        Email email = (Email) customerEmail;

        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        if(shoppingItemService.findByItemId(itemId)==null){
            throw new ShopException(("Item nicht vorhanden"));
        }
        if(quantity<0){
            throw new ShopException(("keine negativen Mengen"));
        }

        if(quantity> shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId))){
            System.out.println(shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId))+"sindvorhanden");
            throw new ShopException("Nicht genügend vorhanden");
        }


        int currentInventory = shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId));
        shoppingInventoryService.setQuantity(shoppingItemService.findByItemId(itemId),currentInventory-quantity);

        if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
            UUID id = UUID.randomUUID();
            ShoppingCartPart shoppingCartItem = new ShoppingCartPart(id, shoppingItemService.findByItemId(itemId),email,quantity,"dummy");
            shoppingCartPartRepository.save(shoppingCartItem);
            System.out.println("addedItemIF:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
            List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
            ShoppingCartPart itemAfter = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
            shoppingCartItems.add(itemAfter);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository
                    .findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()+quantity);
        }
        else {
            ShoppingCartPart oldPart = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
            int existingQuantity = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity();
            shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).setQuantity(existingQuantity+quantity);
            System.out.println("addedItemElse:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
            List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
            shoppingCartItems.remove(oldPart);
            shoppingCartItems.add(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)));
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository
                    .findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()+quantity);
        }

    }

    @Override
    public void removeItemFromShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
        Email email = (Email) customerEmail;

        ShoppingCartPart shoppingCartItem = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));

        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
            throw new ShopException("Email und ID nicht vorhanden");
        }
        if(quantity<0 ){
            throw new ShopException("No negative values");
        }
        if(quantity> shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()){
            throw new ShopException("Not enought elements");
        }

        int currentInventory = shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId));
        List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();

        if(quantity== shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()){
            shoppingCartItems.remove(shoppingCartItem);
            shoppingCartPartRepository.delete(shoppingCartItem);
            System.out.println("removeItemIf:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()-quantity);
            for(ShoppingCartPart part: shoppingCartItems){
                System.out.println("allesimCart:"+part.getItem().getItemId()+" kostet " +shoppingItemService.getSellPrice(part.getItem()).getAmount()+" menge:"+part.getQuantity());
            }
        }else{

            shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).
                    setQuantity(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()-quantity);
            shoppingInventoryService.setQuantity(shoppingItemService.findByItemId(itemId),currentInventory+quantity);
            ShoppingCartPart itemAfter = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
            shoppingCartItems.remove(shoppingCartItem);
            shoppingCartItems.add(itemAfter);
            System.out.println("removeItemElse:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()-quantity);
            for(ShoppingCartPart part: shoppingCartItems){
                System.out.println("allesimCart:"+part.getItem().getItemId()+" kostet " +shoppingItemService.getSellPrice(part.getItem()).getAmount()+" menge:"+part.getQuantity());
            }
        }

    }
    public void adjustInventory(UUID itemId, int rest) {
        List<ShoppingCartPart> itemsList = shoppingCartPartRepository.findAllByItem(shoppingItemService.findByItemId(itemId));

        for(ShoppingCartPart shoppingCartItem: itemsList){
            List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).getShoppingCartItems();

            if(shoppingCartItem.getQuantity()>=rest){
                shoppingCartItems.remove(shoppingCartItem);
                shoppingCartItem.setQuantity(shoppingCartItem.getQuantity()-rest);
                shoppingCartItems.add(shoppingCartItem);
                shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setShoppingCartItems(shoppingCartItems);
                shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).getTotalQuantity()-rest);
                Integer quantity = shoppingInventoryService.getQuantity(shoppingCartItem.getItem());
                shoppingInventoryService.setQuantity(shoppingCartItem.getItem(),quantity+rest);
                break;
            }
            else{
                shoppingCartItems.remove(shoppingCartItem);
                shoppingCartPartRepository.delete(shoppingCartItem);
                shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setShoppingCartItems(shoppingCartItems);
                rest-=shoppingCartItem.getQuantity();
                shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setTotalQuantity(0);
                Integer quantity = shoppingInventoryService.getQuantity(shoppingCartItem.getItem());
                shoppingInventoryService.setQuantity(shoppingCartItem.getItem(),quantity+rest-shoppingCartItem.getQuantity());

            }
        }
    }

    @Override
    public void setCommentForShoppingCartPart(EmailType customerEmail, UUID itemId, String comment) {

        if (customerEmail == null) {
            throw new ShopException("customerEmail== null");
        }
        Email email = (Email) customerEmail;
        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        if (shoppingItemService.findByItemId(itemId) == null) {
            throw new ShopException("Item existiert nicht");
        }

        if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
            throw new ShopException("Email und ID nicht vorhanden");
        }

        // Setze den Kommentar für das Element im Warenkorb
        shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).setComment(comment);
    }

    @Override
    public String getCommentForShoppingCartPart(EmailType customerEmail, UUID itemId) {
        if (customerEmail == null) {
            throw new ShopException("customerEmail== null");
        }
        Email email = (Email) customerEmail;
        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        if (shoppingItemService.findByItemId(itemId) == null) {
            throw new ShopException("Item existiert nicht");
        }

        if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
            throw new ShopException("Email und ID nicht vorhanden");
        }

        // Setze den Kommentar für das Element im Warenkorb
        return shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getComment();
    }

    @Override
    public Map<UUID, Integer> getShoppingCartAsMap(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }

        List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
        Map<UUID,Integer> chosen= new HashMap<>();
        for (ShoppingCartPart shoppingCartItem : usersList){
            //if(i.getEmail().compareTo(customerEmail)==0)
            chosen.put(shoppingItemService.getItemId(shoppingCartItem.getItem()),shoppingCartItem.getQuantity());
        }
        //printing
        for (Map.Entry<UUID, Integer> entry : chosen.entrySet()) {
            System.out.println("Map: "+ entry.getKey() + ": " + entry.getValue());
        }

        return chosen;
    }

    @Override
    public MoneyType getShoppingCartAsMoneyValue(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        if (shoppingCustomerService.findByEmail(email) == null) {
            throw new ShopException("Email nicht vorhanden");
        }
        List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
        float price= 0.0f;


        for (ShoppingCartPart shoppingCartItem : usersList){
            //Float onePrice = shoppingItemService.findByItemId(item.getItem().getItemId()).getSellPrice().getAmount();
            Float onePrice = shoppingItemService.getSellPrice(shoppingCartItem.getItem()).getAmount();
            price= price + shoppingCartItem.getQuantity()*onePrice;
        }
        return new Money(price, shoppingItemService.getSellPrice(usersList.get(0).getItem()).getCurrency());
    }

    @Override
    public int getReservedInventoryInShoppingCarts(UUID itemId) {
        if (shoppingItemService.findByItemId(itemId) == null) {
            throw new ShopException("Email nicht vorhanden");
        }

        List<ShoppingCartPart> allItems = shoppingCartPartRepository.findAllByItem(shoppingItemService.findByItemId(itemId));
        int totalQuantity =0;
        for (ShoppingCartPart shoppingCartItem : allItems) {
            totalQuantity += shoppingCartItem.getQuantity();
        }
        return totalQuantity;
    }

    @Override
    public boolean isEmpty(EmailType customerEmail) {

        Email email = (Email) Email.of(customerEmail.toString());

        if(shoppingCustomerService.findByEmail(email)== null){
            throw new ShopException("Email nicht vorhanden");
        }
        if (shoppingCustomerService.findByEmail(email).getName() == null || shoppingCustomerService.findByEmail(email).getName().isEmpty()
                || shoppingCustomerService.findByEmail(email).getEmail() == null || shoppingCustomerService.findByEmail(email).getAddress() == null ) {
            throw new ShopException("Email nicht vollständig");
        }

        if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems().isEmpty()){
            return true;
        }
        return false;
    }

    public boolean isPaymentAuthorized(Email customerEmail) {
        return isPaymentAuthorizedMethod(customerEmail, customerEmail == null);
    }
    @Override
    public boolean isPaymentAuthorized(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());
        return isPaymentAuthorizedMethod(email, customerEmail == null);
    }

    private boolean isPaymentAuthorizedMethod(Email customerEmail, boolean bool) {
        if (bool) {
            throw new ShopException("Invalid email");
        }
        if (shoppingCustomerService.findByEmail(customerEmail) == null) {
            throw new ShopException("Customer not found");
        }

        if (shoppingCartRepository.findByCustomerEmailEmailString(customerEmail.getEmailString()).getShoppingCartItems().isEmpty() ) {
            return false;
        }

        List<Payment> userPayments= paymentRepository.findAllByEmail(customerEmail);
        for(Payment payment: userPayments){
            if(payment.getPayed()==false) return true;
        }

        return false;
    }



    @Override
    public void checkout(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());

        if (shoppingCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");
        if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString())==null)throw new ShopException("No ShoppingCart");
        if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems().isEmpty())throw new ShopException("Empty ShoppingCart");
        //shoppingOrderService.instantiateOrder(email, (Money)this.getShoppingCartAsMoneyValue(email));

        paymentService.authorizePayment(email,getShoppingCartAsMoneyValue(email));
        if(isPaymentAuthorized(customerEmail)){
            //add to delivery Repo
               Map<UUID,Integer> deliverableItems = this.getShoppingCartAsMap(customerEmail);
            shoppingDeliveryService.triggerDelivery(shoppingCustomerService.findByEmail(email),deliverableItems);
            //payment correction
            List<Payment> userPayments= paymentRepository.findAllByEmail(email);
            for(Payment p: userPayments){
                if(p.getPayed()==false) p.setPayed(true);
            }

            //adjust to Order Repo
            List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();

            shoppingInventoryService.isOrdered(usersList);
            shoppingOrderService.persistOrder(email,(Money)this.getShoppingCartAsMoneyValue(email),usersList);
            List<ShoppingCartPart> emptyList= shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
            emptyList.removeAll(usersList);
            //delete from Shopping Cart repo
            shoppingCartPartRepository.deleteAll(usersList);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(emptyList);
            shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(0);
        } else throw new ShopException("no autorization for payment");
    }

    @Override
    public Map<UUID, Integer> getOrderHistory(EmailType customerEmail) {
        Email email = (Email) Email.of(customerEmail.toString());
        //shoppingOrderService.instantiateOrder(email, (Money)this.getShoppingCartAsMoneyValue(email));
        return shoppingOrderService.getOrderParts(email);
    }

    @Override
    public void deleteAllOrders() {
        shoppingOrderService.deleteAll();
        shoppingCartPartRepository.deleteAll();
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCustomerService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.usecases.CustomerType;

public interface ShoppingCustomerService {
    CustomerType findByEmail(Email email);


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingDeliveryService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import thkoeln.archilab.ecommerce.usecases.CustomerType;

import java.util.Map;
import java.util.UUID;

public interface ShoppingDeliveryService {
    void triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingInventoryService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;

import java.util.List;
import java.util.UUID;

public interface ShoppingInventoryService {
    //InventoryElement findByItem(Item item);
    Integer getQuantity(AbstractItem item);
    void setQuantity(AbstractItem item, Integer quantity);
    void isOrdered(List<ShoppingCartPart> items);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingItemService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;

import java.util.UUID;

public interface ShoppingItemService {
    AbstractItem findByItemId(UUID itemId);
    UUID getItemId(AbstractItem item) ;
    Money getSellPrice(AbstractItem item);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingOrderService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;

import java.util.List;
import java.util.Map;
import java.util.UUID;

public interface ShoppingOrderService {
    void instantiateOrder(Email email, Money money);
    void persistOrder(Email email,Money money,List<ShoppingCartPart> usersList);
    Map<UUID,Integer> getOrderParts(Email email);
    void deleteAll();

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractCustomer.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import javax.persistence.*;
import java.util.UUID;

@Entity
@Getter
@NoArgsConstructor
public class AbstractCustomer {

    @Id
    private UUID customerId;
    @Setter
    @Embedded
    private Email email;
    public AbstractCustomer(UUID customerId, Email email) {
        this.customerId=customerId;
        this.email=email;
    }

    }


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractItem.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;

import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.Id;
import java.util.UUID;

@Entity
@Getter
@NoArgsConstructor
public class AbstractItem {
    @Id
    private UUID itemId;

    @Embedded
    private Money sellPrice;

    public AbstractItem(UUID itemId, Money sellPrice){
        this.itemId=itemId;
        this.sellPrice=sellPrice;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;

import javax.persistence.*;
import java.util.List;
import java.util.UUID;

@Getter
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = "shopping_cart")
public class ShoppingCart {
    @Id
    private UUID shoppingCartId;
    @Setter
    @OneToMany(cascade = CascadeType.ALL)
    @JoinColumn(name = "shopping_cart_id")
    private List<ShoppingCartPart> shoppingCartItems;
    @Setter
    @OneToOne(cascade = CascadeType.REMOVE)
    private AbstractCustomer customer;
    @Setter
    private Integer totalQuantity;

    /*public ShoppingCart(UUID shoppingCartId, List<ShoppingCartPart> shoppingCartItems, AbstractCustomer customer, Integer totalQuantity) {
        this.shoppingCartId = shoppingCartId;
        this.shoppingCartItems = shoppingCartItems;
        this.customer = customer;
        this.totalQuantity = totalQuantity;
    }

     */

}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.dom4j.tree.AbstractEntity;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import javax.persistence.*;
import java.util.UUID;
@Getter
@NoArgsConstructor
@Entity
public class ShoppingCartPart extends AbstractEntity {

    @Id
    private UUID shoppingCartItemId;
    @Setter
    @OneToOne
    private AbstractItem item;

    @Setter
    @Embedded
    private Email email;
    @Setter
    private Integer quantity;
    @Setter
    private String comment;

    public ShoppingCartPart(UUID shoppingCartItemId, AbstractItem item, Email email, Integer quantity, String comment){

        if (shoppingCartItemId == null || item==null || email==null) {//|| quantity <0 weggelassen aufgrund von REST POST
            throw new ShopException("Invalid Shopping Card data");
        }
        this.shoppingCartItemId=shoppingCartItemId;
        this.item = item;
        this.email=email;
        this.quantity=quantity;
        this.comment  = comment;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPartRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import org.yaml.snakeyaml.events.Event;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.List;
import java.util.UUID;
@Repository
public interface ShoppingCartPartRepository extends CrudRepository<ShoppingCartPart, Event.ID> {

    ShoppingCartPart findByEmailEmailStringAndItem(String email, AbstractItem item);
    List<ShoppingCartPart> findAllByItem(AbstractItem item);
    ShoppingCartPart findByShoppingCartItemId(UUID id);

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import org.yaml.snakeyaml.events.Event;
import thkoeln.archilab.ecommerce.domainprimitives.Email;

import java.util.UUID;
@Repository
public interface ShoppingCartRepository extends CrudRepository<ShoppingCart, Event.ID> {
    ShoppingCart findByCustomerEmailEmailString(String email);
    ShoppingCart findByShoppingCartId(UUID id);


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerRegistrationUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;

/**
 * This interface contains methods needed in the context of use cases dealing with registering a customer.
 * The interface is probably incomplete, and will grow over time.
 */
public interface CustomerRegistrationUseCases {
    /**
     * Registers a new customer
     *
     * @param name
     * @param email
     * @param address
     * @throws ShopException if ...
     *      - name is null or empty
     *      - email is null
     *      - customer with the given email already exists
     *      - address is null
     */
    public void register( String name, EmailType email, AddressType address );


    /**
     * Changes the address of a customer
     *
     * @param customerEmail
     * @param address
     * @throws ShopException if ...
     *      - email is null
     *      - customer with the given email already exists
     *      - address is null
     */
    public void changeAddress( EmailType customerEmail, AddressType address );


    /**
     * Returns the data of a customer
     * @param customerEmail
     * @return the customer data
     * @throws ShopException if ...
     *      - email is null
     *      - the customer with the given email does not exist
     */
    public CustomerType getCustomerData( EmailType customerEmail );



    /**
     * Deletes all customers, including all orders and shopping carts
     */
    public void deleteAllCustomers();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerType.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;

/**
 * This interface expresses the essence of a shop customer
 */
public interface CustomerType {
    public String getName();
    public EmailType getEmail();
    public AddressType getAddress();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with logistics,
 * i.e. the delivery of items to a customer. It is probably incomplete, and will grow over time.
 */
public interface DeliveryUseCases {
    /**
     * Delivers a item to a customer. The item is identified by its id, and the customer by
     * his/her name, street, city and postal code.
     * @param deliveryRecipient
     * @param deliveryContent - a map of item ids and quantities
     * @return the id of the delivery, if successfully triggered
     * @throws ShopException if ...
     *      - deliveryRecipient is null
     *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
     *      - deliveryContent is null or empty
     *      - the total number of items in the delivery is > 20
     */
    public UUID triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent );


    /**
     * Returns a map showing which items have been delivered to a customer, and how many of each item
     *
     * @param customerEmail
     * @return the delivery history of the customer (map is empty if the customer has not had any deliveries yet)
     * @throws ShopException if
     *      - email is null
     *      - the customer with the given email does not exist
     */
    public Map<UUID, Integer> getDeliveryHistory( EmailType customerEmail );



    /**
     *  Deletes all delivery history.
     */
    public void deleteDeliveryHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\AddressType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface AddressType {
    /**
     * @return the street as a string
     */
    public String getStreet();

    /**
     * @return the city as a string
     */
    public String getCity();

    /**
     * @return the postal code
     */
    public PostalCodeType getPostalCode();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an postal code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param street the street as a string
     * @param city the city as a string
     * @param postalCode the postal code
     * @return the address object matching the parameters
     * @throws ShopException if ...
     *      - street is null or empty
     *      - city is null or empty
     *      - postalCode is null
     */
     // public static AddressType of( String street, String city, PostalCodeType postalCode );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface EmailType {
    /**
     * @return the email as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an email, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param emailAsString - the email as a string.
     *      We will use a much simplified validation method to check if the email is valid:
     *      - it must contain exactly one '@' character.
     *      - the part before the '@' and the part after the '@' must not be empty, contain of
     *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
     *      - the parts before and after the '@' may contain one or several '.' as separators
     *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
     *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
     *        (for simplicity we do not allow any other domains)
     * @return a new EmailType object matching the given email
     * @throws ShopException if ...
     *      - emailAsString is null
     *      - emailAsString is not a valid email (see above)
     */
     // public static EmailType of( String emailAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface MoneyType {
    /**
     * @return the amount of money
     */
    public Float getAmount();


    /**
     * @return the currency of the money
     */
    public String getCurrency();


    /**
     * @param otherMoney
     * @return this + otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public MoneyType add( MoneyType otherMoney );


    /**
     * @param otherMoney
     * @return this - otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     *      - otherMoney > this
     */
    public MoneyType subtract( MoneyType otherMoney );


    /**
     * @param factor
     * @return this * factor, as a new object
     * @throws ShopException if ...
     *     - factor < 0
     */
    public MoneyType multiplyBy( int factor );

    /**
     * @param otherMoney
     * @return true, if this > otherMoney
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public boolean largerThan( MoneyType otherMoney );


    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates a money object from an amount and a currency (as string).
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param amount the amount of money (must be >= 0)
     * @param currency the currency of the money (allowed values: "EUR", "CHF")
     * @return a new Money object with the given amount and currency
     * @throws ShopException if ...
     *   - amount is null
     *   - amount < 0
     *   - currency is null
     *   - currency is not one of the allowed values
     */
     // public static MoneyType of( Float amount, String currency );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PostalCodeType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface PostalCodeType {
    /**
     * @return the postal code as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an postal code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param postalCodeAsString - the postal code as a string.
     *      We will use a much simplified validation method to check if the postal code is valid:
     *      - It must contain exactly 5 digits.
     *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
     * @return a new postal code object matching the given string
     * @throws ShopException if ...
     *      - postalCodeAsString is null
     *      - postalCodeAsString is not a valid postal code (see above)
     */
     // public static PostalCodeType of( String postalCodeAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
 * i.e. adding and removing items in the warehouse. The interface is probably incomplete, and
 * will grow over time.
 */
public interface InventoryManagementUseCases {
    /**
     * Adds a certain quantity of a given item to the inventory
     * @param itemId
     * @param addedQuantity
     * @throws ShopException if ...
     *      - itemId is null
     *      - the item with that id does not exist
     *      - addedQuantity <= 0
     */
    public void addToInventory( UUID itemId, int addedQuantity );


    /**
     * Removes a certain quantity of a given item from the inventory.
     * If the new total quantity is lower than the currently reserved items, some of currently reserved items
     * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
     * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
     * or some of the items were stolen from the warehouse, are broken, etc.)
     * @param itemId
     * @param removedQuantity
     * @throws ShopException if ...
     *      - itemId is null
     *      - the item with that id does not exist
     *      - removedQuantity <= 0
     *      - the removed quantity is greater than the current inventory and the currently reserved items together
     */
    public void removeFromInventory( UUID itemId, int removedQuantity );


    /**
     * Changes the total quantity of a given item in the inventory.
     * If the new total quantity is lower than the currently reserved items, some of currently reserved items
     * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
     * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
     * or some of the items were stolen from the warehouse, are broken, etc.)
     * @param itemId
     * @param newTotalQuantity
     * @throws ShopException if ...
     *      - itemId is null
     *      - the item with that id does not exist
     *      - newTotalQuantity < 0
     */
    public void changeInventoryTo( UUID itemId, int newTotalQuantity );


    /**
     * Get the current total inventory of a given item, including the currently reserved items
     * @param itemId
     * @return the current total inventory of the item
     * @throws ShopException if ...
     *      - itemId is null
     *      - the item with that id does not exist
     */
    public int getAvailableInventory( UUID itemId );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\ItemCatalogUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the item catalog.
 * The interface is probably incomplete, and will grow over time.
 */

public interface ItemCatalogUseCases {
    /**
     * Adds a new item to the shop catalog
     * @param itemId
     * @param name
     * @param description
     * @param size
     * @param purchasePrice
     * @param sellPrice
     * @throws ShopException if ...
     *      - itemId is null,
     *      - the item with that id already exists,
     *      - name or description are null or empty,
     *      - the size is <= 0 (but can be null!),
     *      - the purchase price is null,
     *      - the sell price is null,
     *      - the sell price is lower than the purchase price
     */
    public void addItemToCatalog( UUID itemId, String name, String description, Float size,
                                           MoneyType purchasePrice, MoneyType sellPrice );


    /**
     * Removes a item from the shop catalog
     * @param itemId
     * @throws ShopException if
     *      - itemId is null,
     *      - the item with that id does not exist
     *      - the item is still in inventory
     *      - the item is still reserved in a shopping cart, or part of a completed order
     */
    public void removeItemFromCatalog( UUID itemId );


    /**
     * Get the sell price of a given item
     * @param itemId
     * @return the sell price
     * @throws ShopException if ...
     *      - itemId is null,
     *      - the item with that id does not exist
     */
    public MoneyType getSellPrice( UUID itemId );


    /**
     * Clears the item catalog, i.e. removes all items from the catalog, including all the inventory,
     * all the reservations and all the orders.
     */
    public void deleteItemCatalog();

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with payments.
 */
public interface PaymentUseCases {

    /**
     * Authorizes a payment from a debit card for a given amount
     *
     * @param customerEmail
     * @param moneyAmount
     * @return the id of the payment, if successfully authorized
     * @throws ShopException if ...
     *      - customerEmail is null
     *      - the amount is null
     *      - the amount is 0.00 EUR
     *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
     */
    public UUID authorizePayment( EmailType customerEmail, MoneyType moneyAmount );


    /**
     * Returns the total amount of payments (over the complete history) for a customer
     * (identified by his/her email)
     *
     * @param customerEmail
     * @return the total amount of payments made using this debit card, or 0.00 EUR if there
     *         weren't any payments yet.
     * @throws ShopException if ...
     *      - customerEmail is null
     */
    public MoneyType getPaymentTotal( EmailType customerEmail );


    /**
     * Deletes all payment history, for all customers.
     */
    public void deletePaymentHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingCartUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with the shopping cart.
 * The interface is probably incomplete, and will grow over time.
 */
public interface ShoppingCartUseCases {
    /**
     * Adds a item to the shopping cart of a customer
     *
     * @param customerEmail
     * @param itemId
     * @param quantity
     * @throws ShopException if ...
     *      - the customer with the given email does not exist,
     *      - the item does not exist,
     *      - the quantity <= 0,
     *      - the item is not available in the requested quantity
     */
    public void addItemToShoppingCart( EmailType customerEmail, UUID itemId, int quantity );


    /**
     * Removes a item from the shopping cart of a customer
     *
     * @param customerEmail
     * @param itemId
     * @param quantity
     * @throws ShopException if ...
     *      - customerEmail is null,
     *      - the customer with the given email does not exist,
     *      - the item does not exist
     *      - the quantity <= 0,
     *      - the item is not in the shopping cart in the requested quantity
     */
    public void removeItemFromShoppingCart( EmailType customerEmail, UUID itemId, int quantity );


    /**
     * Sets a comment in the shopping cart part containing a item
     *
     * @param customerEmail
     * @param itemId
     * @param comment (can be null)
     * @throws ShopException if ...
     *      - customerEmail is null,
     *      - the customer with the given email does not exist,
     *      - the item does not exist
     *      - the item is not in the shopping cart
     */
    public void setCommentForShoppingCartPart( EmailType customerEmail, UUID itemId, String comment );


    /**
     * Returns the comment in the shopping cart part containing a item
     *
     * @param customerEmail
     * @param itemId
     * @return the comment (can be null)
     * @throws ShopException if ...
     *      - customerEmail is null,
     *      - the customer with the given email does not exist,
     *      - the item does not exist
     *      - the item is not in the shopping cart
     */
    public String getCommentForShoppingCartPart( EmailType customerEmail, UUID itemId );


    /**
     * Returns a map showing which items are in the shopping cart of a customer and how many of each item
     *
     * @param customerEmail
     * @return the shopping cart of the customer (map is empty if the shopping cart is empty)
     * @throws ShopException if ...
     *      - customerEmail is null,
     *      - the customer with the given email does not exist
     */
    public Map<UUID, Integer> getShoppingCartAsMap( EmailType customerEmail );


    /**
     * Returns the current value of all items in the shopping cart of a customer
     *
     * @param customerEmail
     * @return the value of shopping cart of the customer
     * @throws ShopException if ...
     *      - customerEmail is null,
     *      - the customer with the given email does not exist
     */
    public MoneyType getShoppingCartAsMoneyValue( EmailType customerEmail );



    /**
     * Get the number units of a specific item that are currently reserved in the shopping carts of all customers
     * @param itemId
     * @return the number of reserved items of that type in all shopping carts
     * @throws ShopException
     *      - itemId is null
     *      - if the item id does not exist
     */
    public int getReservedInventoryInShoppingCarts( UUID itemId );


    /**
     * Checks if the shopping cart of a customer is empty
     *
     * @param customerEmail
     * @return true if the shopping cart is empty, false otherwise
     * @throws ShopException if ...
     *    - customerEmail is null
     *    - the customer with the given email does not exist
     */
    public boolean isEmpty( EmailType customerEmail );


    /**
     * Checks if the payment for a specific shopping cart of a customer has been authorized to be paid,
     * i.e. the shopping cart is not empty, the customer has given his/her payment details, and the payment
     * has been authorized (under the limits of the customer's credit card). However, the order
     * has not yet been placed yet, and the logistics details have not yet been given.
     *
     * @param customerEmail
     * @return true if the payment has been authorized, false otherwise
     * @throws ShopException if ...
     *      - customerEmail is null
     *      - the customer with the given email does not exist
     */
    public boolean isPaymentAuthorized( EmailType customerEmail );


    /**
     * Checks out the shopping cart of a customer
     *
     * @param customerEmail
     * @throws ShopException if ... 
     * @throws ShopException if ...
     *      - customerEmail is null
     *      - the customer with the given email does not exist
     *      - the shopping cart is empty
     */
    public void checkout( EmailType customerEmail );




    /**
     * Returns a map showing which items have been ordered by a customer, and how many of each item
     *
     * @param customerEmail
     * @return the order history of the customer (map is empty if the customer has not ordered anything yet)
     * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
     * @throws ShopException if
     *      - the email is null
     *      - the customer with the given email does not exist
     */
    public Map<UUID, Integer> getOrderHistory( EmailType customerEmail );



    /**
     * Deletes all orders and shopping carts in the system
     * @Deprecated Might be split into two methods later (delete orders and delete shopping carts), with
     *             the order deletion moved to a dedicated OrderUseCases interface later
     *             (but still valid in this milestone)
     */
    public void deleteAllOrders();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;

import static com.tngtech.archunit.library.Architectures.layeredArchitecture;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln")
@SuppressWarnings("PMD")
public class E3DDDOutsideSolutionRulesTest {

    @ArchTest
    static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
            layeredArchitecture()
                    .consideringAllDependencies()
                    .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
                    .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
                    .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
                    .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
                    .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )

                    .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
                    .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Service;

import javax.persistence.Entity;
import javax.persistence.Id;

import java.util.UUID;

import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
@SuppressWarnings("PMD")
public class E3DDDRulesTest {

    @ArchTest
    static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
            noClasses().that().resideInAPackage("..domain..")
                    .should().dependOnClassesThat().resideInAPackage("..application..");

    @ArchTest
    static final ArchRule entitiesMustResideInADomainPackage =
            classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
                    .as("Entities must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule entitiesMustNotAccessRepositories =
            noClasses().that().areAnnotatedWith( Entity.class )
                    .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );

    @ArchTest
    static final ArchRule repositoriesMustResideInADomainPackage =
            classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
                    .as("Repositories must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule repositoryNamesMustHaveProperSuffix =
            classes().that().areAssignableTo( CrudRepository.class )
                    .should().haveSimpleNameEndingWith("Repository");

    @ArchTest
    static final ArchRule servicesMustResideInAnApplicationPackage =
            classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
                    .as("Application Services must reside in a package '..application..'");

    @ArchTest
    static final ArchRule serviceNamesMustHaveProperSuffix =
            classes().that().areAnnotatedWith( Service.class )
                    .should().haveSimpleNameEndingWith("Service");

    @ArchTest
    static final ArchRule noClassesOnTopLevel =
            classes().should().resideInAPackage( "..solution.*.." );

    @ArchTest
    static final ArchRule noNonIdFieldsOfTypeIUUID =
            fields()
                    .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
                    .and().areNotAnnotatedWith( Id.class )
                    .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Item" )
                    .should().notHaveRawType( UUID.class );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClass;
import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import com.tngtech.archunit.lang.ArchRule;
import com.tngtech.archunit.library.dependencies.SliceAssignment;
import com.tngtech.archunit.library.dependencies.SliceIdentifier;
import org.junit.jupiter.api.Test;

import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;

public class E3NoCycleTest {
    private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");

    private SliceAssignment inAllClasses() {
        return new SliceAssignment() {
            @Override
            public String getDescription() {
                return "every class in it's own slice";
            }

            @Override
            public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
                return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
            }
        };
    }

    @Test
    public void testNoCyclicDependenciesBetweenClasses() {
        slices().assignedFrom(inAllClasses())
                .namingSlices("$1[$2.$3]")
                .should().beFreeOfCycles()
                .check(importedClasses);
    }

    @Test
    public void testNoCyclicDependenciesBetweenPackages() {
        ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
        rule.check(importedClasses);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3PackageStructureTest {

    private static final String[] REQUIRED_PACKAGES = {"customer", "shoppingcart", "item", "order"};
    private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
    private JavaClasses importedClasses;


    @BeforeEach
    public void setUp() {
        importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
    }

    @Test
    void testRequiredPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage;
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredDomainPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected domain sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredApplicationPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected application sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import org.junit.jupiter.api.Test;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
import org.springframework.core.type.classreading.MetadataReader;
import org.springframework.core.type.classreading.MetadataReaderFactory;

import java.io.IOException;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;

import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3RequiredClassesTest {


    private static final String[] REQUIRED_CLASSES = {
            "Customer",
            "CustomerRepository",
            "Order",
            "OrderRepository",
            "ShoppingCart",
            "ShoppingCartRepository",
            "Item",
            "ItemRepository"
    };

    @Test
    public void testRequiredClassesDeclared() throws IOException {
        String basePackage = "thkoeln.archilab.ecommerce";
        String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";

        PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );

        Set<String> foundClasses = new HashSet<>();

        Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
            try {
                MetadataReader reader = readerFactory.getMetadataReader( resource );
                foundClasses.add( reader.getClassMetadata().getClassName() );
            } catch (IOException e) {
                e.printStackTrace();
            }
        } );

        Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
            boolean found = foundClasses.stream().anyMatch(className ->
                    className.startsWith(basePackage) && className.endsWith("." + requiredClass)
            );
            assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
        });
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E1OrdertRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private EmailType nonExistingEmail;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllItems();
        initialMasterDataCreator.inventoryUpAllItems();
        initialMasterDataCreator.registerAllCustomers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingEmail = instantiateEmail( "harry@sally.de" );
    }


    @Test
    public void testGetNoOrders() throws Exception {
        // given
        // when
        // then
        mockMvc.perform( get( "/orders" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=" + CUSTOMER_EMAIL[3].toString() ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
    }


    @Test void testMakeThreeOrders() throws Exception {
        // given
        String emailString = CUSTOMER_EMAIL[6].toString();

        UUID itemId2 = (UUID) ITEM_DATA[2][0];
        UUID itemId4 = (UUID) ITEM_DATA[4][0];
        UUID itemId6 = (UUID) ITEM_DATA[6][0];
        Float itemMoneyAmount2 = ((MoneyType) ITEM_DATA[2][5]).getAmount() * 2;
        Float itemMoneyAmount4 = ((MoneyType) ITEM_DATA[4][5]).getAmount() * 4;
        Float itemMoneyAmount6 = ((MoneyType) ITEM_DATA[6][5]).getAmount() * 6;

        String uriAllOrders = "/orders?email=" + emailString;
        String uriLatestOrder = uriAllOrders + "&filter=latest";

        // when
        restHelper.makeOrderForCustomer( emailString, itemId2, 2 );
        restHelper.makeOrderForCustomer( emailString, itemId4, 4 );
        restHelper.makeOrderForCustomer( emailString, itemId6, 6 );

        // then get all orders ...
        mockMvc.perform( get( uriAllOrders ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 3 ) )

                .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount2 ) )

                .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[1].price.amount" ).value( itemMoneyAmount4 ) )

                .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[2].price.amount" ).value( itemMoneyAmount6 ) );

        // ... and the latest order
        mockMvc.perform( get( uriLatestOrder ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount6 ) );
    }


    @Test
    public void testIfMoneySumInOrderIsCorrect() throws Exception {
        // given
        String emailString = CUSTOMER_EMAIL[3].toString();
        UUID itemId3 = (UUID) ITEM_DATA[3][0];
        UUID itemId4 = (UUID) ITEM_DATA[4][0];
        Integer quantity3 = 14;
        Integer quantity4 = 5;
        Float itemMoneyAmount =
                ((MoneyType) ITEM_DATA[3][5]).getAmount() * quantity3 +
                ((MoneyType) ITEM_DATA[4][5]).getAmount() * quantity4;

        // when
        UUID shoppingCartId = restHelper.getShoppingCartId( emailString );
        restHelper.addItemToShoppingCart( shoppingCartId, itemId3, quantity3 );
        restHelper.addItemToShoppingCart( shoppingCartId, itemId4, quantity4 );
        mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
                .andExpect( status().isOk() );

        // then
        mockMvc.perform( get(
                "/orders?email=" + emailString + "&filter=latest") )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount ) );
    }



}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingCartRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E2ShoppingCartRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private EmailType nonExistingEmail;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllItems();
        initialMasterDataCreator.inventoryUpAllItems();
        initialMasterDataCreator.registerAllCustomers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingEmail = instantiateEmail( "harry@sally.de" );
    }


    @Test
    public void testEmptyShoppingCart() throws Exception {
        // given
        String validUri = "/shoppingCarts?email=" + CUSTOMER_EMAIL[4].toString();
        String invalidUri1 = "/shoppingCarts?email=" + nonExistingEmail.toString();
        String invalidUri2 = "/shoppingCarts?email=justaninvalidemailaddress";

        // when
        // then
        mockMvc.perform( get( validUri ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
        mockMvc.perform( get( invalidUri1 ) )
                .andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidUri2 ) )
                .andExpect( status().isNotFound() );
    }


    @Test
    public void testInvalidUris() throws Exception {
        // given
        UUID itemId = (UUID) ITEM_DATA[3][0];
        String customerEmailString = CUSTOMER_EMAIL[4].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );

        String invalidPostUri = "/shoppingCarts/" + UUID.randomUUID() + "/shoppingCartParts";
        String invalidPatchGetDeleteUri1 =
                "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + UUID.randomUUID();
        String invalidPatchGetDeleteUri2 =
                "/shoppingCarts/" + UUID.randomUUID().toString() + "/shoppingCartParts/" + itemId;
        String invalidCheckoutUri1 = "/shoppingCarts/" + shoppingCartId + "/chekkout";
        String invalidCheckoutUri2 = "/shoppingCarts/" + UUID.randomUUID() + "/checkout";

        // when
        // then
        mockMvc.perform( post( invalidPostUri )
                .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testQueryNonExistingItem() throws Exception {
        // given
        UUID itemId = (UUID) ITEM_DATA[3][0];
        String customerEmailString = CUSTOMER_EMAIL[7].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String invalidUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + itemId;

        // when
        // then
        mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testDeleteFromShoppingCart() throws Exception {
        // given
        UUID itemId1 = (UUID) ITEM_DATA[1][0];
        String customerEmailString9 = CUSTOMER_EMAIL[9].toString();
        String customerEmailString7 = CUSTOMER_EMAIL[7].toString();

        UUID shoppingCartId9 = restHelper.getShoppingCartId( customerEmailString9 );
        UUID shoppingCartId7 = restHelper.getShoppingCartId( customerEmailString7 );

        String baseUri9 = "/shoppingCarts/" + shoppingCartId9 + "/shoppingCartParts/";
        String checkoutUri9 = "/shoppingCarts/" + shoppingCartId9 + "/checkout";
        String checkoutUri7 = "/shoppingCarts/" + shoppingCartId7 + "/checkout";

        // when
        restHelper.addMultipleItemsToShoppingCart( customerEmailString9,
                new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
        restHelper.checkMultipleShoppingCartParts(
                customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
                new String[]{"c1", "c4", "c6"} );
        mockMvc.perform( delete( baseUri9 + itemId1 ) )
                .andExpect( status().isOk() );
        restHelper.checkMultipleShoppingCartParts(
                customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
                new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
        // ... and another customer can still buy 10 of the "Nr. 1" item
        restHelper.addItemToShoppingCart( shoppingCartId7, itemId1, 10,
                "still10", null );

        // then
        mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString9,
                new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
        mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString7,
                new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
    }


    @Test
    public void testAddToAndRemoveFromShoppingCart() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[2].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
                new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
        restHelper.checkMultipleShoppingCartParts(
                customerEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
                new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
                new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
    }


    @Test
    public void testRemoveMoreThanThereIsInShoppingCart() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[2].toString();

        // when
        // then
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testAddMoreThanIsInInventory() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[7].toString();

        // when
        // then
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[5].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
    }



    @Test
    public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[1].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[8].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleItemsToShoppingCart( customerEmailString,
                new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testNoCheckoutForEmptyShoppingCart() throws Exception {
        // given
        String customerEmailString = CUSTOMER_EMAIL[9].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.ResultActions;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;

public class RESTHelper {
    private MockMvc mockMvc;

    public static final ResultMatcher NOT_FOUND = status().isNotFound();
    public static final ResultMatcher OK = status().isOk();
    public static final ResultMatcher CREATED = status().isCreated();
    public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
    public static final ResultMatcher CONFLICT = status().isConflict();

    public RESTHelper( MockMvc mockMvc ) {
        this.mockMvc = mockMvc;
    }

    public void makeOrderForCustomer( String emailString, UUID itemId, Integer quantity ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( emailString );
        addItemToShoppingCart( shoppingCartId, itemId, quantity );
        mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
                .andExpect( OK );
    }

    public UUID getShoppingCartId( String emailString ) throws Exception {
        // get the shopping cart and extract its id ...
        MvcResult shoppingCart = mockMvc.perform( get( "/shoppingCarts?email=" + emailString ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.id" ).isNotEmpty() )
                .andReturn();
        ObjectMapper objectMapper = new ObjectMapper();
        IdDTO idDTO = objectMapper.readValue( shoppingCart.getResponse().getContentAsString(), IdDTO.class );
        return idDTO.getId();
    }

    public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity,
                                                 String comment, ResultMatcher expectedStatus )
                                                throws Exception {
        ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
        ObjectMapper objectMapper = new ObjectMapper();
        QuantityAndCommentDTO dto = new QuantityAndCommentDTO( itemId, quantity, comment );
        String quantityJson = objectMapper.writeValueAsString( dto );
        mockMvc.perform( post( "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts" )
                .contentType( APPLICATION_JSON ).content( quantityJson ) )
                .andExpect( status );
    }


    public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity )
            throws Exception {
        addItemToShoppingCart( shoppingCartId, itemId, quantity, null, null );
    }



    public void addMultipleItemsToShoppingCart(
            String customerEmailString, Integer[] itemIndices, Integer[] quantities, String[] comments,
            ResultMatcher[] expectedAddStatuses ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( customerEmailString );
        String shoppingCartUri = "shoppingCarts?email=" + customerEmailString;
        String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";

        // add all the items to the shopping cart ...
        Map<Integer, Integer> quantityMap = new HashMap<>();
        Map<Integer, String> commentMap = new HashMap<>();
        for ( int i = 0; i < itemIndices.length; i++ ) {
            UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
            addItemToShoppingCart( shoppingCartId, itemId, quantities[i], comments[i], expectedAddStatuses[i] );
            if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
                quantityMap.put( itemIndices[i],
                        quantities[i] + quantityMap.getOrDefault( itemIndices[i], 0 ) );
                commentMap.put( itemIndices[i], comments[i] );
            }
        }
    }


    public void addMultipleItemsToShoppingCart(
            String customerEmailString, Integer[] itemIndices, Integer[] quantities,
            String[] comments ) throws Exception {
        ResultMatcher[] expectedAddStatuses = new ResultMatcher[itemIndices.length];
        for ( int i = 0; i < itemIndices.length; i++ ) {
            expectedAddStatuses[i] = CREATED;
        }
        addMultipleItemsToShoppingCart( customerEmailString, itemIndices, quantities,
                comments, expectedAddStatuses );
    }


    public void checkMultipleShoppingCartParts( String customerEmailString,
                                                         Integer[] itemIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( customerEmailString );
        String shoppingCartUri = "/shoppingCarts?email=" + customerEmailString;
        String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";

        // check that the shopping cart contains all the items ...
        int totalQuantity = 0;
        for ( int i = 0; i < itemIndices.length; i++ ) {
            if ( expectedQuantities[i] != null ) {
                totalQuantity += expectedQuantities[i];
            }
        }
        mockMvc.perform( get( shoppingCartUri ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );

        // check that each item has the correct quantity and comment ...
        for ( int i = 0; i < itemIndices.length; i++ ) {
            UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
            if ( expectedToBeFound[i] ) {
                mockMvc.perform( get( baseUri + itemId ) )
                        .andExpect( OK )
                        .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
                        .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
            } else {
                mockMvc.perform( get( baseUri + itemId ) )
                        .andExpect( NOT_FOUND );
            }
        }
    }


    public void checkMultipleShoppingCartParts( String customerEmailString,
                                                         Integer[] itemIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments ) throws Exception {
        Boolean[] expectedToBeFound = new Boolean[itemIndices.length];
        for ( int i = 0; i < itemIndices.length; i++ ) {
            expectedToBeFound[i] = true;
        }
        checkMultipleShoppingCartParts( customerEmailString, itemIndices, expectedQuantities,
                expectedComments, expectedToBeFound );
    }



    public void checkMultipleOrderPartsInLatestOrder(
            String customerEmailString, Integer[] itemIndices, Integer[] expectedQuantities,
            String[] expectedComments ) throws Exception {
        String latestOrderUri = "/orders?email=" + customerEmailString + "&filter=latest";

        // Calculate the total price of the order ...
        float totalPrice = 0f;
        for ( int i = 0; i < itemIndices.length; i++ ) {
            totalPrice += expectedQuantities[i] * ((MoneyType) ITEM_DATA[itemIndices[i]][5]).getAmount();
        }

        // ... and check that the order has the correct total price (and other data)
        ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
                .andExpect( jsonPath( "$[0].email.emailString" ).value( customerEmailString ) );

        // Now check that all the expected parts are there
        for ( int i = 0; i < itemIndices.length; i++ ) {
            UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
            resultActions.andExpect(
                    jsonPath( "$[0].orderParts.length()" ).value( itemIndices.length ) );
            resultActions.andExpect(
                    jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].quantity" )
                            .value( expectedQuantities[i] ) );
            if ( expectedComments[i] != null ) {
                resultActions.andExpect(
                        jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].comment" )
                                .value( expectedComments[i] ) );
            }
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a comment, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class CommentDTO {
    private UUID itemId;
    private String comment;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just the id of an entity, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class IdDTO {
    private UUID id;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a quantity, used in testing.
 */


@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class QuantityAndCommentDTO {
    private UUID itemId;
    private Integer quantity;
    private String comment;

    public QuantityAndCommentDTO( UUID itemId, Integer quantity, String comment ) {
        this.itemId = itemId;
        this.quantity = quantity;
        this.comment = comment;
    }
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionAddressTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionAddressTest {

    @Test
    public void testGetterMethods() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        PostalCodeType plz = instantiatePostalCode( "12345" );

        // when
        AddressType instance = instantiateAddress( street, city, plz );

        // then
        assertEquals( street, instance.getStreet() );
        assertEquals( city, instance.getCity() );
        assertEquals( plz, instance.getPostalCode() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        PostalCodeType plz = instantiatePostalCode( "12345" );

        // when
        // then
        assertDoesNotThrow( () -> instantiateAddress( street, city, plz ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        PostalCodeType plz = instantiatePostalCode( "12345" );

        // when
        // then
        assertThrows( ShopException.class, () -> instantiateAddress( null, city, plz ) );
        assertThrows( ShopException.class, () -> instantiateAddress( "", city, plz ) );
        assertThrows( ShopException.class, () -> instantiateAddress( street, null, plz ) );
        assertThrows( ShopException.class, () -> instantiateAddress( street, "", plz ) );
        assertThrows( ShopException.class, () -> instantiateAddress( street, city, null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        PostalCodeType plz = instantiatePostalCode( "12345" );

        // when
        AddressType instance1 = instantiateAddress( street, city, plz );
        AddressType instance2 = instantiateAddress( street, city, plz );
        AddressType instance3 = instantiateAddress( "Anderestr. 12", city, plz );
        AddressType instance4 = instantiateAddress( street, "AndereStadt", plz );
        AddressType instance5 = instantiateAddress( street, city, instantiatePostalCode( "54321" ) );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
        assertNotEquals( instance1, instance4 );
        assertNotEquals( instance1, instance5 );
    }

    @Test
    public void testImmutability() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        PostalCodeType plz = instantiatePostalCode( "12345" );

        // when
        AddressType instance = instantiateAddress( street, city, plz );

        // then
        try {
            instance.getClass().getMethod( "setStreet", String.class );
            fail( "setStreet method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setCity", String.class );
            fail( "setCity method should not exist" );

        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setPostalCode", PostalCodeType.class );
            fail( "setPostalCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionEmailTest {

    @Test
    public void testToString() {
        // given
        String input = "test@example.com";

        // when
        EmailType instance = instantiateEmail( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateEmail( null ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        EmailType instance1 = instantiateEmail( "test@example.com" );
        EmailType instance2 = instantiateEmail( "test@example.com" );
        EmailType instance3 = instantiateEmail( "different@example.com" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        EmailType instance = instantiateEmail( "test@example.com" );

        // then
        try {
            instance.getClass().getMethod( "setEmail", String.class );
            fail( "setEmail method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionMoneyTest {

    @Test
    public void testGetAmount() {
        // given
        Float inputAmount = 10.0f;

        // when
        MoneyType instance = instantiateMoney( inputAmount, "EUR" );

        // then
        assertEquals( inputAmount, instance.getAmount() );
    }

    @Test
    public void testGetCurrency() {
        // given
        String inputCurrency = "EUR";

        // when
        MoneyType instance = instantiateMoney( 10.0f, inputCurrency );

        // then
        assertEquals( inputCurrency, instance.getCurrency() );
    }

    @Test
    public void testAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );

        // when
        MoneyType result12 = instance1.add( instance2 );
        MoneyType result13 = instance1.add( instance3 );

        // then
        assertEquals( 30.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 10.0f, result13.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
    }

    @Test
    public void testInvalidAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
    }

    @Test
    public void testSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );

        // when
        MoneyType result12 = instance1.subtract( instance2 );
        MoneyType result13 = instance1.subtract( instance3 );
        MoneyType result14 = instance1.subtract( instance4 );

        // then
        assertEquals( 10.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 30.0f, result13.getAmount() );
        assertEquals( "EUR", result13.getCurrency() );
        assertEquals( 0.0f, result14.getAmount() );
        assertEquals( "EUR", result14.getCurrency() );
    }

    @Test
    public void testInvalidSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
        assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
    }

    @Test
    public void testMultiplyBy() {
        // given
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // when
        MoneyType result = instance.multiplyBy( 3 );

        // then
        assertEquals( 30.0f, result.getAmount() );
        assertEquals( "EUR", result.getCurrency() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
    }

    @Test
    public void testLargerThan() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );

        // when
        // then
        assertTrue( instance2.largerThan( instance1 ) );
        assertFalse( instance1.largerThan( instance2 ) );
        assertFalse( instance1.largerThan( instance3 ) );
        assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
    }


    @Test
    public void testValueObjectEquality() {
        // given
        // when
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // then
        try {
            instance.getClass().getMethod( "setAmount", Float.class );
            fail( "setAmount method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }

        try {
            instance.getClass().getMethod( "setCurrency", String.class );
            fail( "setCurrency method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPostalCodeTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionPostalCodeTest {

    @Test
    public void testToString() {
        // given
        String input = "12345";

        // when
        PostalCodeType instance = instantiatePostalCode( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiatePostalCode( "12345" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiatePostalCode( "123456" ) );
        assertThrows( ShopException.class, () -> instantiatePostalCode( "1234" ) );
        assertThrows( ShopException.class, () -> instantiatePostalCode( "20000" ) );
        assertThrows( ShopException.class, () -> instantiatePostalCode( null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        PostalCodeType instance1 = instantiatePostalCode( "12345" );
        PostalCodeType instance2 = instantiatePostalCode( "12345" );
        PostalCodeType instance3 = instantiatePostalCode( "54321" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        PostalCodeType instance = instantiatePostalCode( "12345" );

        // then
        try {
            instance.getClass().getMethod( "setpostalCode", String.class );
            fail( "setpostalCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionCustomerRegistrationTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.CustomerType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.transaction.Transactional;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_ADDRESS;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;

@SpringBootTest
@Transactional
public class RegressionCustomerRegistrationTest {

    @Autowired
    private CustomerRegistrationUseCases customerRegistrationUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    private EmailType nonExistingEmail;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        nonExistingEmail = instantiateEmail( "this@nononono.de" );
    }


    @Test
    public void testAllCustomersRegistered() {
        // given
        initialMasterDataCreator.registerAllCustomers();

        // when
        CustomerType customer3 = customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[3] );

        // then
        Assertions.assertEquals( initialMasterDataCreator.CUSTOMER_NAME[3], customer3.getName() );
        Assertions.assertEquals( CUSTOMER_EMAIL[3], customer3.getEmail() );
        Assertions.assertEquals( CUSTOMER_ADDRESS[3], customer3.getAddress() );
    }


    @Test
    public void testRegisterCustomerWithDuplicateEmail() {
        // given
        initialMasterDataCreator.registerAllCustomers();

        // when
        // then
        assertThrows( ShopException.class, () ->
                customerRegistrationUseCases.register( "Gandalf The Grey", CUSTOMER_EMAIL[5],
                        CUSTOMER_ADDRESS[5] ) );
    }

    @Test
    public void testRegisterCustomerWithDuplicateNameOrAddress() {
        // given
        initialMasterDataCreator.registerAllCustomers();
        EmailType newEmail = instantiateEmail( "some@this.de" );

        // when
        // then
        assertDoesNotThrow(() ->
                customerRegistrationUseCases.register( initialMasterDataCreator.CUSTOMER_NAME[2], newEmail,
                        CUSTOMER_ADDRESS[2] ) );
    }


    @Test
    public void testDeleteCustomersNoMoreCustomers() {
        // given
        initialMasterDataCreator.registerAllCustomers();

        // when
        customerRegistrationUseCases.deleteAllCustomers();

        // then
        assertThrows( ShopException.class, () -> customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[0] ) );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_INVENTORY;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;

@SpringBootTest
@Transactional
public class RegressionInventoryManagementTest {

    @Autowired
    private InventoryManagementUseCases inventoryManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        initialMasterDataCreator.addAllItems();
    }



    @Test
    public void testAddToInventory() {
        // given
        initialMasterDataCreator.inventoryUpAllItems();
        UUID itemId8 = (UUID) ITEM_DATA[8][0];

        // when
        int inventory8before = inventoryManagementUseCases.getAvailableInventory( itemId8 );
        assertEquals( ITEM_INVENTORY.get( itemId8 ), inventory8before );
        inventoryManagementUseCases.addToInventory( itemId8, 22 );
        int inventory8after = inventoryManagementUseCases.getAvailableInventory( itemId8 );
        inventoryManagementUseCases.addToInventory( itemId8, 1 );
        int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( itemId8 );

        // then
        assertEquals( inventory8before + 22, inventory8after );
        assertEquals( inventory8after + 1, inventory8after2 );
    }


    @Test
    public void testRemoveFromInventory() {
        // given
        initialMasterDataCreator.inventoryUpAllItems();
        UUID itemId6 = (UUID) ITEM_DATA[6][0];
        int inventory6before = ITEM_INVENTORY.get( itemId6 );
        UUID itemId9 = (UUID) ITEM_DATA[9][0];
        int inventory9before = ITEM_INVENTORY.get( itemId9 );
        UUID itemId1 = (UUID) ITEM_DATA[1][0];
        int inventory1before = ITEM_INVENTORY.get( itemId1 );

        // when
        inventoryManagementUseCases.removeFromInventory( itemId6, 1 );
        int inventory6after = inventoryManagementUseCases.getAvailableInventory( itemId6 );
        inventoryManagementUseCases.removeFromInventory( itemId1, 3 );
        int inventory1after = inventoryManagementUseCases.getAvailableInventory( itemId1 );
        inventoryManagementUseCases.removeFromInventory( itemId9, inventory9before );
        int inventory9after = inventoryManagementUseCases.getAvailableInventory( itemId9 );

        // then
        assertEquals( inventory6before - 1, inventory6after );
        assertEquals( inventory1before - 3, inventory1after );
        assertEquals( 0, inventory9after );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionItemCatalogTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;

@SpringBootTest
@Transactional
public class RegressionItemCatalogTest {

    @Autowired
    private ItemCatalogUseCases itemCatalogUseCases;
    @Autowired
    private InventoryManagementUseCases inventoryManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
    }



    @Test
    public void testAddItemToCatalog() {
        // given
        initialMasterDataCreator.addAllItems();

        // when
        MoneyType sellPrice = itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] );

        // then
        assertEquals( ITEM_DATA[4][5], sellPrice );
    }

    @Test
    public void testRemoveItemFromCatalog() {
        // given
        initialMasterDataCreator.addAllItems();
        UUID itemId = (UUID) ITEM_DATA[4][0];

        // when
        assertDoesNotThrow( () -> itemCatalogUseCases.getSellPrice( itemId ) );
        itemCatalogUseCases.removeItemFromCatalog( itemId );

        // then
        assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( itemId ) );
    }




    @Test
    public void testRemoveItemThatIsInInventory() {
        // given
        initialMasterDataCreator.addAllItems();
        UUID itemId = (UUID) ITEM_DATA[4][0];
        inventoryManagementUseCases.addToInventory( itemId, 3 );

        // when
        // then
        assertThrows( ShopException.class, () -> itemCatalogUseCases.removeItemFromCatalog( itemId ) );
    }


    @Test
    public void testClearItemCatalog() {
        // given
        initialMasterDataCreator.addAllItems();

        // when
        itemCatalogUseCases.deleteItemCatalog();

        // then
        assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] ) );
    }

}


[RESPONSE]:
# Code Review Ergebnisse

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java

- **Address** [Zeilen 46-48, 51-53, 56-58]: **Dead Code** : Die Override-Methoden `getStreet()`, `getCity()` und `getPostalCode()` sind redundant, da Lombok `@Getter` bereits Getter für alle Felder generiert.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java

- **Email** [Zeile 18-21]: **Duplication** [Original Zeile 28-30]: Die Null/Empty-Prüfung im Konstruktor ist identisch mit der im `of()`-Factory-Method.

- **Email** [Zeilen 46-50, 52-56]: **Duplication** : Die for-Schleifen für `beforeAt` und `afterAt` sind nahezu identisch und könnten in eine gemeinsame Methode extrahiert werden.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerOrderService.java

- **CustomerOrderService** [Zeile 26-28]: **Dead Code** : Die Methode `findByEmailEmailString` gibt immer `null` zurück und wird nicht sinnvoll implementiert.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerRegistrationService.java

- **CustomerRegistrationService** [Zeilen 76-122]: **Dead Code** : Der gesamte auskommentierte Code am Ende der Klasse ist toter Code und sollte entfernt werden.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java

- **Customer** : **Anemic Entity** : Die Klasse enthält hauptsächlich Getter/Setter (via Lombok) und einen Konstruktor, aber keine echte Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\DeliveryRecipientClass.java

- **DeliveryRecipientClass** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter und Konstruktoren ohne Domänenlogik.

- **DeliveryRecipientClass** [Zeilen 18-22]: **Duplication** [Original: Customer Zeilen 31-34]: Die Felder `name`, `email`, `address` werden sowohl hier als auch in der Parent-Klasse `Customer` definiert und überschrieben.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java

- **DeliveryService** [Zeilen 49-63]: **Dead Code** : Die auskommentierte Methode `triggerDeliveryCheck` ist toter Code.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java

- **Delivery** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne echte Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryElement.java

- **InventoryElement** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\Item.java

- **Item** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java

- **OrderController** [Zeilen 46-64]: **Dead Code** : Der auskommentierte POST-Endpunkt ist toter Code.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapperService.java

- **OrderDtoMapperService** [Zeilen 28-34]: **Dead Code** : Die auskommentierte Methode `mapToEntity` ist toter Code.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderExceptions.java

- **OrderExceptions** [gesamte Datei]: **Dead Code** : Die Klasse ist leer und wird nirgends verwendet.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java

- **OrderService** [Zeilen 27-31]: **Dead Code** : Die auskommentierte Methode `createOrderFromDto` ist toter Code.

- **OrderService** [Zeilen 34-38]: **Duplication** [Original: OrderShoppingService Zeilen 39-44]: Die Methode `instantiateOrder` ist nahezu identisch mit der in `OrderShoppingService`.

- **OrderService** [Zeilen 41-52]: **Duplication** [Original: OrderShoppingService Zeilen 47-58]: Die Methode `persistOrder` ist nahezu identisch mit der in `OrderShoppingService`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java

- **Order** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\domain\OrderPart.java

- **OrderPart** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java

- **Payment** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartController.java

- **ShoppingCartController** [Zeilen 130-207]: **Dead Code** : Der gesamte auskommentierte Code am Ende der Klasse ist toter Code.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java

- **ShoppingCartService** [Zeilen 104-106]: **Duplication** [Original Zeilen 77-79]: Die Email-Prüfung und Kundenprüfung wiederholt sich in mehreren Methoden (`addItemToShoppingCart`, `removeItemFromShoppingCart`, `setCommentForShoppingCartPart`, etc.).

- **ShoppingCartService** [Zeilen 176-184]: **Duplication** [Original Zeilen 185-193]: Die beiden `isPaymentAuthorized`-Methoden sind nahezu identisch, die überladene Version delegiert nur an die interne Methode.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractCustomer.java

- **AbstractCustomer** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractItem.java

- **AbstractItem** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java

- **ShoppingCart** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

- **ShoppingCart** [Zeilen 30-36]: **Dead Code** : Der auskommentierte Konstruktor ist toter Code.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java

- **ShoppingCartPart** : **Anemic Entity** : Die Klasse enthält nur Getter/Setter ohne Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderShoppingService.java

- **OrderShoppingService** [Zeile 7]: **Layer Violation** : Import von `thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository` - direkter Zugriff auf das Domain-Repository eines anderen Packages (customer) aus dem Order-Package.

- **OrderShoppingService** [Zeile 7]: **Shared Persistency** : Import von `CustomerRepository` stellt direkten Zugriff auf das Repository eines anderen Bounded Context dar.

ENDE
Generated by claude-opus-4-5-20251101
-----------------------------------