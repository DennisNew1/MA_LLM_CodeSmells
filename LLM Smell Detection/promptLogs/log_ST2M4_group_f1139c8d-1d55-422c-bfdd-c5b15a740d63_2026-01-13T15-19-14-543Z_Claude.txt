--- DATE: 13.1.2026, 16:19:14 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
9: 
10: import javax.persistence.Embeddable;
11: 
12: @Embeddable
13: @NoArgsConstructor
14: @Getter
15: @EqualsAndHashCode
16: public class Address implements AddressType {
17: 
18:   private String street;
19: 
20:   private String city;
21: 
22:   private PostalCode postalCode;
23: 
24:   /**
25:    * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
26:    * implementing class to provide a static factory method (simply named "of(...)"),
27:    * which creates an postal code, given as a string.
28:    * We specify this factory method here as a comment, using the Javadoc documentation style.
29:    *
30:    * @param street the street as a string
31:    * @param city the city as a string
32:    * @param postalCode the postal code
33:    * @return the address object matching the parameters
34:    * @throws ShopException if ...
35:    *      - street is null or empty
36:    *      - city is null or empty
37:    *      - postalCode is null
38:    */
39:   public static Address of(final String street, final String city, final PostalCodeType postalCode) throws ShopException {
40:     return new Address(street, city, (PostalCode) postalCode);
41:   }
42: 
43:   private Address(String street, String city, PostalCode postalCode) throws ShopException {
44:     setStreet(street);
45:     setCity(city);
46:     setPostalCode(postalCode);
47:   }
48: 
49:   private void setStreet(final String street) throws ShopException {
50:     if (street == null || street.isEmpty())
51:       throw new ShopException("Street must not be null or empty");
52: 
53:     this.street = street;
54:   }
55: 
56:   private void setCity(final String city) throws ShopException {
57:     if (city == null || city.isEmpty())
58:       throw new ShopException("City must not be null or empty");
59: 
60:     this.city = city;
61:   }
62: 
63:   private void setPostalCode(final PostalCode postalCode) throws ShopException {
64:     if (postalCode == null)
65:       throw new ShopException("Postal code must not be null");
66: 
67:     this.postalCode = postalCode;
68:   }
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.NotFoundException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: 
10: import javax.persistence.Embeddable;
11: 
12: @Embeddable
13: @NoArgsConstructor
14: @Getter
15: @EqualsAndHashCode
16: public class Email implements EmailType {
17: 
18:   private String emailString;
19: 
20:   /**
21:    * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
22:    * implementing class to provide a static factory method (simply named "of(...)"),
23:    * which creates an email, given as a string.
24:    * We specify this factory method here as a comment, using the Javadoc documentation style.
25:    *
26:    * @param emailAsString - the email as a string.
27:    *      We will use a much simplified validation method to check if the email is valid:
28:    *      - it must contain exactly one '@' character.
29:    *      - the part before the '@' and the part after the '@' must not be empty, contain of
30:    *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
31:    *      - the parts before and after the '@' may contain one or several '.' as separators
32:    *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
33:    *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
34:    *        (for simplicity we do not allow any other domains)
35:    * @return a new EmailType object matching the given email
36:    * @throws ShopException if ...
37:    *      - emailAsString is null
38:    *      - emailAsString is not a valid email (see above)
39:    */
40:   public static Email of(final String emailAsString) {
41:     return new Email(emailAsString);
42:   }
43: 
44:   private Email(final String emailString) {
45:     setEmail(emailString);
46:   }
47: 
48:   private void setEmail(final String emailAsString) {
49:     if (emailAsString == null)
50:       throw new ShopException("Email must not be null");
51:     if (!emailAsString.matches("^([A-Za-z0-9]+\\.)*[A-Za-z0-9]+@([A-Za-z0-9]+\\.)+(de|at|ch|com|org)$"))
52:       throw new NotFoundException("Email is not valid");
53: 
54:     this.emailString = emailAsString;
55:   }
56: 
57:   @Override
58:   public String toString() {
59:     return emailString;
60:   }
61: }
62: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\exceptions\ConflictException.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives.exceptions;
2: 
3: import org.springframework.web.bind.annotation.ResponseStatus;
4: import thkoeln.archilab.ecommerce.ShopException;
5: 
6: @ResponseStatus(code = org.springframework.http.HttpStatus.CONFLICT)
7: public class ConflictException extends ShopException {
8:     public ConflictException(String message) {
9:         super(message);
10:     }
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\exceptions\NotFoundException.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives.exceptions;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.NOT_FOUND)
8: public class NotFoundException extends ShopException {
9:     public NotFoundException(String message) {
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: 
8: import javax.persistence.Embeddable;
9: import java.util.Arrays;
10: 
11: @Embeddable
12: @NoArgsConstructor
13: @Getter
14: @EqualsAndHashCode
15: public class Money {
16: 
17:   private static final String[] ALLOWED_CURRENCIES = {"EUR", "CHF"};
18: 
19:   private Float amount;
20:   private String currency;
21: 
22:   /**
23:    * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
24:    * implementing class to provide a static factory method (simply named "of(...)"),
25:    * which creates a money object from an amount and a currency (as string).
26:    * We specify this factory method here as a comment, using the Javadoc documentation style.
27:    *
28:    * @param amount the amount of money (must be >= 0)
29:    * @param currency the currency of the money (allowed values: "EUR", "CHF")
30:    * @return a new Money object with the given amount and currency
31:    * @throws ShopException if ...
32:    *   - amount is null
33:    *   - amount < 0
34:    *   - currency is null
35:    *   - currency is not one of the allowed values
36:    */
37:   public static Money of(final Float amount, final String currency) {
38:     return new Money(amount, currency);
39:   }
40: 
41:   private Money(final Float amount, final String currency) {
42:     setAmount(amount);
43:     setCurrency(currency);
44:   }
45: 
46:   private void setAmount(final Float amount) {
47:     if (amount == null)
48:       throw new ShopException("Amount must not be null");
49:     if (amount < 0)
50:       throw new ShopException("Amount must not be negative");
51: 
52:     this.amount = amount;
53:   }
54: 
55:   private void setCurrency(final String currency) {
56:     if (currency == null)
57:       throw new ShopException("Currency must not be null");
58:     if (Arrays.stream(ALLOWED_CURRENCIES).noneMatch(currency::equals))
59:       throw new ShopException("Currency must not be " + currency);
60: 
61:     this.currency = currency;
62:   }
63: 
64:   /**
65:    * @param otherMoney
66:    * @return this + otherMoney, as a new object
67:    * @throws ShopException if ...
68:    *                       - otherMoney is null
69:    *                       - otherMoney.currency != this.currency
70:    */
71:   public Money add(final Money otherMoney) {
72:     if (otherMoney == null)
73:       throw new ShopException("Other money must not be null");
74:     if (!otherMoney.getCurrency().equals(this.currency))
75:       throw new ShopException("Other money must not have a different currency");
76: 
77:     return Money.of(this.amount + otherMoney.getAmount(), this.currency);
78:   }
79: 
80:   /**
81:    * @param otherMoney
82:    * @return this - otherMoney, as a new object
83:    * @throws ShopException if ...
84:    *                       - otherMoney is null
85:    *                       - otherMoney.currency != this.currency
86:    *                       - otherMoney > this
87:    */
88:   public Money subtract(final Money otherMoney) {
89:     if (otherMoney == null)
90:       throw new ShopException("Other money must not be null");
91:     if (!otherMoney.getCurrency().equals(this.currency))
92:       throw new ShopException("Other money must not have a different currency");
93:     if (otherMoney.getAmount() > this.amount)
94:       throw new ShopException("Other money must not be larger than this");
95: 
96:     return Money.of(this.amount - otherMoney.getAmount(), this.currency);
97:   }
98: 
99:   /**
100:    * @param factor
101:    * @return this * factor, as a new object
102:    * @throws ShopException if ...
103:    *                       - factor < 0
104:    */
105:   public Money multiplyBy(final int factor) {
106:     if (factor < 0)
107:       throw new ShopException("Factor must not be negative");
108: 
109:     return Money.of(this.amount * factor, this.currency);
110:   }
111: 
112:   /**
113:    * @param otherMoney
114:    * @return true, if this > otherMoney
115:    * @throws ShopException if ...
116:    *                       - otherMoney is null
117:    *                       - otherMoney.currency != this.currency
118:    */
119:   public boolean largerThan(final Money otherMoney) {
120:     if (otherMoney == null)
121:       throw new ShopException("Other money must not be null");
122:     if (!otherMoney.getCurrency().equals(this.currency))
123:       throw new ShopException("Other money must not have a different currency");
124: 
125:     return this.amount > otherMoney.getAmount();
126:   }
127: }
128: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\MoneyTypeAdapter.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
7: 
8: @Getter
9: @EqualsAndHashCode
10: public class MoneyTypeAdapter implements MoneyType {
11: 
12:   private final Money money;
13: 
14:   /**
15:    * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
16:    * implementing class to provide a static factory method (simply named "of(...)"),
17:    * which creates a money object from an amount and a currency (as string).
18:    * We specify this factory method here as a comment, using the Javadoc documentation style.
19:    *
20:    * @param amount the amount of money (must be >= 0)
21:    * @param currency the currency of the money (allowed values: "EUR", "CHF")
22:    * @return a new Money object with the given amount and currency
23:    * @throws ShopException if ...
24:    *   - amount is null
25:    *   - amount < 0
26:    *   - currency is null
27:    *   - currency is not one of the allowed values
28:    */
29:   public static MoneyType of(final Float amount, final String currency) {
30:     return new MoneyTypeAdapter(Money.of(amount, currency));
31:   }
32: 
33:   public static MoneyType of(final Money money) {
34:     return new MoneyTypeAdapter(money);
35:   }
36: 
37:   private MoneyTypeAdapter(final Money money) {
38:     this.money = money;
39:   }
40: 
41:   /**
42:    * @return the amount of money
43:    */
44:   @Override
45:   public Float getAmount() {
46:     return money.getAmount();
47:   }
48: 
49:   /**
50:    * @return the currency of the money
51:    */
52:   @Override
53:   public String getCurrency() {
54:     return money.getCurrency();
55:   }
56: 
57:   /**
58:    * @param otherMoney
59:    * @return this + otherMoney, as a new object
60:    * @throws ShopException if ...
61:    *                       - otherMoney is null
62:    *                       - otherMoney.currency != this.currency
63:    */
64:   @Override
65:   public MoneyType add(final MoneyType otherMoney) {
66:     return new MoneyTypeAdapter(money.add(((MoneyTypeAdapter) otherMoney).getMoney()));
67:   }
68: 
69:   /**
70:    * @param otherMoney
71:    * @return this - otherMoney, as a new object
72:    * @throws ShopException if ...
73:    *                       - otherMoney is null
74:    *                       - otherMoney.currency != this.currency
75:    *                       - otherMoney > this
76:    */
77:   @Override
78:   public MoneyType subtract(final MoneyType otherMoney) {
79:     return new MoneyTypeAdapter(money.subtract(((MoneyTypeAdapter) otherMoney).getMoney()));
80:   }
81: 
82:   /**
83:    * @param factor
84:    * @return this * factor, as a new object
85:    * @throws ShopException if ...
86:    *                       - factor < 0
87:    */
88:   @Override
89:   public MoneyType multiplyBy(final int factor) {
90:     return new MoneyTypeAdapter(money.multiplyBy(factor));
91:   }
92: 
93:   /**
94:    * @param otherMoney
95:    * @return true, if this > otherMoney
96:    * @throws ShopException if ...
97:    *                       - otherMoney is null
98:    *                       - otherMoney.currency != this.currency
99:    */
100:   @Override
101:   public boolean largerThan(final MoneyType otherMoney) {
102:     return money.largerThan(((MoneyTypeAdapter) otherMoney).getMoney());
103:   }
104: }
105: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Name.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import org.springframework.util.StringUtils;
7: import thkoeln.archilab.ecommerce.ShopException;
8: 
9: import javax.persistence.Embeddable;
10: 
11: @Embeddable
12: @NoArgsConstructor
13: @Getter
14: @EqualsAndHashCode
15: public class Name {
16: 
17:   private String firstName;
18: 
19:   private String lastName;
20: 
21:   /**
22:    * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:    * implementing class to provide a static factory method (simply named "of(...)"),
24:    * which creates an postal code, given as a string.
25:    * We specify this factory method here as a comment, using the Javadoc documentation style.
26:    *
27:    * @param name     name consisting of first and last name as string
28:    * @return the name object matching the parameters
29:    * @throws ShopException if ...
30:    *                       - name is null or empty
31:    *                       - name does not consist of first and last name
32:    */
33:   public static Name of(final String name) throws ShopException {
34:     return new Name(name);
35:   }
36: 
37:   private Name(final String name) throws ShopException {
38:     final var splitName = StringUtils.split(name, " ");
39:     if (splitName == null || splitName.length != 2)
40:       throw new ShopException("Name must consist of first and last name");
41: 
42:     setFirstName(splitName[0]);
43:     setLastName(splitName[1]);
44:   }
45: 
46:   private void setFirstName(final String firstName) throws ShopException {
47:     if (firstName == null || firstName.isEmpty())
48:       throw new ShopException("First name must not be null or empty");
49: 
50:     this.firstName = firstName;
51:   }
52: 
53:   private void setLastName(final String lastName) throws ShopException {
54:     if (lastName == null || lastName.isEmpty())
55:       throw new ShopException("Last name must not be null or empty");
56: 
57:     this.lastName = lastName;
58:   }
59: 
60:   @Override
61:   public String toString() {
62:     return firstName + " " + lastName;
63:   }
64: }
65: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PostalCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
8: 
9: import javax.persistence.Embeddable;
10: 
11: @Embeddable
12: @Getter
13: @NoArgsConstructor
14: @EqualsAndHashCode
15: public class PostalCode implements PostalCodeType {
16: 
17:   private String postalCodeAsString;
18: 
19:   /**
20:    * @param postalCodeAsString - the postal code as a string.
21:    *      We will use a much simplified validation method to check if the postal code is valid:
22:    *      - It must contain exactly 5 digits.
23:    *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
24:    * @return a new postal code object matching the given string
25:    * @throws ShopException if ...
26:    *      - postalCodeAsString is null
27:    *      - postalCodeAsString is not a valid postal code (see above)
28:    */
29:   public static PostalCode of(final String postalCodeAsString) {
30:     return new PostalCode(postalCodeAsString);
31:   }
32: 
33:   protected PostalCode(final String postalCodeAsString) {
34:     setPostalCode(postalCodeAsString);
35:   }
36: 
37:   private void setPostalCode(final String postalCodeAsString) {
38:     if (postalCodeAsString == null)
39:       throw new ShopException("Postal code must not be null");
40:     if (!postalCodeAsString.matches("\\d{5}"))
41:       throw new ShopException("Postal code must contain exactly 5 digits");
42:     if (postalCodeAsString.endsWith("0000"))
43:       throw new ShopException("Postal code must not end with 0000");
44: 
45:     this.postalCodeAsString = postalCodeAsString;
46:   }
47: 
48:   /**
49:    * @return the postal code as a string
50:    */
51:   @Override
52:   public String toString() {
53:     return postalCodeAsString;
54:   }
55: }
56: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static AddressType instantiateAddress(
52:             String street, String city, PostalCodeType postalCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, PostalCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for AddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, postalCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + postalCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (AddressType) instance;
79:     }
80: 
81: 
82:     public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for PostalCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, postalCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (PostalCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * customers and items. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] CUSTOMER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] CUSTOMER_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static AddressType[] CUSTOMER_ADDRESS = new AddressType[] {
53:             FactoryMethodInvoker.instantiateAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiateAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiateAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiateAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiateAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiateAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiateAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiateAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiateAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiateAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
83:     };
84: 
85:     public final static CustomerType[] mockCustomers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] ITEM_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private CustomerRegistrationUseCases customerRegistrationUseCases;
135:     private ItemCatalogUseCases itemCatalogUseCases;
136:     private InventoryManagementUseCases inventoryManagementUseCases;
137:     private ShoppingCartUseCases shoppingCartUseCases;
138: 
139: 
140:     // item 0 is out of inventory, item 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random inventory between 5 and 100
142:     public static final Map<UUID, Integer> ITEM_INVENTORY = new HashMap<>();
143: 
144:     static {
145:         mockCustomers = new CustomerType[CUSTOMER_NAME.length];
146:         for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
147:             mockCustomers[i] = new MockCustomer(
148:                     CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] itemData : ITEM_DATA ) {
152:             ITEM_INVENTORY.put( (UUID) itemData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[0][0], 0 );
155:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[1][0], 10 );
156:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[2][0], 20 );
157:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             CustomerRegistrationUseCases customerRegistrationUseCases,
181:             ItemCatalogUseCases itemCatalogUseCases,
182:             InventoryManagementUseCases inventoryManagementUseCases,
183:             ShoppingCartUseCases shoppingCartUseCases ) {
184:         this.customerRegistrationUseCases = customerRegistrationUseCases;
185:         this.itemCatalogUseCases = itemCatalogUseCases;
186:         this.inventoryManagementUseCases = inventoryManagementUseCases;
187:         this.shoppingCartUseCases = shoppingCartUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingCartUseCases.deleteAllOrders();
193:         itemCatalogUseCases.deleteItemCatalog();
194:         customerRegistrationUseCases.deleteAllCustomers();
195:     }
196: 
197: 
198:     public void registerAllCustomers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.CUSTOMER_NAME.length; i++ ) {
200:             registerCustomer( InitialMasterDataCreator.CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerCustomer( String name, EmailType email, AddressType address ) {
206:         customerRegistrationUseCases.register( name, email, address );
207:     }
208: 
209:     public void addAllItems() {
210:         for ( Object[] itemData : ITEM_DATA ) {
211:             addItemDataToCatalog( itemData );
212:         }
213:     }
214: 
215:     public void addItemDataToCatalog( Object[] itemData ) {
216:         itemCatalogUseCases.addItemToCatalog( (UUID) itemData[0], (String) itemData[1], (String) itemData[2],
217:                 (Float) itemData[3], (MoneyType) itemData[4], (MoneyType) itemData[5] );
218:     }
219: 
220: 
221:     public Object[] getItemDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] itemData = ITEM_DATA[1];
223:         Object[] itemDataInvalid = new Object[itemData.length];
224:         System.arraycopy( itemData, 0, itemDataInvalid, 0, itemData.length );
225:         itemDataInvalid[index] = itemData[index].getClass().cast(
226:                 reason.getInvalidValue( itemData[index] ) );
227:         return itemDataInvalid;
228:     }
229: 
230: 
231:     public void inventoryUpAllItems() {
232:         for ( Object[] itemData : ITEM_DATA ) {
233:             if ( ITEM_INVENTORY.get( itemData[0] ) > 0 )
234:                 inventoryManagementUseCases.addToInventory( (UUID) itemData[0], ITEM_INVENTORY.get( itemData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockCustomer.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockCustomer implements CustomerType {
12:     private String name;
13:     private EmailType email;
14:     private AddressType address;
15: 
16: 
17:     public MockCustomer( String name, EmailType email, AddressType address) {
18:         this.name = name;
19:         this.email = email;
20:         this.address = address;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public AddressType getAddress() {
35:         return address;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockCustomer ) ) return false;
42:         MockCustomer that = (MockCustomer) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( address, that.address );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, address );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllCustomers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\CustomerRegistrationUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Address;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Name;
8: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
9: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
10: import thkoeln.archilab.ecommerce.usecases.CustomerType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: @Service
15: public class CustomerRegistrationUseCasesAdapterService implements CustomerRegistrationUseCases {
16: 
17:   private final CustomerService customerService;
18: 
19:   @Autowired
20:   public CustomerRegistrationUseCasesAdapterService(CustomerService customerService) {
21:     this.customerService = customerService;
22:   }
23: 
24:   @Override
25:   public void register(String name, EmailType email, AddressType address) {
26:     customerService.register(Name.of(name), (Email) email, (Address) address);
27:   }
28: 
29:   @Override
30:   public void changeAddress(EmailType customerEmail, AddressType address) {
31:     customerService.changeAddress((Email) customerEmail, (Address) address);
32:   }
33: 
34:   @Override
35:   public CustomerType getCustomerData(EmailType customerEmail) {
36:     return customerService.getCustomerData((Email) customerEmail);
37:   }
38: 
39:   @Override
40:   public void deleteAllCustomers() {
41:     customerService.deleteAllCustomers();
42:   }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\DeliveryUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Name;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
10: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
11: import thkoeln.archilab.ecommerce.usecases.CustomerType;
12: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: 
15: import java.util.Map;
16: import java.util.UUID;
17: 
18: @Service
19: public class DeliveryUseCasesAdapterService implements DeliveryUseCases {
20: 
21:   private final DeliveryService deliveryService;
22: 
23:   @Autowired
24:   public DeliveryUseCasesAdapterService(DeliveryService deliveryService) {
25:     this.deliveryService = deliveryService;
26:   }
27: 
28:   @Override
29:   public UUID triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
30:     if (deliveryRecipient == null)
31:       throw new ShopException("Delivery recipient is null");
32:     var customer = new Customer((Email) deliveryRecipient.getEmail(), Name.of(deliveryRecipient.getName()), (Address) deliveryRecipient.getAddress());
33:     return deliveryService.triggerDelivery(customer, deliveryContent);
34:   }
35: 
36:   @Override
37:   public Map<UUID, Integer> getDeliveryHistory(EmailType customerEmail) {
38:     return deliveryService.getDeliveryHistory((Email) customerEmail);
39:   }
40: 
41:   @Override
42:   public void deleteDeliveryHistory() {
43:     deliveryService.deleteDeliveryHistory();
44:   }
45: }
46: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\InventoryManagementUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.inventory.application.InventoryManagementService;
6: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
7: 
8: import java.util.UUID;
9: 
10: @Service
11: public class InventoryManagementUseCasesAdapterService implements InventoryManagementUseCases {
12: 
13:   private final InventoryManagementService inventoryManagementService;
14: 
15:   @Autowired
16:   public InventoryManagementUseCasesAdapterService(InventoryManagementService inventoryManagementService) {
17:     this.inventoryManagementService = inventoryManagementService;
18:   }
19: 
20:   @Override
21:   public void addToInventory(UUID itemId, int addedQuantity) {
22:     inventoryManagementService.addToInventory(itemId, addedQuantity);
23:   }
24: 
25:   @Override
26:   public void removeFromInventory(UUID itemId, int removedQuantity) {
27:     inventoryManagementService.removeFromInventory(itemId, removedQuantity);
28:   }
29: 
30:   @Override
31:   public void changeInventoryTo(UUID itemId, int newTotalQuantity) {
32:     inventoryManagementService.changeInventoryTo(itemId, newTotalQuantity);
33:   }
34: 
35:   @Override
36:   public int getAvailableInventory(UUID itemId) {
37:     return inventoryManagementService.getAvailableInventory(itemId);
38:   }
39: }
40: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\ItemCatalogUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.MoneyTypeAdapter;
6: import thkoeln.archilab.ecommerce.solution.item.application.ItemCatalogService;
7: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: public class ItemCatalogUseCasesAdapterService implements ItemCatalogUseCases {
14: 
15:   private final ItemCatalogService itemCatalogService;
16: 
17:   @Autowired
18:   public ItemCatalogUseCasesAdapterService(ItemCatalogService itemCatalogService) {
19:     this.itemCatalogService = itemCatalogService;
20:   }
21: 
22:   @Override
23:   public void addItemToCatalog(UUID itemId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellPrice) {
24:     var purchasePriceAsMoney = (purchasePrice != null) ? ((MoneyTypeAdapter) purchasePrice).getMoney() : null;
25:     var sellPriceAsMoney = (sellPrice != null) ? ((MoneyTypeAdapter) sellPrice).getMoney() : null;
26:     itemCatalogService.addItemToCatalog(itemId, name, description, size, purchasePriceAsMoney, sellPriceAsMoney);
27:   }
28: 
29:   @Override
30:   public void removeItemFromCatalog(UUID itemId) {
31: itemCatalogService.removeItemFromCatalog(itemId);
32:   }
33: 
34:   @Override
35:   public MoneyType getSellPrice(UUID itemId) {
36:     return MoneyTypeAdapter.of(itemCatalogService.getSellPrice(itemId));
37:   }
38: 
39:   @Override
40:   public void deleteItemCatalog() {
41:     itemCatalogService.deleteItemCatalog();
42:   }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\PaymentUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.domainprimitives.MoneyTypeAdapter;
7: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
8: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.UUID;
13: 
14: @Service
15: public class PaymentUseCasesAdapterService implements PaymentUseCases {
16: 
17:   private final PaymentService paymentService;
18: 
19:   @Autowired
20:   public PaymentUseCasesAdapterService(PaymentService paymentService) {
21:     this.paymentService = paymentService;
22:   }
23: 
24:   @Override
25:   public UUID authorizePayment(EmailType customerEmail, MoneyType amount) {
26:     var amountAsMoney = (amount != null) ? ((MoneyTypeAdapter) amount).getMoney() : null;
27:     return paymentService.authorizePayment((Email) customerEmail, amountAsMoney);
28:   }
29: 
30:   @Override
31:   public MoneyType getPaymentTotal(EmailType customerEmail) {
32:     return MoneyTypeAdapter.of(paymentService.getPaymentTotal((Email) customerEmail));
33:   }
34: 
35:   @Override
36:   public void deletePaymentHistory() {
37:     paymentService.deletePaymentHistory();
38:   }
39: }
40: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\ShoppingCartUseCasesAdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.anticorruptionlayer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.domainprimitives.MoneyTypeAdapter;
7: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService;
9: import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: @Service
17: public class ShoppingCartUseCasesAdapterService implements ShoppingCartUseCases {
18: 
19:   private final ShoppingCartService shoppingCartService;
20:   private final OrderService orderService;
21: 
22:   @Autowired
23:   public ShoppingCartUseCasesAdapterService(ShoppingCartService shoppingCartService, OrderService orderService) {
24:     this.shoppingCartService = shoppingCartService;
25:     this.orderService = orderService;
26:   }
27: 
28:   @Override
29:   public void addItemToShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
30:     shoppingCartService.addItemToShoppingCart(shoppingCartService.getShoppingCart((Email) customerEmail).getId(), itemId, quantity, null);
31:   }
32: 
33:   @Override
34:   public void removeItemFromShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
35:     shoppingCartService.removeItemFromShoppingCart(shoppingCartService.getShoppingCart((Email) customerEmail).getId(), itemId, quantity, null);
36:   }
37: 
38:   @Override
39:   public void setCommentForShoppingCartPart(EmailType customerEmail, UUID itemId, String comment) {
40:   }
41: 
42:   @Override
43:   public String getCommentForShoppingCartPart(EmailType customerEmail, UUID itemId) {
44:     return null;
45:   }
46: 
47:   @Override
48:   public Map<UUID, Integer> getShoppingCartAsMap(EmailType customerEmail) {
49:     return shoppingCartService.getShoppingCart((Email) customerEmail).getShoppingCartAsMap();
50:   }
51: 
52:   @Override
53:   public MoneyType getShoppingCartAsMoneyValue(EmailType customerEmail) {
54:     return MoneyTypeAdapter.of(shoppingCartService.getShoppingCart((Email) customerEmail).getShoppingCartAsMoneyValue());
55:   }
56: 
57:   @Override
58:   public int getReservedInventoryInShoppingCarts(UUID itemId) {
59:     return shoppingCartService.getReservedInventoryInShoppingCarts(itemId);
60:   }
61: 
62:   @Override
63:   public boolean isEmpty(EmailType customerEmail) {
64:     return shoppingCartService.getShoppingCart((Email) customerEmail).isEmpty();
65:   }
66: 
67:   @Override
68:   public boolean isPaymentAuthorized(EmailType customerEmail) {
69:     return shoppingCartService.isPaymentAuthorized(shoppingCartService.getShoppingCart((Email) customerEmail).getId());
70:   }
71: 
72:   @Override
73:   public void checkout(EmailType customerEmail) {
74:     shoppingCartService.checkout(shoppingCartService.getShoppingCart((Email) customerEmail).getId());
75:   }
76: 
77:   @Override
78:   public Map<UUID, Integer> getOrderHistory(EmailType customerEmail) {
79:     return orderService.getOrderHistory((Email) customerEmail);
80:   }
81: 
82:   @Override
83:   public void deleteAllOrders() {
84:     orderService.deleteAllOrders();
85:   }
86: }
87: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Name;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
9: import thkoeln.archilab.ecommerce.domainprimitives.Address;
10: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
11: import thkoeln.archilab.ecommerce.ShopException;
12: import thkoeln.archilab.ecommerce.solution.item.application.ItemStorage;
13: 
14: import java.util.Optional;
15: 
16: @Service
17: public class CustomerService {
18: 
19:   private final CustomerRepository customerRepository;
20:   private final ItemStorage shoppingCartService;
21:   private final Deletable shoppingCartService1;
22: 
23:   @Autowired
24:   public CustomerService(CustomerRepository customerRepository, @Lazy ItemStorage shoppingCartService, @Lazy Deletable shoppingCartService1) {
25:     this.customerRepository = customerRepository;
26:     this.shoppingCartService = shoppingCartService;
27:     this.shoppingCartService1 = shoppingCartService1;
28:   }
29: 
30:   public void register(Name name, Email email, Address address) {
31:     if (customerRepository.existsByEmail(email))
32:       throw new ShopException("Customer with the given email already exists");
33: 
34:     var newCustomer = new Customer(email, name, address);
35:     customerRepository.save(newCustomer);
36:     shoppingCartService.createShoppingCart(newCustomer.getEmail());
37:   }
38: 
39:   public void changeAddress(Email customerEmail, Address address) {
40:     var customer = customerRepository.findByEmail(customerEmail)
41:         .orElseThrow(() -> new ShopException("Customer with given email does not exist"));
42: 
43:     customer.setAddress(address);
44:     customerRepository.save(customer);
45:   }
46: 
47:   public Customer getCustomerData(Email customerEmail) {
48:     return customerRepository.findByEmail(customerEmail)
49:         .orElseThrow(() -> new ShopException("Customer does not exist"));
50:   }
51: 
52:   public void deleteAllCustomers() {
53:     shoppingCartService1.deleteAll();
54:     customerRepository.deleteAll();
55:   }
56: 
57:   public Boolean isCustomerRegistered(Email customerEmail) {
58:     return customerRepository.existsByEmail(customerEmail);
59:   }
60: 
61:   public Optional<Customer> getCustomer(Email customerEmail) {
62:     return customerRepository.findByEmail(customerEmail);
63:   }
64: }
65: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\Deletable.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: public interface Deletable {
4: 
5:   void deleteAll();
6: }
7: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: 
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Address;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.domainprimitives.Name;
10: import thkoeln.archilab.ecommerce.usecases.CustomerType;
11: 
12: import javax.persistence.*;
13: import java.util.UUID;
14: 
15: @Entity
16: @NoArgsConstructor
17: @Getter
18: public class Customer implements CustomerType {
19: 
20:   @Id
21:   @GeneratedValue
22:   @Column(name = "customer_id")
23:   private UUID id;
24: 
25:   @Column(unique = true)
26:   private Email email;
27: 
28:   @Embedded
29:   private Name name;
30: 
31:   @Embedded
32:   private Address address;
33: 
34:   public Customer(Email email, Name name, Address address) throws ShopException {
35:     setEmail(email);
36:     setName(name);
37:     setAddress(address);
38:   }
39: 
40:   public final void setEmail(Email email) throws ShopException {
41:     if (email == null)
42:       throw new ShopException("Email must not be null");
43:     this.email = email;
44:   }
45: 
46:   public final void setName(Name name) throws ShopException {
47:     if (name == null)
48:       throw new ShopException("Name must not be null");
49:     this.name = name;
50:   }
51: 
52:   public final void setAddress(Address address) throws ShopException {
53:     if (address == null)
54:       throw new ShopException("Address must not be null");
55:     this.address = address;
56:   }
57: 
58:   @Override
59:   public String getName() {
60:     return name.toString();
61:   }
62: }
63: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\CustomerRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.Optional;
7: import java.util.UUID;
8: 
9: public interface CustomerRepository extends CrudRepository<Customer, UUID> {
10:   Optional<Customer> findByEmail(Email customerEmail);
11: 
12:   Boolean existsByEmail(Email customerEmail);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.ConflictException;
8: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
10: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
11: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryPart;
12: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
13: import thkoeln.archilab.ecommerce.solution.item.application.ItemCatalogService;
14: import thkoeln.archilab.ecommerce.ShopException;
15: 
16: import java.util.Collection;
17: import java.util.Map;
18: import java.util.UUID;
19: import java.util.stream.Collectors;
20: 
21: @Service
22: public class DeliveryService {
23: 
24:   private static final int MAX_DELIVERY_PARTS = 20;
25: 
26:   private final DeliveryRepository deliveryRepository;
27:   private final CustomerService customerService;
28:   private final ItemCatalogService itemCatalogService;
29: 
30:   @Autowired
31:   public DeliveryService(DeliveryRepository deliveryRepository, @Lazy CustomerService customerService, @Lazy ItemCatalogService itemCatalogService) {
32:     this.deliveryRepository = deliveryRepository;
33:     this.customerService = customerService;
34:     this.itemCatalogService = itemCatalogService;
35:   }
36: 
37:   public UUID triggerDelivery(Customer deliveryRecipient, Map<UUID, Integer> deliveryContent) {
38:     if (deliveryRecipient == null)
39:       throw new ShopException("Delivery recipient is null");
40: 
41:     if (deliveryRecipient.getName() == null || deliveryRecipient.getName().isEmpty() ||
42:         deliveryRecipient.getEmail() == null ||
43:         deliveryRecipient.getAddress() == null)
44:       throw new ShopException("Delivery recipient is invalid");
45: 
46:     if (deliveryContent == null || deliveryContent.isEmpty())
47:       throw new ShopException("Delivery content is null or empty");
48: 
49:     if (deliveryContent.values().stream().reduce(0, Integer::sum) > MAX_DELIVERY_PARTS)
50:       throw new ConflictException("The total number of items in the delivery is > 20");
51: 
52:     deliveryContent.keySet().forEach(itemId -> {
53:       if (!itemCatalogService.isItemInCatalog(itemId))
54:         throw new ShopException("Item with the given id does not exist" + itemId);
55:     });
56:     var customer = customerService.getCustomer(deliveryRecipient.getEmail())
57:         .orElseThrow(() -> new ShopException("Customer with the given email does not exist"));
58: 
59:     var delivery = new Delivery();
60:     delivery.setCustomer(customer);
61:     delivery.setParts(
62:         deliveryContent
63:             .entrySet()
64:             .stream()
65:             .map(entry -> Map.entry(itemCatalogService.getItem(entry.getKey()), entry.getValue()))
66:             .map(DeliveryPart::new)
67:             .collect(Collectors.toList())
68:     );
69:     deliveryRepository.save(delivery);
70:     return delivery.getId();
71:   }
72: 
73:   public Map<UUID, Integer> getDeliveryHistory(Email customerEmail) {
74:     if (customerEmail == null)
75:       throw new ShopException("Customer email is null");
76: 
77:     if (!customerService.isCustomerRegistered(customerEmail))
78:       throw new ShopException("Customer with the given email does not exist");
79: 
80:     return deliveryRepository.findByCustomerEmail(customerEmail)
81:         .stream()
82:         .map(Delivery::getParts)
83:         .flatMap(Collection::stream)
84:         .map(orderPart -> Map.entry(orderPart.getItem().getId(), orderPart.getQuantity()))
85:         .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, Integer::sum));
86:   }
87: 
88:   public void deleteDeliveryHistory() {
89:     deliveryRepository.deleteAll();
90:   }
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
7: 
8: import javax.persistence.*;
9: import java.util.ArrayList;
10: import java.util.List;
11: import java.util.UUID;
12: 
13: @Entity
14: @NoArgsConstructor
15: @Getter
16: @Setter
17: public class Delivery {
18: 
19:   @Id
20:   @GeneratedValue
21:   @Column(name = "delivery_id")
22:   private UUID id;
23: 
24:   @ManyToOne
25:   private Customer customer;
26: 
27:   @ElementCollection
28:   private List<DeliveryPart> parts = new ArrayList<>();
29: }
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryPart.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
8: 
9: import javax.persistence.Embeddable;
10: import javax.persistence.ManyToOne;
11: import java.util.Map;
12: 
13: @Embeddable
14: @NoArgsConstructor
15: @AllArgsConstructor
16: @Getter
17: @EqualsAndHashCode
18: public class DeliveryPart {
19: 
20:   @ManyToOne
21:   private Item item;
22: 
23:   private int quantity;
24: 
25:   public DeliveryPart(Map.Entry<Item, Integer> entry) {
26:     this.item = entry.getKey();
27:     this.quantity = entry.getValue();
28:   }
29: }
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.Collection;
7: import java.util.UUID;
8: 
9: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
10:   Collection<Delivery> findByCustomerEmail(Email customerEmail);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryPart;
7: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
8: import thkoeln.archilab.ecommerce.solution.item.application.ItemCatalogService;
9: import thkoeln.archilab.ecommerce.solution.item.application.ItemStorage;
10: import thkoeln.archilab.ecommerce.solution.item.application.ItemStorageReadable;
11: import thkoeln.archilab.ecommerce.ShopException;
12: 
13: import java.util.UUID;
14: 
15: 
16: @Service
17: public class InventoryManagementService implements ItemStorageReadable {
18: 
19:   private final InventoryRepository inventoryRepository;
20:   private final ItemCatalogService itemCatalogService;
21:   private final ItemStorage shoppingCartService;
22: 
23:   @Autowired
24:   public InventoryManagementService(InventoryRepository inventoryRepository, @Lazy ItemCatalogService itemCatalogService, @Lazy ItemStorage shoppingCartService) {
25:     this.inventoryRepository = inventoryRepository;
26:     this.itemCatalogService = itemCatalogService;
27:     this.shoppingCartService = shoppingCartService;
28:   }
29: 
30:   public void addToInventory(UUID itemId, int addedQuantity) {
31:     if (!inventoryRepository.existsByItemId(itemId)) {
32:       var item = itemCatalogService.getItem(itemId);
33:       var newInventory = new InventoryPart(item, 0);
34:       inventoryRepository.save(newInventory);
35:     }
36:     changeInventoryTo(itemId, getAvailableInventory(itemId) + addedQuantity);
37:   }
38: 
39:   public void removeFromInventory(UUID itemId, int removedQuantity) {
40:     changeInventoryTo(itemId, getAvailableInventory(itemId) - removedQuantity);
41:   }
42: 
43:   public void changeInventoryTo(UUID itemId, int newTotalQuantity) {
44:     var inventory = getInventory(itemId);
45:     if (newTotalQuantity < shoppingCartService.getQuantityOfItem(itemId)) {
46:       shoppingCartService.reduceQuantityOfItem(itemId, newTotalQuantity);
47:       inventory.setQuantity(newTotalQuantity - shoppingCartService.getQuantityOfItem(itemId));
48:     } else {
49:       inventory.setQuantity(newTotalQuantity - shoppingCartService.getQuantityOfItem(itemId));
50:     }
51:     inventoryRepository.save(inventory);
52:   }
53: 
54:   public int getAvailableInventory(UUID itemId) {
55:     var item = itemCatalogService.getItem(itemId);
56:     return inventoryRepository.findByItemId(itemId)
57:         .map(inventoryPart -> inventoryPart.getQuantity() + shoppingCartService.getQuantityOfItem(itemId))
58:         .orElse(0);
59:   }
60: 
61:   public InventoryPart getInventory(UUID itemId) {
62:     return inventoryRepository.findByItemId(itemId)
63:         .orElseThrow(() -> new ShopException("Inventory does not exist"));
64:   }
65: 
66:   @Override
67:   public Boolean hasItemStored(UUID itemId) {
68:     return getAvailableInventory(itemId) > 0;
69:   }
70: 
71:   @Override
72:   public int getQuantityOfItem(UUID itemId) {
73:     return getAvailableInventory(itemId);
74:   }
75: }
76: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryDomainService.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.domain;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.NotFoundException;
6: 
7: import java.util.UUID;
8: 
9: @Component
10: public class InventoryDomainService {
11: 
12:   private final InventoryRepository inventoryRepository;
13: 
14:   @Autowired
15:   public InventoryDomainService(InventoryRepository inventoryRepository) {
16:     this.inventoryRepository = inventoryRepository;
17:   }
18: 
19:   public void addItemToInventory(InventoryPart inventory, InventoryPart inventoryPart) {
20:     inventory.increaseQuantity(inventoryPart);
21:     inventoryRepository.save(inventory);
22:   }
23: 
24:   public void removeItemFromInventory(InventoryPart inventory, InventoryPart inventoryPart) {
25:     inventory.decreaseQuantity(inventoryPart);
26:     inventoryRepository.save(inventory);
27:   }
28: 
29:   public InventoryPart getInventory(UUID inventoryId) {
30:     return inventoryRepository.findById(inventoryId)
31:         .orElseThrow(() -> new NotFoundException("Inventory with id " + inventoryId + " not found!"));
32:   }
33: }
34: 
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryPart.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
7: 
8: import javax.persistence.*;
9: import java.util.UUID;
10: 
11: @Entity
12: @NoArgsConstructor
13: @Getter
14: public class InventoryPart {
15: 
16:   @Id
17:   @GeneratedValue
18:   @Column(name = "inventory_id")
19:   private UUID id;
20: 
21:   @ManyToOne
22:   private Item item;
23: 
24:   private int quantity;
25: 
26:   public InventoryPart(Item item, int quantity) {
27:     setItem(item);
28:     setQuantity(quantity);
29:   }
30: 
31:   private void setItem(Item item) {
32:     this.item = item;
33:   }
34: 
35:   public void setQuantity(int quantity) {
36:     if (quantity < 0) {
37:       throw new ShopException("Quantity must be greater than 0");
38:     }
39:     this.quantity = quantity;
40:   }
41: 
42:   public void increaseQuantity(InventoryPart inventoryPart) {
43:     setQuantity(this.quantity + inventoryPart.getQuantity());
44:   }
45: 
46:   public void decreaseQuantity(InventoryPart inventoryPart) {
47:     setQuantity(this.quantity - inventoryPart.getQuantity());
48:   }
49: }
50: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.Optional;
6: import java.util.UUID;
7: 
8: public interface InventoryRepository extends CrudRepository<InventoryPart, UUID> {
9:   Optional<InventoryPart> findByItemId(UUID itemId);
10:   Boolean existsByItemId(UUID itemId);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
8: import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
9: import thkoeln.archilab.ecommerce.ShopException;
10: 
11: import java.util.UUID;
12: 
13: @Service
14: public class ItemCatalogService {
15: 
16:   private final ItemRepository itemRepository;
17:   private final ItemStorageReadable inventoryManagementService;
18:   private final ItemStorageReadable orderService;
19: 
20:   @Autowired
21:   public ItemCatalogService(ItemRepository itemRepository, @Lazy ItemStorageReadable inventoryManagementService, @Lazy ItemStorageReadable orderService) {
22:     this.itemRepository = itemRepository;
23:     this.inventoryManagementService = inventoryManagementService;
24:     this.orderService = orderService;
25:   }
26: 
27:   public void addItemToCatalog(UUID itemId, String name, String description, Float size, Money purchasePrice, Money sellPrice) {
28:     if (itemId != null && itemRepository.existsById(itemId))
29:       throw new ShopException("Item id already exists");
30: 
31:     var newItem = new Item(itemId, name, description, size, purchasePrice, sellPrice);
32:     itemRepository.save(newItem);
33:   }
34: 
35:   public void removeItemFromCatalog(UUID itemId) {
36:     if (!itemRepository.existsById(itemId))
37:       throw new ShopException("Item id does not exist");
38: 
39:     if (inventoryManagementService.hasItemStored(itemId))
40:       throw new ShopException("Item is still in inventory");
41: 
42:     if (orderService.hasItemStored(itemId))
43:       throw new ShopException("Item is still reserved in a shopping cart, or part of a completed order");
44: 
45:     itemRepository.deleteById(itemId);
46:   }
47: 
48:   public Money getSellPrice(UUID itemId) {
49:     return itemRepository.findById(itemId)
50:         .map(Item::getSellPrice)
51:         .orElseThrow(() -> new ShopException("Item id does not exist"));
52:   }
53: 
54:   public void deleteItemCatalog() {
55:     itemRepository.deleteAll();
56:   }
57: 
58:   public Boolean isItemInCatalog(UUID itemId) {
59:     if (itemId == null) return false;
60:     return itemRepository.existsById(itemId);
61:   }
62: 
63:   public Item getItem(UUID itemId) {
64:     return itemRepository.findById(itemId)
65:         .orElseThrow(() -> new ShopException("Item id does not exist"));
66:   }
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemStorage.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: 
5: public interface ItemStorage extends ItemStorageReadable, ItemStorageReducable {
6: 
7:   void createShoppingCart(Email customerEmail);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemStorageReadable.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ItemStorageReadable {
6: 
7:   Boolean hasItemStored(UUID itemId);
8:   int getQuantityOfItem(UUID itemId);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemStorageReducable.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ItemStorageReducable {
6: 
7:   void reduceQuantityOfItem(UUID itemId, int newQuantity);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\Item.java ---
1: package thkoeln.archilab.ecommerce.solution.item.domain;
2: 
3: 
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @NoArgsConstructor
14: @Getter
15: public class Item {
16: 
17:   @Id
18:   @Column(name = "item_id")
19:   private UUID id;
20: 
21:   private String name;
22: 
23:   private String description;
24: 
25:   @Column(name = "`size`")
26:   private Float size;
27: 
28:   @Embedded
29:   @AttributeOverrides({
30:       @AttributeOverride(name = "amount", column = @Column(insertable = false, updatable = false)),
31:       @AttributeOverride(name = "currency", column = @Column(insertable = false, updatable = false))
32:   })
33:   private Money purchasePrice;
34: 
35:   @Embedded
36:   @AttributeOverrides({
37:       @AttributeOverride(name = "amount", column = @Column(insertable = false, updatable = false)),
38:       @AttributeOverride(name = "currency", column = @Column(insertable = false, updatable = false))
39:   })
40:   private Money sellPrice;
41: 
42:   public Item(UUID id, String name, String description, Float size, Money purchasePrice, Money sellPrice) throws ShopException {
43:     setId(id);
44:     setName(name);
45:     setDescription(description);
46:     setSize(size);
47:     setPurchasePrice(purchasePrice);
48:     setSellPrice(sellPrice);
49:   }
50: 
51:   public final void setId(UUID id) throws ShopException {
52:     if (id == null)
53:       throw new ShopException("Item id must not be null");
54:     this.id = id;
55:   }
56: 
57:   public final void setName(String name) throws ShopException {
58:     if (name == null || name.isEmpty())
59:       throw new ShopException("Name must not be null or empty");
60:     this.name = name;
61:   }
62: 
63:   public final void setDescription(String description) throws ShopException {
64:     if (description == null || description.isEmpty())
65:       throw new ShopException("Description must not be null or empty");
66:     this.description = description;
67:   }
68: 
69:   public final void setSize(Float size) throws ShopException {
70:     if (size != null && size <= 0)
71:       throw new ShopException("Size must not be negative");
72:     this.size = size;
73:   }
74: 
75:   public final void setPurchasePrice(Money purchasePrice) throws ShopException {
76:     if (purchasePrice == null)
77:       throw new ShopException("Purchase price must not be null");
78:     validateMargin(purchasePrice, this.sellPrice);
79:     this.purchasePrice = purchasePrice;
80:   }
81: 
82:   public final void setSellPrice(Money sellPrice) throws ShopException {
83:     if (sellPrice == null)
84:       throw new ShopException("Sell price must not be null");
85:     validateMargin(this.purchasePrice, sellPrice);
86:     this.sellPrice = sellPrice;
87:   }
88: 
89:   private void validateMargin(Money purchasePrice, Money sellPrice) throws ShopException {
90:     if (purchasePrice == null || sellPrice == null)
91:       return;
92:     if (purchasePrice.largerThan(sellPrice))
93:       throw new ShopException("Sell price must not be lower than purchase price");
94:   }
95: }
96: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\ItemRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.item.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.UUID;
6: 
7: public interface ItemRepository extends CrudRepository<Item, UUID> {
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.Data;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: 
7: import java.util.List;
8: import java.util.UUID;
9: 
10: @Data
11: public class OrderDto {
12: 
13:     private UUID orderId;
14:     private Email email;
15:     private Money price;
16:     private List<OrderPartDto> orderParts;
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
6: 
7: @Component
8: public class OrderDtoMapper {
9: 
10:     private final ModelMapper modelMapper = new ModelMapper();
11: 
12:     public OrderDto mapToDto(Order order) {
13:         var orderDto = modelMapper.map(order, OrderDto.class);
14:         orderDto.setEmail(order.getCustomer().getEmail());
15:         orderDto.setPrice(order.getPayment().getAmount());
16:         return orderDto;
17:     }
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderFilter.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: public enum OrderFilter {
4:     ALL,
5:     LATEST
6: }
7: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.Data;
4: 
5: import java.util.UUID;
6: 
7: @Data
8: public class OrderPartDto {
9:     private UUID itemId;
10:     private int quantity;
11:     private String comment;
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderRestController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.ResponseEntity;
5: import org.springframework.web.bind.annotation.*;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: 
8: import java.util.Collections;
9: import java.util.List;
10: import java.util.stream.Collectors;
11: 
12: @RestController
13: public class OrderRestController {
14: 
15:     private final OrderService orderService;
16: 
17:     private final OrderDtoMapper orderDtoMapper;
18: 
19:     @Autowired
20:     public OrderRestController(OrderService orderService, OrderDtoMapper orderDtoMapper) {
21:         this.orderService = orderService;
22:         this.orderDtoMapper = orderDtoMapper;
23:     }
24: 
25:     @GetMapping("/orders")
26:     public ResponseEntity<List<OrderDto>> getOrdersByEmailAndFilter(@RequestParam(required = false) String email, @RequestParam(defaultValue = "ALL") OrderFilter filter) {
27:         try {
28:             var orders = orderService.getOrderHistory(Email.of(email), filter).stream().map(orderDtoMapper::mapToDto).collect(Collectors.toList());
29:             return ResponseEntity.ok(orders);
30:         } catch (Exception e) {
31:             return ResponseEntity.ok(Collections.emptyList());
32:         }
33:     }
34: }
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.internal.Pair;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.context.annotation.Lazy;
6: import org.springframework.stereotype.Service;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
9: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
10: import thkoeln.archilab.ecommerce.solution.item.application.ItemCatalogService;
11: import thkoeln.archilab.ecommerce.solution.item.application.ItemStorageReadable;
12: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
13: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
14: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPart;
15: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
16: import thkoeln.archilab.ecommerce.ShopException;
17: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
18: 
19: import java.util.*;
20: import java.util.stream.Collectors;
21: import java.util.stream.StreamSupport;
22: 
23: @Service
24: public class OrderService implements ItemStorageReadable {
25: 
26:   private final OrderRepository orderRepository;
27:   private final CustomerService customerService;
28:   private final ItemCatalogService itemCatalogService;
29:   private final PaymentRepository paymentRepository;
30:   private final DeliveryRepository deliveryRepository;
31: 
32:   @Autowired
33:   public OrderService(OrderRepository orderRepository, @Lazy CustomerService customerService, @Lazy ItemCatalogService itemCatalogService,
34:                       PaymentRepository paymentRepository,
35:                       DeliveryRepository deliveryRepository) {
36:     this.orderRepository = orderRepository;
37:     this.customerService = customerService;
38:     this.itemCatalogService = itemCatalogService;
39:     this.paymentRepository = paymentRepository;
40:     this.deliveryRepository = deliveryRepository;
41:   }
42: 
43:   public void createOrder(Email customerEmail, Map<UUID, Pair<Integer, String>> shoppingCartContent, UUID paymentId, UUID deliveryId) {
44:     var customer = customerService.getCustomer(customerEmail)
45:         .orElseThrow(() -> new ShopException("Customer with the given email does not exist"));
46:     var payment = paymentRepository.findById(paymentId)
47:         .orElseThrow(() -> new ShopException("Payment with the given id does not exist"));
48:     var delivery = deliveryRepository.findById(deliveryId)
49:         .orElseThrow(() -> new ShopException("Delivery with the given id does not exist"));
50:     var order = new Order();
51:     order.setCustomer(customer);
52:     order.setPayment(payment);
53:     order.setDelivery(delivery);
54:     order.setParts(
55:         shoppingCartContent
56:             .entrySet()
57:             .stream()
58:             .map(entry -> Map.entry(itemCatalogService.getItem(entry.getKey()), entry.getValue()))
59:             .map(OrderPart::new)
60:             .collect(Collectors.toList())
61:     );
62:     orderRepository.save(order);
63:   }
64: 
65:   public Map<UUID, Integer> getOrderHistory(Email customerEmail) {
66:     if (!customerService.isCustomerRegistered(customerEmail))
67:       throw new ShopException("Customer with the given email does not exist");
68: 
69:     return orderRepository.findByCustomerEmail(customerEmail)
70:         .stream()
71:         .map(Order::getParts)
72:         .flatMap(Collection::stream)
73:         .map(orderPart -> Map.entry(orderPart.getItem().getId(), orderPart.getQuantity()))
74:         .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, Integer::sum));
75:   }
76: 
77:   public void deleteAllOrders() {
78:     orderRepository.deleteAll();
79:   }
80: 
81:   public Boolean isItemPartOfAnyOrder(UUID itemId) {
82:     return StreamSupport.stream(orderRepository.findAll().spliterator(), false)
83:         .map(Order::getParts)
84:         .flatMap(Collection::stream)
85:         .map(OrderPart::getItem)
86:         .map(Item::getId)
87:         .anyMatch(itemId::equals);
88:   }
89: 
90:   @Override
91:   public Boolean hasItemStored(UUID itemId) {
92:     return isItemPartOfAnyOrder(itemId);
93:   }
94: 
95:   @Override
96:   public int getQuantityOfItem(UUID itemId) {
97:     return StreamSupport.stream(orderRepository.findAll().spliterator(), false)
98:         .map(Order::getParts)
99:         .flatMap(Collection::stream)
100:         .filter(orderPart -> orderPart.getItem().getId().equals(itemId))
101:         .map(OrderPart::getQuantity)
102:         .reduce(0, Integer::sum);
103:   }
104: 
105:   public List<Order> getOrderHistory(Email customerEmail, OrderFilter orderFilter) {
106:     if (!customerService.isCustomerRegistered(customerEmail))
107:       throw new ShopException("Customer with the given email does not exist");
108: 
109:     if (orderFilter == OrderFilter.ALL) {
110:       return orderRepository.findByCustomerEmailOrderByOrderDateAsc(customerEmail).stream().collect(Collectors.toList());
111:     } else if (orderFilter == OrderFilter.LATEST) {
112:       return orderRepository.findTop1ByCustomerEmailOrderByOrderDateDesc(customerEmail).stream().collect(Collectors.toList());
113:     }
114:     throw new ShopException("OrderFilter not implemented");
115:   }
116: }
117: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\StringToOrderFilterConverter.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.core.convert.converter.Converter;
4: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.ConflictException;
5: 
6: public class StringToOrderFilterConverter implements Converter<String, OrderFilter> {
7:     @Override
8:     public OrderFilter convert(String source) {
9:         try {
10:             return OrderFilter.valueOf(source.toUpperCase());
11:         } catch (IllegalArgumentException e) {
12:             throw new ConflictException("Order filter '" + source + "' does not exist.");
13:         }
14:     }
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\WebConfig.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.context.annotation.Configuration;
4: import org.springframework.format.FormatterRegistry;
5: import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
6: 
7: @Configuration
8: public class WebConfig implements WebMvcConfigurer {
9:     @Override
10:     public void addFormatters(FormatterRegistry registry) {
11:         registry.addConverter(new StringToOrderFilterConverter());
12:     }
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
7: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
8: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
9: 
10: import javax.persistence.*;
11: import java.util.ArrayList;
12: import java.util.Date;
13: import java.util.List;
14: import java.util.UUID;
15: 
16: @Entity
17: @NoArgsConstructor
18: @Getter
19: @Setter
20: @Table(name = "`ORDER`")
21: public class Order {
22: 
23:   @Id
24:   @GeneratedValue
25:   @Column(name = "order_id")
26:   private UUID id;
27: 
28:   @ManyToOne
29:   private Customer customer;
30: 
31:   @OneToOne
32:   private Payment payment;
33: 
34:   @OneToOne
35:   private Delivery delivery;
36: 
37:   @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)
38:   private List<OrderPart> parts = new ArrayList<>();
39: 
40:   private Date orderDate = new Date();
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPart.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.*;
4: import org.modelmapper.internal.Pair;
5: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
6: 
7: import javax.persistence.*;
8: import java.util.Map;
9: import java.util.UUID;
10: 
11: @Entity
12: @NoArgsConstructor
13: @AllArgsConstructor
14: @Getter
15: @Setter
16: public class OrderPart {
17: 
18:   @Id
19:   @GeneratedValue
20:   private UUID id;
21: 
22:   @ManyToOne
23:   private Item item;
24: 
25:   private int quantity;
26: 
27:   private String comment;
28: 
29:   public OrderPart(Map.Entry<Item, Pair<Integer, String>> entry) {
30:     this.item = entry.getKey();
31:     this.quantity = entry.getValue().getLeft();
32:     this.comment = entry.getValue().getRight();
33:   }
34: }
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.Collection;
7: import java.util.Optional;
8: import java.util.UUID;
9: 
10: public interface OrderRepository extends CrudRepository<Order, UUID> {
11:   Collection<Order> findByCustomerEmail(Email customerEmail);
12:   Collection<Order> findByCustomerEmailOrderByOrderDateAsc(Email customerEmail);
13:   Optional<Order> findTop1ByCustomerEmailOrderByOrderDateDesc(Email customerEmail);
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
9: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
11: import thkoeln.archilab.ecommerce.ShopException;
12: 
13: import java.util.UUID;
14: 
15: @Service
16: public class PaymentService {
17: 
18:   private final PaymentRepository paymentRepository;
19:   private final CustomerService customerService;
20: 
21:   @Autowired
22:   public PaymentService(PaymentRepository paymentRepository, @Lazy CustomerService customerService) {
23:     this.paymentRepository = paymentRepository;
24:     this.customerService = customerService;
25:   }
26: 
27:   public UUID authorizePayment(Email customerEmail, Money amount) {
28:     if (customerEmail == null)
29:       throw new ShopException("Customer email is null");
30:     var customer = customerService.getCustomer(customerEmail)
31:         .orElseThrow(() -> new ShopException("Customer with the given email does not exist"));
32: 
33:     var payment = new Payment(customer, amount);
34:     paymentRepository.save(payment);
35:     return payment.getId();
36:   }
37: 
38:   public Money getPaymentTotal(Email customerEmail) {
39:     if (!customerService.isCustomerRegistered(customerEmail))
40:       throw new ShopException("Customer with the given email does not exist");
41: 
42:     return paymentRepository.findByCustomerEmail(customerEmail)
43:         .stream()
44:         .map(Payment::getAmount)
45:         .reduce(Money::add)
46:         .orElse(Money.of(0.00f, "EUR"));
47:   }
48: 
49:   public void deletePaymentHistory() {
50:     paymentRepository.deleteAll();
51:   }
52: }
53: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.ConflictException;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
8: import thkoeln.archilab.ecommerce.ShopException;
9: 
10: 
11: import javax.persistence.*;
12: import java.util.UUID;
13: 
14: @Entity
15: @NoArgsConstructor
16: @Getter
17: public class Payment {
18: 
19:   @Id
20:   @GeneratedValue
21:   @Column(name = "payment_id")
22:   private UUID id;
23: 
24:   @ManyToOne
25:   private Customer customer;
26: 
27:   private Money amount;
28: 
29:   public Payment(Customer customer, Money amount) {
30:     setCustomer(customer);
31:     setAmount(amount);
32:   }
33: 
34:   public final void setCustomer(Customer customer) {
35:     this.customer = customer;
36:   }
37: 
38:   public final void setAmount(Money amount) {
39:     if (amount == null)
40:       throw new ShopException("Amount must not be null");
41: 
42:     if (amount.equals(Money.of(0.00f, "EUR")))
43:       throw new ShopException("Amount must not be negative or zero");
44: 
45:     if (amount.largerThan(Money.of(500.00f, "EUR")))
46:       throw new ConflictException("Amount must not be greater than 500");
47: 
48:     this.amount = amount;
49:   }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.Collection;
7: import java.util.UUID;
8: 
9: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
10: 
11:   Collection<Payment> findByCustomerEmail(Email customerEmail);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import lombok.Data;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.UUID;
7: 
8: @Data
9: public class ShoppingCartDto {
10:     private UUID id;
11:     private Email customerEmail;
12:     private int totalQuantity;
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
7: 
8: @Component
9: public class ShoppingCartMapper {
10: 
11:     private final ModelMapper modelMapper = new ModelMapper();
12: 
13:     public ShoppingCartDto mapToDto(ShoppingCart shoppingCart) {
14:         var shoppingCartDto =  modelMapper.map(shoppingCart, ShoppingCartDto.class);
15:         shoppingCartDto.setTotalQuantity(
16:                 shoppingCart
17:                         .getParts()
18:                         .stream()
19:                         .map(ShoppingCartPart::getQuantity)
20:                         .reduce(Integer::sum)
21:                         .orElse(0)
22:         );
23:         return shoppingCartDto;
24:     }
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartPartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import lombok.Data;
4: 
5: import java.util.UUID;
6: 
7: @Data
8: public class ShoppingCartPartDto {
9:     private UUID itemId;
10:     private int quantity;
11:     private String comment;
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartPartMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
6: 
7: @Component
8: public class ShoppingCartPartMapper {
9: 
10:     private final ModelMapper modelMapper = new ModelMapper();
11: 
12:     public ShoppingCartPartDto mapToDto(ShoppingCartPart shoppingCartPart) {
13:         return modelMapper.map(shoppingCartPart, ShoppingCartPartDto.class);
14:     }
15: 
16:     public ShoppingCartPart mapToEntity(ShoppingCartPartDto shoppingCartPartDto) {
17:         return modelMapper.map(shoppingCartPartDto, ShoppingCartPart.class);
18:     }
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartRestController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.ResponseEntity;
5: import org.springframework.web.bind.annotation.*;
6: import org.springframework.web.servlet.support.ServletUriComponentsBuilder;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: 
9: import java.util.UUID;
10: 
11: @RestController
12: public class ShoppingCartRestController {
13: 
14:     private final ShoppingCartService shoppingCartService;
15: 
16:     private final ShoppingCartMapper shoppingCartMapper;
17: 
18:     private final ShoppingCartPartMapper shoppingCartPartMapper;
19: 
20:     @Autowired
21:     public ShoppingCartRestController(ShoppingCartService shoppingCartService, ShoppingCartMapper shoppingCartMapper, ShoppingCartPartMapper shoppingCartPartMapper) {
22:         this.shoppingCartService = shoppingCartService;
23:         this.shoppingCartMapper = shoppingCartMapper;
24:         this.shoppingCartPartMapper = shoppingCartPartMapper;
25:     }
26: 
27:     @GetMapping("/shoppingCarts")
28:     public ResponseEntity<ShoppingCartDto> getShoppingCartByEmail(@RequestParam String email) {
29:         var shoppingCart = shoppingCartService.getShoppingCart(Email.of(email));
30:         var shoppingCartDto = shoppingCartMapper.mapToDto(shoppingCart);
31:         return ResponseEntity.ok(shoppingCartDto);
32:     }
33: 
34:     @PostMapping("/shoppingCarts/{shoppingCart-id}/shoppingCartParts")
35:     public ResponseEntity<Void> addShoppingCartPart(@PathVariable("shoppingCart-id") UUID shoppingCartId, @RequestBody ShoppingCartPartDto shoppingCartPartDto) {
36:         if (shoppingCartPartDto.getQuantity() > 0) {
37:             var shoppingCartPart = shoppingCartPartMapper.mapToEntity(shoppingCartPartDto);
38:             shoppingCartService.addItemToShoppingCart(shoppingCartId, shoppingCartPart.getItem().getId(), shoppingCartPart.getQuantity(), shoppingCartPart.getComment());
39:         } else {
40:             shoppingCartPartDto.setQuantity(-shoppingCartPartDto.getQuantity());
41:             var shoppingCartPart = shoppingCartPartMapper.mapToEntity(shoppingCartPartDto);
42:             shoppingCartService.removeItemFromShoppingCart(shoppingCartId, shoppingCartPart.getItem().getId(), shoppingCartPart.getQuantity(), shoppingCartPart.getComment());
43:         }
44:         return ResponseEntity.created(
45:                 ServletUriComponentsBuilder.fromCurrentRequest()
46:                         .path("/{id}")
47:                         .buildAndExpand(shoppingCartPartDto.getItemId())
48:                         .toUri()
49:         ).build();
50:     }
51: 
52:     @DeleteMapping("/shoppingCarts/{shoppingCart-id}/shoppingCartParts/{item-id}")
53:     public void deleteShoppingCartPart(@PathVariable("shoppingCart-id") UUID shoppingCartId, @PathVariable("item-id") UUID itemId) {
54:         shoppingCartService.removeItemFromShoppingCart(shoppingCartId, itemId);
55:     }
56: 
57:     @GetMapping("/shoppingCarts/{shoppingCart-id}/shoppingCartParts/{item-id}")
58:     public ShoppingCartPartDto getShoppingCartPart(@PathVariable("shoppingCart-id") UUID shoppingCartId, @PathVariable("item-id") UUID itemId) {
59:         return shoppingCartPartMapper.mapToDto(shoppingCartService.getShoppingCartPart(shoppingCartId, itemId));
60:     }
61: 
62:     @PutMapping("/shoppingCarts/{shoppingCart-id}/checkout")
63:     public void checkoutShoppingCart(@PathVariable("shoppingCart-id") UUID shoppingCartId) {
64:         shoppingCartService.checkout(shoppingCartId);
65:     }
66: }
67: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import org.springframework.transaction.annotation.Transactional;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.ConflictException;
9: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.NotFoundException;
10: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
11: import thkoeln.archilab.ecommerce.solution.customer.application.Deletable;
12: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
13: import thkoeln.archilab.ecommerce.solution.inventory.application.InventoryManagementService;
14: import thkoeln.archilab.ecommerce.solution.item.application.ItemCatalogService;
15: import thkoeln.archilab.ecommerce.solution.item.application.ItemStorage;
16: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
17: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
18: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
19: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
20: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartDomainService;
21: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
22: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
23: import thkoeln.archilab.ecommerce.ShopException;
24: 
25: import java.util.Collection;
26: import java.util.UUID;
27: import java.util.stream.StreamSupport;
28: 
29: @Service
30: public class ShoppingCartService implements ItemStorage, Deletable {
31: 
32:   private final ShoppingCartRepository shoppingCartRepository;
33: 
34:   private final ShoppingCartDomainService shoppingCartDomainService;
35:   private final CustomerService customerService;
36:   private final ItemCatalogService itemCatalogService;
37:   private final InventoryManagementService inventoryManagementService;
38:   private final OrderService orderService;
39:   private final PaymentService paymentService;
40:   private final DeliveryService deliveryService;
41:   private final PaymentRepository paymentRepository;
42: 
43:   @Autowired
44:   public ShoppingCartService(ShoppingCartRepository shoppingCartRepository, ShoppingCartDomainService shoppingCartDomainService, @Lazy CustomerService customerService, @Lazy ItemCatalogService itemCatalogService, @Lazy InventoryManagementService inventoryManagementService, @Lazy OrderService orderService, @Lazy PaymentService paymentService, @Lazy DeliveryService deliveryService,
45:                              PaymentRepository paymentRepository) {
46:     this.shoppingCartRepository = shoppingCartRepository;
47:     this.shoppingCartDomainService = shoppingCartDomainService;
48:     this.customerService = customerService;
49:     this.itemCatalogService = itemCatalogService;
50:     this.inventoryManagementService = inventoryManagementService;
51:     this.orderService = orderService;
52:     this.paymentService = paymentService;
53:     this.deliveryService = deliveryService;
54:     this.paymentRepository = paymentRepository;
55:   }
56: 
57:   @Override
58:   public void createShoppingCart(Email customerEmail) {
59:     var customer = customerService.getCustomer(customerEmail)
60:         .orElseThrow(() -> new ShopException("Customer does not exist"));
61: 
62:     var shoppingCart = new ShoppingCart();
63:     shoppingCart.setCustomer(customer);
64:     shoppingCartRepository.save(shoppingCart);
65:   }
66: 
67:   @Transactional
68:   public void addItemToShoppingCart(UUID shoppingCartId, UUID itemId, int quantity, String comment) {
69:     var item = itemCatalogService.getItem(itemId);
70:     var shoppingCart = shoppingCartDomainService.getShoppingCart(shoppingCartId);
71:     var shoppingCartPart = new ShoppingCartPart(item, quantity, comment);
72: 
73:     if (inventoryManagementService.getInventory(itemId).getQuantity() < quantity)
74:       throw new ConflictException("Not enough items in inventory");
75: 
76:     inventoryManagementService.removeFromInventory(itemId, quantity);
77:     shoppingCartDomainService.addItemToShoppingCart(shoppingCart, shoppingCartPart);
78:   }
79: 
80:   @Transactional
81:   public void removeItemFromShoppingCart(UUID shoppingCartId, UUID itemId, int quantity, String comment) {
82:     var item = itemCatalogService.getItem(itemId);
83:     var shoppingCart = shoppingCartDomainService.getShoppingCart(shoppingCartId);
84:     var shoppingCartPart = new ShoppingCartPart(item, quantity, comment);
85: 
86:     shoppingCartDomainService.removeItemFromShoppingCart(shoppingCart, shoppingCartPart);
87:     inventoryManagementService.addToInventory(itemId, quantity);
88:   }
89: 
90:   public int getReservedInventoryInShoppingCarts(UUID itemId) {
91:     var item = itemCatalogService.getItem(itemId);
92:     return StreamSupport.stream(shoppingCartRepository.findAll().spliterator(), false)
93:         .map(ShoppingCart::getParts)
94:         .flatMap(Collection::stream)
95:         .filter(shoppingCartQuantity -> shoppingCartQuantity.getItem().getId().equals(itemId))
96:         .map(ShoppingCartPart::getQuantity)
97:         .reduce(0, Integer::sum);
98:   }
99: 
100:   public boolean isPaymentAuthorized(UUID shoppingCartId) {
101:     return shoppingCartRepository.findById(shoppingCartId)
102:         .map(shoppingCart -> shoppingCart.getPayment() != null)
103:         .orElse(false);
104:   }
105: 
106:   public void checkout(UUID shoppingCartId) {
107:     var shoppingCart = shoppingCartDomainService.getShoppingCart(shoppingCartId);
108: 
109:     if (shoppingCart.isEmpty())
110:       throw new ConflictException("Card is empty");
111: 
112:     if (!isPaymentAuthorized(shoppingCartId)) {
113:       var paymentId = paymentService.authorizePayment(shoppingCart.getCustomer().getEmail(), shoppingCart.getShoppingCartAsMoneyValue());
114:       var payment = paymentRepository.findById(paymentId)
115:           .orElseThrow(() -> new ShopException("Payment does not exist"));
116:       shoppingCart.setPayment(payment);
117:     }
118: 
119:     var deliveryId = deliveryService.triggerDelivery(shoppingCart.getCustomer(), shoppingCart.getShoppingCartAsMap());
120: 
121:     orderService.createOrder(shoppingCart.getCustomer().getEmail(), shoppingCart.getCommentsAsMap(), shoppingCart.getPayment().getId(), deliveryId);
122:     shoppingCart.setPayment(null);
123:     shoppingCart.getParts().clear();
124:     shoppingCartRepository.save(shoppingCart);
125:   }
126: 
127:   @Override
128:   public Boolean hasItemStored(UUID itemId) {
129:     return getReservedInventoryInShoppingCarts(itemId) > 0;
130:   }
131: 
132:   public void reduceReservedInventoryInShoppingCarts(UUID itemId, int newTotalQuantity) {
133:     shoppingCartRepository.findAll()
134:         .forEach(shoppingCart ->
135:             shoppingCart.getParts()
136:                 .stream()
137:                 .filter(shoppingCartPart -> shoppingCartPart.getItem().getId().equals(itemId))
138:                 .findFirst()
139:                 .ifPresent(shoppingCartPart -> {
140:                   shoppingCartPart.decreaseQuantity(Math.min(shoppingCartPart.getQuantity(), (getReservedInventoryInShoppingCarts(itemId) - newTotalQuantity)));
141:                   shoppingCartRepository.save(shoppingCart);
142:             })
143:         );
144:   }
145: 
146:   @Override
147:   public int getQuantityOfItem(UUID itemId) {
148:     return getReservedInventoryInShoppingCarts(itemId);
149:   }
150: 
151:   @Override
152:   public void reduceQuantityOfItem(UUID itemId, int newQuantity) {
153:     reduceReservedInventoryInShoppingCarts(itemId, newQuantity);
154:   }
155: 
156:   public ShoppingCart getShoppingCart(Email customerEmail) {
157:     return shoppingCartRepository.findByCustomerEmail(customerEmail)
158:         .orElseThrow(() -> new NotFoundException("Shopping cart not found"));
159:   }
160: 
161:   public void removeItemFromShoppingCart(UUID shoppingCartId, UUID itemId) {
162:     var shoppingCart = shoppingCartDomainService.getShoppingCart(shoppingCartId);
163:     var quantity = getShoppingCartPart(shoppingCartId, itemId).getQuantity();
164:     removeItemFromShoppingCart(shoppingCartId, itemId, quantity, null);
165:     shoppingCartRepository.save(shoppingCart);
166:   }
167: 
168:   public ShoppingCartPart getShoppingCartPart(UUID shoppingCartId, UUID itemId) {
169:     var shoppingCart = shoppingCartDomainService.getShoppingCart(shoppingCartId);
170:     return shoppingCart.getParts().stream().filter(shoppingCartQuantity -> shoppingCartQuantity.getItem().getId().equals(itemId)).findFirst()
171:         .orElseThrow(() -> new NotFoundException("Item does not exist in ShoppingCart"));
172:   }
173: 
174:   @Override
175:   public void deleteAll() {
176:     shoppingCartRepository.deleteAll();
177:   }
178: }
179: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: 
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import org.modelmapper.internal.Pair;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.domainprimitives.Money;
10: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.ConflictException;
11: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
12: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
13: 
14: import javax.persistence.*;
15: import java.util.ArrayList;
16: import java.util.List;
17: import java.util.Map;
18: import java.util.UUID;
19: import java.util.stream.Collectors;
20: 
21: @Entity
22: @NoArgsConstructor
23: @Getter
24: @Setter
25: public class ShoppingCart {
26: 
27:   @Id
28:   @GeneratedValue
29:   @Column(name = "shoppingcart_id")
30:   private UUID id;
31: 
32:   @OneToOne
33:   private Customer customer;
34: 
35:   @OneToOne
36:   private Payment payment;
37: 
38:   @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)
39:   private List<ShoppingCartPart> parts = new ArrayList<>();
40: 
41:   public void addItem(ShoppingCartPart shoppingCartPart) {
42:     parts.stream()
43:         .filter(part -> part.getItem().getId().equals(shoppingCartPart.getItem().getId()))
44:         .findFirst()
45:         .ifPresentOrElse(
46:             part -> {
47:               part.increaseQuantity(shoppingCartPart.getQuantity());
48:               part.setComment(shoppingCartPart.getComment());
49:             },
50:             () -> parts.add(shoppingCartPart));
51:     setPayment(null);
52:   }
53: 
54:   public void removeItem(ShoppingCartPart shoppingCartPart) {
55:     parts.stream()
56:         .filter(part -> part.getItem().getId().equals(shoppingCartPart.getItem().getId()))
57:         .findFirst()
58:         .ifPresentOrElse(
59:             part -> {
60:               if (part.getQuantity() > shoppingCartPart.getQuantity()) {
61:                 part.decreaseQuantity(shoppingCartPart.getQuantity());
62:                 part.setComment(shoppingCartPart.getComment());
63:               } else if (part.getQuantity() == shoppingCartPart.getQuantity()) {
64:                 parts.remove(part);
65:               } else {
66:                 throw new ConflictException("Quantity of item in shopping cart is less than requested");
67:               }
68:             },
69:             () -> {
70:               throw new ShopException("Item not found in shopping cart");
71:             }
72:         );
73:     setPayment(null);
74:   }
75: 
76:   public Map<UUID, Integer> getShoppingCartAsMap() {
77:     return parts
78:         .stream()
79:         .collect(Collectors.toMap(part -> part.getItem().getId(), ShoppingCartPart::getQuantity));
80:   }
81: 
82:   public Map<UUID, Pair<Integer, String>> getCommentsAsMap() {
83:     return parts
84:         .stream()
85:         .collect(Collectors.toMap(part -> part.getItem().getId(), part -> Pair.of(part.getQuantity(), part.getComment())));
86:   }
87: 
88:   public Money getShoppingCartAsMoneyValue() {
89:     return parts
90:         .stream()
91:         .map(part -> part.getItem().getSellPrice().multiplyBy(part.getQuantity()))
92:         .reduce(Money::add)
93:         .orElseThrow();
94:   }
95: 
96:   public boolean isEmpty() {
97:     return parts.isEmpty();
98:   }
99: }
100: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartDomainService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.domainprimitives.exceptions.NotFoundException;
6: 
7: import java.util.UUID;
8: 
9: @Component
10: public class ShoppingCartDomainService {
11: 
12:   private final ShoppingCartRepository shoppingCartRepository;
13: 
14:   @Autowired
15:   public ShoppingCartDomainService(ShoppingCartRepository shoppingCartRepository) {
16:     this.shoppingCartRepository = shoppingCartRepository;
17:   }
18: 
19:   public void addItemToShoppingCart(ShoppingCart shoppingCart, ShoppingCartPart shoppingCartPart) {
20:     shoppingCart.addItem(shoppingCartPart);
21:     shoppingCartRepository.save(shoppingCart);
22:   }
23: 
24:   public void removeItemFromShoppingCart(ShoppingCart shoppingCart, ShoppingCartPart shoppingCartPart) {
25:     shoppingCart.removeItem(shoppingCartPart);
26:     shoppingCartRepository.save(shoppingCart);
27:   }
28: 
29:   public ShoppingCart getShoppingCart(UUID shoppingCartId) {
30:     return shoppingCartRepository.findById(shoppingCartId)
31:         .orElseThrow(() -> new NotFoundException("ShoppingCart with id " + shoppingCartId + " not found!"));
32:   }
33: }
34: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import lombok.*;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
6: 
7: import javax.persistence.*;
8: import java.util.UUID;
9: 
10: @Entity
11: @NoArgsConstructor
12: @Getter
13: @Setter
14: public class ShoppingCartPart {
15: 
16:   @Id
17:   @GeneratedValue
18:   private UUID id;
19: 
20:   @ManyToOne
21:   private Item item;
22: 
23:   private int quantity;
24: 
25:   private String comment;
26: 
27:   public ShoppingCartPart(Item item, int quantity, String comment) {
28:     setItem(item);
29:     setQuantity(quantity);
30:     setComment(comment);
31:   }
32: 
33:   public void setItem(Item item) {
34:     this.item = item;
35:   }
36: 
37:   public void setQuantity(int quantity) {
38:     if (quantity < 0) {
39:       throw new ShopException("Quantity must be greater than 0");
40:     }
41:     this.quantity = quantity;
42:   }
43: 
44:   public void setComment(String comment) {
45:     this.comment = comment;
46:   }
47: 
48:   public void increaseQuantity(int quantity) {
49:     setQuantity(this.quantity + quantity);
50:   }
51: 
52:   public void decreaseQuantity(int quantity) {
53:     setQuantity(this.quantity - quantity);
54:   }
55: }
56: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.Optional;
7: import java.util.UUID;
8: 
9: public interface ShoppingCartRepository extends CrudRepository<ShoppingCart, UUID> {
10:   Optional<ShoppingCart> findByCustomerEmail(Email customerEmail);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a customer.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface CustomerRegistrationUseCases {
12:     /**
13:      * Registers a new customer
14:      *
15:      * @param name
16:      * @param email
17:      * @param address
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - customer with the given email already exists
22:      *      - address is null
23:      */
24:     public void register( String name, EmailType email, AddressType address );
25: 
26: 
27:     /**
28:      * Changes the address of a customer
29:      *
30:      * @param customerEmail
31:      * @param address
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - customer with the given email already exists
35:      *      - address is null
36:      */
37:     public void changeAddress( EmailType customerEmail, AddressType address );
38: 
39: 
40:     /**
41:      * Returns the data of a customer
42:      * @param customerEmail
43:      * @return the customer data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the customer with the given email does not exist
47:      */
48:     public CustomerType getCustomerData( EmailType customerEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all customers, including all orders and shopping carts
54:      */
55:     public void deleteAllCustomers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop customer
8:  */
9: public interface CustomerType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public AddressType getAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of items to a customer. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a item to a customer. The item is identified by its id, and the customer by
16:      * his/her name, street, city and postal code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of item ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of items in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which items have been delivered to a customer, and how many of each item
31:      *
32:      * @param customerEmail
33:      * @return the delivery history of the customer (map is empty if the customer has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the customer with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType customerEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\AddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface AddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the postal code
18:      */
19:     public PostalCodeType getPostalCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an postal code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param postalCode the postal code
30:      * @return the address object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - postalCode is null
35:      */
36:      // public static AddressType of( String street, String city, PostalCodeType postalCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PostalCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PostalCodeType {
6:     /**
7:      * @return the postal code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an postal code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param postalCodeAsString - the postal code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new postal code object matching the given string
22:      * @throws ShopException if ...
23:      *      - postalCodeAsString is null
24:      *      - postalCodeAsString is not a valid postal code (see above)
25:      */
26:      // public static PostalCodeType of( String postalCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
10:  * i.e. adding and removing items in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface InventoryManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given item to the inventory
16:      * @param itemId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - itemId is null
20:      *      - the item with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToInventory( UUID itemId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given item from the inventory.
28:      * If the new total quantity is lower than the currently reserved items, some of currently reserved items
29:      * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
30:      * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
31:      * or some of the items were stolen from the warehouse, are broken, etc.)
32:      * @param itemId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - itemId is null
36:      *      - the item with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current inventory and the currently reserved items together
39:      */
40:     public void removeFromInventory( UUID itemId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given item in the inventory.
45:      * If the new total quantity is lower than the currently reserved items, some of currently reserved items
46:      * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
47:      * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
48:      * or some of the items were stolen from the warehouse, are broken, etc.)
49:      * @param itemId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - itemId is null
53:      *      - the item with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeInventoryTo( UUID itemId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total inventory of a given item, including the currently reserved items
61:      * @param itemId
62:      * @return the current total inventory of the item
63:      * @throws ShopException if ...
64:      *      - itemId is null
65:      *      - the item with that id does not exist
66:      */
67:     public int getAvailableInventory( UUID itemId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\ItemCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the item catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface ItemCatalogUseCases {
15:     /**
16:      * Adds a new item to the shop catalog
17:      * @param itemId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param sellPrice
23:      * @throws ShopException if ...
24:      *      - itemId is null,
25:      *      - the item with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the sell price is null,
30:      *      - the sell price is lower than the purchase price
31:      */
32:     public void addItemToCatalog( UUID itemId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType sellPrice );
34: 
35: 
36:     /**
37:      * Removes a item from the shop catalog
38:      * @param itemId
39:      * @throws ShopException if
40:      *      - itemId is null,
41:      *      - the item with that id does not exist
42:      *      - the item is still in inventory
43:      *      - the item is still reserved in a shopping cart, or part of a completed order
44:      */
45:     public void removeItemFromCatalog( UUID itemId );
46: 
47: 
48:     /**
49:      * Get the sell price of a given item
50:      * @param itemId
51:      * @return the sell price
52:      * @throws ShopException if ...
53:      *      - itemId is null,
54:      *      - the item with that id does not exist
55:      */
56:     public MoneyType getSellPrice( UUID itemId );
57: 
58: 
59:     /**
60:      * Clears the item catalog, i.e. removes all items from the catalog, including all the inventory,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteItemCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a debit card for a given amount
16:      *
17:      * @param customerEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - customerEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType customerEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a customer
31:      * (identified by his/her email)
32:      *
33:      * @param customerEmail
34:      * @return the total amount of payments made using this debit card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - customerEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType customerEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all customers.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingCartUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping cart.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingCartUseCases {
15:     /**
16:      * Adds a item to the shopping cart of a customer
17:      *
18:      * @param customerEmail
19:      * @param itemId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the customer with the given email does not exist,
23:      *      - the item does not exist,
24:      *      - the quantity <= 0,
25:      *      - the item is not available in the requested quantity
26:      */
27:     public void addItemToShoppingCart( EmailType customerEmail, UUID itemId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a item from the shopping cart of a customer
32:      *
33:      * @param customerEmail
34:      * @param itemId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - customerEmail is null,
38:      *      - the customer with the given email does not exist,
39:      *      - the item does not exist
40:      *      - the quantity <= 0,
41:      *      - the item is not in the shopping cart in the requested quantity
42:      */
43:     public void removeItemFromShoppingCart( EmailType customerEmail, UUID itemId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping cart part containing a item
48:      *
49:      * @param customerEmail
50:      * @param itemId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - customerEmail is null,
54:      *      - the customer with the given email does not exist,
55:      *      - the item does not exist
56:      *      - the item is not in the shopping cart
57:      */
58:     public void setCommentForShoppingCartPart( EmailType customerEmail, UUID itemId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping cart part containing a item
63:      *
64:      * @param customerEmail
65:      * @param itemId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - customerEmail is null,
69:      *      - the customer with the given email does not exist,
70:      *      - the item does not exist
71:      *      - the item is not in the shopping cart
72:      */
73:     public String getCommentForShoppingCartPart( EmailType customerEmail, UUID itemId );
74: 
75: 
76:     /**
77:      * Returns a map showing which items are in the shopping cart of a customer and how many of each item
78:      *
79:      * @param customerEmail
80:      * @return the shopping cart of the customer (map is empty if the shopping cart is empty)
81:      * @throws ShopException if ...
82:      *      - customerEmail is null,
83:      *      - the customer with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingCartAsMap( EmailType customerEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all items in the shopping cart of a customer
90:      *
91:      * @param customerEmail
92:      * @return the value of shopping cart of the customer
93:      * @throws ShopException if ...
94:      *      - customerEmail is null,
95:      *      - the customer with the given email does not exist
96:      */
97:     public MoneyType getShoppingCartAsMoneyValue( EmailType customerEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific item that are currently reserved in the shopping carts of all customers
103:      * @param itemId
104:      * @return the number of reserved items of that type in all shopping carts
105:      * @throws ShopException
106:      *      - itemId is null
107:      *      - if the item id does not exist
108:      */
109:     public int getReservedInventoryInShoppingCarts( UUID itemId );
110: 
111: 
112:     /**
113:      * Checks if the shopping cart of a customer is empty
114:      *
115:      * @param customerEmail
116:      * @return true if the shopping cart is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - customerEmail is null
119:      *    - the customer with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType customerEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping cart of a customer has been authorized to be paid,
126:      * i.e. the shopping cart is not empty, the customer has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the customer's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param customerEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - customerEmail is null
134:      *      - the customer with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType customerEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping cart of a customer
141:      *
142:      * @param customerEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - customerEmail is null
146:      *      - the customer with the given email does not exist
147:      *      - the shopping cart is empty
148:      */
149:     public void checkout( EmailType customerEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which items have been ordered by a customer, and how many of each item
156:      *
157:      * @param customerEmail
158:      * @return the order history of the customer (map is empty if the customer has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the customer with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType customerEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping carts in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping carts), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Item" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"customer", "shoppingcart", "item", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "Customer",
21:             "CustomerRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingCart",
25:             "ShoppingCartRepository",
26:             "Item",
27:             "ItemRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllItems();
45:         initialMasterDataCreator.inventoryUpAllItems();
46:         initialMasterDataCreator.registerAllCustomers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + CUSTOMER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = CUSTOMER_EMAIL[6].toString();
76: 
77:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
78:         UUID itemId4 = (UUID) ITEM_DATA[4][0];
79:         UUID itemId6 = (UUID) ITEM_DATA[6][0];
80:         Float itemMoneyAmount2 = ((MoneyType) ITEM_DATA[2][5]).getAmount() * 2;
81:         Float itemMoneyAmount4 = ((MoneyType) ITEM_DATA[4][5]).getAmount() * 4;
82:         Float itemMoneyAmount6 = ((MoneyType) ITEM_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForCustomer( emailString, itemId2, 2 );
89:         restHelper.makeOrderForCustomer( emailString, itemId4, 4 );
90:         restHelper.makeOrderForCustomer( emailString, itemId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( itemMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( itemMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = CUSTOMER_EMAIL[3].toString();
118:         UUID itemId3 = (UUID) ITEM_DATA[3][0];
119:         UUID itemId4 = (UUID) ITEM_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float itemMoneyAmount =
123:                 ((MoneyType) ITEM_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) ITEM_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingCartId = restHelper.getShoppingCartId( emailString );
128:         restHelper.addItemToShoppingCart( shoppingCartId, itemId3, quantity3 );
129:         restHelper.addItemToShoppingCart( shoppingCartId, itemId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingCartRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingCartRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllItems();
47:         initialMasterDataCreator.inventoryUpAllItems();
48:         initialMasterDataCreator.registerAllCustomers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingCart() throws Exception {
57:         // given
58:         String validUri = "/shoppingCarts?email=" + CUSTOMER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingCarts?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingCarts?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID itemId = (UUID) ITEM_DATA[3][0];
78:         String customerEmailString = CUSTOMER_EMAIL[4].toString();
79:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
80: 
81:         String invalidPostUri = "/shoppingCarts/" + UUID.randomUUID() + "/shoppingCartParts";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingCarts/" + UUID.randomUUID().toString() + "/shoppingCartParts/" + itemId;
86:         String invalidCheckoutUri1 = "/shoppingCarts/" + shoppingCartId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingCarts/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingItem() throws Exception {
107:         // given
108:         UUID itemId = (UUID) ITEM_DATA[3][0];
109:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
110:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
111:         String invalidUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + itemId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingCart() throws Exception {
121:         // given
122:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
123:         String customerEmailString9 = CUSTOMER_EMAIL[9].toString();
124:         String customerEmailString7 = CUSTOMER_EMAIL[7].toString();
125: 
126:         UUID shoppingCartId9 = restHelper.getShoppingCartId( customerEmailString9 );
127:         UUID shoppingCartId7 = restHelper.getShoppingCartId( customerEmailString7 );
128: 
129:         String baseUri9 = "/shoppingCarts/" + shoppingCartId9 + "/shoppingCartParts/";
130:         String checkoutUri9 = "/shoppingCarts/" + shoppingCartId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingCarts/" + shoppingCartId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleItemsToShoppingCart( customerEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingCartParts(
137:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + itemId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingCartParts(
142:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" item
145:         restHelper.addItemToShoppingCart( shoppingCartId7, itemId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingCart() throws Exception {
160:         // given
161:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
162:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
163:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingCartParts(
170:                 customerEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingCart() throws Exception {
182:         // given
183:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInInventory() throws Exception {
195:         // given
196:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String customerEmailString = CUSTOMER_EMAIL[5].toString();
210:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
211:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String customerEmailString = CUSTOMER_EMAIL[1].toString();
229:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
230:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String customerEmailString = CUSTOMER_EMAIL[8].toString();
245:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
246:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingCart() throws Exception {
259:         // given
260:         String customerEmailString = CUSTOMER_EMAIL[9].toString();
261:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
262:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForCustomer( String emailString, UUID itemId, Integer quantity ) throws Exception {
36:         UUID shoppingCartId = getShoppingCartId( emailString );
37:         addItemToShoppingCart( shoppingCartId, itemId, quantity );
38:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingCartId( String emailString ) throws Exception {
43:         // get the shopping cart and extract its id ...
44:         MvcResult shoppingCart = mockMvc.perform( get( "/shoppingCarts?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingCart.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( itemId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity )
67:             throws Exception {
68:         addItemToShoppingCart( shoppingCartId, itemId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleItemsToShoppingCart(
74:             String customerEmailString, Integer[] itemIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingCartId = getShoppingCartId( customerEmailString );
77:         String shoppingCartUri = "shoppingCarts?email=" + customerEmailString;
78:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";
79: 
80:         // add all the items to the shopping cart ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < itemIndices.length; i++ ) {
84:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
85:             addItemToShoppingCart( shoppingCartId, itemId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( itemIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( itemIndices[i], 0 ) );
89:                 commentMap.put( itemIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleItemsToShoppingCart(
96:             String customerEmailString, Integer[] itemIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[itemIndices.length];
99:         for ( int i = 0; i < itemIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleItemsToShoppingCart( customerEmailString, itemIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingCartParts( String customerEmailString,
108:                                                          Integer[] itemIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingCartId = getShoppingCartId( customerEmailString );
111:         String shoppingCartUri = "/shoppingCarts?email=" + customerEmailString;
112:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";
113: 
114:         // check that the shopping cart contains all the items ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < itemIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingCartUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each item has the correct quantity and comment ...
126:         for ( int i = 0; i < itemIndices.length; i++ ) {
127:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + itemId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + itemId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingCartParts( String customerEmailString,
142:                                                          Integer[] itemIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[itemIndices.length];
145:         for ( int i = 0; i < itemIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingCartParts( customerEmailString, itemIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPartsInLatestOrder(
155:             String customerEmailString, Integer[] itemIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + customerEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < itemIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) ITEM_DATA[itemIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( customerEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < itemIndices.length; i++ ) {
173:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderParts.length()" ).value( itemIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID itemId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID itemId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID itemId, Integer quantity, String comment ) {
24:         this.itemId = itemId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.h2.security.SHA256;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static AddressType instantiateAddress(
52:             String street, String city, PostalCodeType postalCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, PostalCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for AddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, postalCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + postalCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (AddressType) instance;
79:     }
80: 
81: 
82:     public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for PostalCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, postalCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (PostalCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         PostalCodeType plz = instantiatePostalCode( "12345" );
19: 
20:         // when
21:         AddressType instance = instantiateAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getPostalCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         PostalCodeType plz = instantiatePostalCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiateAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         PostalCodeType plz = instantiatePostalCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiateAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiateAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiateAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiateAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiateAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         PostalCodeType plz = instantiatePostalCode( "12345" );
63: 
64:         // when
65:         AddressType instance1 = instantiateAddress( street, city, plz );
66:         AddressType instance2 = instantiateAddress( street, city, plz );
67:         AddressType instance3 = instantiateAddress( "Anderestr. 12", city, plz );
68:         AddressType instance4 = instantiateAddress( street, "AndereStadt", plz );
69:         AddressType instance5 = instantiateAddress( street, city, instantiatePostalCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         PostalCodeType plz = instantiatePostalCode( "12345" );
84: 
85:         // when
86:         AddressType instance = instantiateAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setPostalCode", PostalCodeType.class );
104:             fail( "setPostalCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPostalCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionPostalCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         PostalCodeType instance = instantiatePostalCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiatePostalCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiatePostalCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiatePostalCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiatePostalCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiatePostalCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         PostalCodeType instance1 = instantiatePostalCode( "12345" );
48:         PostalCodeType instance2 = instantiatePostalCode( "12345" );
49:         PostalCodeType instance3 = instantiatePostalCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         PostalCodeType instance = instantiatePostalCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setpostalCode", String.class );
65:             fail( "setpostalCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\MockCustomer.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockCustomer implements CustomerType {
12:     private String name;
13:     private EmailType email;
14:     private AddressType address;
15: 
16: 
17:     public MockCustomer( String name, EmailType email, AddressType address) {
18:         this.name = name;
19:         this.email = email;
20:         this.address = address;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public AddressType getAddress() {
35:         return address;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockCustomer ) ) return false;
42:         MockCustomer that = (MockCustomer) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( address, that.address );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, address );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionCheckoutTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: 
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.TestHelper;
10: import thkoeln.archilab.ecommerce.usecases.*;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: 
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
14: 
15: import javax.transaction.Transactional;
16: import java.util.Map;
17: import java.util.UUID;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: import static thkoeln.archilab.ecommerce.TestHelper.*;
21: import static thkoeln.archilab.ecommerce.FactoryMethodInvoker.*;
22: 
23: @SpringBootTest
24: @Transactional
25: public class RegressionCheckoutTest {
26: 
27:     @Autowired
28:     private CustomerRegistrationUseCases customerRegistrationUseCases;
29:     @Autowired
30:     private ShoppingCartUseCases shoppingCartUseCases;
31:     @Autowired
32:     private ItemCatalogUseCases itemCatalogUseCases;
33:     @Autowired
34:     private TestHelper testHelper;
35: 
36:     private MoneyType justTheMoneyLimit, aBitOverTheMoneyLimit;
37: 
38: 
39:     @BeforeEach
40:     public void setUp() {
41:         shoppingCartUseCases.deleteAllOrders();
42:         customerRegistrationUseCases.deleteAllCustomers();
43:         itemCatalogUseCases.deleteItemCatalog();
44:         testHelper.registerAllCustomers();
45:         testHelper.addAllItems();
46:         testHelper.inventoryUpAllItems();
47: 
48:         justTheMoneyLimit = instantiateMoney( 500.0f, "EUR" );
49:         aBitOverTheMoneyLimit = instantiateMoney( 501.0f, "EUR" );
50:     }
51: 
52: 
53:     @Test
54:     public void testShoppingCartPaymentLimits() {
55:         // given
56:         UUID itemId100EUR = (UUID) ITEM_DATA[13][0];
57:         UUID itemId25EUR = (UUID) ITEM_DATA[12][0];
58:         UUID itemId1EUR = (UUID) ITEM_DATA[4][0];
59:         EmailType email3 = CUSTOMER_EMAIL[3];
60:         assertTrue( shoppingCartUseCases.isEmpty( email3 ) );
61:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
62: 
63:         // when
64:         shoppingCartUseCases.addItemToShoppingCart( email3, itemId100EUR, 4 );
65:         shoppingCartUseCases.addItemToShoppingCart( email3, itemId25EUR, 4 );
66:         shoppingCartUseCases.addItemToShoppingCart( email3, itemId1EUR, 1 );
67:         assertFalse( shoppingCartUseCases.isEmpty( email3 ) );
68:         assertEquals( aBitOverTheMoneyLimit, shoppingCartUseCases.getShoppingCartAsMoneyValue( email3 ) );
69:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
70: 
71:         // then
72:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( email3 ) );
73:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
74:         assertFalse( shoppingCartUseCases.isEmpty( email3 ) );
75:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
76:         Map<UUID, Integer> orderHistory = shoppingCartUseCases.getOrderHistory( email3 );
77:         assertEquals( 0, orderHistory.size() );
78: 
79:         // and then remove 1 EUR and it should be ok
80:         shoppingCartUseCases.removeItemFromShoppingCart( email3, itemId1EUR, 1 );
81:         assertEquals( justTheMoneyLimit, shoppingCartUseCases.getShoppingCartAsMoneyValue( email3 ) );
82:         assertDoesNotThrow( () -> shoppingCartUseCases.checkout( email3 ) );
83:         assertTrue( shoppingCartUseCases.isEmpty( email3 ) );
84:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
85:         orderHistory = shoppingCartUseCases.getOrderHistory( email3 );
86:         assertEquals( 2, orderHistory.size() );
87:         assertEquals( 4, orderHistory.get( itemId100EUR ).intValue() );
88:         assertEquals( 4, orderHistory.get( itemId25EUR ).intValue() );
89:     }
90: 
91: 
92:     @Test
93:     public void testShoppingCartLogisticsLimits() {
94:         // given
95:         UUID itemId100EUR = (UUID) ITEM_DATA[13][0];
96:         UUID itemId25EUR = (UUID) ITEM_DATA[12][0];
97:         UUID itemId1EUR = (UUID) ITEM_DATA[4][0];
98:         EmailType email7 = CUSTOMER_EMAIL[7];
99:         assertTrue( shoppingCartUseCases.isEmpty( email7 ) );
100:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email7 ) );
101:         MoneyType money488 = instantiateMoney( 488.0f, "EUR" );
102:         MoneyType money489 = instantiateMoney( 489.0f, "EUR" );
103: 
104:         // when
105:         shoppingCartUseCases.addItemToShoppingCart( email7, itemId100EUR, 4 );
106:         shoppingCartUseCases.addItemToShoppingCart( email7, itemId25EUR, 3 );
107:         shoppingCartUseCases.addItemToShoppingCart( email7, itemId1EUR, 14 );
108:         assertFalse( shoppingCartUseCases.isEmpty( email7 ) );
109:         assertEquals( money489, shoppingCartUseCases.getShoppingCartAsMoneyValue( email7 ) );
110:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email7 ) );
111: 
112:         // then
113:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( email7 ) );
114:         assertTrue( shoppingCartUseCases.isPaymentAuthorized( email7 ) );
115:         assertFalse( shoppingCartUseCases.isEmpty( email7 ) );
116:         Map<UUID, Integer> orderHistory = shoppingCartUseCases.getOrderHistory( email7 );
117:         assertEquals( 0, orderHistory.size() );
118: 
119:         // and then remove 1 item and it should be ok (<= 20)
120:         shoppingCartUseCases.removeItemFromShoppingCart( email7, itemId1EUR, 1 );
121:         assertEquals( money488, shoppingCartUseCases.getShoppingCartAsMoneyValue( email7 ) );
122:         assertDoesNotThrow( () -> shoppingCartUseCases.checkout( email7 ) );
123:         assertTrue( shoppingCartUseCases.isEmpty( email7 ) );
124:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email7 ) );
125:         orderHistory = shoppingCartUseCases.getOrderHistory( email7 );
126:         assertEquals( 3, orderHistory.size() );
127:         assertEquals( 4, orderHistory.get( itemId100EUR ).intValue() );
128:         assertEquals( 3, orderHistory.get( itemId25EUR ).intValue() );
129:         assertEquals( 13, orderHistory.get( itemId1EUR ).intValue() );
130:     }
131: 
132: 
133:     @Test
134:     public void testNoCheckoutForEmptyShoppingCart() {
135:         // given
136:         EmailType email3 = CUSTOMER_EMAIL[3];
137:         assertTrue( shoppingCartUseCases.isEmpty( email3 ) );
138:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
139: 
140:         // when
141:         // then
142:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( email3 ) );
143:         assertFalse( shoppingCartUseCases.isPaymentAuthorized( email3 ) );
144:         assertTrue( shoppingCartUseCases.isEmpty( email3 ) );
145:         Map<UUID, Integer> orderHistory = shoppingCartUseCases.getOrderHistory( email3 );
146:         assertEquals( 0, orderHistory.size() );
147:     }
148: }
149: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionCustomerRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.CustomerType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionCustomerRegistrationTest {
25: 
26:     @Autowired
27:     private CustomerRegistrationUseCases customerRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllCustomersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllCustomers();
44: 
45:         // when
46:         CustomerType customer3 = customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.CUSTOMER_NAME[3], customer3.getName() );
50:         Assertions.assertEquals( CUSTOMER_EMAIL[3], customer3.getEmail() );
51:         Assertions.assertEquals( CUSTOMER_ADDRESS[3], customer3.getAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterCustomerWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllCustomers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 customerRegistrationUseCases.register( "Gandalf The Grey", CUSTOMER_EMAIL[5],
64:                         CUSTOMER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterCustomerWithDuplicateNameOrAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllCustomers();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 customerRegistrationUseCases.register( initialMasterDataCreator.CUSTOMER_NAME[2], newEmail,
77:                         CUSTOMER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteCustomersNoMoreCustomers() {
83:         // given
84:         initialMasterDataCreator.registerAllCustomers();
85: 
86:         // when
87:         customerRegistrationUseCases.deleteAllCustomers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionDeliveryMockTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.TestHelper;
8: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
9: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
10: import thkoeln.archilab.ecommerce.ShopException;
11: 
12: import javax.transaction.Transactional;
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.UUID;
16: 
17: import static org.junit.jupiter.api.Assertions.*;
18: import static thkoeln.archilab.ecommerce.TestHelper.*;
19: import static thkoeln.archilab.ecommerce.TestHelper.InvalidReason.EMPTY;
20: import static thkoeln.archilab.ecommerce.TestHelper.InvalidReason.NULL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionDeliveryMockTest {
25: 
26:     @Autowired
27:     private DeliveryUseCases deliveryUseCases;
28:     @Autowired
29:     private CustomerRegistrationUseCases customerRegistrationUseCases;
30:     @Autowired
31:     private TestHelper testHelper;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         deliveryUseCases.deleteDeliveryHistory();
36:         customerRegistrationUseCases.deleteAllCustomers();
37:         testHelper.registerAllCustomers();
38:         testHelper.addAllItems();
39:         testHelper.inventoryUpAllItems();
40:     }
41: 
42:     @Test
43:     public void testDeliverHappyPath() {
44:         // given
45:         Map delivery3a = new HashMap<>();
46:         delivery3a.put( ITEM_DATA[0][0], 3 );
47:         delivery3a.put( ITEM_DATA[1][0], 2 );
48:         Map delivery3b = new HashMap<>();
49:         delivery3b.put( ITEM_DATA[2][0], 4 );
50:         delivery3b.put( ITEM_DATA[3][0], 6 );
51:         Map delivery3c = new HashMap<>();
52:         delivery3c.put( ITEM_DATA[1][0], 5 );
53:         delivery3c.put( ITEM_DATA[2][0], 1 );
54: 
55:         // when
56:         UUID deliveryId1 = deliveryUseCases.triggerDelivery( mockCustomers[3], delivery3a );
57:         UUID deliveryId2 = deliveryUseCases.triggerDelivery( mockCustomers[3], delivery3b );
58:         UUID deliveryId3 = deliveryUseCases.triggerDelivery( mockCustomers[3], delivery3c );
59:         Map<UUID, Integer> deliveryHistory = deliveryUseCases.getDeliveryHistory( CUSTOMER_EMAIL[3] );
60: 
61:         // then
62:         assertEquals( 4, deliveryHistory.size() );
63:         assertEquals( 3, deliveryHistory.get( ITEM_DATA[0][0] ) );
64:         assertEquals( 7, deliveryHistory.get( ITEM_DATA[1][0] ) );
65:         assertEquals( 5, deliveryHistory.get( ITEM_DATA[2][0] ) );
66:         assertEquals( 6, deliveryHistory.get( ITEM_DATA[3][0] ) );
67:         assertNotNull( deliveryId1 );
68:         assertNotNull( deliveryId2 );
69:         assertNotNull( deliveryId3 );
70:     }
71: 
72: 
73:     @Test
74:     public void testDeliverInvalidRecipient() {
75:         // given
76:         Map delivery = new HashMap<>();
77:         delivery.put( ITEM_DATA[0][0], 1 );
78:         delivery.put( ITEM_DATA[1][0], 1 );
79: 
80:         // when
81:         // then
82:         assertThrows( ShopException.class, () -> deliveryUseCases.triggerDelivery( null, delivery ) );
83:     }
84: 
85:     @Test
86:     public void testDeliverTooManyItems() {
87:         // given
88:         Map delivery = new HashMap<>();
89:         delivery.put( ITEM_DATA[3][0], 1 );
90:         delivery.put( ITEM_DATA[4][0], 4 );
91:         delivery.put( ITEM_DATA[5][0], 5 );
92:         delivery.put( ITEM_DATA[6][0], 6 );
93:         delivery.put( ITEM_DATA[7][0], 5 ); // too many items, total 21
94: 
95:         // when
96:         // then
97:         assertThrows( ShopException.class, () -> deliveryUseCases.triggerDelivery( mockCustomers[7], delivery ) );
98:         delivery.put( ITEM_DATA[7][0], 4 ); // total 20, now ok
99:         assertDoesNotThrow( () -> deliveryUseCases.triggerDelivery ( mockCustomers[7], delivery ) );
100:     }
101: 
102: }
103: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_INVENTORY;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionInventoryManagementTest {
20: 
21:     @Autowired
22:     private InventoryManagementUseCases inventoryManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllItems();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToInventory() {
37:         // given
38:         initialMasterDataCreator.inventoryUpAllItems();
39:         UUID itemId8 = (UUID) ITEM_DATA[8][0];
40: 
41:         // when
42:         int inventory8before = inventoryManagementUseCases.getAvailableInventory( itemId8 );
43:         assertEquals( ITEM_INVENTORY.get( itemId8 ), inventory8before );
44:         inventoryManagementUseCases.addToInventory( itemId8, 22 );
45:         int inventory8after = inventoryManagementUseCases.getAvailableInventory( itemId8 );
46:         inventoryManagementUseCases.addToInventory( itemId8, 1 );
47:         int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( itemId8 );
48: 
49:         // then
50:         assertEquals( inventory8before + 22, inventory8after );
51:         assertEquals( inventory8after + 1, inventory8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromInventory() {
57:         // given
58:         initialMasterDataCreator.inventoryUpAllItems();
59:         UUID itemId6 = (UUID) ITEM_DATA[6][0];
60:         int inventory6before = ITEM_INVENTORY.get( itemId6 );
61:         UUID itemId9 = (UUID) ITEM_DATA[9][0];
62:         int inventory9before = ITEM_INVENTORY.get( itemId9 );
63:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
64:         int inventory1before = ITEM_INVENTORY.get( itemId1 );
65: 
66:         // when
67:         inventoryManagementUseCases.removeFromInventory( itemId6, 1 );
68:         int inventory6after = inventoryManagementUseCases.getAvailableInventory( itemId6 );
69:         inventoryManagementUseCases.removeFromInventory( itemId1, 3 );
70:         int inventory1after = inventoryManagementUseCases.getAvailableInventory( itemId1 );
71:         inventoryManagementUseCases.removeFromInventory( itemId9, inventory9before );
72:         int inventory9after = inventoryManagementUseCases.getAvailableInventory( itemId9 );
73: 
74:         // then
75:         assertEquals( inventory6before - 1, inventory6after );
76:         assertEquals( inventory1before - 3, inventory1after );
77:         assertEquals( 0, inventory9after );
78:     }
79: 
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionItemCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionItemCatalogTest {
22: 
23:     @Autowired
24:     private ItemCatalogUseCases itemCatalogUseCases;
25:     @Autowired
26:     private InventoryManagementUseCases inventoryManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddItemToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllItems();
41: 
42:         // when
43:         MoneyType sellPrice = itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( ITEM_DATA[4][5], sellPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveItemFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllItems();
53:         UUID itemId = (UUID) ITEM_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> itemCatalogUseCases.getSellPrice( itemId ) );
57:         itemCatalogUseCases.removeItemFromCatalog( itemId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( itemId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveItemThatIsInInventory() {
68:         // given
69:         initialMasterDataCreator.addAllItems();
70:         UUID itemId = (UUID) ITEM_DATA[4][0];
71:         inventoryManagementUseCases.addToInventory( itemId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> itemCatalogUseCases.removeItemFromCatalog( itemId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearItemCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllItems();
83: 
84:         // when
85:         itemCatalogUseCases.deleteItemCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionPaymentMockTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.TestHelper;
8: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
9: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import java.util.UUID;
17: 
18: import static org.junit.jupiter.api.Assertions.*;
19: import static thkoeln.archilab.ecommerce.TestHelper.CUSTOMER_EMAIL;
20: import static thkoeln.archilab.ecommerce.FactoryMethodInvoker.*;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionPaymentMockTest {
25: 
26:     @Autowired
27:     private PaymentUseCases paymentUseCases;
28:     @Autowired
29:     private CustomerRegistrationUseCases customerRegistrationUseCases;
30:     @Autowired
31:     private TestHelper testHelper;
32: 
33:     private EmailType nonExistingEmail;
34: 
35:     private MoneyType money0, money20, money100, money130, money150, money300, money450, money500, money501;
36: 
37:     @BeforeEach
38:     public void setUp() {
39:         paymentUseCases.deletePaymentHistory();
40:         customerRegistrationUseCases.deleteAllCustomers();
41:         testHelper.registerAllCustomers();
42: 
43:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
44:         money20 = instantiateMoney( 20.00f, "EUR" );
45:         money100 = instantiateMoney( 100.00f, "EUR" );
46:         money130 = instantiateMoney( 130.00f, "EUR" );
47:         money150 = instantiateMoney( 150.00f, "EUR" );
48:         money300 = instantiateMoney( 300.00f, "EUR" );
49:         money450 = instantiateMoney( 450.00f, "EUR" );
50:         money500 = instantiateMoney( 500.00f, "EUR" );
51:         money501 = instantiateMoney( 501.00f, "EUR" );
52:     }
53: 
54:     @Test
55:     public void testPaymentHappyPath() {
56:         // given
57:         UUID paymentId1 = paymentUseCases.authorizePayment( CUSTOMER_EMAIL[3], money20 );
58:         UUID paymentId2 = paymentUseCases.authorizePayment( CUSTOMER_EMAIL[3], money130 );
59:         UUID paymentId3 = paymentUseCases.authorizePayment( CUSTOMER_EMAIL[3], money150 );
60:         UUID paymentId4 = paymentUseCases.authorizePayment( CUSTOMER_EMAIL[4], money450 );
61:         MoneyType expectedTotal3 = instantiateMoney( 300.00f, "EUR" );
62:         MoneyType expectedTotal4 = instantiateMoney( 450.00f, "EUR" );
63: 
64:         // when
65:         MoneyType total3 = paymentUseCases.getPaymentTotal( CUSTOMER_EMAIL[3] );
66:         MoneyType total4 = paymentUseCases.getPaymentTotal( CUSTOMER_EMAIL[4] );
67: 
68:         // then
69:         assertEquals( expectedTotal3, total3 );
70:         assertEquals( expectedTotal4, total4 );
71:         assertNotNull( paymentId1 );
72:         assertNotNull( paymentId2 );
73:         assertNotNull( paymentId3 );
74:         assertNotNull( paymentId4 );
75:     }
76: 
77: 
78:     @Test
79:     public void testInvalidPaymentData() {
80:         // given
81:         // when
82:         // then
83:         assertThrows( ShopException.class, () ->
84:                 paymentUseCases.authorizePayment( null, money100 ) );
85:         assertThrows( ShopException.class, () ->
86:                 paymentUseCases.authorizePayment( nonExistingEmail, money100 ) );
87:         assertThrows( ShopException.class, () ->
88:                 paymentUseCases.authorizePayment( CUSTOMER_EMAIL[3], money0 ) );
89:         assertThrows( ShopException.class, () ->
90:                 paymentUseCases.authorizePayment( CUSTOMER_EMAIL[3], null ) );
91:     }
92: 
93: 
94:     @Test
95:     public void testMaxAmountExceeded() {
96:         // given
97:         // when
98:         // then
99:         assertThrows( ShopException.class, () ->
100:                 paymentUseCases.authorizePayment( CUSTOMER_EMAIL[7], money501 ) );
101:         assertDoesNotThrow( () ->
102:                 paymentUseCases.authorizePayment( CUSTOMER_EMAIL[8], money500 ) );
103:     }
104: 
105: 
106: }
107: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionRequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class RegressionRequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "Customer",
21:             "CustomerRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingCart",
25:             "ShoppingCartRepository",
26:             "Item",
27:             "ItemRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionShoppingCartTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.TestHelper;
9: import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
10: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
11: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
12: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
15: import javax.transaction.Transactional;
16: import java.util.Map;
17: import java.util.UUID;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: import static thkoeln.archilab.ecommerce.TestHelper.*;
21: import static thkoeln.archilab.ecommerce.FactoryMethodInvoker.*;
22: 
23: @SpringBootTest
24: @Transactional
25: public class RegressionShoppingCartTest {
26: 
27:     @Autowired
28:     private CustomerRegistrationUseCases customerRegistrationUseCases;
29:     @Autowired
30:     private ShoppingCartUseCases shoppingCartUseCases;
31:     @Autowired
32:     private ItemCatalogUseCases itemCatalogUseCases;
33:     @Autowired
34:     private InventoryManagementUseCases inventoryManagementUseCases;
35:     @Autowired
36:     private TestHelper testHelper;
37: 
38:     private EmailType nonExistingEmail;
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         shoppingCartUseCases.deleteAllOrders();
43:         customerRegistrationUseCases.deleteAllCustomers();
44:         itemCatalogUseCases.deleteItemCatalog();
45:         testHelper.registerAllCustomers();
46:         testHelper.addAllItems();
47:         testHelper.inventoryUpAllItems();
48: 
49:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testInvalidAddToShoppingCart() {
55:         // given
56:         UUID nonExistentItemId = UUID.randomUUID();
57:         UUID itemId5 = (UUID) ITEM_DATA[5][0];
58:         UUID itemId0 = (UUID) ITEM_DATA[0][0];
59:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
60:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
61:         EmailType customerEmail0 = CUSTOMER_EMAIL[0];
62: 
63:         // when
64:         shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId2, 6 );
65:         shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId2, 13 );
66: 
67:         // then
68:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( customerEmail0, nonExistentItemId, 12 ) );
69:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( nonExistingEmail, itemId5, 12 ) );
70:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId5, -1 ) );
71:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId0, 1 ) );
72:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId1, 11 ) );
73:         assertThrows( ShopException.class, () -> shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId2, 2 ) );
74:     }
75: 
76: 
77: 
78:     @Test
79:     public void testInvalidRemoveFromShoppingCart() {
80:         // given
81:         UUID nonExistentItemId = UUID.randomUUID();
82:         UUID itemId5 = (UUID) ITEM_DATA[5][0];
83:         UUID itemId0 = (UUID) ITEM_DATA[0][0];
84:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
85:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
86:         EmailType customerEmail0 = CUSTOMER_EMAIL[0];
87:         shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId1, 5 );
88:         shoppingCartUseCases.addItemToShoppingCart( customerEmail0, itemId2, 15 );
89: 
90:         // when
91:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId1, 2 );
92:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId2, 4 );
93:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId2, 7 );
94: 
95:         // then
96:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, nonExistentItemId, 12 ) );
97:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( nonExistingEmail, itemId5, 12 ) );
98:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId5, -1 ) );
99:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId0, 1 ) );
100:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId1, 4 ) );
101:         assertThrows( ShopException.class, () -> shoppingCartUseCases.removeItemFromShoppingCart( customerEmail0, itemId2, 5 ) );
102:     }
103: 
104: 
105: 
106:     @Test
107:     public void testAddRemoveItemsFromAndToShoppingCart() {
108:         // given
109:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
110:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
111:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
112:         EmailType customerEmail5 = CUSTOMER_EMAIL[5];
113: 
114:         // when
115:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId1, 2 );
116:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId2, 3 );
117:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail3, itemId1, 2 );
118:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId1, 1 );
119:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId2, 6 );
120:         // customer3 has 1x itemId1 and 9x itemId2 in cart
121:         Map<UUID, Integer> cart3 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail3 );
122: 
123:         shoppingCartUseCases.addItemToShoppingCart( customerEmail5, itemId1, 2 );
124:         shoppingCartUseCases.addItemToShoppingCart( customerEmail5, itemId2, 8 );
125:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail5, itemId1, 1 );
126:         shoppingCartUseCases.addItemToShoppingCart( customerEmail5, itemId2, 2 );
127:         // customer5 has 1x itemId1 and 10x itemId2 in cart
128:         Map<UUID, Integer> cart5 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail5 );
129:         int reservedInventory1 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId1 );
130:         int reservedInventory2 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId2 );
131: 
132:         // then
133:         assertEquals( 2, cart3.size() );
134:         assertEquals( 1, cart3.get( itemId1 ) );
135:         assertEquals( 9, cart3.get( itemId2 ) );
136: 
137:         assertEquals( 2, cart5.size() );
138:         assertEquals( 1, cart5.get( itemId1 ) );
139:         assertEquals( 10, cart5.get( itemId2 ) );
140: 
141:         assertEquals( 2, reservedInventory1 );
142:         assertEquals( 19, reservedInventory2 );
143:     }
144: 
145: 
146:     @Test
147:     public void testImpactOfInventoryCorrectionToOneShoppingCart() {
148:         // given
149:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
150:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
151:         UUID itemId3 = (UUID) ITEM_DATA[3][0];
152:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
153: 
154:         // when
155:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId1, 6 );
156:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId2, 15 );
157:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId3, 1 );
158:         inventoryManagementUseCases.changeInventoryTo( itemId1, 4 );
159:         inventoryManagementUseCases.changeInventoryTo( itemId2, 16 );
160:         inventoryManagementUseCases.changeInventoryTo( itemId3, 0 );
161:         Map<UUID, Integer> cart = shoppingCartUseCases.getShoppingCartAsMap( customerEmail3 );
162:         int reservedInventory1 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId1 );
163:         int reservedInventory2 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId2 );
164:         int reservedInventory3 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId3 );
165: 
166:         // then
167:         assertEquals( 4, cart.get( itemId1 ) );
168:         assertEquals( 15, cart.get( itemId2 ) );
169:         assertTrue( cart.get( itemId3 ) == null || cart.get( itemId3 ) == 0 );
170:         assertEquals( 4, reservedInventory1 );
171:         assertEquals( 15, reservedInventory2 );
172:         assertEquals( 0, reservedInventory3 );
173:     }
174: 
175: 
176:     @Test
177:     public void testImpactOfInventoryCorrectionToSeveralShoppingCarts() {
178:         // given
179:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
180:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
181:         EmailType customerEmail6 = CUSTOMER_EMAIL[6];
182:         EmailType customerEmail9 = CUSTOMER_EMAIL[9];
183: 
184:         // when
185:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId2, 3 );
186:         shoppingCartUseCases.addItemToShoppingCart( customerEmail6, itemId2, 6 );
187:         shoppingCartUseCases.addItemToShoppingCart( customerEmail9, itemId2, 9 );
188:         inventoryManagementUseCases.removeFromInventory( itemId2, 2 );
189:         Map<UUID, Integer> cart31 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail3 );
190:         Map<UUID, Integer> cart61 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail6 );
191:         Map<UUID, Integer> cart91 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail9 );
192:         int reservedInventory21 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId2 );
193: 
194:         inventoryManagementUseCases.removeFromInventory( itemId2, 8 );
195:         Map<UUID, Integer> cart32 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail3 );
196:         Map<UUID, Integer> cart62 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail6 );
197:         Map<UUID, Integer> cart92 = shoppingCartUseCases.getShoppingCartAsMap( customerEmail9 );
198:         int quantity32 = cart32.get( itemId2 ) == null ? 0 : cart32.get( itemId2 );
199:         int quantity62 = cart62.get( itemId2 ) == null ? 0 : cart62.get( itemId2 );
200:         int quantity92 = cart92.get( itemId2 ) == null ? 0 : cart92.get( itemId2 );
201:         int reservedInventory22 = shoppingCartUseCases.getReservedInventoryInShoppingCarts( itemId2 );
202: 
203:         // then
204:         assertEquals( 3, cart31.get( itemId2 ) );
205:         assertEquals( 6, cart61.get( itemId2 ) );
206:         assertEquals( 9, cart91.get( itemId2 ) );
207:         assertEquals( 18, reservedInventory21 );
208:         assertEquals( 10, reservedInventory22 );
209:         assertEquals( reservedInventory22, quantity32 + quantity62 + quantity92 );
210:     }
211: 
212: 
213:     @Test
214:     public void testShoppingCartValue() {
215:         // given
216:         UUID itemId3 = (UUID) ITEM_DATA[3][0];
217:         UUID itemId6 = (UUID) ITEM_DATA[6][0];
218:         UUID itemId8 = (UUID) ITEM_DATA[8][0];
219:         MoneyType price3 = (MoneyType) ITEM_DATA[3][5];
220:         MoneyType price6 = (MoneyType) ITEM_DATA[6][5];
221:         MoneyType price8 = (MoneyType) ITEM_DATA[8][5];
222:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
223: 
224:         // when
225:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId3, 3 );
226:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId6, 2 );
227:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId8, 5 );
228:         // customer3 has 3x itemId3, 2x itemId6 and 5x itemId8 in cart
229:         MoneyType cartValue = shoppingCartUseCases.getShoppingCartAsMoneyValue( customerEmail3 );
230: 
231:         // then
232:         //assertEquals( 3 * price3 + 2 * price6 + 5 * price8, cartValue, 0.1f );
233:         assertEquals( price3.multiplyBy( 3 ).add( price6.multiplyBy( 2 ) ).add( price8.multiplyBy( 5 ) ),
234:                 cartValue );
235:     }
236: 
237: 
238:     @Test
239:     public void testShoppingCartValueInvalid() {
240:         // given
241:         // when
242:         // then
243:         assertThrows( ShopException.class, () -> shoppingCartUseCases.getShoppingCartAsMoneyValue( nonExistingEmail ) );
244:     }
245: 
246: 
247:     @Test
248:     public void testCheckout() {
249:         // given
250:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
251:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
252:         UUID itemId3 = (UUID) ITEM_DATA[3][0];
253:         int inventory1before = ITEM_INVENTORY.get( itemId1 );
254:         int inventory2before = ITEM_INVENTORY.get( itemId2 );
255:         int inventory3before = ITEM_INVENTORY.get( itemId3 );
256:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
257:         Map<UUID, Integer> orderHistoryBefore = shoppingCartUseCases.getOrderHistory( customerEmail3 );
258: 
259:         // when
260:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId1,
261:                 inventory1before-2 );
262:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId2, 4 );
263:         shoppingCartUseCases.addItemToShoppingCart( customerEmail3, itemId3, 5 );
264:         shoppingCartUseCases.checkout( customerEmail3 );
265:         int inventory1after = inventoryManagementUseCases.getAvailableInventory( itemId1 );
266:         int inventory2after = inventoryManagementUseCases.getAvailableInventory( itemId2 );
267:         int inventory3after = inventoryManagementUseCases.getAvailableInventory( itemId3 );
268:         Map<UUID, Integer> orderHistoryAfter = shoppingCartUseCases.getOrderHistory( customerEmail3 );
269: 
270:         // then
271:         assertEquals( 0, orderHistoryBefore.size() );
272:         assertEquals( 2, inventory1after );
273:         assertEquals( inventory2before-4, inventory2after );
274:         assertEquals( inventory3before-5, inventory3after );
275:         assertEquals( 3, orderHistoryAfter.size() );
276:         assertEquals( inventory1before-2, orderHistoryAfter.get( itemId1 ) );
277:         assertEquals( 4, orderHistoryAfter.get( itemId2 ) );
278:         assertEquals( 5, orderHistoryAfter.get( itemId3 ) );
279:     }
280: 
281: 
282:     @Test
283:     public void testCheckoutInvalid() {
284:         // given
285:         EmailType customerEmail3 = CUSTOMER_EMAIL[3];
286:         EmailType customerEmail5 = CUSTOMER_EMAIL[5];
287:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
288: 
289:         // when
290:         shoppingCartUseCases.addItemToShoppingCart( customerEmail5, itemId2, 4 );
291:         shoppingCartUseCases.removeItemFromShoppingCart( customerEmail5, itemId2, 4 );
292: 
293:         // then
294:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( nonExistingEmail ) );
295:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( customerEmail3 ) );
296:         assertThrows( ShopException.class, () -> shoppingCartUseCases.checkout( customerEmail5 ) );
297:     }
298: 
299: 
300:     @Test
301:     public void testOrderHistory() {
302:         // given
303:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
304:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
305:         EmailType customerEmail = CUSTOMER_EMAIL[7];
306:         Map<UUID, Integer> orderHistoryBefore = shoppingCartUseCases.getOrderHistory( customerEmail );
307: 
308:         // when
309:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId1, 3 );
310:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId2, 2 );
311:         shoppingCartUseCases.checkout( customerEmail );
312:         Map<UUID, Integer> orderHistory1 = shoppingCartUseCases.getOrderHistory( customerEmail );
313:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId1, 6 );
314:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId2, 2 );
315:         shoppingCartUseCases.checkout( customerEmail );
316:         Map<UUID, Integer> orderHistory2 = shoppingCartUseCases.getOrderHistory( customerEmail );
317:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId1, 1 );
318:         shoppingCartUseCases.addItemToShoppingCart( customerEmail, itemId2, 6 );
319:         shoppingCartUseCases.checkout( customerEmail );
320:         Map<UUID, Integer> orderHistory3 = shoppingCartUseCases.getOrderHistory( customerEmail );
321: 
322:         // then
323:         assertEquals( 0, orderHistoryBefore.size() );
324:         assertEquals( 2, orderHistory1.size() );
325:         assertEquals( 2, orderHistory2.size() );
326:         assertEquals( 2, orderHistory3.size() );
327:         assertEquals( 3, orderHistory1.get( itemId1 ) );
328:         assertEquals( 2, orderHistory1.get( itemId2 ) );
329:         assertEquals( 9, orderHistory2.get( itemId1 ) );
330:         assertEquals( 4, orderHistory2.get( itemId2 ) );
331:         assertEquals( 10, orderHistory3.get( itemId1 ) );
332:         assertEquals( 10, orderHistory3.get( itemId2 ) );
333:     }
334: 
335: 
336: }
337: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\TestHelper.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Component;
5: import thkoeln.archilab.ecommerce.regression.MockCustomer;
6: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
7: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
8: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
9: import thkoeln.archilab.ecommerce.usecases.CustomerType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import java.util.HashMap;
15: import java.util.Map;
16: import java.util.Random;
17: import java.util.UUID;
18: 
19: @Component
20: @SuppressWarnings("PMD")
21: public class TestHelper {
22: 
23:     private CustomerRegistrationUseCases customerRegistrationUseCases;
24:     private ItemCatalogUseCases itemCatalogUseCases;
25:     private InventoryManagementUseCases inventoryManagementUseCases;
26: 
27:     public static final String EUR = "EUR";
28: 
29:     @Autowired
30:     public TestHelper( CustomerRegistrationUseCases customerRegistrationUseCases,
31:                        ItemCatalogUseCases itemCatalogUseCases,
32:                        InventoryManagementUseCases inventoryManagementUseCases ) {
33:         this.customerRegistrationUseCases = customerRegistrationUseCases;
34:         this.itemCatalogUseCases = itemCatalogUseCases;
35:         this.inventoryManagementUseCases = inventoryManagementUseCases;
36: 
37:     }
38: 
39:     public final static String[] CUSTOMER_NAME = new String[]{
40:             "Max Müller",
41:             "Sophie Schmitz",
42:             "Irene Mihalic",
43:             "Emilia Fischer",
44:             "Filiz Polat",
45:             "Lina Wagner",
46:             "Leon Becker",
47:             "Agnieszka Kalterer",
48:             "Felix Bauer",
49:             "Lara Schulz"
50:     };
51: 
52:     public final static EmailType[] CUSTOMER_EMAIL = new EmailType[] {
53:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
54:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
55:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
56:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
57:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
58:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
59:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
60:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
61:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
62:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
63:     };
64: 
65:     public final static AddressType[] CUSTOMER_ADDRESS = new AddressType[] {
66:             FactoryMethodInvoker.instantiateAddress(
67:                     "Hauptstraße 1", "Berlin", 
68:                     FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
69:             FactoryMethodInvoker.instantiateAddress(
70:                     "Bahnhofstraße 12", "München", 
71:                     FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
72:             FactoryMethodInvoker.instantiateAddress(
73:                     "Kirchplatz 3", "Hamburg", 
74:                     FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
75:             FactoryMethodInvoker.instantiateAddress(
76:                     "Goethestraße 7", "Frankfurt am Main", 
77:                     FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
78:             FactoryMethodInvoker.instantiateAddress(
79:                     "Mühlenweg 15", "Köln", 
80:                     FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
81:             FactoryMethodInvoker.instantiateAddress(
82:                     "Schulstraße 9", "Düsseldorf", 
83:                     FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
84:             FactoryMethodInvoker.instantiateAddress(
85:                     "Dorfstraße 21", "Stuttgart", 
86:                     FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
87:             FactoryMethodInvoker.instantiateAddress(
88:                     "Marktstraße 5", "Leipzig", 
89:                     FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
90:             FactoryMethodInvoker.instantiateAddress(
91:                     "Rosenweg 14", "Dortmund", 
92:                     FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
93:             FactoryMethodInvoker.instantiateAddress(
94:                     "Wiesenstraße 6", "Essen", 
95:                     FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
96:     };
97: 
98: 
99:     public final static CustomerType[] mockCustomers;
100: 
101:     public static final Object[][] ITEM_DATA = new Object[][]{
102:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
103:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
105:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
106:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
108:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
109:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
111:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
112:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
114:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
115:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
117:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
118:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
120:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
121:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
123:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
124:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
126:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
127:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
129:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
130:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
132:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
133:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
134:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
135:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
136:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
137:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
138:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
139:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
140:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
141:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
142:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
143:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
144:     };
145: 
146: 
147:     // item 0 is out of inventory, item 1 and 2 have fixed quantities of 10 and 20, respectively, and the
148:     // others have a random inventory between 5 and 100
149:     public static final Map<UUID, Integer> ITEM_INVENTORY = new HashMap<>();
150: 
151:     static {
152:         Random random = new Random();
153:         for ( Object[] itemData : ITEM_DATA ) {
154:             ITEM_INVENTORY.put( (UUID) itemData[0], random.nextInt( 100 ) + 20 );
155:         }
156:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[0][0], 0 );
157:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[1][0], 10 );
158:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[2][0], 20 );
159:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[3][0], 30 );
160: 
161:         mockCustomers = new CustomerType[CUSTOMER_NAME.length];
162:         for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
163:             mockCustomers[i] = new MockCustomer(
164:                     CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i]);
165:         }
166:     }
167: 
168: 
169:     public enum InvalidReason {
170:         NULL, EMPTY;
171: 
172:         public Object getInvalidValue( Object originalValue ) {
173:             switch (this) {
174:                 case NULL:
175:                     return null;
176:                 case EMPTY:
177:                     return "";
178:                 default:
179:                     return null;
180:             }
181:         }
182:     }
183: 
184:     public void registerAllCustomers() {
185:         for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
186:             registerCustomer( CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i] );
187:         }
188:     }
189: 
190: 
191:     public void registerCustomer( String name, EmailType email, AddressType address ) {
192:         customerRegistrationUseCases.register( name, email, address );
193:     }
194: 
195: 
196: 
197:     public void addAllItems() {
198:         for ( Object[] itemData : ITEM_DATA ) {
199:             addItemDataToCatalog( itemData );
200:         }
201:     }
202: 
203:     public void addItemDataToCatalog( Object[] itemData ) {
204:         itemCatalogUseCases.addItemToCatalog( (UUID) itemData[0], (String) itemData[1], (String) itemData[2],
205:                 (Float) itemData[3], (MoneyType) itemData[4], (MoneyType) itemData[5] );
206:     }
207: 
208: 
209:     public Object[] getItemDataInvalidAtIndex( int index, InvalidReason reason ) {
210:         Object[] itemData = ITEM_DATA[1];
211:         Object[] itemDataInvalid = new Object[itemData.length];
212:         System.arraycopy( itemData, 0, itemDataInvalid, 0, itemData.length );
213:         itemDataInvalid[index] = itemData[index].getClass().cast(
214:                 reason.getInvalidValue( itemData[index] ) );
215:         return itemDataInvalid;
216:     }
217: 
218: 
219:     public void inventoryUpAllItems() {
220:         for ( Object[] itemData : ITEM_DATA ) {
221:             if ( ITEM_INVENTORY.get( itemData[0] ) > 0 )
222:                 inventoryManagementUseCases.addToInventory( (UUID) itemData[0], ITEM_INVENTORY.get( itemData[0] ) );
223:         }
224:     }
225: }
226: 

[RESPONSE]:
# Code Review Ergebnisse

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java

[Money.java] Zeilen 72-75, 89-92, 120-123: **Duplication** (Original: Zeilen 72-75): Identische Null- und Währungsprüfung in `add()`, `subtract()` und `largerThan()` Methoden. Diese Validierungslogik könnte in eine private Hilfsmethode extrahiert werden.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java

[Delivery.java]: **Anemic Entity**: Die Klasse besitzt nur Getter/Setter (via Lombok) ohne Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryPart.java

[DeliveryPart.java] Zeilen 20-23: **Layer Violation / Shared Persistency**: `DeliveryPart` in `delivery.domain` hat direkte Abhängigkeit zu `Item` aus `item.domain` via `@ManyToOne`. Zugriff auf Domain-Entität eines anderen Packages.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java

[DeliveryService.java] Zeilen 37-39, 74-77: **Duplication** (Original: Zeilen 37-39): Null-Check und Exception für `deliveryRecipient`/`customerEmail` wird doppelt implementiert.

[DeliveryService.java] Zeile 56: **Shared Persistency**: Zugriff auf `CustomerService` eines anderen Packages (customer) um Kunden zu laden.

[DeliveryService.java] Zeile 64: **Layer Violation**: Direkter Zugriff auf `ItemCatalogService.getItem()` aus dem `item`-Package.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java

[Order.java]: **Anemic Entity**: Die Klasse besitzt nur Getter/Setter ohne Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPart.java

[OrderPart.java] Zeilen 22-23: **Layer Violation / Shared Persistency**: `OrderPart` in `order.domain` hat direkte Abhängigkeit zu `Item` aus `item.domain`.

[OrderPart.java]: **Anemic Entity**: Nur Getter/Setter, keine Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java

[OrderService.java] Zeilen 29-30: **Shared Persistency**: Direkter Zugriff auf `PaymentRepository` und `DeliveryRepository` anderer Packages.

[OrderService.java] Zeilen 65-67, 105-107: **Duplication** (Original: 65-67): Identische Prüfung ob Kunde registriert ist mit Exception-Wurf.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java

[Payment.java] Zeilen 24-25: **Layer Violation / Shared Persistency**: `Payment` in `payment.domain` hat `@ManyToOne` Beziehung zu `Customer` aus `customer.domain`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java

[ShoppingCart.java] Zeilen 32-33: **Layer Violation / Shared Persistency**: Direkte Abhängigkeit zu `Customer` und `Payment` aus anderen Packages.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java

[ShoppingCartPart.java] Zeilen 20-21: **Layer Violation / Shared Persistency**: `ShoppingCartPart` hat direkte Abhängigkeit zu `Item` aus `item.domain`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java

[ShoppingCartService.java] Zeile 41: **Shared Persistency**: Direkter Zugriff auf `PaymentRepository` aus dem `payment`-Package.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryPart.java

[InventoryPart.java] Zeilen 20-21: **Layer Violation / Shared Persistency**: `InventoryPart` hat direkte Abhängigkeit zu `Item` aus `item.domain`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryDomainService.java

[InventoryDomainService.java] Zeilen 19-27: **Dead Code**: Die Methoden `addItemToInventory` und `removeItemFromInventory` werden nirgends aufgerufen.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\main\java\thkoeln\archilab\ecommerce\solution\anticorruptionlayer\application\ShoppingCartUseCasesAdapterService.java

[ShoppingCartUseCasesAdapterService.java] Zeilen 39-45: **Dead Code**: `setCommentForShoppingCartPart` und `getCommentForShoppingCartPart` sind leere bzw. nur null-returnierende Implementierungen ohne Funktionalität.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\FactoryMethodInvoker.java

[FactoryMethodInvoker.java] Zeilen 23-48, 51-79, 82-107, 110-135: **Duplication** (Original: Zeilen 23-48 in masterdata/FactoryMethodInvoker.java): Die gesamte Klasse ist ein Duplikat der Klasse in `masterdata`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\regression\MockCustomer.java

[MockCustomer.java] Zeilen 1-51: **Duplication** (Original: masterdata/MockCustomer.java Zeilen 1-51): Die gesamte Klasse ist ein Duplikat.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_f1139c8d-1d55-422c-bfdd-c5b15a740d63\src\test\java\thkoeln\archilab\ecommerce\TestHelper.java

[TestHelper.java] Zeilen 39-166: **Duplication** (Original: masterdata/InitialMasterDataCreator.java Zeilen 27-159): Große Teile der statischen Daten (CUSTOMER_NAME, CUSTOMER_EMAIL, CUSTOMER_ADDRESS, ITEM_DATA, ITEM_INVENTORY) sind dupliziert.

ENDE
Generated by claude-opus-4-5-20251101
-----------------------------------