--- DATE: 13.1.2026, 14:36:15 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: 
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
10: 
11: import javax.persistence.Embeddable;
12: import javax.persistence.Embedded;
13: import java.util.Objects;
14: 
15: @EqualsAndHashCode
16: @Getter
17: @Embeddable
18: public class Address implements AddressType {
19:     private String street;
20:     private String city;
21:     @Embedded
22:     private PostalCode postalCode;
23: 
24:     public Address(String street, String city, PostalCode postalCode) {
25: 
26:         if (street == null || street.isEmpty() || city == null || city.isEmpty() || postalCode == null) {
27:             throw new ShopException("Invalid address");
28:         }
29:         this.street = street;
30:         this.city= city;
31:         this.postalCode = postalCode;
32:     }
33: 
34:     public Address() {
35: 
36:     }
37: 
38: 
39:     public static AddressType of(String street, String city, PostalCodeType postalCode) {
40:         if (postalCode == null) {
41:             throw new ShopException("PostalCode is null");
42:         }
43:         if (!(postalCode instanceof PostalCode)) {
44:             throw new ShopException("wrong PostalCode type");
45:         }
46: 
47:         PostalCode code = (PostalCode) postalCode;
48:         return new Address(street, city, code);
49:     }
50: 
51:     @Override
52:     public String getStreet() {
53:         return street;
54:     }
55: 
56:     @Override
57:     public String getCity() {
58:         return city;
59:     }
60: 
61:     @Override
62:     public PostalCodeType getPostalCode() {
63:         return postalCode;
64:     }
65: 
66: 
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: 
10: import javax.persistence.Embeddable;
11: import java.io.Serializable;
12: @EqualsAndHashCode
13: @Getter
14: @Embeddable
15: public class Email implements EmailType , Serializable {
16: 
17:     private String emailString;
18: 
19:     public Email(String email){
20:         if ( email == null || email.isEmpty()) {
21:             throw new ShopException("Invalid customer data");
22:         }
23:         this.emailString=email;
24:     }
25: 
26:     public Email() {
27: 
28:     }
29: 
30:     public static EmailType of (String emailAsString){
31: 
32:         if ( emailAsString == null || emailAsString.isEmpty()) {
33:             throw new ShopException("Invalid customer data");
34:         }
35:         if ( !emailAsString.contains("@")) {
36:             throw new ShopException("Kein @");
37:         }
38: 
39:         int positionOfAt = emailAsString.indexOf('@');
40:         String beforeAt = emailAsString.substring(0,positionOfAt);
41:         String afterAt = emailAsString.substring(positionOfAt+1);
42: 
43:         if ( emailAsString.contains(" ")) {
44:             throw new ShopException("contains Leerzeichen");
45:         }
46:         if(beforeAt.isEmpty()||afterAt.isEmpty()){
47:             throw new ShopException("before or after @ is empty");
48:         }
49: 
50:         for (char c : beforeAt.toCharArray()) {
51:             if (!(Character.isLetterOrDigit(c) || c == '.')) {
52:                 throw new ShopException("no valid char");
53:             }
54:         }
55: 
56:         for (char c : afterAt.toCharArray()) {
57:             if (!(Character.isLetterOrDigit(c) || c == '.')) {
58:                 throw new ShopException("no valid char");
59:             }
60:         }/*
61:         if(!beforeAt.contains(".")||!afterAt.contains(".")){
62:             throw new ShopException("no dots existent");
63:         }
64:         */
65:         if(emailAsString.contains("..")){
66:             throw new ShopException("2 dots in a row");
67:         }
68:         if (!(afterAt.endsWith(".de") || afterAt.endsWith(".at") ||
69:                 afterAt.endsWith(".ch") || afterAt.endsWith(".com") || afterAt.endsWith(".org"))) {
70:             throw new ShopException("no valid ending of email");
71:         }
72: 
73:         return new Email(emailAsString);
74:     }
75:     @Override
76:     public String toString() {
77:         return emailString;
78:     }
79: 
80: 
81: }
82: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
7: 
8: import javax.persistence.Embeddable;
9: 
10: @EqualsAndHashCode
11: @Getter
12: @Embeddable
13: public class Money implements MoneyType {
14:     private Float amount;
15:     private String currency;
16: 
17:     public Money(Float amount, String currency) {
18:         this.amount = amount;
19:         this.currency = currency;
20:     }
21: 
22:     public Money() {
23: 
24:     }
25: 
26:     @Override
27:     public MoneyType add(MoneyType otherMoney) {
28:         checkEqualCurrency(otherMoney);
29:         return new Money(amount + otherMoney.getAmount(), currency);
30:     }
31: 
32:     @Override
33:     public MoneyType subtract(MoneyType otherMoney) {
34:         checkEqualCurrency(otherMoney);
35:         if (amount < otherMoney.getAmount()) {
36:             throw new ShopException("negative result");
37:         }
38:         return new Money(amount - otherMoney.getAmount(), currency);
39:     }
40: 
41:     @Override
42:     public MoneyType multiplyBy(int factor) {
43:         if (factor < 0) {
44:             throw new ShopException("negative result");
45:         }
46:         return new Money(amount * factor, currency);
47:     }
48: 
49:     @Override
50:     public boolean largerThan(MoneyType otherMoney) {
51:         checkEqualCurrency(otherMoney);
52:         return amount > otherMoney.getAmount();
53:     }
54: 
55:     private void checkEqualCurrency(MoneyType otherMoney) {
56:         if (!currency.equals(otherMoney.getCurrency())) {
57:             throw new ShopException("diifferent Currencies");
58:         }
59:     }
60: 
61:     public static MoneyType of(Float amount, String currency) {
62:         if (amount==null|| amount < 0||currency==null||!currency.equals("EUR") && !currency.equals("CHF")) {
63:             throw new ShopException("Money or Moneytype invalid");
64:         }
65:         return new Money(amount, currency);
66:     }
67: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PostalCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import javax.persistence.Embeddable;
8: 
9: @Embeddable
10: public class PostalCode implements PostalCodeType {
11:     private String postalCodeAsString;
12: 
13:     public PostalCode (String code){
14: 
15:         this.postalCodeAsString = code;
16:     }
17: 
18:     public PostalCode() {
19: 
20:     }
21: 
22:     public static PostalCodeType of(String postalCodeAsString){
23: 
24:         if (postalCodeAsString == null || postalCodeAsString.length()!=5|| postalCodeAsString.substring(1).equals("0000")) {
25:             throw new ShopException("Invalid address data");
26:         }
27:         return new PostalCode(postalCodeAsString);
28: 
29:     }
30:     @Override
31:     public String toString() {
32:         return postalCodeAsString;
33:     }
34:     @Override
35:     public boolean equals(Object obj) {
36:         if (this == obj) {
37:             return true;
38:         }
39:         if (obj == null || getClass() != obj.getClass()) {
40:             return false;
41:         }
42:         PostalCode other = (PostalCode) obj;
43:         return postalCodeAsString.equals(other.postalCodeAsString);
44:     }
45: 
46: 
47: }
48: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static AddressType instantiateAddress(
52:             String street, String city, PostalCodeType postalCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, PostalCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for AddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, postalCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + postalCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (AddressType) instance;
79:     }
80: 
81: 
82:     public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for PostalCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, postalCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (PostalCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * customers and items. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] CUSTOMER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] CUSTOMER_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static AddressType[] CUSTOMER_ADDRESS = new AddressType[] {
53:             FactoryMethodInvoker.instantiateAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiateAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiateAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiateAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiateAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiateAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiateAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiateAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiateAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiateAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
83:     };
84: 
85:     public final static CustomerType[] mockCustomers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] ITEM_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private CustomerRegistrationUseCases customerRegistrationUseCases;
135:     private ItemCatalogUseCases itemCatalogUseCases;
136:     private InventoryManagementUseCases inventoryManagementUseCases;
137:     private ShoppingCartUseCases shoppingCartUseCases;
138: 
139: 
140:     // item 0 is out of inventory, item 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random inventory between 5 and 100
142:     public static final Map<UUID, Integer> ITEM_INVENTORY = new HashMap<>();
143: 
144:     static {
145:         mockCustomers = new CustomerType[CUSTOMER_NAME.length];
146:         for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
147:             mockCustomers[i] = new MockCustomer(
148:                     CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] itemData : ITEM_DATA ) {
152:             ITEM_INVENTORY.put( (UUID) itemData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[0][0], 0 );
155:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[1][0], 10 );
156:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[2][0], 20 );
157:         ITEM_INVENTORY.put( (UUID) ITEM_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             CustomerRegistrationUseCases customerRegistrationUseCases,
181:             ItemCatalogUseCases itemCatalogUseCases,
182:             InventoryManagementUseCases inventoryManagementUseCases,
183:             ShoppingCartUseCases shoppingCartUseCases ) {
184:         this.customerRegistrationUseCases = customerRegistrationUseCases;
185:         this.itemCatalogUseCases = itemCatalogUseCases;
186:         this.inventoryManagementUseCases = inventoryManagementUseCases;
187:         this.shoppingCartUseCases = shoppingCartUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingCartUseCases.deleteAllOrders();
193:         itemCatalogUseCases.deleteItemCatalog();
194:         customerRegistrationUseCases.deleteAllCustomers();
195:     }
196: 
197: 
198:     public void registerAllCustomers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.CUSTOMER_NAME.length; i++ ) {
200:             registerCustomer( InitialMasterDataCreator.CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerCustomer( String name, EmailType email, AddressType address ) {
206:         customerRegistrationUseCases.register( name, email, address );
207:     }
208: 
209:     public void addAllItems() {
210:         for ( Object[] itemData : ITEM_DATA ) {
211:             addItemDataToCatalog( itemData );
212:         }
213:     }
214: 
215:     public void addItemDataToCatalog( Object[] itemData ) {
216:         itemCatalogUseCases.addItemToCatalog( (UUID) itemData[0], (String) itemData[1], (String) itemData[2],
217:                 (Float) itemData[3], (MoneyType) itemData[4], (MoneyType) itemData[5] );
218:     }
219: 
220: 
221:     public Object[] getItemDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] itemData = ITEM_DATA[1];
223:         Object[] itemDataInvalid = new Object[itemData.length];
224:         System.arraycopy( itemData, 0, itemDataInvalid, 0, itemData.length );
225:         itemDataInvalid[index] = itemData[index].getClass().cast(
226:                 reason.getInvalidValue( itemData[index] ) );
227:         return itemDataInvalid;
228:     }
229: 
230: 
231:     public void inventoryUpAllItems() {
232:         for ( Object[] itemData : ITEM_DATA ) {
233:             if ( ITEM_INVENTORY.get( itemData[0] ) > 0 )
234:                 inventoryManagementUseCases.addToInventory( (UUID) itemData[0], ITEM_INVENTORY.get( itemData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockCustomer.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockCustomer implements CustomerType {
12:     private String name;
13:     private EmailType email;
14:     private AddressType address;
15: 
16: 
17:     public MockCustomer( String name, EmailType email, AddressType address) {
18:         this.name = name;
19:         this.email = email;
20:         this.address = address;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public AddressType getAddress() {
35:         return address;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockCustomer ) ) return false;
42:         MockCustomer that = (MockCustomer) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( address, that.address );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, address );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllCustomers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerOrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
8: import thkoeln.archilab.ecommerce.solution.order.application.OrderCustomerService;
9: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
10: import thkoeln.archilab.ecommerce.usecases.CustomerType;
11: 
12: @Service
13: public class CustomerOrderService implements OrderCustomerService {
14:     CustomerRepository customerRepository;
15: 
16:     @Autowired
17:     public CustomerOrderService(CustomerRepository customerRepository) {
18:         this.customerRepository = customerRepository;
19:     }
20: 
21:     @Override
22:     public AbstractCustomer findByEmail(Email email) {
23:         return customerRepository.findByEmailEmailString(email.getEmailString());
24:     }
25: 
26:     @Override
27:     public Customer findByEmailEmailString(String email) {
28:         return null;
29:     }
30: }
31: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerPaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
7: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentCustomerService;
8: import thkoeln.archilab.ecommerce.usecases.CustomerType;
9: @Service
10: public class CustomerPaymentService implements PaymentCustomerService {
11:     CustomerRepository customerRepository;
12: 
13:     @Autowired
14:     public CustomerPaymentService(CustomerRepository customerRepository){
15:         this.customerRepository = customerRepository;
16: 
17:     }
18:     @Override
19:     public CustomerType findByEmail(Email email) {
20:         return customerRepository.findByEmailEmailString(email.getEmailString());
21:     }
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerRegistrationService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.domainprimitives.PostalCode;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
10: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
11: import thkoeln.archilab.ecommerce.domainprimitives.Address;
12: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
13: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
14: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
15: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
16: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
17: import thkoeln.archilab.ecommerce.usecases.CustomerType;
18: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
19: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
20: 
21: import java.sql.Date;
22: import java.time.LocalDate;
23: import java.util.ArrayList;
24: import java.util.UUID;
25: 
26: @Service
27: public class CustomerRegistrationService implements CustomerRegistrationUseCases {
28: 
29:     @Autowired
30:     private CustomerRepository customerRepository;
31:     @Autowired
32:     ShoppingCartRepository shoppingCartRepository;
33: 
34: 
35:     @Override
36:     public void register(String name, EmailType email, AddressType address) {
37:         if (email == null|| address==null) {
38:             throw new ShopException("invalid input");
39:         }
40:         Email customerEmail = (Email) email;
41:         PostalCode postalCode = (PostalCode) PostalCode.of(address.getPostalCode().toString());
42:         Address customerAddress = (Address) Address.of(address.getStreet(), address.getCity(), postalCode);
43:         Customer c = new Customer(UUID.randomUUID(),name,customerEmail,customerAddress);
44: 
45:         if (customerRepository.findByEmailEmailString(customerEmail.getEmailString()) != null) {
46:             throw new ShopException("Email vorhanden");
47:         }
48:         customerRepository.save(c);
49:         ShoppingCart shoppingCart = new ShoppingCart(UUID.randomUUID(),new ArrayList<>(),c,0);
50:         shoppingCartRepository.save(shoppingCart);
51: 
52: 
53: 
54: 
55:     }
56: 
57:     @Override
58:     public void changeAddress(EmailType customerEmail, AddressType address) {
59:         if (customerEmail == null|| address==null) {
60:             throw new ShopException("invalid input");
61:         }
62:         Email email = (Email) customerEmail;
63: 
64:         if (customerRepository.findByEmailEmailString(email.getEmailString()) == null) {
65:             throw new ShopException("Email nicht vorhanden");
66:         }
67:         PostalCode postalCode = (PostalCode) PostalCode.of(address.getPostalCode().toString());
68:         Address customerAddress = (Address) Address.of(address.getCity(), address.getStreet(), postalCode);
69:         customerRepository.findByEmailEmailString(email.getEmailString()).setAddress(customerAddress);
70:     }
71: 
72:     @Override
73:     public CustomerType getCustomerData(EmailType customerEmail) {
74:         Email email = (Email) Email.of(customerEmail.toString());
75: 
76:         if (customerRepository.findByEmailEmailString(email.getEmailString()) ==null) {
77:             throw new ShopException("Email nicht vorhanden");
78:         }
79:         /*return new String[]{a.getName(), a.getEmail().toString(), a.getAddress().getCity(),
80:                 a.getAddress().getStreet(),a.getAddress().getPostalCode().toString()};
81: 
82:          */
83:         return customerRepository.findByEmailEmailString(email.getEmailString());
84:     }
85: 
86: 
87:     @Override
88:     public void deleteAllCustomers() {
89:         shoppingCartRepository.deleteAll();
90:         customerRepository.deleteAll();
91:     }
92: /*
93: 
94:     @Override
95:     public void register(String name, String email, String street, String city, PostalCode postalCode) {
96: 
97:         Email customerEmail = (Email) Email.of(email);
98:         Address customerAddress = new Address(street,city,postalCode);
99:         Customer c = new Customer(UUID.randomUUID(),name,customerEmail,customerAddress);
100: 
101:         if (customerRepository.findByEmail(customerEmail) != null) {
102:             throw new ShopException("Email vorhanden");
103:         }
104:         customerRepository.save(c);
105:     }
106: 
107:     @Override
108:     public void changeAddress(String customerEmail, String street, String city, PostalCode postalCode) {
109:         Email email = (Email) Email.of(customerEmail);
110: 
111:         if (customerRepository.findByEmail(email) == null) {
112:             throw new ShopException("Email nicht vorhanden");
113:         }
114:         Address customerAddress = new Address(street,city,postalCode);
115:         customerRepository.findByEmail(email).setAddress(customerAddress);
116:     }
117: 
118:     @Override
119:     public void register(String name, String email, String street, String city, PostalCode postalCode) {
120: 
121:         Address a = new Address(street,city,postalCode);
122:         Customer c = new Customer(name,email,a);
123: 
124:         if (customerRepository.findByEmail(email) != null) {
125:             throw new ShopException("Email vorhanden");
126:         }
127:         customerRepository.save(c);
128:     }
129: 
130:     @Override
131:     public void changeAddress(String customerEmail, String street, String city, PostalCode postalCode) {
132: 
133:         Address a = new Address(street,city,postalCode);
134:         if (customerRepository.findByEmail(customerEmail) == null) {
135:             throw new ShopException("Email nicht vorhanden");
136:         }
137:         customerRepository.findByEmail(customerEmail).setAddress(a);
138:     }
139: 
140:     @Override
141:     public String[] getCustomerData(String customerEmail) {
142: 
143:         if (customerRepository.findByEmail(customerEmail) ==null) {
144:             throw new ShopException("Email nicht vorhanden");
145:         }
146:         Customer a= customerRepository.findByEmail(customerEmail);
147:         return new String[]{a.getName(), a.getEmail().toString(), a.getAddress().getCity(),
148:                             a.getAddress().getStreet(),a.getAddress().getPostalCode().toString()};
149:     }
150: 
151: 
152:  */
153: 
154: }
155: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCustomerService;
8: import thkoeln.archilab.ecommerce.usecases.CustomerType;
9: @Service
10: public class CustomerShoppingCartService implements ShoppingCustomerService {
11: 
12: 
13:     CustomerRepository customerRepository;
14: 
15:     @Autowired
16:     public CustomerShoppingCartService(CustomerRepository customerRepository){
17:         this.customerRepository = customerRepository;
18: 
19:     }
20: 
21:     @Override
22:     public CustomerType findByEmail(Email email) {
23:         return customerRepository.findByEmailEmailString(email.getEmailString());
24:     }
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Address;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
10: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
11: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
12: import thkoeln.archilab.ecommerce.usecases.CustomerType;
13: 
14: 
15: import javax.persistence.*;
16: import java.util.List;
17: import java.util.UUID;
18: 
19: @NoArgsConstructor
20: @Getter
21: @Entity
22: 
23: public class Customer extends AbstractCustomer implements CustomerType  {
24:     @Setter
25:     private String name;
26:     @OneToOne(mappedBy = "customer", cascade = CascadeType.REMOVE)
27:     private ShoppingCart shoppingCart;
28:     @OneToMany
29:     private List<Order> orders;
30:     @Id
31:     private UUID customerId;
32:     @Setter
33:     @Embedded
34:     private Email email;
35:     @Setter
36:     @Embedded
37:     private Address address;
38: 
39:     public Customer(UUID customerId, String name, Email email, Address address) {
40:         super(customerId, email);
41:         if (name == null || name.isEmpty() || email == null || address == null ) {
42:             throw new ShopException("Invalid customer data");
43:         }
44: 
45:         this.name = name;
46:         this.customerId = customerId;
47:         this.email = email;
48:         this.address = address;
49:     }
50:     public void setCustomerId(UUID itemId) {
51:         if (this.customerId != null) {
52:             throw new ShopException("customerId can´t be changed");
53:         }
54:         this.customerId = itemId;
55:     }
56: 
57: }
58: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\CustomerRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: 
7: import javax.persistence.Id;
8: import java.util.UUID;
9: @Repository
10: public interface CustomerRepository extends CrudRepository<Customer, Id> {
11: 
12:     Customer findByEmailEmailString(String email);
13: 
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\DeliveryRecipientClass.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Address;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.domainprimitives.PostalCode;
10: import thkoeln.archilab.ecommerce.usecases.CustomerType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
12: 
13: import javax.persistence.Embeddable;
14: import javax.persistence.Embedded;
15: 
16: @Getter
17: @NoArgsConstructor
18: @Embeddable
19: public class DeliveryRecipientClass extends Customer {
20: 
21:     @Setter
22:     private String name;
23:     @Setter
24:     @Embedded
25:     private Email email;
26:     @Setter
27:     private Address address;
28: 
29:     public DeliveryRecipientClass(String name, Email email, Address address) {
30:         if (name == null || name.isEmpty() || email == null || address == null) {
31:             throw new ShopException("Invalid deliveryRecipient data");
32:         }
33:         if (address.getCity() == null || address.getCity().isEmpty() || address.getStreet() == null || address.getStreet().isEmpty()
34:                 || address.getPostalCode() == null) {
35:             throw new ShopException("Invalid deliveryRecipient data");
36:         }
37: 
38:         this.name = name;
39:         this.email = email;
40:         this.address = address;
41:     }
42: 
43:     public DeliveryRecipientClass(String name, Email email, String city, String street, PostalCode postalCode) {
44:         this(name, email, new Address(city, street, postalCode));
45:     }
46: 
47:     public String getName() {
48:         return this.name;
49:     }
50: 
51:     @Override
52:     public Email getEmail() {
53:         return this.email;
54:     }
55: 
56: }
57: 
58: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.DeliveryRecipientClass;
10: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
11: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
12: import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
13: import thkoeln.archilab.ecommerce.usecases.CustomerType;
14: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
16: 
17: import java.util.HashMap;
18: import java.util.List;
19: import java.util.Map;
20: import java.util.UUID;
21: 
22: @Service
23: public class DeliveryService implements DeliveryUseCases {
24:     @Autowired
25:     DeliveryRepository deliveryRepository;
26:     @Autowired
27:     ItemRepository itemRepository;
28: 
29:     @Override
30:     public UUID triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
31:         if (deliveryRecipient == null || deliveryContent==null||deliveryContent.isEmpty() ) {
32:             throw new ShopException("Invalid payment data");
33:         }
34:         int totalItems = 0;
35:         for (Integer itemCount : deliveryContent.values()) {
36:             totalItems += itemCount;
37:         }
38:         if (totalItems > 20) {
39:             throw new ShopException("Too many items in the delivery");
40:         }
41:         Map<Item, Integer> itemHash = new HashMap<>();
42:         for (Map.Entry<UUID, Integer> entry : deliveryContent.entrySet()) {
43:             UUID itemId = entry.getKey();
44:             Integer quantity = entry.getValue();
45: 
46:             Item item = itemRepository.findByItemId(itemId);
47: 
48:             itemHash.put(item, quantity);
49:         }
50:         UUID id = UUID.randomUUID();
51:         Email email = (Email) Email.of(deliveryRecipient.getEmail().toString());
52:         //Address customerAddress = (Address) Address.of(deliveryRecipient.getAddress().getCity(), deliveryRecipient.getAddress().getStreet(), deliveryRecipient.getAddress().getPostalCode());
53:         deliveryRepository.save(new Delivery(id,email,itemHash));
54:         return id;
55:     }
56: /*
57:     public UUID triggerDeliveryCheck(DeliveryRecipientClass deliveryRecipient, Map<UUID, Integer> deliverableItems) {
58:         if (deliveryRecipient == null || deliveryContent==null||deliveryContent.isEmpty() ) {
59:             throw new ShopException("Invalid payment data");
60:         }
61:         int totalItems = 0;
62:         for (Integer itemCount : deliveryContent.values()) {
63:             totalItems += itemCount;
64:         }
65:         if (totalItems > 20) {
66:             throw new ShopException("Too many items in the delivery");
67:         }
68:         UUID id = UUID.randomUUID();        deliveryRepository.save(new Delivery(id,deliveryRecipient,deliverableItems));
69:         return id;
70:     }
71: 
72: 
73:  */
74:     @Override
75:     public Map<UUID, Integer> getDeliveryHistory(EmailType customerEmail) {
76:         Email email = (Email) Email.of(customerEmail.toString());
77: 
78:         List<Delivery> userDelivery = deliveryRepository.findAllByEmail(email);
79:         if(userDelivery == null || userDelivery.isEmpty()) throw new ShopException("Email nicht vorhanden");
80: 
81:         Map<UUID, Integer> history = new HashMap<>();
82:         for (Delivery delivery : userDelivery) {
83:             for (Map.Entry<Item, Integer> entry : delivery.getItemHash().entrySet()) {
84:                 UUID itemId = entry.getKey().getItemId();
85:                 Integer quantity = entry.getValue();
86:                 history.put(itemId, history.getOrDefault(itemId, 0) + quantity);
87:             }
88:         }
89:         return history;
90:     }
91: 
92:     @Override
93:     public void deleteDeliveryHistory() {
94:         deliveryRepository.deleteAll();
95:     }
96: 
97: }
98: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryShoppingService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingDeliveryService;
6: import thkoeln.archilab.ecommerce.usecases.CustomerType;
7: 
8: import java.util.Map;
9: import java.util.UUID;
10: 
11: @Service
12: public class DeliveryShoppingService implements ShoppingDeliveryService {
13:     DeliveryService deliveryService;
14: 
15:     @Autowired
16:     public DeliveryShoppingService(DeliveryService deliveryService){
17:         this.deliveryService=deliveryService;
18:     }
19:     @Override
20:     public void triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
21:         deliveryService.triggerDelivery(deliveryRecipient,deliveryContent);
22:     }
23: }
24: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import org.dom4j.tree.AbstractEntity;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.DeliveryRecipientClass;
10: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
11: 
12: import javax.persistence.ElementCollection;
13: import javax.persistence.Embedded;
14: import javax.persistence.Entity;
15: import javax.persistence.Id;
16: import java.util.Map;
17: import java.util.UUID;
18: 
19: @Getter
20: @Entity
21: @NoArgsConstructor
22: public class Delivery extends AbstractEntity {
23:     @Id
24:     UUID deliveryId;
25:     @Setter
26:     @Embedded
27:     private Email email;
28:     @Setter
29:     @ElementCollection
30:     private Map<Item, Integer> itemHash;
31: 
32:     public Delivery(UUID deliveryId, Email email, Map<Item,Integer> itemHash){
33:         if (deliveryId == null || email == null || itemHash.isEmpty()) {
34:             throw new ShopException("Invalid Delivery data");
35:         }
36:         this.deliveryId=deliveryId;
37:         this.email=email;
38:         this.itemHash =itemHash;
39:     }
40:     public void setDeliveryId(UUID itemId) {
41:         if (this.deliveryId != null) {
42:             throw new ShopException("deliveryId can´t be changed");
43:         }
44:         this.deliveryId = itemId;
45:     }
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import java.util.List;
8: import java.util.UUID;
9: 
10: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
11:     List<Delivery> findAllByEmail(Email email);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryItemService.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
4: 
5: import java.util.UUID;
6: 
7: public interface InventoryItemService {
8:     AbstractItem findByItemId(UUID itemId);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService;
7: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
8: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: 
14: public class InventoryManagementService implements InventoryManagementUseCases {
15:     @Autowired
16:     private InventoryRepository inventoryRepository;
17: 
18:     @Autowired
19:     private ShoppingCartService shoppingCartService;
20: 
21:     @Autowired
22:     private InventoryItemService inventoryItemService;
23: 
24: 
25:     @Override
26:     public void addToInventory(UUID itemId, int addedQuantity) {
27: 
28:         if (inventoryItemService.findByItemId(itemId)==null) throw new ShopException ("id nicht vorhanden") ;
29:         if (addedQuantity<=0) throw new ShopException("Menge negativ");
30: 
31:         int quantity = inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity() + addedQuantity;
32:         inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(quantity);
33: 
34:     }
35: 
36:     @Override
37:     public void removeFromInventory(UUID itemId, int removedQuantity) {
38: 
39:         if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");
40:         if ( removedQuantity<=0) throw new ShopException("keine negativen Abzüge");
41: 
42:         int quantityInventory = inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity();
43:         int quantityShoppingCart = shoppingCartService.getReservedInventoryInShoppingCarts(itemId);
44:         int quantityOverall = quantityInventory+quantityShoppingCart;
45:         if (quantityOverall<removedQuantity) throw new ShopException("nicht genug vorhanden");
46: 
47:         if(removedQuantity<=quantityInventory){
48:             inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(quantityInventory-removedQuantity);
49:         }
50:         else{
51:             inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(0);
52:             int rest = removedQuantity-quantityInventory;
53:             shoppingCartService.adjustInventory(itemId,rest);
54:         }
55:     }
56: 
57:     @Override
58:     public void changeInventoryTo(UUID itemId, int newTotalQuantity) {
59: 
60:         if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");
61:         if (newTotalQuantity<0) throw new ShopException("keine negativen Mengen");
62: 
63:         inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).setQuantity(newTotalQuantity);
64:         if(newTotalQuantity< shoppingCartService.getReservedInventoryInShoppingCarts(itemId)){
65:             int rest = shoppingCartService.getReservedInventoryInShoppingCarts(itemId)-newTotalQuantity;
66:             shoppingCartService.adjustInventory(itemId,rest);
67:         }
68:     }
69: 
70:     @Override
71:     public int getAvailableInventory(UUID itemId) {
72: 
73:         if (inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId))==null) throw new ShopException("id nicht vorhanden");
74: 
75:         return inventoryRepository.findByItem(inventoryItemService.findByItemId(itemId)).getQuantity();
76:     }
77: }
78: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\application\InventoryShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
7: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryElement;
8: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
9: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingInventoryService;
10: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
11: 
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Service
16: public class InventoryShoppingCartService implements ShoppingInventoryService {
17: 
18:     InventoryRepository inventoryRepository;
19: 
20:     @Autowired
21:     public InventoryShoppingCartService(InventoryRepository inventoryRepository){
22:         this.inventoryRepository= inventoryRepository;
23:     }
24:     /*@Override
25:     public InventoryElement findByItem(Item item) {
26:         return inventoryRepository.findByItem(item);
27:     }
28: 
29:      */
30: 
31:     @Override
32:     public Integer getQuantity(AbstractItem item) {
33:         return inventoryRepository.findByItem(item).getQuantity();
34:     }
35: 
36:     @Override
37:     public void setQuantity(AbstractItem item, Integer quantity) {
38:         InventoryElement inventoryElement = inventoryRepository.findByItem(item);
39:         inventoryElement.setQuantity(quantity);
40:         inventoryRepository.save(inventoryElement);
41:     }
42: 
43:     @Override
44:     public void isOrdered(List<ShoppingCartPart> items) {
45:         for(ShoppingCartPart shoppingCartItem:items){
46:             InventoryElement inventoryElement = inventoryRepository.findByItem(shoppingCartItem.getItem());
47:             inventoryElement.setOrdered(true);
48:             inventoryRepository.save(inventoryElement);
49:         }
50: 
51:     }
52: 
53: 
54: 
55: 
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryElement.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import org.dom4j.tree.AbstractEntity;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: import javax.persistence.JoinColumn;
13: import javax.persistence.OneToOne;
14: import java.util.UUID;
15: 
16: @Getter
17: @NoArgsConstructor
18: @Entity
19: public class InventoryElement extends AbstractEntity {
20:     @Id
21:     UUID inventoryElementId;
22:     @OneToOne
23:     @JoinColumn(name = "item_item_id", nullable = false)
24:     @Setter
25:     private AbstractItem item;
26:     @Setter
27:     private Integer quantity;
28:     @Setter
29:     private Boolean ordered;
30: 
31:     public InventoryElement(UUID inventoryElementId , AbstractItem item, Integer quantity){
32:         if (item == null ||quantity == null || quantity <0) throw new ShopException("id nicht vorhanden");
33: 
34:         this.inventoryElementId = inventoryElementId;
35:         this.item = item;
36:         this.quantity = quantity;
37:         this.ordered = false;
38:     }
39: 
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\inventory\domain\InventoryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.inventory.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
6: 
7: import java.util.UUID;
8: @Repository
9: public interface InventoryRepository extends CrudRepository<InventoryElement,UUID> {
10: 
11:     InventoryElement findByItem(AbstractItem item);
12: 
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryElement;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingCartService;
9: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
10: import thkoeln.archilab.ecommerce.solution.inventory.domain.InventoryRepository;
11: import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
12: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPartRepository;
13: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
15: 
16: import java.util.UUID;
17: @Service
18: public class ItemCatalogService implements ItemCatalogUseCases {
19:     @Autowired
20:      ItemRepository itemRepository;
21:     @Autowired
22:     InventoryRepository inventoryRepository;
23:     @Autowired
24:      ShoppingCartPartRepository shoppingCartPartRepository;
25:     @Autowired
26:      ShoppingCartService shoppingCartService;
27: 
28: 
29:     @Override
30:     public void addItemToCatalog(UUID itemId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellPrice) {
31:         if (purchasePrice == null||sellPrice==null) {
32:             throw new ShopException("price==null");
33:         }
34:         Money purchase = (Money) Money.of(purchasePrice.getAmount(),purchasePrice.getCurrency());
35:         Money sell = (Money) Money.of(sellPrice.getAmount(),sellPrice.getCurrency());
36: 
37:         Item item = new Item(itemId,name,description,size,purchase,sell);
38: 
39:         itemRepository.save(item);
40:             InventoryElement element = new InventoryElement(UUID.randomUUID(),itemRepository.findByItemId(itemId),0);
41:             inventoryRepository.save(element);
42: 
43:     }
44: 
45:     @Override
46:     public void removeItemFromCatalog(UUID itemId) {
47: 
48:         if (itemRepository.findByItemId(itemId) == null) {
49:             throw new ShopException("ID nicht vorhanden");
50:         }
51:         Item item = itemRepository.findByItemId(itemId);
52: 
53:         if (inventoryRepository.findByItem(item).getQuantity()>0){
54:             throw new ShopException("Item still in inventory");
55:         }
56:         if(shoppingCartPartRepository.findAllByItem(itemRepository.findByItemId(itemId))!=null && shoppingCartService.getReservedInventoryInShoppingCarts(itemId)>0){
57:             throw new ShopException("Item still in Shopping Cart");
58:         }
59:         if(inventoryRepository.findByItem(item).getOrdered())throw new ShopException("Item is ordered");
60:         inventoryRepository.delete(inventoryRepository.findByItem(item));
61:         itemRepository.delete(item);
62:     }
63: 
64:     @Override
65:     public MoneyType getSellPrice(UUID itemId) {
66:         Item item = itemRepository.findByItemId(itemId);
67:         if (itemRepository.findByItemId(itemId) == null) {
68:             throw new ShopException("ID nicht vorhanden");
69:         }
70:         return item.getSellPrice();
71:     }
72: 
73: 
74:     @Override
75:     public void deleteItemCatalog() {
76:         inventoryRepository.deleteAll();
77:         itemRepository.deleteAll();
78:     }
79: }
80: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemInventoryService.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.inventory.application.InventoryItemService;
6: import thkoeln.archilab.ecommerce.solution.item.domain.Item;
7: import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
8: 
9: import java.util.UUID;
10: 
11: @Service
12: public class ItemInventoryService implements InventoryItemService {
13:     ItemRepository itemRepository;
14: 
15:     @Autowired
16:     public ItemInventoryService(ItemRepository itemRepository){
17:         this.itemRepository=itemRepository;
18:     }
19:     @Override
20:     public Item findByItemId(UUID itemId) {
21:         return itemRepository.findByItemId(itemId);
22:     }
23: 
24: 
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.item.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.item.domain.ItemRepository;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingItemService;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
9: 
10: import java.util.UUID;
11: @Service
12: public class ItemShoppingCartService implements ShoppingItemService {
13:     ItemRepository itemRepository;
14: 
15:     @Autowired
16:     public ItemShoppingCartService(ItemRepository itemRepository){
17:         this.itemRepository = itemRepository;
18:     }
19: 
20:     @Override
21:     public AbstractItem findByItemId(UUID itemId) {
22:         return itemRepository.findByItemId(itemId);
23:     }
24: 
25:     @Override
26:     public UUID getItemId(AbstractItem item) {
27:         return item.getItemId();
28:     }
29: 
30:     @Override
31:     public Money getSellPrice(AbstractItem item) {
32:         return item.getSellPrice();
33:     }
34: }
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\Item.java ---
1: package thkoeln.archilab.ecommerce.solution.item.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
9: 
10: import javax.persistence.*;
11: import java.util.UUID;
12: 
13: @Getter
14: @NoArgsConstructor
15: @Entity
16: 
17: public class Item extends AbstractItem {
18: 
19:     @Setter
20:     private String name;
21:     @Setter
22:     private String description;
23:     @Setter
24:     private Float size;
25:     @Setter
26:     @Embedded
27:     private Money purchasePrice;
28: 
29: 
30:     public Item(UUID itemId, String name, String description, Float size, Money purchasePrice, Money sellPrice) {
31:         super(itemId, sellPrice);
32: 
33:         if (name == null || name.isEmpty() || description == null || description.isEmpty() || itemId == null || purchasePrice == null
34:                 || purchasePrice.getAmount() <= 0 || sellPrice == null || sellPrice.getAmount() <= purchasePrice.getAmount() )  {
35:             throw new ShopException("Invalid item data");
36:         }
37: 
38:         this.name = name;
39:         this.description = description;
40:         this.size = size;
41:         this.purchasePrice = purchasePrice;
42:     }
43: 
44: }
45: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\ItemRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.item.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.UUID;
6: 
7: public interface ItemRepository extends CrudRepository <Item, UUID> {
8:     Item findByItemId(UUID itemId);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.http.ResponseEntity;
4: import org.springframework.transaction.annotation.Transactional;
5: import org.springframework.util.StringUtils;
6: import org.springframework.web.bind.annotation.*;
7: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
8: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
9: 
10: import java.util.*;
11: @RestController
12: @RequestMapping
13: @Transactional
14: public class OrderController {
15:     OrderRepository orderRepository;
16:     OrderService orderService;
17: 
18:     public OrderController(OrderRepository orderRepository){
19:         this.orderRepository= orderRepository;
20:     }
21: 
22:     @GetMapping("/orders")
23:     public ResponseEntity<List<OrderDto>> getOrdersByMail(
24:             @RequestParam(value = "email", required = false) String email,
25:             @RequestParam(value = "filter",  required = false) String filter) {
26:         List<OrderDto> orderDtos = new ArrayList<>();
27: 
28:         if (StringUtils.isEmpty(email)) {
29:             return ResponseEntity.ok(orderDtos);
30:         }
31: 
32:         List<Order> orders = orderRepository.findByCustomerEmailEmailString(email);
33: 
34:         if (Objects.equals(filter, "latest")) {
35:             if (orders == null || orders.isEmpty())
36:             {
37:                 return ResponseEntity.ok(orderDtos);
38:             }
39:             orders = List.of(orderRepository.findFirstByCustomerEmailEmailStringOrderBySubmissionDateDesc(email));
40:         }
41:         List<OrderDto> allOrderDtos = new ArrayList<>();
42:         for (Order order: orders){
43:             allOrderDtos.add(OrderDtoMapperService.mapToDto(order));
44:         }
45: 
46:         return ResponseEntity.ok(allOrderDtos);
47:     }
48: 
49: /*
50:     //Create
51:     @PostMapping("/orders")
52:     public ResponseEntity<OrderDto> createOrder(@RequestAttribute OrderDto orderDto){
53: 
54: 
55:         Order order= orderService.createOrderFromDto(orderDto);
56:         for(OrderPart orderPart: orderDto.getOrderParts()){
57:             shoppingCartService.addItemToShoppingCart(order.getCustomer().getEmail(),orderPart.getItem().getItemId(),orderPart.getQuantity());
58:         }
59:         shoppingCartService.checkout(order.getCustomer().getEmail());
60:         URI returnUri = ServletUriComponentsBuilder.fromCurrentRequest().path("/id")
61:                         .buildAndExpand(order.getOrderId()).toUri();
62:         OrderDto createdOrderDto = OrderDtoMapper.mapToDto(order);
63:         return ResponseEntity.created(returnUri).body(createdOrderDto);
64:     }
65: 
66:  */
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderCustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
5: import thkoeln.archilab.ecommerce.usecases.CustomerType;
6: 
7: public interface OrderCustomerService {
8:     AbstractCustomer findByEmail(Email email);
9:     AbstractCustomer findByEmailEmailString(String email);
10: 
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: import lombok.AllArgsConstructor;
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
9: 
10: import java.sql.Date;
11: import java.time.LocalDate;
12: import java.time.LocalDateTime;
13: import java.util.ArrayList;
14: import java.util.List;
15: import java.util.UUID;
16: 
17: @Getter
18: @Setter
19: @NoArgsConstructor
20: @AllArgsConstructor
21: public class OrderDto {
22:     private UUID id;
23:     private Email email;
24:     private Money price;
25:     private List<OrderPartDto> orderParts;
26:     private LocalDateTime submissionDate;
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
6: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
7: 
8: import java.util.ArrayList;
9: import java.util.List;
10: @Service
11: public class OrderDtoMapperService {
12:     @Autowired
13:     OrderCustomerService orderCustomerService;
14: 
15:     public static OrderDto mapToDto(Order order) {
16: 
17:         OrderDto orderDto = new OrderDto();
18:         orderDto.setId(order.getOrderId());
19: 
20:         orderDto.setEmail(order.getCustomer().getEmail());
21:         orderDto.setPrice(order.getMoney());
22:         /*List<OrderPartDto> orderPartDtos =  order.getOrderParts().stream()
23:                         .map(orderPart -> new OrderPartDto(orderPart.getItem().getItemId(),orderPart.getQuantity(),orderPart.getComment()))
24:                                 .collect(Collectors.toList());
25: 
26:          */
27:         List<OrderPartDto> orderPartDtos= mapOrderPartsToDto(order.getOrderParts());
28: 
29:         orderDto.setOrderParts(orderPartDtos);
30:         orderDto.setSubmissionDate(order.getSubmissionDate());
31: 
32: 
33:         return orderDto;
34:     }
35: /*
36:     public static Order mapToEntity(OrderDto orderDto) {
37:         UUID orderId = orderDto.getId();
38:         Customer customer= customerRepository.findByEmail_EmailAsString(orderDto.getEmailString());
39:         Money money = new Money(orderDto.getMoneyAmount(),"");
40:         List<OrderPart> orderParts = orderDto.getOrderParts();
41: 
42:         return new Order(orderId, orderParts, customer, money,orderDto.getSubmissionDate());
43:     }
44: 
45: 
46:  */
47:     public static List<OrderPartDto> mapOrderPartsToDto(List<OrderPart> orderParts) {
48:         List<OrderPartDto> orderPartDtos = new ArrayList<>();
49:         for (OrderPart orderPart : orderParts) {
50:             OrderPartDto orderPartDto = new OrderPartDto(
51:                     orderPart.getItem().getItemId(),
52:                     orderPart.getQuantity(),
53:                     orderPart.getComment()
54:             );
55:             orderPartDtos.add(orderPartDto);
56:         }
57:         return orderPartDtos;
58:     }
59: }
60: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderExceptions.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: 
4: public class OrderExceptions {
5: }
6: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: @Getter
10: @Setter
11: @NoArgsConstructor
12: @AllArgsConstructor
13: public class OrderPartDto {
14:     private UUID itemId;
15:     private int quantity;
16:     private String comment;
17: }
18: 
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
9: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
10: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
11: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPartRepository;
12: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
13: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
14: 
15: import java.sql.Date;
16: import java.time.LocalDate;
17: import java.time.LocalDateTime;
18: import java.util.ArrayList;
19: import java.util.List;
20: import java.util.UUID;
21: @Service
22: public class OrderService {
23: 
24:     @Autowired
25:     private ShoppingCartRepository shoppingCartRepository;
26:     @Autowired
27:     private OrderPartRepository orderPartRepository;
28:     @Autowired
29:     private OrderRepository orderRepository;
30:     @Autowired
31:     private OrderCustomerService orderCustomerService;
32: /*
33:     public Order createOrderFromDto(OrderDto orderDto){
34:         Order order = OrderDtoMapper.mapToEntity(orderDto);
35:         orderRepository.save(order);
36:         return order;
37:     }
38: 
39:  */
40: 
41:     public void instantiateOrder(Email email, Money money) {
42:         Order order = new Order(UUID.randomUUID(), new ArrayList<>(), orderCustomerService.findByEmailEmailString(email.getEmailString()), money, LocalDateTime.now());
43:         orderRepository.save(order);
44:     }
45: 
46: 
47:     public void persistOrder(Email email, Money money, List<ShoppingCartPart> usersList) {
48:         List<OrderPart> orderParts = new ArrayList<>();
49:         Order order = new Order(UUID.randomUUID(), new ArrayList<>(), orderCustomerService.findByEmailEmailString(email.getEmailString()), money,LocalDateTime.now());
50:         for (ShoppingCartPart item : usersList) {
51:             UUID id = UUID.randomUUID();
52:             OrderPart part = new OrderPart(id, item.getItem(), item.getEmail(), item.getQuantity(),"");
53: 
54:             orderPartRepository.save(part);
55:             orderParts.add(part);
56: 
57:         }
58:         orderRepository.save(order);
59: 
60:     }
61: 
62: 
63: }
64: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderShoppingService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
9: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
10: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
11: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
12: import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPartRepository;
13: import thkoeln.archilab.ecommerce.solution.shoppingcart.application.ShoppingOrderService;
14: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
15: 
16: import java.sql.Date;
17: import java.time.LocalDate;
18: import java.time.LocalDateTime;
19: import java.util.*;
20: 
21: 
22: @Service
23: public class OrderShoppingService implements ShoppingOrderService {
24:     OrderRepository orderRepository;
25:     OrderPartRepository orderPartRepository;
26:     OrderCustomerService orderCustomerService;
27: 
28:     @Autowired
29:     public OrderShoppingService(OrderRepository orderRepository, OrderPartRepository orderPartRepository, OrderCustomerService orderCustomerService){
30:         this.orderRepository=orderRepository;
31:         this.orderPartRepository=orderPartRepository;
32:         this.orderCustomerService=orderCustomerService;
33:     }
34: 
35: 
36:     @Override
37:     public void instantiateOrder(Email email, Money money) {
38:         if(orderRepository.findByCustomerEmailEmailString(email.getEmailString())==null){
39:             Order order = new Order(UUID.randomUUID(),new ArrayList<>()
40:                     ,orderCustomerService.findByEmailEmailString(email.getEmailString()),money, LocalDateTime.now());
41:             orderRepository.save(order);
42:         }
43:     }
44: 
45:     @Override
46:     public void persistOrder(Email email, Money money, List<ShoppingCartPart> usersList) {
47:         List<OrderPart> orderParts = new ArrayList<>();
48:         Order order = new Order(UUID.randomUUID(), orderParts, orderCustomerService.findByEmail(email), money,LocalDateTime.now());
49:         for (ShoppingCartPart item : usersList) {
50:             UUID id = UUID.randomUUID();
51:             OrderPart part = new OrderPart(id, item.getItem(), item.getEmail(), item.getQuantity(),item.getComment());
52: 
53:             orderPartRepository.save(part);
54:             orderParts.add(part);
55: 
56:         }
57:         orderRepository.save(order);
58: 
59:     }
60: 
61:     @Override
62:     public Map<UUID,Integer> getOrderParts(Email email) {
63:         Map<UUID,Integer> history= new HashMap<>();
64:         List<Order> orders = orderRepository.findByCustomerEmailEmailString(email.getEmailString());
65:         for(Order order: orders){
66:             List<OrderPart> userOrders = order.getOrderParts();
67:             for(OrderPart orderPart : userOrders){
68:                 int count = history.getOrDefault(orderPart.getItem().getItemId(), 0);
69:                 history.put(orderPart.getItem().getItemId(), count + orderPart.getQuantity());
70:             }
71:         }
72:         return history;
73:     }
74: 
75:     @Override
76:     public void deleteAll() {
77:         orderRepository.deleteAll();
78:     }
79: 
80: 
81: }
82: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1:     package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3:     import lombok.Generated;
4:     import lombok.Getter;
5:     import lombok.Setter;
6:     import thkoeln.archilab.ecommerce.ShopException;
7:     import thkoeln.archilab.ecommerce.domainprimitives.Email;
8:     import thkoeln.archilab.ecommerce.domainprimitives.Money;
9:     import thkoeln.archilab.ecommerce.solution.orderpart.domain.OrderPart;
10: 
11: 
12:     import java.sql.Date;
13:     import java.time.LocalDateTime;
14:     import java.util.List;
15:     import java.util.UUID;
16: 
17: 
18:     import lombok.NoArgsConstructor;
19:     import org.dom4j.tree.AbstractEntity;
20:     import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractCustomer;
21: 
22:     import javax.persistence.*;
23: 
24:     @Getter
25:     @NoArgsConstructor
26:     @Entity
27:     @Table(name = "TabelleOrder")
28:     public class Order extends AbstractEntity {
29: 
30:         @Id
31:         private UUID orderId;
32: 
33:         @OneToMany
34:         @JoinColumn(name = "order_id")
35:         @Setter
36:         private List<OrderPart> orderParts;
37:         @Setter
38:         @ManyToOne(cascade = CascadeType.REMOVE)
39:         private AbstractCustomer customer;
40:         @Embedded
41:         @Setter
42:         private Money money;
43:         private LocalDateTime submissionDate;
44: 
45: 
46:         // Weitere Attribute der Bestellung (z. B. Datum, Kunde, Versandinformationen) können hier hinzugefügt werden
47: 
48:         public Order(UUID orderId, List<OrderPart> orderParts,AbstractCustomer customer, Money money, LocalDateTime submissionDate) {
49:             this.orderId = orderId;
50:             this.orderParts = orderParts;
51:             this.customer =customer;
52:             this.money=money;
53:             this.submissionDate=submissionDate;
54:         }
55:         public void setOrderId(UUID itemId) {
56:             if (this.orderId != null) {
57:                 throw new ShopException("OrderId can´t be changed");
58:             }
59:             this.orderId = itemId;
60:         }
61:     }
62: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import org.yaml.snakeyaml.events.Event;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: 
8: import java.util.List;
9: import java.util.UUID;
10: @Repository
11: public interface OrderRepository extends CrudRepository<Order, Event.ID> {
12:     List<Order> findByCustomerEmailEmailString(String email);
13:     Order findByOrderId(UUID uuid);
14:     Order findFirstByCustomerEmailEmailStringOrderBySubmissionDateDesc(String email);
15: 
16: }
17: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\application\OrderPartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.orderpart.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
9: 
10: import javax.persistence.Embedded;
11: 
12: @Getter
13: @Setter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class OrderPartDto {
17:     private AbstractItem item;
18:     private Email email;
19:     private Integer quantity;
20: 
21: 
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\domain\OrderPart.java ---
1: package thkoeln.archilab.ecommerce.solution.orderpart.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import org.dom4j.tree.AbstractEntity;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
10: 
11: import javax.persistence.*;
12: import java.util.UUID;
13: @Getter
14: @NoArgsConstructor
15: @Entity
16: public class OrderPart extends AbstractEntity {
17:     @Id
18:     private UUID orderPartId;
19:     @Setter
20:     @OneToOne
21:     private AbstractItem item;
22:     @Setter
23:     @Embedded
24:     private Email email;
25:     @Setter
26:     private Integer quantity;
27:     @Setter
28:     private String comment;
29: 
30: 
31:     public OrderPart(UUID orderPartId, AbstractItem item, Email email,  Integer quantity, String comment){
32: 
33:         this.orderPartId=orderPartId;
34:         this.item = item;
35:         this.email=email;
36:         this.quantity=quantity;
37:         this.comment=comment;
38:     }
39:     public void setOrderPartId(UUID itemId) {
40:         if (this.orderPartId != null) {
41:             throw new ShopException("OrderId can´t be changed");
42:         }
43:         this.orderPartId = itemId;
44:     }
45: }
46: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\orderpart\domain\OrderPartRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.orderpart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.yaml.snakeyaml.events.Event;
5: 
6: 
7: public interface OrderPartRepository extends CrudRepository<OrderPart, Event.ID> {
8: 
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentCustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: 
6: public interface PaymentCustomerService {
7:     CustomerType findByEmail(Email email);
8: 
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
9: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
11: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
14: 
15: import java.util.List;
16: import java.util.UUID;
17: 
18: @Service
19: public class PaymentService implements PaymentUseCases {
20:     @Autowired
21:     PaymentRepository paymentRepository;
22:     @Autowired
23:     PaymentCustomerService paymentCustomerService;
24: 
25:     @Override
26:     public UUID authorizePayment(EmailType customerEmail, MoneyType amount) {
27:         if (customerEmail == null ||  amount == null ) {
28:             throw new ShopException("Invalid payment data");
29:         }
30:         if( amount.getAmount() <= 0.0f || amount.getAmount() > 500.00){
31:             System.out.println("amount:"+amount.getAmount());
32:             throw new ShopException("Invalid payment amount");
33:         }
34:         Email email = (Email) Email.of(customerEmail.toString());
35:         if (paymentCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");
36: 
37:         Money money = new Money(amount.getAmount(), amount.getCurrency());
38:         Payment payment = new Payment(UUID.randomUUID(), email, money);
39: 
40:         //ein unbezahltes Payment wird ersetzt
41:         //if(paymentRepository.findByEmailAndPayed(customerEmail,false)==null){
42:         paymentRepository.save(payment);
43:         return UUID.randomUUID();
44:     }
45: 
46:     @Override
47:     public MoneyType getPaymentTotal(EmailType customerEmail) {
48:         Email email = (Email) Email.of(customerEmail.toString());
49: 
50:         if (customerEmail.toString().isEmpty()) throw new ShopException("Email nicht vorhanden");
51:         if (paymentCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");
52: 
53:         List<Payment> payments = paymentRepository.findAllByEmail(email);
54:         float totalPaymentAmount = 0.0f;
55:         for (Payment payment : payments) {
56:             totalPaymentAmount += payment.getMoney().getAmount();
57:         }
58: 
59:         return new Money(totalPaymentAmount,payments.get(0).getMoney().getCurrency());
60:     }
61: 
62: 
63:     @Override
64:     public void deletePaymentHistory() {
65:         paymentRepository.deleteAll();
66:     }
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import org.dom4j.tree.AbstractEntity;
7: import org.springframework.beans.factory.annotation.Autowired;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.domainprimitives.Email;
10: import thkoeln.archilab.ecommerce.domainprimitives.Money;
11: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
12: 
13: import javax.persistence.*;
14: import java.util.UUID;
15: 
16: @NoArgsConstructor
17: @Getter
18: @Entity
19: public class Payment extends AbstractEntity {
20: 
21:     @Id
22:     private UUID paymentId;
23:     private Email email;
24:     @Setter
25:     @Embedded
26:     private Money money;
27:     @Setter
28:     @Column(columnDefinition = "boolean default false")
29:     private Boolean payed;
30: 
31:     public Payment(UUID paymentId, Email email, Money money){
32:         if (paymentId == null ||  email == null || money.getAmount() == null ) {
33:             throw new ShopException("Invalid payment data");
34:         }
35:         this.paymentId = paymentId;
36:         this.email = email;
37:         this.money= new Money(money.getAmount(), money.getCurrency());
38:         this.payed = false;
39:     }
40:     public void setPaymentId(UUID itemId) {
41:         if (this.paymentId != null) {
42:             throw new ShopException("PaymentId can´t be changed");
43:         }
44:         this.paymentId = itemId;
45:     }
46: }
47: 
48: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
10:     Payment findByPaymentId(UUID paymentId);
11:     List<Payment> findAllByEmail(Email email);
12:     Payment findByEmailAndPayed(Email email,Boolean payed);
13: 
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.http.ResponseEntity;
5: import org.springframework.web.bind.annotation.*;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;
8: 
9: import java.util.List;
10: import java.util.Optional;
11: import java.util.UUID;
12: import java.util.stream.Collectors;
13: 
14: @RestController
15: @RequestMapping
16: public class ShoppingCartController {
17: 
18:     private final ShoppingCartService shoppingCartService;
19:     ShoppingCartRepository shoppingCartRepository;
20:     ShoppingCustomerService shoppingCustomerService;
21:     ShoppingCartPartRepository shoppingCartPartRepository;
22:     ShoppingItemService shoppingItemService;
23:     ShoppingCartItemDtoMapperService shoppingCartItemDtoMapperService;
24: 
25: 
26:     public ShoppingCartController(ShoppingCartService shoppingCartService, ShoppingCartRepository shoppingCartRepository
27:             ,ShoppingCustomerService shoppingCustomerService, ShoppingCartPartRepository shoppingCartPartRepository
28:             ,ShoppingItemService shoppingItemService, ShoppingCartItemDtoMapperService shoppingCartItemDtoMapperService         ) {
29:         this.shoppingCartService = shoppingCartService;
30:         this.shoppingCartRepository= shoppingCartRepository;
31:         this.shoppingCustomerService = shoppingCustomerService;
32:         this.shoppingCartPartRepository = shoppingCartPartRepository;
33:         this.shoppingItemService=shoppingItemService;
34:         this.shoppingCartItemDtoMapperService = shoppingCartItemDtoMapperService;
35: 
36:     }
37: 
38:     @GetMapping("/shoppingCarts")
39:     public ResponseEntity<ShoppingCartDto> getShoppingCartsByEmail(@RequestParam(value = "email",required = false) String email) {
40: 
41:             Optional<ShoppingCart> optionalShoppingCart = Optional.ofNullable(shoppingCartRepository.findByCustomerEmailEmailString(email));
42:             if (optionalShoppingCart.isPresent()) {
43:                 ShoppingCart shoppingCart = optionalShoppingCart.get();
44:                 ShoppingCartDto shoppingCartDto = ShoppingCartDtoMapperService.mapToDto(shoppingCart);
45:                 return ResponseEntity.ok(shoppingCartDto);
46:             } else {
47:                 return ResponseEntity.notFound().build();
48:             }
49: 
50:     }
51: 
52:     @GetMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts/{itemId}")
53:     public ResponseEntity<ShoppingCartItemDto> getShoppingCartItem(
54:             @PathVariable("shoppingCartId") UUID shoppingCartId,
55:             @PathVariable("itemId") UUID itemId) {
56:         ShoppingCart shoppingCart= shoppingCartRepository.findByShoppingCartId(shoppingCartId);
57: 
58:         if (shoppingCart!=null) {
59: 
60:             Optional<ShoppingCartPart> optionalShoppingCartPart = shoppingCart.getShoppingCartItems().stream()
61:                     .filter(item -> item.getItem().getItemId().equals(itemId))
62:                     .findFirst();
63: 
64:             if (optionalShoppingCartPart.isPresent()) {
65:                 ShoppingCartPart shoppingCartPart = optionalShoppingCartPart.get();
66:                 ShoppingCartItemDto shoppingCartItemDto = new ShoppingCartItemDto(
67:                         shoppingCartPart.getItem().getItemId(),
68:                         shoppingCartPart.getQuantity(),
69:                         shoppingCartPart.getComment()
70:                 );
71:                 if(shoppingCartPart.getQuantity()==null||shoppingCartPart.getComment()==null)return ResponseEntity.notFound().build();
72:                 return ResponseEntity.ok(shoppingCartItemDto);
73:             }
74:         }
75:         return ResponseEntity.notFound().build();
76:     }
77: 
78: 
79: 
80:     @PostMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts")
81:     public ResponseEntity<Void> addOrUpdateShoppingCartPart(
82:             @PathVariable("shoppingCartId") UUID shoppingCartId,
83:             @RequestBody ShoppingCartItemDto shoppingCartItemDto) {
84:         ShoppingCartPart shoppingCartPart = shoppingCartItemDtoMapperService.mapToEntity(shoppingCartItemDto,shoppingCartId);
85:         ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
86:         if(shoppingCart!=null){
87:             try {
88:                 shoppingCartService.updateItemInShoppingCart(shoppingCart.getCustomer().getEmail(),
89:                         shoppingCartPart.getItem().getItemId(), shoppingCartPart.getQuantity(), shoppingCartPart.getComment());
90:                 return ResponseEntity.status(HttpStatus.CREATED).build();
91:             }catch (ShopException shopException){
92:             shopException.printStackTrace();
93:             return ResponseEntity.status(HttpStatus.CONFLICT).build();
94:             }
95:         }
96:         return ResponseEntity.notFound().build();
97: 
98:     }
99: 
100:     @DeleteMapping("/shoppingCarts/{shoppingCartId}/shoppingCartParts/{itemId}")
101:     public ResponseEntity<Void> removeShoppingCartPart(
102:             @PathVariable("shoppingCartId") UUID shoppingCartId,
103:             @PathVariable("itemId") UUID itemId) {
104:         ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
105:         if (shoppingCart != null) {
106:             String email = shoppingCart.getCustomer().getEmail().getEmailString();
107:             List<ShoppingCartPart> deletedList = shoppingCart.getShoppingCartItems();
108:             boolean bool = deletedList.stream().anyMatch(shoppingCartPart -> shoppingCartPart.getItem().getItemId().equals(itemId));
109:             if (!bool) return ResponseEntity.notFound().build();
110: 
111:             List<ShoppingCartPart> newList = deletedList.stream().filter(shoppingCartPart -> !shoppingCartPart.getItem().getItemId().equals(itemId)).collect(Collectors.toList());
112:             shoppingCart.setShoppingCartItems(newList);
113:             shoppingCartRepository.findByShoppingCartId(shoppingCartId).setTotalQuantity(
114:                     shoppingCartRepository.findByShoppingCartId(shoppingCartId).getTotalQuantity() -
115:                             shoppingCartPartRepository.findByEmailEmailStringAndItem(
116:                                     email, shoppingItemService.findByItemId(itemId)).getQuantity());
117:             shoppingCartRepository.findByShoppingCartId(shoppingCartId).setShoppingCartItems(newList);
118: 
119:             return ResponseEntity.ok().build();
120: 
121:         }
122:         return ResponseEntity.notFound().build();
123:     }
124: 
125:     @PutMapping("/shoppingCarts/{shoppingCartId}/checkout")
126:     public ResponseEntity<Void> checkoutShoppingCart(@PathVariable("shoppingCartId") UUID shoppingCartId) {
127: 
128:         ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
129:         if(shoppingCart==null) return ResponseEntity.notFound().build();
130:         if(shoppingCart.getShoppingCartItems().isEmpty()){
131:             return ResponseEntity.status(HttpStatus.CONFLICT).build();
132:         }
133:         try{
134:             shoppingCartService.checkout(shoppingCart.getCustomer().getEmail());
135:             return ResponseEntity.ok().build();
136:         }catch (ShopException shopException){
137:             shopException.printStackTrace();
138:             return ResponseEntity.status(HttpStatus.CONFLICT).build();
139:         }
140: 
141:     }
142: }
143: 
144: 
145: 
146:     /*
147: @RestController
148: @Transactional
149: public class ShoppingCartController {
150:     private ShoppingCartRepository shoppingCartRepository;
151:     private ShoppingCartDtoMapper shoppingCartDtoMapper;
152:     private ShoppingCartService shoppingCartService;
153: 
154:     @Autowired
155:     public ShoppingCartController(ShoppingCartRepository shoppingCartRepository) {
156:         this.shoppingCartRepository = shoppingCartRepository;
157:         this.shoppingCartDtoMapper = new ShoppingCartDtoMapper();
158:     }
159: 
160: 
161:     // Get all shopping carts
162:     @GetMapping("/shoppingCarts")
163:     public Iterable<ShoppingCartDto> getAllShoppingCarts() {
164:         Iterable<ShoppingCart> allShoppingCarts = shoppingCartRepository.findAll();
165:         List<ShoppingCartDto> allShoppingCartDtos = new ArrayList<>();
166:         for (ShoppingCart shoppingCart : allShoppingCarts) {
167:             allShoppingCartDtos.add(shoppingCartDtoMapper.mapToDto(shoppingCart));
168:         }
169:         return allShoppingCartDtos;
170:     }
171: 
172:     // Get one shopping cart
173:     @GetMapping("/shoppingCarts/{shoppingCart-id}")
174:     public ShoppingCartDto getOneShoppingCart(@PathVariable("shoppingCart-id") UUID id) {
175:         ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(id);
176:         ShoppingCartDto shoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
177:         return shoppingCartDto;
178:     }
179:     @GetMapping("/shoppingCarts?email")
180:     public ShoppingCartDto getOneShoppingCart(@RequestParam("email") String emailString) {
181:         Email email = (Email) Email.of(emailString);
182:         ShoppingCart shoppingCart = shoppingCartRepository.findByEmail(email);
183:         ShoppingCartDto shoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
184:         return shoppingCartDto;
185:     }
186:     // Create shopping cart
187:     @PostMapping("/shoppingCarts")
188:     public ResponseEntity<ShoppingCartDto> createShoppingCart(@RequestBody ShoppingCartDto shoppingCartDto) {
189:         ShoppingCart shoppingCart = shoppingCartService.createShoppingCartFromDto(shoppingCartDto);
190:         URI returnUri = ServletUriComponentsBuilder.fromCurrentRequest().path("/{shoppingCart-id}")
191:                 .buildAndExpand(shoppingCart.getShoppingCartId()).toUri();
192:         ShoppingCartDto createdShoppingCartDto = shoppingCartDtoMapper.mapToDto(shoppingCart);
193:         return ResponseEntity.created(returnUri).body(createdShoppingCartDto);
194:     }
195:     // Delete shopping cart part for an item
196:     @DeleteMapping("/shoppingCarts/{cartId}/shoppingCartParts/{itemId}")
197:     public ResponseEntity<?> deleteShoppingCartPart(
198:             @PathVariable UUID cartId,
199:             @PathVariable UUID itemId
200:     ) {
201:         // Handle shopping cart part deletion logic here
202:         List<ShoppingCartItem> deletedList= shoppingCartRepository.findByShoppingCartId(cartId).getShoppingCartItems();
203:         deletedList.remove(itemId);
204:         shoppingCartRepository.findByShoppingCartId(cartId).setShoppingCartItems(deletedList);
205:         return ResponseEntity.noContent().build();
206:     }
207: 
208:     // Add/remove quantity of items to a shopping cart
209:     @PostMapping("/shoppingCarts/{cartId}/shoppingCartParts")
210:     public ResponseEntity<ShoppingCartDto> updateShoppingCart(
211:             @PathVariable UUID cartId,
212:             @RequestParam UUID itemId,
213:             @RequestParam Integer quantity,
214:             @RequestParam(required = false) String comment
215:     ) {
216:         // Handle add/remove quantity logic here
217:         ShoppingCart updatedShoppingCart = shoppingCartService.updateShoppingCart(cartId, itemId, quantity, comment);
218:         ShoppingCartDto updatedShoppingCartDto = shoppingCartDtoMapper.mapToDto(updatedShoppingCart);
219:         return ResponseEntity.ok(updatedShoppingCartDto);
220:     }
221: 
222:  */
223: 
224: 
225: 
226: 
227: 
228: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import com.fasterxml.jackson.annotation.JsonProperty;
4: import lombok.AllArgsConstructor;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import lombok.Setter;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: 
10: import java.util.UUID;
11: 
12: @Getter
13: @Setter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class ShoppingCartDto {
17:     private UUID id;
18:     @JsonProperty
19:     private Email emailString;
20:     private Integer totalQuantity;
21: }
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDtoMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
8: 
9: import java.util.*;
10: @Service
11: public class ShoppingCartDtoMapperService {
12:     @Autowired
13:     ShoppingCartRepository shoppingCartRepository;
14: 
15: 
16:     public static ShoppingCartDto mapToDto(ShoppingCart shoppingCart) {
17:         ShoppingCartDto shoppingCartDto = new ShoppingCartDto();
18:         shoppingCartDto.setId(shoppingCart.getShoppingCartId());
19:         shoppingCartDto.setEmailString(shoppingCart.getCustomer().getEmail());
20:         shoppingCartDto.setTotalQuantity(shoppingCart.getTotalQuantity());
21:         return shoppingCartDto;
22: 
23:     }
24: 
25:     public ShoppingCart mapToEntity(ShoppingCartDto shoppingCartDto) {
26:         UUID shoppingCartId = shoppingCartDto.getId();
27:         Email email = shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer().getEmail();
28:         Integer totalQuantity = shoppingCartDto.getTotalQuantity();
29:         return new ShoppingCart(shoppingCartId, shoppingCartRepository.findByShoppingCartId(shoppingCartId).getShoppingCartItems(),
30:                 shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer(), totalQuantity);
31: 
32:     }
33: 
34: 
35: 
36: 
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartExistsExeption.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.UNPROCESSABLE_ENTITY, reason = "ShoppingCartID already exists")
8: public class ShoppingCartExistsExeption extends ShopException {
9: 
10:     public ShoppingCartExistsExeption(String message) {
11:         super(message);
12:     }
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartItemDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: 
9: import java.util.UUID;
10: @Getter
11: @Setter
12: @NoArgsConstructor
13: @AllArgsConstructor
14: public class ShoppingCartItemDto {
15:     private UUID itemId;
16:     private int quantity;
17:     private String comment;
18: 
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartItemDtoMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
6: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
7: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPartRepository;
8: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
9: 
10: import java.util.UUID;
11: @Service
12: public class ShoppingCartItemDtoMapperService {
13:     @Autowired
14:     ShoppingItemService shoppingItemService;
15:     @Autowired
16:     ShoppingCartRepository shoppingCartRepository;
17:     @Autowired
18:     ShoppingCartPartRepository shoppingCartPartRepository;
19: 
20: 
21: 
22:     public ShoppingCartItemDto mapToDto(ShoppingCartPart item, UUID shoppingCartId) {
23:         ShoppingCart shoppingCart = shoppingCartRepository.findByShoppingCartId(shoppingCartId);
24:         Integer quantity = 0;
25:         String comment = "";
26:         for(ShoppingCartPart shoppingCartItem: shoppingCart.getShoppingCartItems()){
27:             if(shoppingCartItem.getItem().getItemId()==item.getItem().getItemId()){
28:                 quantity = shoppingCartItem.getQuantity();
29:                 comment = shoppingCartItem.getComment();
30:                 return new ShoppingCartItemDto(item.getShoppingCartItemId(),quantity,comment);
31:             }
32:         }
33:         return null;
34: 
35:     }
36: 
37:     public ShoppingCartPart mapToEntity(ShoppingCartItemDto dto, UUID shoppingCartId) {
38:         // Da `ShoppingCartItemId` von der `ShoppingCartItem`-Klasse festgelegt wird und nicht vom DTO,
39:         // wird der `ShoppingCartItem` direkt erstellt, ohne die ID im Konstruktor zu setzen.
40:         ShoppingCartPart shoppingCartPart = new ShoppingCartPart(UUID.randomUUID()
41:                                     , shoppingItemService.findByItemId(dto.getItemId())
42:                                     , shoppingCartRepository.findByShoppingCartId(shoppingCartId).getCustomer().getEmail()
43:                                     , dto.getQuantity()
44:                                     , dto.getComment());
45:         return shoppingCartPart;
46:     }
47: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
11: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
12: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;
13: import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
16: 
17: import java.util.*;
18: 
19: @Service
20: public class ShoppingCartService implements ShoppingCartUseCases {
21: 
22:     @Autowired
23:     ShoppingCustomerService shoppingCustomerService;
24:     @Autowired
25:     ShoppingItemService shoppingItemService;
26:     @Autowired
27:     ShoppingInventoryService shoppingInventoryService;
28:     @Autowired
29:     ShoppingCartPartRepository shoppingCartPartRepository;
30:     @Autowired
31:     ShoppingCartRepository shoppingCartRepository;
32:     @Autowired
33:     PaymentRepository paymentRepository;
34:     @Autowired
35:     PaymentService paymentService;
36:     @Autowired
37:     ShoppingDeliveryService shoppingDeliveryService;
38:     @Autowired
39:     ShoppingOrderService shoppingOrderService;
40:     @Autowired
41:     ShoppingCartDtoMapperService shoppingCartDtoMapperService;
42: 
43: 
44:     public ShoppingCart createShoppingCartFromDto(ShoppingCartDto shoppingCartDto){
45:         ShoppingCart shoppingCart = shoppingCartDtoMapperService.mapToEntity(shoppingCartDto);
46:         shoppingCartPartRepository.saveAll(shoppingCart.getShoppingCartItems());
47:         shoppingCartRepository.save(shoppingCart);
48:         return shoppingCart;
49:     }
50: 
51:     public void updateItemInShoppingCart(EmailType customerEmail, UUID itemId, int quantity, String comment) {
52:         AbstractItem item = shoppingItemService.findByItemId(itemId);
53:         Email email = (Email) customerEmail;
54:         if(quantity>0){
55:             if(shoppingInventoryService.getQuantity(item)<quantity){
56:                 adjustInventory(itemId,shoppingInventoryService.getQuantity(item)+getReservedInventoryInShoppingCarts(itemId));
57:             }
58:             addItemToShoppingCart(customerEmail,itemId,quantity);
59:         }
60:         else {
61:             removeItemFromShoppingCart(customerEmail, itemId, -quantity);
62:         }
63:         if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(),item)!=null){
64:             shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(),item).setComment(comment);
65:         }
66: 
67: 
68:     }
69: 
70:     @Override
71:     public void addItemToShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
72:         Email email = (Email) customerEmail;
73: 
74:         if (shoppingCustomerService.findByEmail(email) == null) {
75:             throw new ShopException("Email nicht vorhanden");
76:         }
77:         if(shoppingItemService.findByItemId(itemId)==null){
78:             throw new ShopException(("Item nicht vorhanden"));
79:         }
80:         if(quantity<0){
81:             throw new ShopException(("keine negativen Mengen"));
82:         }
83: 
84:         if(quantity> shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId))){
85:             System.out.println(shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId))+"sindvorhanden");
86:             throw new ShopException("Nicht genügend vorhanden");
87:         }
88: 
89: 
90:         int currentInventory = shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId));
91:         shoppingInventoryService.setQuantity(shoppingItemService.findByItemId(itemId),currentInventory-quantity);
92: 
93:         if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
94:             UUID id = UUID.randomUUID();
95:             ShoppingCartPart shoppingCartItem = new ShoppingCartPart(id, shoppingItemService.findByItemId(itemId),email,quantity,"dummy");
96:             shoppingCartPartRepository.save(shoppingCartItem);
97:             System.out.println("addedItemIF:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
98:             List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
99:             ShoppingCartPart itemAfter = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
100:             shoppingCartItems.add(itemAfter);
101:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
102:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository
103:                     .findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()+quantity);
104:         }
105:         else {
106:             ShoppingCartPart oldPart = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
107:             int existingQuantity = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity();
108:             shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).setQuantity(existingQuantity+quantity);
109:             System.out.println("addedItemElse:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
110:             List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
111:             shoppingCartItems.remove(oldPart);
112:             shoppingCartItems.add(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)));
113:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
114:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository
115:                     .findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()+quantity);
116:         }
117: 
118:     }
119: 
120:     @Override
121:     public void removeItemFromShoppingCart(EmailType customerEmail, UUID itemId, int quantity) {
122:         Email email = (Email) customerEmail;
123: 
124:         ShoppingCartPart shoppingCartItem = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
125: 
126:         if (shoppingCustomerService.findByEmail(email) == null) {
127:             throw new ShopException("Email nicht vorhanden");
128:         }
129:         if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
130:             throw new ShopException("Email und ID nicht vorhanden");
131:         }
132:         if(quantity<0 ){
133:             throw new ShopException("No negative values");
134:         }
135:         if(quantity> shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()){
136:             throw new ShopException("Not enought elements");
137:         }
138: 
139:         int currentInventory = shoppingInventoryService.getQuantity(shoppingItemService.findByItemId(itemId));
140:         List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
141: 
142:         if(quantity== shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()){
143:             shoppingCartItems.remove(shoppingCartItem);
144:             shoppingCartPartRepository.delete(shoppingCartItem);
145:             System.out.println("removeItemIf:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
146:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
147:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()-quantity);
148:             for(ShoppingCartPart part: shoppingCartItems){
149:                 System.out.println("allesimCart:"+part.getItem().getItemId()+" kostet " +shoppingItemService.getSellPrice(part.getItem()).getAmount()+" menge:"+part.getQuantity());
150:             }
151:         }else{
152: 
153:             shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).
154:                     setQuantity(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getQuantity()-quantity);
155:             shoppingInventoryService.setQuantity(shoppingItemService.findByItemId(itemId),currentInventory+quantity);
156:             ShoppingCartPart itemAfter = shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId));
157:             shoppingCartItems.remove(shoppingCartItem);
158:             shoppingCartItems.add(itemAfter);
159:             System.out.println("removeItemElse:"+itemId+"menge::"+quantity+"kostet"+shoppingItemService.getSellPrice(shoppingItemService.findByItemId(itemId)).getAmount());
160:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(shoppingCartItems);
161:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getTotalQuantity()-quantity);
162:             for(ShoppingCartPart part: shoppingCartItems){
163:                 System.out.println("allesimCart:"+part.getItem().getItemId()+" kostet " +shoppingItemService.getSellPrice(part.getItem()).getAmount()+" menge:"+part.getQuantity());
164:             }
165:         }
166: 
167:     }
168:     public void adjustInventory(UUID itemId, int rest) {
169:         List<ShoppingCartPart> itemsList = shoppingCartPartRepository.findAllByItem(shoppingItemService.findByItemId(itemId));
170: 
171:         for(ShoppingCartPart shoppingCartItem: itemsList){
172:             List<ShoppingCartPart> shoppingCartItems = shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).getShoppingCartItems();
173: 
174:             if(shoppingCartItem.getQuantity()>=rest){
175:                 shoppingCartItems.remove(shoppingCartItem);
176:                 shoppingCartItem.setQuantity(shoppingCartItem.getQuantity()-rest);
177:                 shoppingCartItems.add(shoppingCartItem);
178:                 shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setShoppingCartItems(shoppingCartItems);
179:                 shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setTotalQuantity(shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).getTotalQuantity()-rest);
180:                 Integer quantity = shoppingInventoryService.getQuantity(shoppingCartItem.getItem());
181:                 shoppingInventoryService.setQuantity(shoppingCartItem.getItem(),quantity+rest);
182:                 break;
183:             }
184:             else{
185:                 shoppingCartItems.remove(shoppingCartItem);
186:                 shoppingCartPartRepository.delete(shoppingCartItem);
187:                 shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setShoppingCartItems(shoppingCartItems);
188:                 rest-=shoppingCartItem.getQuantity();
189:                 shoppingCartRepository.findByCustomerEmailEmailString(shoppingCartItem.getEmail().getEmailString()).setTotalQuantity(0);
190:                 Integer quantity = shoppingInventoryService.getQuantity(shoppingCartItem.getItem());
191:                 shoppingInventoryService.setQuantity(shoppingCartItem.getItem(),quantity+rest-shoppingCartItem.getQuantity());
192: 
193:             }
194:         }
195:     }
196: 
197:     @Override
198:     public void setCommentForShoppingCartPart(EmailType customerEmail, UUID itemId, String comment) {
199: 
200:         if (customerEmail == null) {
201:             throw new ShopException("customerEmail== null");
202:         }
203:         Email email = (Email) customerEmail;
204:         if (shoppingCustomerService.findByEmail(email) == null) {
205:             throw new ShopException("Email nicht vorhanden");
206:         }
207:         if (shoppingItemService.findByItemId(itemId) == null) {
208:             throw new ShopException("Item existiert nicht");
209:         }
210: 
211:         if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
212:             throw new ShopException("Email und ID nicht vorhanden");
213:         }
214: 
215:         // Setze den Kommentar für das Element im Warenkorb
216:         shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).setComment(comment);
217:     }
218: 
219:     @Override
220:     public String getCommentForShoppingCartPart(EmailType customerEmail, UUID itemId) {
221:         if (customerEmail == null) {
222:             throw new ShopException("customerEmail== null");
223:         }
224:         Email email = (Email) customerEmail;
225:         if (shoppingCustomerService.findByEmail(email) == null) {
226:             throw new ShopException("Email nicht vorhanden");
227:         }
228:         if (shoppingItemService.findByItemId(itemId) == null) {
229:             throw new ShopException("Item existiert nicht");
230:         }
231: 
232:         if(shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId))==null){
233:             throw new ShopException("Email und ID nicht vorhanden");
234:         }
235: 
236:         // Setze den Kommentar für das Element im Warenkorb
237:         return shoppingCartPartRepository.findByEmailEmailStringAndItem(email.getEmailString(), shoppingItemService.findByItemId(itemId)).getComment();
238:     }
239: 
240:     @Override
241:     public Map<UUID, Integer> getShoppingCartAsMap(EmailType customerEmail) {
242:         Email email = (Email) Email.of(customerEmail.toString());
243: 
244:         if (shoppingCustomerService.findByEmail(email) == null) {
245:             throw new ShopException("Email nicht vorhanden");
246:         }
247: 
248:         List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
249:         Map<UUID,Integer> chosen= new HashMap<>();
250:         for (ShoppingCartPart shoppingCartItem : usersList){
251:             //if(i.getEmail().compareTo(customerEmail)==0)
252:             chosen.put(shoppingItemService.getItemId(shoppingCartItem.getItem()),shoppingCartItem.getQuantity());
253:         }
254:         //printing
255:         for (Map.Entry<UUID, Integer> entry : chosen.entrySet()) {
256:             System.out.println("Map: "+ entry.getKey() + ": " + entry.getValue());
257:         }
258: 
259:         return chosen;
260:     }
261: 
262:     @Override
263:     public MoneyType getShoppingCartAsMoneyValue(EmailType customerEmail) {
264:         Email email = (Email) Email.of(customerEmail.toString());
265: 
266:         if (shoppingCustomerService.findByEmail(email) == null) {
267:             throw new ShopException("Email nicht vorhanden");
268:         }
269:         List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
270:         float price= 0.0f;
271: 
272: 
273:         for (ShoppingCartPart shoppingCartItem : usersList){
274:             //Float onePrice = shoppingItemService.findByItemId(item.getItem().getItemId()).getSellPrice().getAmount();
275:             Float onePrice = shoppingItemService.getSellPrice(shoppingCartItem.getItem()).getAmount();
276:             price= price + shoppingCartItem.getQuantity()*onePrice;
277:         }
278:         return new Money(price, shoppingItemService.getSellPrice(usersList.get(0).getItem()).getCurrency());
279:     }
280: 
281:     @Override
282:     public int getReservedInventoryInShoppingCarts(UUID itemId) {
283:         if (shoppingItemService.findByItemId(itemId) == null) {
284:             throw new ShopException("Email nicht vorhanden");
285:         }
286: 
287:         List<ShoppingCartPart> allItems = shoppingCartPartRepository.findAllByItem(shoppingItemService.findByItemId(itemId));
288:         int totalQuantity =0;
289:         for (ShoppingCartPart shoppingCartItem : allItems) {
290:             totalQuantity += shoppingCartItem.getQuantity();
291:         }
292:         return totalQuantity;
293:     }
294: 
295:     @Override
296:     public boolean isEmpty(EmailType customerEmail) {
297: 
298:         Email email = (Email) Email.of(customerEmail.toString());
299: 
300:         if(shoppingCustomerService.findByEmail(email)== null){
301:             throw new ShopException("Email nicht vorhanden");
302:         }
303:         if (shoppingCustomerService.findByEmail(email).getName() == null || shoppingCustomerService.findByEmail(email).getName().isEmpty()
304:                 || shoppingCustomerService.findByEmail(email).getEmail() == null || shoppingCustomerService.findByEmail(email).getAddress() == null ) {
305:             throw new ShopException("Email nicht vollständig");
306:         }
307: 
308:         if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems().isEmpty()){
309:             return true;
310:         }
311:         return false;
312:     }
313: 
314:     public boolean isPaymentAuthorized(Email customerEmail) {
315:         return isPaymentAuthorizedMethod(customerEmail, customerEmail == null);
316:     }
317:     @Override
318:     public boolean isPaymentAuthorized(EmailType customerEmail) {
319:         Email email = (Email) Email.of(customerEmail.toString());
320:         return isPaymentAuthorizedMethod(email, customerEmail == null);
321:     }
322: 
323:     private boolean isPaymentAuthorizedMethod(Email customerEmail, boolean bool) {
324:         if (bool) {
325:             throw new ShopException("Invalid email");
326:         }
327:         if (shoppingCustomerService.findByEmail(customerEmail) == null) {
328:             throw new ShopException("Customer not found");
329:         }
330: 
331:         if (shoppingCartRepository.findByCustomerEmailEmailString(customerEmail.getEmailString()).getShoppingCartItems().isEmpty() ) {
332:             return false;
333:         }
334: 
335:         List<Payment> userPayments= paymentRepository.findAllByEmail(customerEmail);
336:         for(Payment payment: userPayments){
337:             if(payment.getPayed()==false) return true;
338:         }
339: 
340:         return false;
341:     }
342: 
343: 
344: 
345:     @Override
346:     public void checkout(EmailType customerEmail) {
347:         Email email = (Email) Email.of(customerEmail.toString());
348: 
349:         if (shoppingCustomerService.findByEmail(email) == null) throw new ShopException("Email nicht vorhanden");
350:         if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString())==null)throw new ShopException("No ShoppingCart");
351:         if(shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems().isEmpty())throw new ShopException("Empty ShoppingCart");
352:         //shoppingOrderService.instantiateOrder(email, (Money)this.getShoppingCartAsMoneyValue(email));
353: 
354:         paymentService.authorizePayment(email,getShoppingCartAsMoneyValue(email));
355:         if(isPaymentAuthorized(customerEmail)){
356:             //add to delivery Repo
357:                Map<UUID,Integer> deliverableItems = this.getShoppingCartAsMap(customerEmail);
358:             shoppingDeliveryService.triggerDelivery(shoppingCustomerService.findByEmail(email),deliverableItems);
359:             //payment correction
360:             List<Payment> userPayments= paymentRepository.findAllByEmail(email);
361:             for(Payment p: userPayments){
362:                 if(p.getPayed()==false) p.setPayed(true);
363:             }
364: 
365:             //adjust to Order Repo
366:             List<ShoppingCartPart> usersList = shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
367: 
368:             shoppingInventoryService.isOrdered(usersList);
369:             shoppingOrderService.persistOrder(email,(Money)this.getShoppingCartAsMoneyValue(email),usersList);
370:             List<ShoppingCartPart> emptyList= shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).getShoppingCartItems();
371:             emptyList.removeAll(usersList);
372:             //delete from Shopping Cart repo
373:             shoppingCartPartRepository.deleteAll(usersList);
374:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setShoppingCartItems(emptyList);
375:             shoppingCartRepository.findByCustomerEmailEmailString(email.getEmailString()).setTotalQuantity(0);
376:         } else throw new ShopException("no autorization for payment");
377:     }
378: 
379:     @Override
380:     public Map<UUID, Integer> getOrderHistory(EmailType customerEmail) {
381:         Email email = (Email) Email.of(customerEmail.toString());
382:         //shoppingOrderService.instantiateOrder(email, (Money)this.getShoppingCartAsMoneyValue(email));
383:         return shoppingOrderService.getOrderParts(email);
384:     }
385: 
386:     @Override
387:     public void deleteAllOrders() {
388:         shoppingOrderService.deleteAll();
389:         shoppingCartPartRepository.deleteAll();
390:     }
391: 
392: 
393: }
394: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: 
6: public interface ShoppingCustomerService {
7:     CustomerType findByEmail(Email email);
8: 
9: 
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingDeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.CustomerType;
4: 
5: import java.util.Map;
6: import java.util.UUID;
7: 
8: public interface ShoppingDeliveryService {
9:     void triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent);
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingInventoryService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
4: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface ShoppingInventoryService {
10:     //InventoryElement findByItem(Item item);
11:     Integer getQuantity(AbstractItem item);
12:     void setQuantity(AbstractItem item, Integer quantity);
13:     void isOrdered(List<ShoppingCartPart> items);
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingItemService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Money;
4: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.AbstractItem;
5: 
6: import java.util.UUID;
7: 
8: public interface ShoppingItemService {
9:     AbstractItem findByItemId(UUID itemId);
10:     UUID getItemId(AbstractItem item) ;
11:     Money getSellPrice(AbstractItem item);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingOrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.application;
2: 
3: import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: import thkoeln.archilab.ecommerce.domainprimitives.Money;
5: import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartPart;
6: 
7: import java.util.List;
8: import java.util.Map;
9: import java.util.UUID;
10: 
11: public interface ShoppingOrderService {
12:     void instantiateOrder(Email email, Money money);
13:     void persistOrder(Email email,Money money,List<ShoppingCartPart> usersList);
14:     Map<UUID,Integer> getOrderParts(Email email);
15:     void deleteAll();
16: 
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractCustomer.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @Getter
14: @NoArgsConstructor
15: public class AbstractCustomer {
16: 
17:     @Id
18:     private UUID customerId;
19:     @Setter
20:     @Embedded
21:     private Email email;
22:     public AbstractCustomer(UUID customerId, Email email) {
23:         this.customerId=customerId;
24:         this.email=email;
25:     }
26: 
27:     }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\AbstractItem.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: 
8: import javax.persistence.Embedded;
9: import javax.persistence.Entity;
10: import javax.persistence.Id;
11: import java.util.UUID;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor
16: public class AbstractItem {
17:     @Id
18:     private UUID itemId;
19: 
20:     @Embedded
21:     private Money sellPrice;
22: 
23:     public AbstractItem(UUID itemId, Money sellPrice){
24:         this.itemId=itemId;
25:         this.sellPrice=sellPrice;
26:     }
27: 
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
9: 
10: import javax.persistence.*;
11: import java.util.List;
12: import java.util.UUID;
13: 
14: @Getter
15: @NoArgsConstructor
16: @AllArgsConstructor
17: @Entity
18: @Table(name = "shopping_cart")
19: public class ShoppingCart {
20:     @Id
21:     private UUID shoppingCartId;
22:     @Setter
23:     @OneToMany(cascade = CascadeType.ALL)
24:     @JoinColumn(name = "shopping_cart_id")
25:     private List<ShoppingCartPart> shoppingCartItems;
26:     @Setter
27:     @OneToOne(cascade = CascadeType.REMOVE)
28:     private AbstractCustomer customer;
29:     @Setter
30:     private Integer totalQuantity;
31: 
32:     /*public ShoppingCart(UUID shoppingCartId, List<ShoppingCartPart> shoppingCartItems, AbstractCustomer customer, Integer totalQuantity) {
33:         this.shoppingCartId = shoppingCartId;
34:         this.shoppingCartItems = shoppingCartItems;
35:         this.customer = customer;
36:         this.totalQuantity = totalQuantity;
37:     }
38: 
39:      */
40: 
41: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import org.dom4j.tree.AbstractEntity;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: 
10: import javax.persistence.*;
11: import java.util.UUID;
12: @Getter
13: @NoArgsConstructor
14: @Entity
15: public class ShoppingCartPart extends AbstractEntity {
16: 
17:     @Id
18:     private UUID shoppingCartItemId;
19:     @Setter
20:     @OneToOne
21:     private AbstractItem item;
22: 
23:     @Setter
24:     @Embedded
25:     private Email email;
26:     @Setter
27:     private Integer quantity;
28:     @Setter
29:     private String comment;
30: 
31:     public ShoppingCartPart(UUID shoppingCartItemId, AbstractItem item, Email email, Integer quantity, String comment){
32: 
33:         if (shoppingCartItemId == null || item==null || email==null) {//|| quantity <0 weggelassen aufgrund von REST POST
34:             throw new ShopException("Invalid Shopping Card data");
35:         }
36:         this.shoppingCartItemId=shoppingCartItemId;
37:         this.item = item;
38:         this.email=email;
39:         this.quantity=quantity;
40:         this.comment  = comment;
41:     }
42: 
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPartRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import org.yaml.snakeyaml.events.Event;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: 
8: import java.util.List;
9: import java.util.UUID;
10: @Repository
11: public interface ShoppingCartPartRepository extends CrudRepository<ShoppingCartPart, Event.ID> {
12: 
13:     ShoppingCartPart findByEmailEmailStringAndItem(String email, AbstractItem item);
14:     List<ShoppingCartPart> findAllByItem(AbstractItem item);
15:     ShoppingCartPart findByShoppingCartItemId(UUID id);
16: 
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: import org.yaml.snakeyaml.events.Event;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: 
8: import java.util.UUID;
9: @Repository
10: public interface ShoppingCartRepository extends CrudRepository<ShoppingCart, Event.ID> {
11:     ShoppingCart findByCustomerEmailEmailString(String email);
12:     ShoppingCart findByShoppingCartId(UUID id);
13: 
14: 
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a customer.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface CustomerRegistrationUseCases {
12:     /**
13:      * Registers a new customer
14:      *
15:      * @param name
16:      * @param email
17:      * @param address
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - customer with the given email already exists
22:      *      - address is null
23:      */
24:     public void register( String name, EmailType email, AddressType address );
25: 
26: 
27:     /**
28:      * Changes the address of a customer
29:      *
30:      * @param customerEmail
31:      * @param address
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - customer with the given email already exists
35:      *      - address is null
36:      */
37:     public void changeAddress( EmailType customerEmail, AddressType address );
38: 
39: 
40:     /**
41:      * Returns the data of a customer
42:      * @param customerEmail
43:      * @return the customer data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the customer with the given email does not exist
47:      */
48:     public CustomerType getCustomerData( EmailType customerEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all customers, including all orders and shopping carts
54:      */
55:     public void deleteAllCustomers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop customer
8:  */
9: public interface CustomerType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public AddressType getAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of items to a customer. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a item to a customer. The item is identified by its id, and the customer by
16:      * his/her name, street, city and postal code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of item ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of items in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which items have been delivered to a customer, and how many of each item
31:      *
32:      * @param customerEmail
33:      * @return the delivery history of the customer (map is empty if the customer has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the customer with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType customerEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\AddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface AddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the postal code
18:      */
19:     public PostalCodeType getPostalCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an postal code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param postalCode the postal code
30:      * @return the address object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - postalCode is null
35:      */
36:      // public static AddressType of( String street, String city, PostalCodeType postalCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PostalCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PostalCodeType {
6:     /**
7:      * @return the postal code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an postal code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param postalCodeAsString - the postal code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new postal code object matching the given string
22:      * @throws ShopException if ...
23:      *      - postalCodeAsString is null
24:      *      - postalCodeAsString is not a valid postal code (see above)
25:      */
26:      // public static PostalCodeType of( String postalCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
10:  * i.e. adding and removing items in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface InventoryManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given item to the inventory
16:      * @param itemId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - itemId is null
20:      *      - the item with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToInventory( UUID itemId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given item from the inventory.
28:      * If the new total quantity is lower than the currently reserved items, some of currently reserved items
29:      * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
30:      * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
31:      * or some of the items were stolen from the warehouse, are broken, etc.)
32:      * @param itemId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - itemId is null
36:      *      - the item with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current inventory and the currently reserved items together
39:      */
40:     public void removeFromInventory( UUID itemId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given item in the inventory.
45:      * If the new total quantity is lower than the currently reserved items, some of currently reserved items
46:      * (in the customers' shopping baskets) are removed. This means that some of the reserved items are lost for
47:      * the customer. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
48:      * or some of the items were stolen from the warehouse, are broken, etc.)
49:      * @param itemId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - itemId is null
53:      *      - the item with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeInventoryTo( UUID itemId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total inventory of a given item, including the currently reserved items
61:      * @param itemId
62:      * @return the current total inventory of the item
63:      * @throws ShopException if ...
64:      *      - itemId is null
65:      *      - the item with that id does not exist
66:      */
67:     public int getAvailableInventory( UUID itemId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\ItemCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the item catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface ItemCatalogUseCases {
15:     /**
16:      * Adds a new item to the shop catalog
17:      * @param itemId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param sellPrice
23:      * @throws ShopException if ...
24:      *      - itemId is null,
25:      *      - the item with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the sell price is null,
30:      *      - the sell price is lower than the purchase price
31:      */
32:     public void addItemToCatalog( UUID itemId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType sellPrice );
34: 
35: 
36:     /**
37:      * Removes a item from the shop catalog
38:      * @param itemId
39:      * @throws ShopException if
40:      *      - itemId is null,
41:      *      - the item with that id does not exist
42:      *      - the item is still in inventory
43:      *      - the item is still reserved in a shopping cart, or part of a completed order
44:      */
45:     public void removeItemFromCatalog( UUID itemId );
46: 
47: 
48:     /**
49:      * Get the sell price of a given item
50:      * @param itemId
51:      * @return the sell price
52:      * @throws ShopException if ...
53:      *      - itemId is null,
54:      *      - the item with that id does not exist
55:      */
56:     public MoneyType getSellPrice( UUID itemId );
57: 
58: 
59:     /**
60:      * Clears the item catalog, i.e. removes all items from the catalog, including all the inventory,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteItemCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a debit card for a given amount
16:      *
17:      * @param customerEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - customerEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType customerEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a customer
31:      * (identified by his/her email)
32:      *
33:      * @param customerEmail
34:      * @return the total amount of payments made using this debit card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - customerEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType customerEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all customers.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingCartUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping cart.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingCartUseCases {
15:     /**
16:      * Adds a item to the shopping cart of a customer
17:      *
18:      * @param customerEmail
19:      * @param itemId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the customer with the given email does not exist,
23:      *      - the item does not exist,
24:      *      - the quantity <= 0,
25:      *      - the item is not available in the requested quantity
26:      */
27:     public void addItemToShoppingCart( EmailType customerEmail, UUID itemId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a item from the shopping cart of a customer
32:      *
33:      * @param customerEmail
34:      * @param itemId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - customerEmail is null,
38:      *      - the customer with the given email does not exist,
39:      *      - the item does not exist
40:      *      - the quantity <= 0,
41:      *      - the item is not in the shopping cart in the requested quantity
42:      */
43:     public void removeItemFromShoppingCart( EmailType customerEmail, UUID itemId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping cart part containing a item
48:      *
49:      * @param customerEmail
50:      * @param itemId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - customerEmail is null,
54:      *      - the customer with the given email does not exist,
55:      *      - the item does not exist
56:      *      - the item is not in the shopping cart
57:      */
58:     public void setCommentForShoppingCartPart( EmailType customerEmail, UUID itemId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping cart part containing a item
63:      *
64:      * @param customerEmail
65:      * @param itemId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - customerEmail is null,
69:      *      - the customer with the given email does not exist,
70:      *      - the item does not exist
71:      *      - the item is not in the shopping cart
72:      */
73:     public String getCommentForShoppingCartPart( EmailType customerEmail, UUID itemId );
74: 
75: 
76:     /**
77:      * Returns a map showing which items are in the shopping cart of a customer and how many of each item
78:      *
79:      * @param customerEmail
80:      * @return the shopping cart of the customer (map is empty if the shopping cart is empty)
81:      * @throws ShopException if ...
82:      *      - customerEmail is null,
83:      *      - the customer with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingCartAsMap( EmailType customerEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all items in the shopping cart of a customer
90:      *
91:      * @param customerEmail
92:      * @return the value of shopping cart of the customer
93:      * @throws ShopException if ...
94:      *      - customerEmail is null,
95:      *      - the customer with the given email does not exist
96:      */
97:     public MoneyType getShoppingCartAsMoneyValue( EmailType customerEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific item that are currently reserved in the shopping carts of all customers
103:      * @param itemId
104:      * @return the number of reserved items of that type in all shopping carts
105:      * @throws ShopException
106:      *      - itemId is null
107:      *      - if the item id does not exist
108:      */
109:     public int getReservedInventoryInShoppingCarts( UUID itemId );
110: 
111: 
112:     /**
113:      * Checks if the shopping cart of a customer is empty
114:      *
115:      * @param customerEmail
116:      * @return true if the shopping cart is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - customerEmail is null
119:      *    - the customer with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType customerEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping cart of a customer has been authorized to be paid,
126:      * i.e. the shopping cart is not empty, the customer has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the customer's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param customerEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - customerEmail is null
134:      *      - the customer with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType customerEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping cart of a customer
141:      *
142:      * @param customerEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - customerEmail is null
146:      *      - the customer with the given email does not exist
147:      *      - the shopping cart is empty
148:      */
149:     public void checkout( EmailType customerEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which items have been ordered by a customer, and how many of each item
156:      *
157:      * @param customerEmail
158:      * @return the order history of the customer (map is empty if the customer has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the customer with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType customerEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping carts in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping carts), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Item" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"customer", "shoppingcart", "item", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "Customer",
21:             "CustomerRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingCart",
25:             "ShoppingCartRepository",
26:             "Item",
27:             "ItemRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllItems();
45:         initialMasterDataCreator.inventoryUpAllItems();
46:         initialMasterDataCreator.registerAllCustomers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + CUSTOMER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = CUSTOMER_EMAIL[6].toString();
76: 
77:         UUID itemId2 = (UUID) ITEM_DATA[2][0];
78:         UUID itemId4 = (UUID) ITEM_DATA[4][0];
79:         UUID itemId6 = (UUID) ITEM_DATA[6][0];
80:         Float itemMoneyAmount2 = ((MoneyType) ITEM_DATA[2][5]).getAmount() * 2;
81:         Float itemMoneyAmount4 = ((MoneyType) ITEM_DATA[4][5]).getAmount() * 4;
82:         Float itemMoneyAmount6 = ((MoneyType) ITEM_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForCustomer( emailString, itemId2, 2 );
89:         restHelper.makeOrderForCustomer( emailString, itemId4, 4 );
90:         restHelper.makeOrderForCustomer( emailString, itemId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( itemMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( itemMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = CUSTOMER_EMAIL[3].toString();
118:         UUID itemId3 = (UUID) ITEM_DATA[3][0];
119:         UUID itemId4 = (UUID) ITEM_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float itemMoneyAmount =
123:                 ((MoneyType) ITEM_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) ITEM_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingCartId = restHelper.getShoppingCartId( emailString );
128:         restHelper.addItemToShoppingCart( shoppingCartId, itemId3, quantity3 );
129:         restHelper.addItemToShoppingCart( shoppingCartId, itemId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( itemMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingCartRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingCartRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllItems();
47:         initialMasterDataCreator.inventoryUpAllItems();
48:         initialMasterDataCreator.registerAllCustomers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingCart() throws Exception {
57:         // given
58:         String validUri = "/shoppingCarts?email=" + CUSTOMER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingCarts?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingCarts?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID itemId = (UUID) ITEM_DATA[3][0];
78:         String customerEmailString = CUSTOMER_EMAIL[4].toString();
79:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
80: 
81:         String invalidPostUri = "/shoppingCarts/" + UUID.randomUUID() + "/shoppingCartParts";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingCarts/" + UUID.randomUUID().toString() + "/shoppingCartParts/" + itemId;
86:         String invalidCheckoutUri1 = "/shoppingCarts/" + shoppingCartId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingCarts/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingItem() throws Exception {
107:         // given
108:         UUID itemId = (UUID) ITEM_DATA[3][0];
109:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
110:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
111:         String invalidUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/" + itemId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingCart() throws Exception {
121:         // given
122:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
123:         String customerEmailString9 = CUSTOMER_EMAIL[9].toString();
124:         String customerEmailString7 = CUSTOMER_EMAIL[7].toString();
125: 
126:         UUID shoppingCartId9 = restHelper.getShoppingCartId( customerEmailString9 );
127:         UUID shoppingCartId7 = restHelper.getShoppingCartId( customerEmailString7 );
128: 
129:         String baseUri9 = "/shoppingCarts/" + shoppingCartId9 + "/shoppingCartParts/";
130:         String checkoutUri9 = "/shoppingCarts/" + shoppingCartId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingCarts/" + shoppingCartId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleItemsToShoppingCart( customerEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingCartParts(
137:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + itemId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingCartParts(
142:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" item
145:         restHelper.addItemToShoppingCart( shoppingCartId7, itemId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingCart() throws Exception {
160:         // given
161:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
162:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
163:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingCartParts(
170:                 customerEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingCart() throws Exception {
182:         // given
183:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInInventory() throws Exception {
195:         // given
196:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String customerEmailString = CUSTOMER_EMAIL[5].toString();
210:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
211:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPartsInLatestOrder( customerEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String customerEmailString = CUSTOMER_EMAIL[1].toString();
229:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
230:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String customerEmailString = CUSTOMER_EMAIL[8].toString();
245:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
246:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleItemsToShoppingCart( customerEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingCart() throws Exception {
259:         // given
260:         String customerEmailString = CUSTOMER_EMAIL[9].toString();
261:         UUID shoppingCartId = restHelper.getShoppingCartId( customerEmailString );
262:         String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForCustomer( String emailString, UUID itemId, Integer quantity ) throws Exception {
36:         UUID shoppingCartId = getShoppingCartId( emailString );
37:         addItemToShoppingCart( shoppingCartId, itemId, quantity );
38:         mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingCartId( String emailString ) throws Exception {
43:         // get the shopping cart and extract its id ...
44:         MvcResult shoppingCart = mockMvc.perform( get( "/shoppingCarts?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingCart.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( itemId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addItemToShoppingCart( UUID shoppingCartId, UUID itemId, Integer quantity )
67:             throws Exception {
68:         addItemToShoppingCart( shoppingCartId, itemId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleItemsToShoppingCart(
74:             String customerEmailString, Integer[] itemIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingCartId = getShoppingCartId( customerEmailString );
77:         String shoppingCartUri = "shoppingCarts?email=" + customerEmailString;
78:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";
79: 
80:         // add all the items to the shopping cart ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < itemIndices.length; i++ ) {
84:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
85:             addItemToShoppingCart( shoppingCartId, itemId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( itemIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( itemIndices[i], 0 ) );
89:                 commentMap.put( itemIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleItemsToShoppingCart(
96:             String customerEmailString, Integer[] itemIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[itemIndices.length];
99:         for ( int i = 0; i < itemIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleItemsToShoppingCart( customerEmailString, itemIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingCartParts( String customerEmailString,
108:                                                          Integer[] itemIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingCartId = getShoppingCartId( customerEmailString );
111:         String shoppingCartUri = "/shoppingCarts?email=" + customerEmailString;
112:         String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartParts/";
113: 
114:         // check that the shopping cart contains all the items ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < itemIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingCartUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each item has the correct quantity and comment ...
126:         for ( int i = 0; i < itemIndices.length; i++ ) {
127:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + itemId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + itemId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingCartParts( String customerEmailString,
142:                                                          Integer[] itemIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[itemIndices.length];
145:         for ( int i = 0; i < itemIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingCartParts( customerEmailString, itemIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPartsInLatestOrder(
155:             String customerEmailString, Integer[] itemIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + customerEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < itemIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) ITEM_DATA[itemIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( customerEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < itemIndices.length; i++ ) {
173:             UUID itemId = (UUID) ITEM_DATA[itemIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderParts.length()" ).value( itemIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderParts[?(@.itemId == '" + itemId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID itemId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID itemId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID itemId, Integer quantity, String comment ) {
24:         this.itemId = itemId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         PostalCodeType plz = instantiatePostalCode( "12345" );
19: 
20:         // when
21:         AddressType instance = instantiateAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getPostalCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         PostalCodeType plz = instantiatePostalCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiateAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         PostalCodeType plz = instantiatePostalCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiateAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiateAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiateAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiateAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiateAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         PostalCodeType plz = instantiatePostalCode( "12345" );
63: 
64:         // when
65:         AddressType instance1 = instantiateAddress( street, city, plz );
66:         AddressType instance2 = instantiateAddress( street, city, plz );
67:         AddressType instance3 = instantiateAddress( "Anderestr. 12", city, plz );
68:         AddressType instance4 = instantiateAddress( street, "AndereStadt", plz );
69:         AddressType instance5 = instantiateAddress( street, city, instantiatePostalCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         PostalCodeType plz = instantiatePostalCode( "12345" );
84: 
85:         // when
86:         AddressType instance = instantiateAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setPostalCode", PostalCodeType.class );
104:             fail( "setPostalCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPostalCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionPostalCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         PostalCodeType instance = instantiatePostalCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiatePostalCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiatePostalCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiatePostalCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiatePostalCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiatePostalCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         PostalCodeType instance1 = instantiatePostalCode( "12345" );
48:         PostalCodeType instance2 = instantiatePostalCode( "12345" );
49:         PostalCodeType instance3 = instantiatePostalCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         PostalCodeType instance = instantiatePostalCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setpostalCode", String.class );
65:             fail( "setpostalCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionCustomerRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.CustomerType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionCustomerRegistrationTest {
25: 
26:     @Autowired
27:     private CustomerRegistrationUseCases customerRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllCustomersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllCustomers();
44: 
45:         // when
46:         CustomerType customer3 = customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.CUSTOMER_NAME[3], customer3.getName() );
50:         Assertions.assertEquals( CUSTOMER_EMAIL[3], customer3.getEmail() );
51:         Assertions.assertEquals( CUSTOMER_ADDRESS[3], customer3.getAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterCustomerWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllCustomers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 customerRegistrationUseCases.register( "Gandalf The Grey", CUSTOMER_EMAIL[5],
64:                         CUSTOMER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterCustomerWithDuplicateNameOrAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllCustomers();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 customerRegistrationUseCases.register( initialMasterDataCreator.CUSTOMER_NAME[2], newEmail,
77:                         CUSTOMER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteCustomersNoMoreCustomers() {
83:         // given
84:         initialMasterDataCreator.registerAllCustomers();
85: 
86:         // when
87:         customerRegistrationUseCases.deleteAllCustomers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_INVENTORY;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionInventoryManagementTest {
20: 
21:     @Autowired
22:     private InventoryManagementUseCases inventoryManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllItems();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToInventory() {
37:         // given
38:         initialMasterDataCreator.inventoryUpAllItems();
39:         UUID itemId8 = (UUID) ITEM_DATA[8][0];
40: 
41:         // when
42:         int inventory8before = inventoryManagementUseCases.getAvailableInventory( itemId8 );
43:         assertEquals( ITEM_INVENTORY.get( itemId8 ), inventory8before );
44:         inventoryManagementUseCases.addToInventory( itemId8, 22 );
45:         int inventory8after = inventoryManagementUseCases.getAvailableInventory( itemId8 );
46:         inventoryManagementUseCases.addToInventory( itemId8, 1 );
47:         int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( itemId8 );
48: 
49:         // then
50:         assertEquals( inventory8before + 22, inventory8after );
51:         assertEquals( inventory8after + 1, inventory8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromInventory() {
57:         // given
58:         initialMasterDataCreator.inventoryUpAllItems();
59:         UUID itemId6 = (UUID) ITEM_DATA[6][0];
60:         int inventory6before = ITEM_INVENTORY.get( itemId6 );
61:         UUID itemId9 = (UUID) ITEM_DATA[9][0];
62:         int inventory9before = ITEM_INVENTORY.get( itemId9 );
63:         UUID itemId1 = (UUID) ITEM_DATA[1][0];
64:         int inventory1before = ITEM_INVENTORY.get( itemId1 );
65: 
66:         // when
67:         inventoryManagementUseCases.removeFromInventory( itemId6, 1 );
68:         int inventory6after = inventoryManagementUseCases.getAvailableInventory( itemId6 );
69:         inventoryManagementUseCases.removeFromInventory( itemId1, 3 );
70:         int inventory1after = inventoryManagementUseCases.getAvailableInventory( itemId1 );
71:         inventoryManagementUseCases.removeFromInventory( itemId9, inventory9before );
72:         int inventory9after = inventoryManagementUseCases.getAvailableInventory( itemId9 );
73: 
74:         // then
75:         assertEquals( inventory6before - 1, inventory6after );
76:         assertEquals( inventory1before - 3, inventory1after );
77:         assertEquals( 0, inventory9after );
78:     }
79: 
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionItemCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.ItemCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.ITEM_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionItemCatalogTest {
22: 
23:     @Autowired
24:     private ItemCatalogUseCases itemCatalogUseCases;
25:     @Autowired
26:     private InventoryManagementUseCases inventoryManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddItemToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllItems();
41: 
42:         // when
43:         MoneyType sellPrice = itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( ITEM_DATA[4][5], sellPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveItemFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllItems();
53:         UUID itemId = (UUID) ITEM_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> itemCatalogUseCases.getSellPrice( itemId ) );
57:         itemCatalogUseCases.removeItemFromCatalog( itemId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( itemId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveItemThatIsInInventory() {
68:         // given
69:         initialMasterDataCreator.addAllItems();
70:         UUID itemId = (UUID) ITEM_DATA[4][0];
71:         inventoryManagementUseCases.addToInventory( itemId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> itemCatalogUseCases.removeItemFromCatalog( itemId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearItemCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllItems();
83: 
84:         // when
85:         itemCatalogUseCases.deleteItemCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> itemCatalogUseCases.getSellPrice( (UUID) ITEM_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

[RESPONSE]:
Hier sind die gefundenen Code Smells basierend auf den definierten Regeln:

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
[Address.java] [43]: [negative conditionals] : Die Bedingung `!(postalCode instanceof PostalCode)` ist negativ formuliert.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
[Email.java] [35]: [negative conditionals] : Die Bedingung `!emailAsString.contains("@")` ist negativ formuliert.
[Email.java] [51]: [negative conditionals] : Die Bedingung `!(Character.isLetterOrDigit(c) || c == '.')` ist negativ und komplex formuliert.
[Email.java] [56-60]: [Duplication] [50-54] : Die Iteration und Überprüfung der Zeichen ist für `afterAt` identisch zur Logik für `beforeAt`.
[Email.java] [57]: [negative conditionals] : Die Bedingung `!(Character.isLetterOrDigit(c) || c == '.')` ist negativ und komplex formuliert.
[Email.java] [60-64]: [dead code] : Auskommentierter Code-Block.
[Email.java] [68]: [negative conditionals] : Die Bedingung `!(afterAt.endsWith(".de") ...)` ist negativ formuliert.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
[Money.java] [56]: [negative conditionals] : Die Bedingung `!currency.equals(...)` ist negativ formuliert.
[Money.java] [62]: [negative conditionals] : Die Bedingung `!currency.equals("EUR")` ist negativ formuliert.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
[FactoryMethodInvoker.java] [51-79]: [Duplication] [23-48] : Die Methode `instantiateAddress` nutzt exakt denselben Reflection-Code wie `instantiateEmail`, nur mit anderen Typen.
[FactoryMethodInvoker.java] [82-107]: [Duplication] [23-48] : Die Methode `instantiatePostalCode` nutzt exakt denselben Reflection-Code wie `instantiateEmail`.
[FactoryMethodInvoker.java] [110-135]: [Duplication] [23-48] : Die Methode `instantiateMoney` nutzt exakt denselben Reflection-Code wie `instantiateEmail`.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
[InitialMasterDataCreator.java] [162-175]: [dead code] : Das Enum `InvalidReason` wird innerhalb der Klasse oder des Pakets nicht verwendet.
[InitialMasterDataCreator.java] [221-228]: [dead code] : Die Methode `getItemDataInvalidAtIndex` wird nie aufgerufen.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerRegistrationService.java ---
[CustomerRegistrationService.java] [32]: [Shared persistency] : Der Service der Customer-Domain greift direkt auf das `ShoppingCartRepository` der ShoppingCart-Domain zu.
[CustomerRegistrationService.java] [50]: [Shared persistency] : Zugriff auf `ShoppingCartRepository`.
[CustomerRegistrationService.java] [92-152]: [dead code] : Großer Block auskommentierter Code.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java ---
[Customer.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\DeliveryRecipientClass.java ---
[DeliveryRecipientClass.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
[DeliveryService.java] [27]: [Shared persistency] : Der Service der Delivery-Domain greift direkt auf das `ItemRepository` der Item-Domain zu.
[DeliveryService.java] [56-73]: [dead code] : Auskommentierte Methode `triggerDeliveryCheck`.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
[Delivery.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\application\ItemCatalogService.java ---
[ItemCatalogService.java] [22]: [Shared persistency] : Der Service der Item-Domain greift direkt auf das `InventoryRepository` der Inventory-Domain zu.
[ItemCatalogService.java] [24]: [Shared persistency] : Der Service der Item-Domain greift direkt auf das `ShoppingCartPartRepository` der ShoppingCart-Domain zu.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\item\domain\Item.java ---
[Item.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
[OrderController.java] [49-66]: [dead code] : Auskommentierte Methode `createOrder`.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapperService.java ---
[OrderDtoMapperService.java] [22-26]: [dead code] : Auskommentierter Code zur Mapping-Logik.
[OrderDtoMapperService.java] [36-46]: [dead code] : Auskommentierte Methode `mapToEntity`.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderExceptions.java ---
[OrderExceptions.java] [4]: [dead code] : Leere Klasse, die nicht genutzt wird.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
[OrderService.java] [25]: [Shared persistency] : Der Service der Order-Domain greift direkt auf das `ShoppingCartRepository` der ShoppingCart-Domain zu.
[OrderService.java] [32-39]: [dead code] : Auskommentierte Methode `createOrderFromDto`.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
[Order.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
[Payment.java] : -Anemic Entity-

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartController.java ---
[ShoppingCartController.java] [147-228]: [dead code] : Großer Block auskommentierter Code (alter Controller-Code).

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
[ShoppingCartService.java] [33]: [Shared persistency] : Der Service der ShoppingCart-Domain greift direkt auf das `PaymentRepository` der Payment-Domain zu.
[ShoppingCartService.java] [106-116]: [Duplication] [93-104] : Die Logik zum Hinzufügen/Updaten eines Items, Logging und Speichern ist in den if/else Zweigen nahezu identisch.
[ShoppingCartService.java] [153-165]: [Duplication] [142-151] : Die Logik zum Entfernen/Updaten eines Items, Logging und Speichern ist in den if/else Zweigen nahezu identisch.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
[ShoppingCart.java] : -Anemic Entity-
[ShoppingCart.java] [32-39]: [dead code] : Auskommentierter Konstruktor.

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_9c98ff81-66de-453e-80cd-c1d3879ebe41\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartPart.java ---
[ShoppingCartPart.java] : -Anemic Entity-

ENDE
Generated by gemini-3-pro-preview
-----------------------------------