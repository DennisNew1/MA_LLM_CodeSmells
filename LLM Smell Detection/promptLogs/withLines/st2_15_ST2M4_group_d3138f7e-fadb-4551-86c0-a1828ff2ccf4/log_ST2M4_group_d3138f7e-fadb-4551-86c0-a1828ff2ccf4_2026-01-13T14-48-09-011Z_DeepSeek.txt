--- DATE: 13.1.2026, 15:48:09 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
8: 
9: import javax.persistence.Embeddable;
10: 
11: @Embeddable
12: @EqualsAndHashCode
13: @NoArgsConstructor (access = AccessLevel.PROTECTED)
14: public class Email implements EmailType {
15: 
16:     private String emailString;
17: 
18:     public String getEmailString() {
19:         return emailString;
20:     }
21: 
22:     public String toString() {
23:         return emailString;
24:     }
25: 
26:     public static Email of(String emailAsString) {
27:         if (emailAsString == null || emailAsString.isBlank()
28:            || emailAsString.chars().filter(atCharInString -> atCharInString == '@').count() != 1)
29:             throw new ShopException("Invalid email!");
30: 
31:         String[] validDomain = {".de", ".at", ".ch", ".com", ".org"};
32:         int domainCounter = 0;
33:         String[] splitEmail = emailAsString.split("@");
34: 
35:         if (splitEmail.length != 2)
36:             throw new ShopException("Invalid email!");
37: 
38:         String beforeAt = splitEmail[0];
39:         String afterAt = splitEmail[1];
40: 
41:         if (beforeAt.isBlank() || beforeAt.contains(" ")
42:            || beforeAt.contains("..")
43:            || afterAt.isBlank() || afterAt.contains(" ")
44:            || afterAt.contains(".."))
45:             throw new ShopException("Invalid email!");
46:         if (!beforeAt.matches("[a-zA-Z0-9.]+")
47:            || !afterAt.matches("[a-zA-Z0-9.]+"))
48:             throw new ShopException("Invalid email!");
49:         for (String domain : validDomain) {
50:             if (!afterAt.endsWith(domain)) {
51:                 if (domainCounter == validDomain.length - 1)
52:                     throw new ShopException("Invalid domain!");
53:             } else break;
54:             domainCounter++;
55:         }
56:         return new Email(emailAsString);
57:     }
58:     private Email(String email) {
59:         this.emailString = email;
60:     }
61: }
62: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import javax.persistence.Embeddable;
10: 
11: @Embeddable
12: @EqualsAndHashCode
13: @NoArgsConstructor (access = AccessLevel.PROTECTED)
14: public class Money implements MoneyType {
15: 
16:     private Float amount;
17: 
18:     private String currency;
19: 
20:     @Override
21:     public Float getAmount() {
22:         return amount;
23:     }
24: 
25:     @Override
26:     public String getCurrency() {
27:         return currency;
28:     }
29: 
30:     @Override
31:     public MoneyType add(MoneyType otherMoney) {
32:         if (otherMoney == null || !otherMoney.getCurrency().equals(this.currency))
33:             throw new ShopException("Invalid addition!");
34:         return new Money(getAmount() + otherMoney.getAmount(), getCurrency());
35:     }
36: 
37:     @Override
38:     public MoneyType subtract(MoneyType otherMoney) {
39:         if (otherMoney == null
40:            || !otherMoney.getCurrency().equals(this.currency)
41:            || this.amount < otherMoney.getAmount())
42:             throw new ShopException("Invalid subtraction!");
43:         return new Money(getAmount() - otherMoney.getAmount(), getCurrency());
44:     }
45: 
46:     @Override
47:     public MoneyType multiplyBy(int factor) {
48:         if (factor < 0)
49:             throw new ShopException("Invalid factor!");
50:         return new Money(getAmount() * factor, getCurrency());
51:     }
52: 
53:     @Override
54:     public boolean largerThan(MoneyType otherMoney) {
55:         if (otherMoney == null || !this.currency.equals(otherMoney.getCurrency()))
56:             throw new ShopException("Invalid othermoney!");
57:         return this.amount > otherMoney.getAmount();
58:     }
59: 
60:     public static Money of( Float amount, String currency ) {
61:         if (amount == null || amount < 0.00F
62:            || currency == null
63:            || !currency.equals("EUR")
64:            && !currency.equals("CHF"))
65:             throw new ShopException("Invalid money!");
66:         return new Money(amount, currency);
67:     }
68: 
69:     private Money(Float amount, String currency) {
70:         this.amount = amount;
71:         this.currency = currency;
72:     }
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PersonalAddress.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AccessLevel;
4: import lombok.EqualsAndHashCode;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
9: 
10: import javax.persistence.Embeddable;
11: import javax.persistence.Embedded;
12: 
13: @Embeddable
14: @EqualsAndHashCode
15: @NoArgsConstructor (access = AccessLevel.PROTECTED)
16: public class PersonalAddress implements PersonalAddressType {
17: 
18:     private String street;
19: 
20:     private String city;
21: 
22:     @Embedded
23:     private PostalCode postalCode;
24: 
25:     @Override
26:     public String getStreet() {
27:         return street;
28:     }
29: 
30:     @Override
31:     public String getCity() {
32:         return city;
33:     }
34: 
35: 
36:     @Override
37:     public PostalCodeType getPostalCode() {
38:         return postalCode;
39:     }
40: 
41:     private static boolean nullOrEmpty(String string) {
42:         return string == null || string.isEmpty();
43:     }
44: 
45:     public static PersonalAddress of(String street, String city, PostalCodeType postalCode) {
46:         if (nullOrEmpty(street) || nullOrEmpty(city) || postalCode == null)
47:             throw new ShopException("Invalid personal address type!");
48:         return new PersonalAddress(street, city, (PostalCode) postalCode);
49:     }
50: 
51:     public PersonalAddress(String street, String city, PostalCode postalCode) {
52:         this.street = street;
53:         this.city = city;
54:         this.postalCode = postalCode;
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PostalCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
8: 
9: import javax.persistence.Embeddable;
10: 
11: @Getter
12: @EqualsAndHashCode
13: @Embeddable
14: @NoArgsConstructor
15: public class PostalCode implements PostalCodeType {
16: 
17:     private Integer postalCode;
18: 
19:     public String toString() {
20:         return postalCode.toString();
21:     }
22: 
23:     private static boolean isNumeric(String string) {
24:         return string != null && string.matches("[0-9]+");
25:     }
26: 
27:     public static PostalCode of(String postalCodeAsString) {
28:         if (!isNumeric(postalCodeAsString) || postalCodeAsString.length() != 5) {
29:             throw new ShopException("Invalid postal code!");
30:         }
31: 
32:         if (postalCodeAsString.endsWith("0000"))
33:             throw new ShopException("Invalid postal code!");
34: 
35:         return new PostalCode(Integer.valueOf(postalCodeAsString));
36:     }
37: 
38:     public PostalCode(Integer postalCode) {
39:         this.postalCode = postalCode;
40:     }
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static PersonalAddressType instantiatePersonalAddress(
52:             String street, String city, PostalCodeType postalCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, PostalCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for PersonalAddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, postalCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + postalCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (PersonalAddressType) instance;
79:     }
80: 
81: 
82:     public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for PostalCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, postalCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (PostalCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * users and products. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] USER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] USER_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static PersonalAddressType[] USER_ADDRESS = new PersonalAddressType[] {
53:             FactoryMethodInvoker.instantiatePersonalAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiatePersonalAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiatePersonalAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiatePersonalAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiatePersonalAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiatePersonalAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiatePersonalAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiatePersonalAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiatePersonalAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiatePersonalAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
83:     };
84: 
85:     public final static UserType[] mockUsers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] PRODUCT_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private UserRegistrationUseCases userRegistrationUseCases;
135:     private ProductCatalogUseCases productCatalogUseCases;
136:     private InventoryManagementUseCases inventoryManagementUseCases;
137:     private ShoppingBasketUseCases shoppingBasketUseCases;
138: 
139: 
140:     // product 0 is out of inventory, product 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random inventory between 5 and 100
142:     public static final Map<UUID, Integer> PRODUCT_INVENTORY = new HashMap<>();
143: 
144:     static {
145:         mockUsers = new UserType[USER_NAME.length];
146:         for ( int i = 0; i < USER_NAME.length; i++ ) {
147:             mockUsers[i] = new MockUser(
148:                     USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] productData : PRODUCT_DATA ) {
152:             PRODUCT_INVENTORY.put( (UUID) productData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         PRODUCT_INVENTORY.put( (UUID) PRODUCT_DATA[0][0], 0 );
155:         PRODUCT_INVENTORY.put( (UUID) PRODUCT_DATA[1][0], 10 );
156:         PRODUCT_INVENTORY.put( (UUID) PRODUCT_DATA[2][0], 20 );
157:         PRODUCT_INVENTORY.put( (UUID) PRODUCT_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             UserRegistrationUseCases userRegistrationUseCases,
181:             ProductCatalogUseCases productCatalogUseCases,
182:             InventoryManagementUseCases inventoryManagementUseCases,
183:             ShoppingBasketUseCases shoppingBasketUseCases ) {
184:         this.userRegistrationUseCases = userRegistrationUseCases;
185:         this.productCatalogUseCases = productCatalogUseCases;
186:         this.inventoryManagementUseCases = inventoryManagementUseCases;
187:         this.shoppingBasketUseCases = shoppingBasketUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingBasketUseCases.deleteAllOrders();
193:         productCatalogUseCases.deleteProductCatalog();
194:         userRegistrationUseCases.deleteAllUsers();
195:     }
196: 
197: 
198:     public void registerAllUsers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.USER_NAME.length; i++ ) {
200:             registerUser( InitialMasterDataCreator.USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerUser( String name, EmailType email, PersonalAddressType personalAddress ) {
206:         userRegistrationUseCases.register( name, email, personalAddress );
207:     }
208: 
209:     public void addAllProducts() {
210:         for ( Object[] productData : PRODUCT_DATA ) {
211:             addProductDataToCatalog( productData );
212:         }
213:     }
214: 
215:     public void addProductDataToCatalog( Object[] productData ) {
216:         productCatalogUseCases.addProductToCatalog( (UUID) productData[0], (String) productData[1], (String) productData[2],
217:                 (Float) productData[3], (MoneyType) productData[4], (MoneyType) productData[5] );
218:     }
219: 
220: 
221:     public Object[] getProductDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] productData = PRODUCT_DATA[1];
223:         Object[] productDataInvalid = new Object[productData.length];
224:         System.arraycopy( productData, 0, productDataInvalid, 0, productData.length );
225:         productDataInvalid[index] = productData[index].getClass().cast(
226:                 reason.getInvalidValue( productData[index] ) );
227:         return productDataInvalid;
228:     }
229: 
230: 
231:     public void inventoryUpAllProducts() {
232:         for ( Object[] productData : PRODUCT_DATA ) {
233:             if ( PRODUCT_INVENTORY.get( productData[0] ) > 0 )
234:                 inventoryManagementUseCases.addToInventory( (UUID) productData[0], PRODUCT_INVENTORY.get( productData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockUser.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.UserType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockUser implements UserType {
12:     private String name;
13:     private EmailType email;
14:     private PersonalAddressType personalAddress;
15: 
16: 
17:     public MockUser( String name, EmailType email, PersonalAddressType personalAddress) {
18:         this.name = name;
19:         this.email = email;
20:         this.personalAddress = personalAddress;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public PersonalAddressType getPersonalAddress() {
35:         return personalAddress;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockUser ) ) return false;
42:         MockUser that = (MockUser) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( personalAddress, that.personalAddress );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, personalAddress );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllUsers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.delivery.domain.entity.Delivery;
7: import thkoeln.archilab.ecommerce.solution.delivery.domain.repository.DeliveryRepository;
8: import thkoeln.archilab.ecommerce.solution.orderposition.application.OrderPositionService;
9: import thkoeln.archilab.ecommerce.solution.product.application.ProductService;
10: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
11: import thkoeln.archilab.ecommerce.ShopException;
12: import thkoeln.archilab.ecommerce.usecases.UserType;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: 
15: import java.util.Map;
16: import java.util.UUID;
17: 
18: @Service
19: public class DeliveryService implements DeliveryUseCases {
20: 
21:     private final DeliveryRepository deliveryRepository;
22: 
23:     private final DeliveryUserService userService;
24: 
25:     private final OrderPositionService orderPositionService;
26: 
27:     private final ProductService productService;
28: 
29:     @Autowired
30:     public DeliveryService (DeliveryRepository deliveryRepository, DeliveryUserService userService,
31:                             ProductService productService, OrderPositionService orderPositionService) {
32:         this.deliveryRepository = deliveryRepository;
33:         this.userService = userService;
34:         this.productService = productService;
35:         this.orderPositionService = orderPositionService;
36:     }
37: 
38:     public <T> boolean nullOrEmpty (T thing) {
39:         if (thing == null)
40:             return true;
41:         if (thing instanceof String)
42:             return ((String) thing).isEmpty();
43:         if (thing instanceof Integer)
44:             return (Integer) thing == 0;
45:         if (thing instanceof Map)
46:             return ((Map<?, ?>) thing).isEmpty();
47:         return false;
48:     }
49: 
50:     public EmailType getEmail(Delivery delivery) {
51:         return delivery.getDeliveryRecipientEmail();
52:     }
53: 
54:     public int getDeliveryQuantity(Map<UUID, Integer> deliveryContent) {
55:         int deliveryQuantity = 0;
56: 
57:         for (Integer quantity : deliveryContent.values()) {
58:             deliveryQuantity += quantity;
59:         }
60: 
61:         return deliveryQuantity;
62:     }
63: 
64:     @Override
65:     public UUID triggerDelivery(UserType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
66:         if (deliveryRecipient == null
67:            || nullOrEmpty(deliveryRecipient.getName()))
68:             throw new ShopException("Not a valid delivery recipient!");
69:         if (nullOrEmpty(deliveryContent))
70:             throw new ShopException("Delivery content is not valid!");
71:         if (deliveryContent.size() > 20 || getDeliveryQuantity(deliveryContent) > 20)
72:             throw new ShopException("Too many products!");
73: 
74:         Delivery newDelivery = new Delivery();
75:         newDelivery.setDeliveryRecipientEmail((Email) deliveryRecipient.getEmail());
76: 
77:         for (UUID productId : deliveryContent.keySet()) {
78:             if (!productService.existsById(productId))
79:                 throw new ShopException("No such product exists!");
80:             newDelivery.getDeliveryContent().add(
81:             orderPositionService.newDeliveryOrderPosition(getEmail(newDelivery),
82:             productService.findById(productId),
83:             deliveryContent.get(productId))
84:             );
85:         }
86:         deliveryRepository.save(newDelivery);
87:         return newDelivery.getDeliveryId();
88:     }
89: 
90:     @Override
91:     public Map<UUID, Integer> getDeliveryHistory(EmailType userEmail) {
92:         if (userService.checkNullOrEmptyOrExists(userEmail))
93:             throw new ShopException("No such user exists!");
94: 
95:         return orderPositionService.getMapOfDeliveriesForUser(userEmail);
96:     }
97: 
98:     @Override
99:     public void deleteDeliveryHistory() {
100:         orderPositionService.deleteDeliveries();
101:         deliveryRepository.deleteAll();
102:     }
103: }
104: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: 
5: public interface DeliveryUserService {
6:     boolean checkNullOrEmptyOrExists(EmailType email);
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\entity\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.Setter;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
7: 
8: import javax.persistence.*;
9: import java.util.ArrayList;
10: import java.util.List;
11: import java.util.UUID;
12: 
13: @Entity
14: @Setter
15: @Getter
16: public class Delivery {
17:     @Id
18:     @GeneratedValue (strategy = GenerationType.AUTO)
19:     private UUID deliveryId;
20: 
21:     @Embedded
22:     private Email deliveryRecipientEmail;
23: 
24:     @OneToMany
25:     private List<AbstractOrderPosition> deliveryContent = new ArrayList<>();
26: }
27: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\repository\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.delivery.domain.entity.Delivery;
5: 
6: import java.util.UUID;
7: 
8: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.HttpStatus;
5: import org.springframework.http.ResponseEntity;
6: import org.springframework.transaction.annotation.Transactional;
7: import org.springframework.web.bind.annotation.*;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.domainprimitives.Email;
10: import thkoeln.archilab.ecommerce.solution.order.domain.entity.Order;
11: 
12: import java.util.ArrayList;
13: import java.util.Comparator;
14: import java.util.List;
15: 
16: @RestController
17: @Transactional
18: public class OrderController {
19: 
20:     private final OrderService orderService;
21: 
22:     private OrderDtoMapper orderDtoMapper = new OrderDtoMapper();
23: 
24:     @Autowired
25:     public OrderController(OrderService orderService) {
26:         this.orderService = orderService;
27:     }
28: 
29:     /**
30:      * find all orders for user with emailID, ordered by Time
31:      * GET /orders?email=...
32:      * The returned Data needs to be an array of orders. If email is not found,
33:      * or has no orders, then an empty array is returned.
34:      * @returns Array<OrderDto>
35:      */
36:     @GetMapping(value = "/orders")
37:     public ResponseEntity<ArrayList<OrderDto>> getForSpecificEmail(
38:             @RequestParam(required = false) String email,
39:             @RequestParam(required = false) String filter) {
40:         ArrayList<OrderDto> orderDtos = new ArrayList<>();
41:         try {
42:             Email emailString = Email.of(email);
43:         } catch (ShopException shopException) {
44:             return new ResponseEntity<>(orderDtos, HttpStatus.OK);
45:         }
46:         Email emailString = Email.of(email);
47:         if (orderService.existsByUserEmail(emailString)) {
48:             if (filter != null && filter.equals("latest")) {
49:                 List<Order> orders = new ArrayList<>(orderService.findByUserEmail(emailString));
50:                 Order latestOrder = orders.stream().max(Comparator.comparing(Order::getSubmissionDate)).get();
51:                 orderDtos.add(orderDtoMapper.mapToDto(latestOrder));
52:             } else {
53:                 for (Order order : orderService.findByUserEmail(emailString)) {
54:                     orderDtos.add(orderDtoMapper.mapToDto(order));
55:                 }
56:             }
57:         }
58:         return ResponseEntity.ok().body(orderDtos);
59:     }
60: }
61: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: 
10: import java.util.ArrayList;
11: import java.util.List;
12: import java.util.UUID;
13: 
14: @Getter
15: @Setter
16: @NoArgsConstructor
17: @AllArgsConstructor
18: public class OrderDto {
19:     private UUID id;
20:     private Email email;
21:     private Money price;
22:     private List<OrderPositionDto> orderPositions = new ArrayList<>();
23: }
24: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDtoMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import thkoeln.archilab.ecommerce.domainprimitives.Money;
5: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.Order;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.util.ArrayList;
10: import java.util.List;
11: 
12: public class OrderDtoMapper {
13:     private ModelMapper modelMapper = new ModelMapper();
14:     private OrderPositionDtoMapper orderPositionDtoMapper = new OrderPositionDtoMapper();
15: 
16:     public OrderDto mapToDto(Order order) {
17:         OrderDto orderDto = new OrderDto();
18:         MoneyType moneyValue = order.getOrderPositions().get(0).getProduct().getSellPrice();
19:         moneyValue = moneyValue.subtract(moneyValue);
20: 
21:         for (AbstractOrderPosition orderPosition : order.getOrderPositions()) {
22:             int orderPositionQuantity = orderPosition.getQuantity();
23:             MoneyType orderPositionProductSellPrice = orderPosition.getProduct().getSellPrice();
24:             moneyValue = moneyValue.add(orderPositionProductSellPrice.multiplyBy(orderPositionQuantity));
25:         }
26: 
27: 
28:         orderDto.setId(order.getOrderId());
29:         orderDto.setEmail(order.getUserEmail());
30:         orderDto.setPrice((Money) moneyValue);
31:         List<OrderPositionDto> orderPositionDtos = new ArrayList<>();
32: 
33:         for (AbstractOrderPosition orderPosition : order.getOrderPositions()) {
34:             orderPositionDtos.add(orderPositionDtoMapper.orderPositionToOrderPositionDto(orderPosition));
35:         }
36: 
37:         orderDto.setOrderPositions(orderPositionDtos);
38: 
39:         return orderDto;
40:     }
41: 
42:     public Order mapToEntity (OrderDto orderDto) {
43:         return modelMapper.map(orderDto, Order.class);
44:     }
45: }
46: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDto.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: 
10: @Getter
11: @Setter
12: @NoArgsConstructor
13: @AllArgsConstructor
14: public class OrderPositionDto {
15:     private UUID productId;
16:     private int quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDtoMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
5: 
6: public class OrderPositionDtoMapper {
7:     private ModelMapper modelMapper = new ModelMapper();
8: 
9:     public OrderPositionDto orderPositionToOrderPositionDto(AbstractOrderPosition orderPosition) {
10:         OrderPositionDto orderPositionDto = new OrderPositionDto();
11:         orderPositionDto.setProductId(orderPosition.getProduct().getProductId());
12:         return modelMapper.map(orderPosition, OrderPositionDto.class);
13:     }
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
7: import thkoeln.archilab.ecommerce.solution.order.domain.entity.Order;
8: import thkoeln.archilab.ecommerce.solution.order.domain.repository.OrderRepository;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: 
11: import java.util.*;
12: 
13: @Service
14: public class OrderService {
15: 
16:     private final OrderRepository orderRepository;
17: 
18:     @Autowired
19:     public OrderService (OrderRepository orderRepository) {
20:         this.orderRepository = orderRepository;
21:     }
22: 
23:     public void save(Order order) {
24:         orderRepository.save(order);
25:     }
26: 
27:     public boolean existsByUserEmail(EmailType userEmail) {
28:         return orderRepository.existsByUserEmail((Email) userEmail);
29:     }
30: 
31:     public List<Order> findByUserEmail(EmailType userEmail) {
32:         return orderRepository.findByUserEmail((Email) userEmail);
33:     }
34: 
35:     public void newOrder(EmailType userEmail, List<AbstractOrderPosition> abstractOrderPositions) {
36:         Order newOrder = new Order((Email) userEmail, abstractOrderPositions);
37:         save(newOrder);
38:     }
39: 
40:     public Iterable<Order> findAll() {
41:         return orderRepository.findAll();
42:     }
43: 
44:     public void deleteAll() {
45:         orderRepository.deleteAll();
46:     }
47: }
48: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\entity\AbstractOrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: 
7: import javax.persistence.*;
8: import java.util.UUID;
9: 
10: @Entity
11: @Inheritance (strategy = InheritanceType.TABLE_PER_CLASS)
12: @Getter
13: @NoArgsConstructor
14: public abstract class AbstractOrderPosition {
15:     @Id
16:     @GeneratedValue(strategy = GenerationType.AUTO)
17:     private UUID orderId;
18: 
19:     @Embedded
20:     private Email userEmail;
21: 
22:     private Integer quantity;
23: 
24:     @ManyToOne
25:     private AbstractProduct product;
26: 
27:     private String comment;
28: 
29:     public void setUserEmail(Email userEmail) {
30:         this.userEmail = userEmail;
31:     }
32: 
33:     public void setQuantity(Integer quantity) {
34:         this.quantity = quantity;
35:     }
36: 
37:     public void setProduct(AbstractProduct product) {
38:         this.product = product;
39:     }
40: 
41:     public void setComment(String comment) {
42:         this.comment = comment; }
43: 
44:     public AbstractOrderPosition(Email userEmail, AbstractProduct product, int quantity, String comment) {
45:         this.userEmail = userEmail;
46:         this.product = product;
47:         this.quantity = quantity;
48:         this.comment = comment;
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\entity\AbstractProduct.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: 
8: import javax.persistence.*;
9: import java.util.UUID;
10: 
11: @Entity
12: @Inheritance (strategy = InheritanceType.TABLE_PER_CLASS)
13: @Getter
14: @Setter
15: @NoArgsConstructor
16: public abstract class AbstractProduct {
17:     @Id
18:     private UUID productId;
19:     @Embedded@AttributeOverrides({
20:             @AttributeOverride(name = "amount", column =
21:             @Column(name = "purchasedAmount")),
22:             @AttributeOverride(name = "currency", column =
23:             @Column(name = "purchasedCurrency"))
24:     })
25:     private Money purchasedPrice;
26:     @Embedded
27:     @AttributeOverrides({
28:             @AttributeOverride(name = "amount", column =
29:             @Column(name = "sellAmount")),
30:             @AttributeOverride(name = "currency", column =
31:             @Column(name = "sellCurrency"))
32:     })
33:     private Money sellPrice;
34: 
35:     public AbstractProduct(UUID productId, Money purchasedPrice, Money sellPrice) {
36:         this.productId = productId;
37:         this.purchasedPrice = purchasedPrice;
38:         this.sellPrice = sellPrice;
39:     }
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\entity\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: 
7: import javax.persistence.*;
8: import java.time.LocalDateTime;
9: import java.util.ArrayList;
10: import java.util.List;
11: import java.util.UUID;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor
16: @Table (name = "User_Orders")
17: public class Order {
18:     @Id
19:     @GeneratedValue (strategy = GenerationType.AUTO)
20:     private UUID orderId;
21: 
22:     @Embedded
23:     private Email userEmail;
24: 
25:     @OneToMany
26:     private List<AbstractOrderPosition> orderPositions = new ArrayList<>();
27: 
28:     private LocalDateTime submissionDate = LocalDateTime.now();
29: 
30:     public Order(Email email, List<AbstractOrderPosition> orderPositions) {
31:         this.userEmail = email;
32:         this.orderPositions = orderPositions;
33:     }
34: }
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\repository\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.solution.order.domain.entity.Order;
6: 
7: import java.util.List;
8: 
9: public interface OrderRepository extends CrudRepository<Order, String> {
10:     boolean existsByUserEmail(Email userEmail);
11: 
12:     List<Order> findByUserEmail(Email userEmail);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\application\OrderPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractProduct;
7: import thkoeln.archilab.ecommerce.solution.orderposition.domain.entity.OrderPosition;
8: import thkoeln.archilab.ecommerce.solution.orderposition.domain.repository.OrderPositionRepository;
9: import thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject.OrderPositionType;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: 
13: import java.util.*;
14: 
15: @Service
16: public class OrderPositionService{
17:     private final OrderPositionRepository orderPositionRepository;
18: 
19:     @Autowired
20:     public OrderPositionService(
21:             OrderPositionRepository orderPositionRepository
22:     ) {
23:         this.orderPositionRepository = orderPositionRepository;
24:     }
25: 
26:     public void save(OrderPosition orderPosition) {
27:         orderPositionRepository.save(orderPosition);
28:     }
29: 
30:     public OrderPosition newOrderPosition(EmailType userEmail, AbstractProduct product, int quantity) {
31:         OrderPosition newOrderPosition = new OrderPosition((Email) userEmail, product, quantity, null);
32:         save(newOrderPosition);
33:         return newOrderPosition;
34:     }
35: 
36:     public OrderPosition newDeliveryOrderPosition(EmailType userEmail, AbstractProduct product, int quantity) {
37:         OrderPosition newOrderPosition = newOrderPosition(userEmail, product, quantity);
38:         newOrderPosition.setOrderPositionType(OrderPositionType.DELIVERY);
39:         save(newOrderPosition);
40:         return newOrderPosition;
41:     }
42: 
43:     private List<OrderPosition> findAllOfSpecificType(OrderPositionType orderPositionType) {
44:         List<OrderPosition> allOfSpecificType = new ArrayList<>();
45: 
46:         for (OrderPosition orderPosition : findAll()) {
47:             if (orderPosition.getOrderPositionType() == orderPositionType)
48:                 allOfSpecificType.add(orderPosition);
49:         }
50: 
51:         return allOfSpecificType;
52:     }
53: 
54:     private Map<UUID, Integer> getMapOfSpecificTypeForUser(EmailType userEmail) {
55:         Map<UUID, Integer> mapOfSpecificType = new HashMap<>();
56: 
57:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.DELIVERY)) {
58:             if (orderPosition.getUserEmail().equals(userEmail)) {
59:                 UUID productId = getProductId(orderPosition);
60:                 int quantity = getQuantity(orderPosition);
61:                 if (mapOfSpecificType.size() > 0 && mapOfSpecificType.containsKey(getProductId(orderPosition)))
62:                     mapOfSpecificType.replace(productId, mapOfSpecificType.get(productId) + quantity);
63:                 else mapOfSpecificType.put(productId, quantity);
64:             }
65:         }
66: 
67:         return mapOfSpecificType;
68:     }
69: 
70:     public Map<UUID, Integer> getMapOfDeliveriesForUser(EmailType userEmail) {
71:         return getMapOfSpecificTypeForUser(userEmail);
72:     }
73: 
74: 
75: 
76:     public UUID getProductId(OrderPosition orderPosition) {
77:         return orderPosition.getProduct().getProductId();
78:     }
79: 
80:     public Integer getQuantity(OrderPosition orderPosition) {
81:         return orderPosition.getQuantity();
82:     }
83: 
84:     public void reduceFromQuantity(OrderPosition orderPosition, int quantity) {
85:         int oldQuantity = orderPosition.getQuantity();
86:         if (oldQuantity < quantity)
87:             throw new ShopException("Invalid quantity!");
88:         else orderPosition.setQuantity(oldQuantity - quantity);
89:         save(orderPosition);
90:     }
91: 
92:     public void removeFromReserved(UUID productId, int newTotalAndReservedDifference) {
93:         if (newTotalAndReservedDifference > 0) {
94:             for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.ORDER)) {
95:                 if (getProductId(orderPosition) == productId) {
96:                     if (getQuantity(orderPosition) >= newTotalAndReservedDifference) {
97:                         reduceFromQuantity(orderPosition, newTotalAndReservedDifference);
98:                         newTotalAndReservedDifference = 0;
99:                         break;
100:                     } else {
101:                         newTotalAndReservedDifference -= getQuantity(orderPosition);
102:                         reduceFromQuantity(orderPosition, getQuantity(orderPosition));
103:                     }
104:                 }
105:             }
106:         }
107:     }
108: 
109:     public void deleteAllEmptyOrderPositions() {
110:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.ORDER)) {
111:             if (getQuantity(orderPosition) == 0)
112:                 delete(orderPosition);
113:         }
114:     }
115: 
116:     private Iterable<OrderPosition> findAll() {
117:         return orderPositionRepository.findAll();
118:     }
119: 
120:     private void deleteAll(Iterable<OrderPosition> orderPositions) {
121:         orderPositionRepository.deleteAll(orderPositions);
122:     }
123: 
124:     private void delete(OrderPosition orderPosition) {
125:         orderPositionRepository.delete(orderPosition);
126:     }
127: 
128:     public void deleteDeliveries() {
129:         deleteAll(findAllOfSpecificType(OrderPositionType.DELIVERY));
130:     }
131: }
132: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\application\ProductSpecificOrderPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.orderposition.domain.entity.OrderPosition;
6: import thkoeln.archilab.ecommerce.solution.orderposition.domain.repository.OrderPositionRepository;
7: import thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject.OrderPositionType;
8: 
9: import java.util.*;
10: 
11: @Service
12: public class ProductSpecificOrderPositionService {
13: 
14:     private final OrderPositionRepository orderPositionRepository;
15:     private final OrderPositionService orderPositionService;
16: 
17:     @Autowired
18:     public ProductSpecificOrderPositionService(
19:             OrderPositionRepository orderPositionRepository,
20:             OrderPositionService orderPositionService) {
21:         this.orderPositionRepository = orderPositionRepository;
22:         this.orderPositionService = orderPositionService;
23:     }
24: 
25:     private List<OrderPosition> findAllOfSpecificType() {
26:         List<OrderPosition> allOfSpecificType = new ArrayList<>();
27: 
28:         for (OrderPosition orderPosition : findAll()) {
29:             if (orderPosition.getOrderPositionType() == OrderPositionType.HISTORY)
30:                 allOfSpecificType.add(orderPosition);
31:         }
32: 
33:         return allOfSpecificType;
34:     }
35: 
36:     public Map<UUID, Integer> getMapOfCompleteHistory() {
37:         Map<UUID, Integer> mapOfCompleteHistory = new HashMap<>();
38: 
39:         for (OrderPosition orderPosition : findAllOfSpecificType()) {
40:             UUID productId = orderPositionService.getProductId(orderPosition);
41:             int quantity = orderPositionService.getQuantity(orderPosition);
42: 
43:             if (mapOfCompleteHistory.size() > 0
44:                     && mapOfCompleteHistory.containsKey(orderPositionService.getProductId(orderPosition)))
45:                 mapOfCompleteHistory.replace(productId, mapOfCompleteHistory.get(productId) + quantity);
46:             else mapOfCompleteHistory.put(productId, quantity);
47:         }
48: 
49:         return mapOfCompleteHistory;
50:     }
51: 
52:     private Iterable<OrderPosition> findAll() {
53:         return orderPositionRepository.findAll();
54:     }
55: 
56:     public void deleteAll() {
57:         orderPositionRepository.deleteAll();
58:     }
59: }
60: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\application\ShoppingBasketSpecificOrderPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractProduct;
7: import thkoeln.archilab.ecommerce.solution.orderposition.domain.entity.OrderPosition;
8: import thkoeln.archilab.ecommerce.solution.orderposition.domain.repository.OrderPositionRepository;
9: import thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject.OrderPositionType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
11: 
12: import java.util.*;
13: 
14: @Service
15: public class ShoppingBasketSpecificOrderPositionService {
16: 
17:     private final OrderPositionRepository orderPositionRepository;
18: 
19:     @Autowired
20:     public ShoppingBasketSpecificOrderPositionService(OrderPositionRepository orderPositionRepository) {
21:         this.orderPositionRepository = orderPositionRepository;
22:     }
23: 
24:     private List<OrderPosition> findAllOfSpecificType(OrderPositionType orderPositionType) {
25:         List<OrderPosition> allOfSpecificType = new ArrayList<>();
26: 
27:         for (OrderPosition orderPosition : findAll()) {
28:             if (orderPosition.getOrderPositionType() == orderPositionType)
29:                 allOfSpecificType.add(orderPosition);
30:         }
31: 
32:         return allOfSpecificType;
33:     }
34: 
35:     private int getQuantity(OrderPosition orderPosition) {
36:         return orderPosition.getQuantity();
37:     }
38: 
39:     private UUID getProductId(OrderPosition orderPosition) {
40:         return orderPosition.getProduct().getProductId();
41:     }
42: 
43:     public OrderPosition newOrderPosition(EmailType userEmail, AbstractProduct product, int quantity) {
44:         OrderPosition newOrderPosition = new OrderPosition((Email) userEmail, product, quantity, null);
45:         save(newOrderPosition);
46:         return newOrderPosition;
47:     }
48: 
49:     public void deleteAllEmptyOrderPositions() {
50:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.ORDER)) {
51:             if (getQuantity(orderPosition) == 0)
52:                 delete(orderPosition);
53:         }
54:     }
55: 
56:     public void setCommentForShoppingBasketPosition(EmailType userEmail, AbstractProduct product, String comment) {
57:         orderPositionRepository.findByUserEmailAndProductAndOrderPositionType(
58:                 userEmail,
59:                 product,
60:                 OrderPositionType.ORDER).setComment(comment);
61:     }
62: 
63:     public String getCommentForShoppingBasketPosition(EmailType userEmail, AbstractProduct product) {
64:         return orderPositionRepository.findByUserEmailAndProductAndOrderPositionType(
65:                 userEmail,
66:                 product,
67:                 OrderPositionType.ORDER).getComment();
68:     }
69: 
70:     public List<OrderPosition> findAllOrdersForUser(EmailType email) {
71:         List<OrderPosition> orderPositions = new ArrayList<>();
72: 
73:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.ORDER)) {
74:             if (orderPosition.getUserEmail().equals(email)) {
75:                 orderPositions.add(orderPosition);
76:             }
77:         }
78: 
79:         return orderPositions;
80:     }
81: 
82:     public void markOrderPositionsOfUserAsHistory(EmailType userEmail) {
83:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.ORDER)) {
84:             if (orderPosition.getUserEmail().equals(userEmail)){
85:                 orderPosition.setOrderPositionType(OrderPositionType.HISTORY);
86:                 save(orderPosition);
87:             }
88:         }
89:     }
90: 
91:     private Map<UUID, Integer> getMapOfSpecificTypeForUser(EmailType userEmail) {
92:         Map<UUID, Integer> mapOfSpecificType = new HashMap<>();
93: 
94:         for (OrderPosition orderPosition : findAllOfSpecificType(OrderPositionType.HISTORY)) {
95:             if (orderPosition.getUserEmail().equals(userEmail)) {
96:                 UUID productId = getProductId(orderPosition);
97:                 int quantity = getQuantity(orderPosition);
98:                 if (mapOfSpecificType.size() > 0 && mapOfSpecificType.containsKey(getProductId(orderPosition)))
99:                     mapOfSpecificType.replace(productId, mapOfSpecificType.get(productId) + quantity);
100:                 else mapOfSpecificType.put(productId, quantity);
101:             }
102:         }
103: 
104:         return mapOfSpecificType;
105:     }
106: 
107:     public Map<UUID, Integer> getMapOfHistoryForUser(EmailType userEmail) {
108:         return getMapOfSpecificTypeForUser(userEmail);
109:     }
110: 
111:     private Iterable<OrderPosition> findAll() {
112:         return orderPositionRepository.findAll();
113:     }
114: 
115:     private void delete(OrderPosition orderPosition) {
116:         orderPositionRepository.delete(orderPosition);
117:     }
118: 
119:     public void deleteAll() {
120:         orderPositionRepository.deleteAll();
121:     }
122: 
123:     private void save(OrderPosition orderPosition) {
124:         orderPositionRepository.save(orderPosition);
125:     }
126: }
127: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\application\UserSpecificOrderPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.orderposition.domain.repository.OrderPositionRepository;
6: 
7: @Service
8: public class UserSpecificOrderPositionService {
9:     private final OrderPositionRepository orderPositionRepository;
10: 
11:     @Autowired
12:     public UserSpecificOrderPositionService(OrderPositionRepository orderPositionRepository) {
13:         this.orderPositionRepository = orderPositionRepository;
14:     }
15: 
16:     public void deleteAll() {
17:         orderPositionRepository.deleteAll();
18:     }
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\domain\entity\OrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
7: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractProduct;
8: import thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject.OrderPositionType;
9: 
10: import javax.persistence.Embedded;
11: import javax.persistence.Entity;
12: import javax.persistence.ManyToOne;
13: 
14: @Entity
15: @Getter
16: @NoArgsConstructor
17: public class OrderPosition extends AbstractOrderPosition {
18:     @Embedded
19:     private Email userEmail;
20: 
21:     @ManyToOne
22:     private AbstractProduct product;
23: 
24:     private Integer quantity;
25: 
26:     private OrderPositionType orderPositionType = OrderPositionType.ORDER;
27: 
28:     private String comment;
29: 
30:     public void setProduct(AbstractProduct abstractProduct) {
31:         this.product = abstractProduct;
32:     }
33: 
34:     public void setQuantity(Integer quantity) {
35:         this.quantity = quantity;
36:     }
37: 
38:     public void setOrderPositionType(OrderPositionType orderPositionType) {
39:         this.orderPositionType = orderPositionType;
40:     }
41: 
42:     public void setComment(String comment) {
43:         this.comment = comment;
44:     }
45: 
46:     public OrderPosition(Email userEmail, AbstractProduct product, int quantity, String comment) {
47:         super(userEmail, product, quantity, comment);
48:         this.userEmail = userEmail;
49:         this.product = product;
50:         this.quantity = quantity;
51:         this.comment = comment;
52:     }
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\domain\repository\OrderPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractProduct;
5: import thkoeln.archilab.ecommerce.solution.orderposition.domain.entity.OrderPosition;
6: import thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject.OrderPositionType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
8: 
9: import java.util.UUID;
10: 
11: public interface OrderPositionRepository extends CrudRepository<OrderPosition, UUID> {
12:     OrderPosition findByUserEmailAndProductAndOrderPositionType(EmailType userEmail, AbstractProduct product, OrderPositionType orderPositionType);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\orderposition\domain\valueobject\OrderPositionType.java ---
1: package thkoeln.archilab.ecommerce.solution.orderposition.domain.valueobject;
2: 
3: public enum OrderPositionType {
4:     ORDER,
5:     HISTORY,
6:     DELIVERY,
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.payment.domain.entity.Payment;
8: import thkoeln.archilab.ecommerce.solution.payment.domain.repository.PaymentRepository;
9: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import java.util.ArrayList;
15: import java.util.List;
16: import java.util.UUID;
17: 
18: @Service
19: public class PaymentService implements PaymentUseCases {
20: 
21:     private final PaymentRepository paymentRepository;
22: 
23:     private final PaymentUserService userService;
24: 
25:     @Autowired
26:     public PaymentService(PaymentRepository paymentRepository, PaymentUserService userService) {
27:         this.paymentRepository = paymentRepository;
28:         this.userService = userService;
29:     }
30: 
31:     private void save(Payment payment) {
32:         paymentRepository.save(payment);
33:     }
34: 
35:     private Payment newPayment(EmailType userEmail, MoneyType amount) {
36:         Payment newPayment = new Payment((Email) userEmail, (Money) amount);
37:         save(newPayment);
38:         return newPayment;
39:     }
40: 
41:     private List<Payment> findAllByEmail(EmailType userEmail) {
42:         List<Payment> newPaymentList = new ArrayList<>();
43: 
44:         for (Payment payment : paymentRepository.findAll()) {
45:             if (payment.getUserEmail().equals(userEmail))
46:                 newPaymentList.add(payment);
47:         }
48: 
49:         return newPaymentList;
50:     }
51: 
52:     @Override
53:     public UUID authorizePayment(EmailType userEmail, MoneyType amount) {
54:         if (userService.checkNullOrEmptyOrExists(userEmail))
55:             throw new ShopException("User does not exist!");
56:         if (amount == null || amount.getAmount() < 0.00F)
57:             throw new ShopException("Invalid amount!");
58:         if (amount.getAmount() > 500.00F)
59:             throw new ShopException("Payment cannot be processed!");
60: 
61:         return newPayment(userEmail, amount).getPaymentId();
62:     }
63: 
64:     @Override
65:     public MoneyType getPaymentTotal(EmailType userEmail) {
66:         if (userService.checkNullOrEmptyOrExists(userEmail))
67:             throw new ShopException("User does not exist!");
68: 
69: 
70:         if (findAllByEmail(userEmail).size() == 0) {
71:             return Money.of(0.00F, "EUR");
72:         }
73: 
74:         MoneyType paymentTotal = findAllByEmail(userEmail).get(0).getMoney();
75:         paymentTotal = paymentTotal.subtract(paymentTotal);
76: 
77:         for (Payment payment : findAllByEmail(userEmail)) {
78:             paymentTotal = paymentTotal.add(payment.getMoney());
79:         }
80: 
81:         return paymentTotal;
82:     }
83: 
84:     @Override
85:     public void deletePaymentHistory() {
86:         paymentRepository.deleteAll();
87:     }
88: }
89: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: 
5: public interface PaymentUserService {
6:     boolean checkNullOrEmptyOrExists(EmailType email);
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\entity\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @Setter
14: @Getter
15: @NoArgsConstructor
16: public class Payment {
17:     @Id
18:     @GeneratedValue (strategy = GenerationType.AUTO)
19:     private UUID paymentId;
20: 
21:     @Embedded
22:     private Email userEmail;
23: 
24:     @Embedded
25:     private Money money;
26: 
27:     public Payment(Email userEmail, Money money) {
28:         this.userEmail = userEmail;
29:         this.money = money;
30:     }
31: }
32: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\repository\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.payment.domain.entity.Payment;
5: 
6: import java.util.UUID;
7: 
8: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\product\application\ProductCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.product.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
6: import thkoeln.archilab.ecommerce.solution.orderposition.application.ProductSpecificOrderPositionService;
7: import thkoeln.archilab.ecommerce.solution.warehouse.application.WarehouseService;
8: import thkoeln.archilab.ecommerce.usecases.ProductCatalogUseCases;
9: import thkoeln.archilab.ecommerce.ShopException;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.UUID;
13: 
14: @Service
15: public class ProductCatalogService implements ProductCatalogUseCases {
16: 
17:     private final ProductService productService;
18: 
19:     private final WarehouseService warehouseService;
20: 
21:     private final OrderService orderService;
22: 
23:     private final ProductShoppingBasketService shoppingBasketService;
24: 
25:     private final ProductSpecificOrderPositionService orderPositionService;
26: 
27:     @Autowired
28:     public ProductCatalogService(
29:             ProductService productService,
30:             WarehouseService warehouseService,
31:             OrderService orderService,
32:             ProductShoppingBasketService shoppingBasketService,
33:             ProductSpecificOrderPositionService orderPositionService
34:     ) {
35:         this.productService = productService;
36:         this.warehouseService = warehouseService;
37:         this.orderService = orderService;
38:         this.shoppingBasketService = shoppingBasketService;
39:         this.orderPositionService = orderPositionService;
40:     }
41: 
42:     @Override
43:     public void addProductToCatalog(UUID productId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellPrice) {
44:         if (productId == null) throw new ShopException("Product Id can't be null!");
45:         if (productService.existsById(productId)) throw new ShopException("This product already exists!");
46:         if (name == null || name.isEmpty() || description == null || description.isEmpty())
47:             throw new ShopException("Invalid name or description!");
48:         if (size != null && size <= 0)
49:             throw new ShopException("Invalid size!");
50:         if (purchasePrice == null || purchasePrice.getAmount() <= 0.00F)
51:             throw new ShopException("Invalid purchase price!");
52:         if (sellPrice == null || sellPrice.getAmount() < 0.00F || sellPrice.getAmount() < purchasePrice.getAmount())
53:             throw new ShopException("Invalid sell price!");
54: 
55:         productService.newProduct(productId, name, description, size, purchasePrice, sellPrice);
56:     }
57: 
58:     @Override
59:     public void removeProductFromCatalog(UUID productId) {
60:         if (productService.checkNullOrEmpty(productId)) throw new ShopException("No such product exists!");
61:         if (warehouseService.existsById(productId)) throw new ShopException("Product is still in inventory!");
62:         if (shoppingBasketService.getReservedInventoryInShoppingBaskets(productId) > 0)
63:             throw new ShopException("Product is still reserved in a shopping basket!");
64:         if (orderPositionService.getMapOfCompleteHistory().containsKey(productId))
65:             throw new ShopException("Product is part of a completed Order!");
66: 
67:         productService.delete(productService.findById(productId));
68:     }
69: 
70:     @Override
71:     public MoneyType getSellPrice(UUID productId) {
72:         if (productService.checkNullOrEmpty(productId)) throw new ShopException("No such product exists");
73:         return productService.findById(productId).getSellPrice();
74:     }
75: 
76:     @Override
77:     public void deleteProductCatalog() {
78:         orderPositionService.deleteAll();
79:         orderService.deleteAll();
80:         warehouseService.deleteAll();
81:         productService.deleteAll();
82:     }
83: }
84: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\product\application\ProductService.java ---
1: package thkoeln.archilab.ecommerce.solution.product.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.product.domain.entity.Product;
7: import thkoeln.archilab.ecommerce.solution.product.domain.repository.ProductRepository;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: public class ProductService implements thkoeln.archilab.ecommerce.solution.warehouse.application.ProductService {
14:     private final ProductRepository productRepository;
15: 
16:     @Autowired
17:     public ProductService(ProductRepository productRepository) {
18:         this.productRepository = productRepository;
19:     }
20: 
21:     public void save(Product product) {
22:         productRepository.save(product);
23:     }
24: 
25:     public void newProduct(UUID productId,
26:                            String name,
27:                            String description,
28:                            Float size,
29:                            MoneyType purchasePrice,
30:                            MoneyType sellPrice) {
31:         Product newProduct = new Product(productId, name, description, size, (Money) purchasePrice, (Money) sellPrice);
32:         save(newProduct);
33:     }
34: 
35:     public boolean existsById(UUID productId) {
36:         return productRepository.existsById(productId);
37:     }
38: 
39:     public Product findById(UUID productId) {
40:         return productRepository.findById(productId).get();
41:     }
42: 
43:     public void delete(Product product) {
44:         productRepository.delete(product);
45:     }
46: 
47:     public boolean checkNullOrEmpty(UUID productId) {
48:         return productId == null || !existsById(productId);
49:     }
50: 
51:     public void deleteAll() {
52:         productRepository.deleteAll();
53:     }
54: }
55: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\product\application\ProductShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.product.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ProductShoppingBasketService {
6:     int getReservedInventoryInShoppingBaskets(UUID productId);
7: 
8:     void removeFromReserved(UUID productId);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\product\domain\entity\Product.java ---
1: package thkoeln.archilab.ecommerce.solution.product.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractProduct;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @Setter
14: @Getter
15: @NoArgsConstructor
16: public class Product extends AbstractProduct {
17:     private UUID productId;
18:     private String name;
19:     private String description;
20:     private Float size;
21:     @Embedded
22:     @AttributeOverrides({
23:             @AttributeOverride(name = "amount", column =
24:             @Column(name = "purchasedAmount")),
25:             @AttributeOverride(name = "currency", column =
26:             @Column(name = "purchasedCurrency"))
27:     })
28:     private Money purchasedPrice;
29:     @Embedded
30:     @AttributeOverrides({
31:             @AttributeOverride(name = "amount", column =
32:             @Column(name = "sellAmount")),
33:             @AttributeOverride(name = "currency", column =
34:             @Column(name = "sellCurrency"))
35:     })
36:     private Money sellPrice;
37: 
38:     public Product(UUID productId, String name, String description, Float size, Money purchasedPrice, Money sellPrice) {
39:         super(productId, purchasedPrice, sellPrice);
40:         this.productId = productId;
41:         this.name = name;
42:         this.description = description;
43:         this.size = size;
44:         this.purchasedPrice = purchasedPrice;
45:         this.sellPrice = sellPrice;
46:     }
47: }
48: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\product\domain\repository\ProductRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.product.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.product.domain.entity.Product;
5: 
6: import java.util.UUID;
7: 
8: public interface ProductRepository extends CrudRepository<Product, UUID> {
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\InventorySpecificShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
7: import thkoeln.archilab.ecommerce.solution.product.application.ProductShoppingBasketService;
8: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.repository.ShoppingBasketRepository;
10: 
11: import java.util.ArrayList;
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Service
16: public class InventorySpecificShoppingBasketService implements ProductShoppingBasketService {
17: 
18:     private final ShoppingBasketRepository shoppingBasketRepository;
19:     private final ShoppingBasketService shoppingBasketService;
20: 
21:     @Autowired
22:     public InventorySpecificShoppingBasketService(ShoppingBasketRepository shoppingBasketRepository,
23:                                                   ShoppingBasketService shoppingBasketService) {
24:         this.shoppingBasketRepository = shoppingBasketRepository;
25:         this.shoppingBasketService = shoppingBasketService;
26:     }
27: 
28:     private Iterable<ShoppingBasket> findAll() {
29:         return shoppingBasketRepository.findAll();
30:     }
31: 
32:     private UUID getProductId(AbstractOrderPosition orderPosition) {
33:         return orderPosition.getProduct().getProductId();
34:     }
35: 
36:     private Integer getQuantity(AbstractOrderPosition orderPosition) {
37:         return orderPosition.getQuantity();
38:     }
39: 
40:     private List<ShoppingBasket> findAllWithProduct(UUID productId) {
41:         List<ShoppingBasket> shoppingBaskets = new ArrayList<>();
42: 
43:         for (ShoppingBasket shoppingBasket : findAll()) {
44:             if (shoppingBasketService.productInBasket(shoppingBasket.getUserEmail(), productId))
45:                 shoppingBaskets.add(shoppingBasket);
46:         }
47: 
48:         return shoppingBaskets;
49:     }
50: 
51:     private ShoppingBasket findByUserEmail(Email userEmail) {
52:         return shoppingBasketRepository.findFirstByUserEmail(userEmail);
53:     }
54: 
55:     public List<AbstractOrderPosition> getShoppingBasketPositions(Email userEmail) {
56:         return findByUserEmail(userEmail).getShoppingBasketPositions();
57:     }
58: 
59:     public void removeFromShoppingBasketPositions(Email userEmail, AbstractOrderPosition orderPosition) {
60:         getShoppingBasketPositions(userEmail).remove(orderPosition);
61:         save(findByUserEmail(userEmail));
62:     }
63: 
64:     public void removeFromReserved(UUID productId) {
65: 
66:         for (ShoppingBasket shoppingBasket : findAllWithProduct(productId)) {
67:             for (AbstractOrderPosition orderPosition : shoppingBasket.getShoppingBasketPositions()) {
68:                 if (getProductId(orderPosition).equals(productId)) {
69:                     if (getQuantity(orderPosition).equals(0)) {
70:                         removeFromShoppingBasketPositions(shoppingBasket.getUserEmail(), orderPosition);
71:                         break;
72:                     }
73:                 }
74:             }
75:         }
76:     }
77: 
78:     public int getReservedInventoryInShoppingBaskets(UUID productId) {
79:         return shoppingBasketService.getReservedInventoryInShoppingBaskets(productId);
80:     }
81: 
82:     private void save(ShoppingBasket shoppingBasket) {
83:         shoppingBasketRepository.save(shoppingBasket);
84:     }
85: }
86: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketConflictException.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.UNPROCESSABLE_ENTITY, reason = "Invalid quantity!")
8: public class ShoppingBasketConflictException extends ShopException {
9:     public ShoppingBasketConflictException(String message) {
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.HttpStatus;
5: import org.springframework.http.ResponseEntity;
6: import org.springframework.web.bind.annotation.*;
7: import org.springframework.web.servlet.support.ServletUriComponentsBuilder;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.domainprimitives.Email;
10: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
11: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
12: 
13: import javax.transaction.Transactional;
14: import java.net.URI;
15: import java.util.Optional;
16: import java.util.UUID;
17: 
18: @RestController
19: @Transactional
20: public class ShoppingBasketController {
21: 
22:     private final ShoppingBasketService shoppingBasketService;
23:     private final ShoppingBasketControllerService shoppingBasketInternalService;
24:     private final ShoppingBasketDtoMapper shoppingBasketDtoMapper = new ShoppingBasketDtoMapper();
25:     private final ShoppingBasketPositionDtoMapper shoppingBasketPositionDtoMapper = new ShoppingBasketPositionDtoMapper();
26: 
27:     @Autowired
28:     public ShoppingBasketController(ShoppingBasketService shoppingBasketService,
29:                                     ShoppingBasketControllerService shoppingBasketInternalService) {
30:         this.shoppingBasketService = shoppingBasketService;
31:         this.shoppingBasketInternalService = shoppingBasketInternalService;
32:     }
33: 
34:     @GetMapping(value = "/shoppingBaskets", params = {"email"})
35:     public <E> ResponseEntity<ShoppingBasketDto> getForSpecificEmail(@RequestParam(required = false) E email) {
36:         ShoppingBasketDto basketDto = new ShoppingBasketDto();
37: 
38:         if (email instanceof String) {
39:             try {
40:                 Email emailString = Email.of((String) email);
41:             } catch (ShopException shopException) {
42:                 return new ResponseEntity<>(basketDto, HttpStatus.NOT_FOUND);
43:             }
44: 
45:             Email emailString = Email.of((String) email);
46: 
47:             if (shoppingBasketInternalService.existsByUserEmail(emailString))
48:                 basketDto = shoppingBasketDtoMapper.mapToDto(
49:                         shoppingBasketInternalService.findByUserEmail(emailString)
50:                 );
51:             else return new ResponseEntity<>(basketDto, HttpStatus.NOT_FOUND);
52:         } else if (email instanceof Email) {
53:             if (shoppingBasketInternalService.existsByUserEmail((Email) email))
54:                 basketDto = shoppingBasketDtoMapper.mapToDto(
55:                         shoppingBasketInternalService.findByUserEmail((Email) email)
56:                 );
57:             else return new ResponseEntity<>(basketDto, HttpStatus.NOT_FOUND);
58:         }
59:         return new ResponseEntity<>(basketDto, HttpStatus.OK);
60:     }
61: 
62:     @GetMapping("/shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions/{product-id}")
63:     public ResponseEntity<ShoppingBasketPositionDto> getShoppingBasketPositionProductById(
64:             @PathVariable("shoppingBasket-id") String shoppingBasketId,
65:             @PathVariable("product-id") String productId
66:     ) {
67:         if (shoppingBasketInternalService.existsById(UUID.fromString(shoppingBasketId))) {
68:             Optional<ShoppingBasket> shoppingBasketOptional =
69:                     shoppingBasketInternalService.findById(UUID.fromString(shoppingBasketId));
70:             ShoppingBasket shoppingBasket = new ShoppingBasket();
71: 
72:             if (shoppingBasketOptional.isPresent())
73:                 shoppingBasket = shoppingBasketOptional.get();
74: 
75:             Email userEmail = shoppingBasket.getUserEmail();
76:             ShoppingBasketPositionDto shoppingBasketPositionDto;
77: 
78:             for (AbstractOrderPosition orderPosition :
79:                     shoppingBasketInternalService.getShoppingBasketPositions(userEmail)) {
80:                 if (orderPosition.getProduct().getProductId().equals(UUID.fromString(productId))) {
81:                     shoppingBasketPositionDto = shoppingBasketPositionDtoMapper.positionToPositionDto(orderPosition);
82:                     return ResponseEntity.ok().body(shoppingBasketPositionDto);
83:                 }
84:             }
85: 
86:             return ResponseEntity.notFound().build();
87:         }
88:         return ResponseEntity.notFound().build();
89:     }
90: 
91:     private ResponseEntity<ShoppingBasketDto> addRemoveFunctions(
92:             ShoppingBasket shoppingBasket,
93:             Email userEmail,
94:             UUID productId,
95:             int quantity,
96:             String comment,
97:             URI returnURI)
98:     {
99:         ShoppingBasketDto shoppingBasketDto = new ShoppingBasketDto();
100: 
101:         if (quantity > 0) {
102:             try {
103:                 shoppingBasketService.addProductToShoppingBasket(userEmail, productId, quantity);
104:             } catch (ShopException shopException) {
105:                 return ResponseEntity.status(HttpStatus.CONFLICT).build();
106:             }
107:             if (comment != null)
108:                 shoppingBasketService.setCommentForShoppingBasketPosition(userEmail, productId, comment);
109: 
110:             shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
111:             return ResponseEntity.created(returnURI).body(shoppingBasketDto);
112:         } else if (quantity < 0) {
113:             quantity = -quantity;
114: 
115:             if (comment != null)
116:                 shoppingBasketService.setCommentForShoppingBasketPosition(userEmail, productId, comment);
117:             try {
118:                 shoppingBasketService.removeProductFromShoppingBasket(userEmail, productId, quantity);
119:             } catch (ShopException shopException) {
120:                 return ResponseEntity.status(HttpStatus.CONFLICT).build();
121:             }
122: 
123:             shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
124:             return ResponseEntity.created(returnURI).body(shoppingBasketDto);
125:         }
126: 
127:         return ResponseEntity.created(returnURI).body(shoppingBasketDto);
128:     }
129: 
130:     @PostMapping("/shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions")
131:     public ResponseEntity<ShoppingBasketDto> addRemoveCertainQuantity(
132:             @RequestBody ShoppingBasketPositionDto positionDto,
133:             @PathVariable("shoppingBasket-id") String shoppingBasketId)
134:     throws ShoppingBasketConflictException, ShoppingBasketNotFoundException
135:     {
136:         if (shoppingBasketInternalService.existsById(UUID.fromString(shoppingBasketId))) {
137:             Optional<ShoppingBasket> shoppingBasketOptional =
138:                     shoppingBasketInternalService.findById(UUID.fromString(shoppingBasketId));
139:             ShoppingBasket shoppingBasket = new ShoppingBasket();
140: 
141:             if (shoppingBasketOptional.isPresent())
142:                 shoppingBasket = shoppingBasketOptional.get();
143: 
144:             Email userEmail = shoppingBasket.getUserEmail();
145:             UUID productId = positionDto.getProductId();
146:             Integer quantity = positionDto.getQuantity();
147:             String comment = positionDto.getComment();
148:             ShoppingBasketDto shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
149: 
150:             URI returnURI = ServletUriComponentsBuilder
151:                     .fromCurrentRequestUri()
152:                     .build()
153:                     .toUri();
154: 
155:             if (quantity == null) {
156:                 return ResponseEntity.created(returnURI).body(shoppingBasketDto);
157:             }
158: 
159:             if (shoppingBasketService.productInBasket(userEmail, productId)) {
160:                 return addRemoveFunctions(shoppingBasket, userEmail,  productId, quantity, comment, returnURI);
161:             } else {
162:                 try {
163:                     shoppingBasketService.addProductToShoppingBasket(userEmail, productId, quantity);
164:                 } catch (ShopException shopException) {
165:                     return ResponseEntity.status(HttpStatus.CONFLICT).build();
166:                 }
167: 
168:                 shoppingBasket = shoppingBasketInternalService.findByUserEmail(userEmail);
169:                 if (comment != null) {
170:                     shoppingBasketService.setCommentForShoppingBasketPosition(userEmail, productId, comment);
171:                 }
172: 
173:                 shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
174:             }
175:             return ResponseEntity.created(returnURI).body(shoppingBasketDto);
176:         }
177:         return new ResponseEntity<>(new ShoppingBasketDto(), HttpStatus.CONFLICT);
178:     }
179: 
180:     @PutMapping("shoppingBaskets/{shoppingBasket-id}/checkout")
181:     public ResponseEntity<ShoppingBasketDto> checkoutShoppingBasket(
182:             @PathVariable("shoppingBasket-id") String shoppingBasketId
183:     ) {
184:         if (shoppingBasketInternalService.existsById(UUID.fromString(shoppingBasketId))) {
185:             Optional<ShoppingBasket> shoppingBasketOptional =
186:                     shoppingBasketInternalService.findById(UUID.fromString(shoppingBasketId));
187:             ShoppingBasket shoppingBasket = new ShoppingBasket();
188: 
189:             if (shoppingBasketOptional.isPresent())
190:                 shoppingBasket = shoppingBasketOptional.get();
191:             Email userEmail = shoppingBasket.getUserEmail();
192:             ShoppingBasketDto shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
193: 
194:             if (shoppingBasketService.basketEmpty(userEmail))
195:                 return ResponseEntity.status(HttpStatus.CONFLICT).build();
196:             try {
197:                 shoppingBasketService.checkout(userEmail);
198:             } catch (ShopException shopException) {
199:                 return ResponseEntity.status(HttpStatus.CONFLICT).build();
200:             }
201: 
202:             return ResponseEntity.ok().body(shoppingBasketDto);
203:         } return ResponseEntity.notFound().build();
204:     }
205: 
206:     @DeleteMapping("shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions/{product-id}")
207:     public ResponseEntity<ShoppingBasketDto> deleteShoppingBasketPositionFromShoppingBasket(
208:             @PathVariable("shoppingBasket-id") String shoppingBasketId,
209:             @PathVariable("product-id") String productId
210:     ) {
211:         ShoppingBasketDto shoppingBasketDto;
212:         if (shoppingBasketInternalService.existsById(UUID.fromString(shoppingBasketId))) {
213:             Optional<ShoppingBasket> optionalShoppingBasket =
214:                     shoppingBasketInternalService.findById(UUID.fromString(shoppingBasketId));
215:             ShoppingBasket shoppingBasket = new ShoppingBasket();
216: 
217:             if (optionalShoppingBasket.isPresent())
218:                 shoppingBasket = optionalShoppingBasket.get();
219: 
220:             Email userEmail = shoppingBasket.getUserEmail();
221:             UUID idProduct = UUID.fromString(productId);
222: 
223:             if (shoppingBasketService.productInBasket(userEmail, idProduct)) {
224:                 int quantity = shoppingBasketInternalService.getQuantityOfProductInBasket(userEmail, idProduct);
225:                 shoppingBasketService.removeProductFromShoppingBasket(userEmail, idProduct, quantity);
226:                 shoppingBasketDto = shoppingBasketDtoMapper.mapToDto(shoppingBasket);
227:                 return ResponseEntity.ok().body(shoppingBasketDto);
228:             }
229:         } return ResponseEntity.notFound().build();
230:     }
231: }
232: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketControllerService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
7: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
8: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.repository.ShoppingBasketRepository;
9: 
10: import java.util.List;
11: import java.util.Optional;
12: import java.util.UUID;
13: 
14: @Service
15: public class ShoppingBasketControllerService {
16: 
17:     private final ShoppingBasketRepository shoppingBasketRepository;
18: 
19:     @Autowired
20:     public ShoppingBasketControllerService(ShoppingBasketRepository shoppingBasketRepository) {
21:         this.shoppingBasketRepository = shoppingBasketRepository;
22:     }
23: 
24:     private UUID getProductId(AbstractOrderPosition orderPosition) {
25:         return orderPosition.getProduct().getProductId();
26:     }
27: 
28:     private int getQuantity(AbstractOrderPosition orderPosition) {
29:         return orderPosition.getQuantity();
30:     }
31: 
32:     public boolean existsById(UUID shoppingBasketId) {
33:         return shoppingBasketRepository.existsById(shoppingBasketId);
34:     }
35: 
36:     public Optional<ShoppingBasket> findById(UUID shoppingBasketId) {
37:         return shoppingBasketRepository.findById(shoppingBasketId);
38:     }
39: 
40:     public boolean existsByUserEmail(Email userEmail) {
41:         return shoppingBasketRepository.existsByUserEmail(userEmail);
42:     }
43: 
44:     public ShoppingBasket findByUserEmail(Email userEmail) {
45: //        return shoppingBasketRepository.findByUserEmail(userEmail);
46: //    }
47: //
48: //    public ShoppingBasket findFirstByEmail(Email userEmail) {
49:         return shoppingBasketRepository.findFirstByUserEmail(userEmail);
50:     }
51: 
52:     public List<AbstractOrderPosition> getShoppingBasketPositions(Email userEmail) {
53:         return findByUserEmail(userEmail).getShoppingBasketPositions();
54:     }
55: 
56:     public int getQuantityOfProductInBasket(Email userEmail, UUID productId) {
57:         int quantity = 0;
58: 
59:         for (AbstractOrderPosition orderPosition : getShoppingBasketPositions(userEmail)) {
60:             if (getProductId(orderPosition).equals(productId)) {
61:                 quantity += getQuantity(orderPosition);
62:                 break;
63:             }
64:         }
65: 
66:         return quantity;
67:     }
68: 
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import java.util.UUID;
9: 
10: @Getter
11: @Setter
12: @NoArgsConstructor
13: @AllArgsConstructor
14: public class ShoppingBasketDto {
15:     private UUID id;
16:     private Email email;
17:     int totalQuantity;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketDtoMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
5: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
6: 
7: public class ShoppingBasketDtoMapper {
8:     private ModelMapper modelMapper = new ModelMapper();
9: 
10:     public ShoppingBasketDto mapToDto(ShoppingBasket shoppingBasket) {
11:         ShoppingBasketDto shoppingBasketDto = new ShoppingBasketDto();
12:         int totalQuantity = 0;
13: 
14:         for (AbstractOrderPosition orderPosition : shoppingBasket.getShoppingBasketPositions()) {
15:             totalQuantity += orderPosition.getQuantity();
16:         }
17: 
18:         shoppingBasketDto.setId(shoppingBasket.getShoppingBasketId());
19:         shoppingBasketDto.setEmail(shoppingBasket.getUserEmail());
20:         shoppingBasketDto.setTotalQuantity(totalQuantity);
21: 
22:         return shoppingBasketDto;
23:     }
24: 
25:     public ShoppingBasket mapToEntity (ShoppingBasketDto shoppingBasketDto) {
26:         return modelMapper.map(shoppingBasketDto, ShoppingBasket.class);
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketInternalService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
8: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.repository.ShoppingBasketRepository;
10: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.valueobject.ShoppingBasketState;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: 
13: import java.util.*;
14: 
15: @Service
16: public class ShoppingBasketInternalService {
17:     private final ShoppingBasketRepository shoppingBasketRepository;
18: 
19:     @Autowired
20:     public ShoppingBasketInternalService(ShoppingBasketRepository shoppingBasketRepository) {
21:         this.shoppingBasketRepository = shoppingBasketRepository;
22:     }
23: 
24:     public void save(ShoppingBasket shoppingBasket) {
25:         shoppingBasketRepository.save(shoppingBasket);
26:     }
27: 
28:     public boolean existsByUserEmail(EmailType shoppingBasketUserEmail) {
29:         return shoppingBasketRepository.existsByUserEmail((Email) shoppingBasketUserEmail);
30:     }
31: 
32:     public ShoppingBasket findByUserEmail(EmailType shoppingBasketUserEmail) {
33:         return shoppingBasketRepository.findFirstByUserEmail((Email) shoppingBasketUserEmail);
34:     }
35: 
36:     public void changeStateTo(EmailType shoppingBasketUserEmail, ShoppingBasketState shoppingBasketState) {
37:         findByUserEmail(shoppingBasketUserEmail).setShoppingBasketState(shoppingBasketState);
38:     }
39: 
40:     public Iterable<ShoppingBasket> findAll() {
41:         return shoppingBasketRepository.findAll();
42:     }
43: 
44:     public void addNewQuantityInOrderPosition(EmailType userEmail, UUID productId, int quantity) {
45:         for (AbstractOrderPosition orderPosition : getShoppingBasketPositions(userEmail)) {
46:             if (getProductId(orderPosition).equals(productId)) {
47:                 int oldQuantity = orderPosition.getQuantity();
48:                 orderPosition.setQuantity(oldQuantity + quantity);
49:                 save(findByUserEmail(userEmail));
50:                 break;
51:             }
52:         }
53:     }
54: 
55:     public UUID getProductId(AbstractOrderPosition orderPosition) {
56:         return orderPosition.getProduct().getProductId();
57:     }
58: 
59:     public List<AbstractOrderPosition> getShoppingBasketPositions(EmailType userEmail) {
60:         return findByUserEmail(userEmail).getShoppingBasketPositions();
61:     }
62: 
63:     public void addToShoppingBasketPositions(EmailType userEmail, AbstractOrderPosition orderPosition){
64:         getShoppingBasketPositions(userEmail).add(orderPosition);
65:         save(findByUserEmail(userEmail));
66:     }
67: 
68:     public Integer getQuantity(AbstractOrderPosition orderPosition) {
69:         return orderPosition.getQuantity();
70:     }
71: 
72:     public void removeFromShoppingBasketPositions(EmailType userEmail, AbstractOrderPosition orderPosition) {
73:         getShoppingBasketPositions(userEmail).remove(orderPosition);
74:         save(findByUserEmail(userEmail));
75:     }
76: 
77:     public void reduceQuantityInShoppingBasketPosition(EmailType userEmail, UUID productId, int quantity){
78:         for (AbstractOrderPosition orderPosition : getShoppingBasketPositions(userEmail)) {
79:             if (getProductId(orderPosition).equals(productId)) {
80:                 int oldQuantity = orderPosition.getQuantity();
81:                 if (oldQuantity < quantity)
82:                     throw new ShopException("Invalid quantity!");
83:                 else {
84:                     orderPosition.setQuantity(oldQuantity - quantity);
85:                 }
86:                 if (getQuantity(orderPosition) == 0)
87:                     removeFromShoppingBasketPositions(userEmail, orderPosition);
88:                 save(findByUserEmail(userEmail));
89:                 break;
90:             }
91:         }
92:     }
93: 
94:     public int getQuantityOfProductInBasket(EmailType userEmail, UUID productId) {
95:         int quantity = 0;
96: 
97:         for (AbstractOrderPosition orderPosition : getShoppingBasketPositions(userEmail)) {
98:             if (getProductId(orderPosition).equals(productId)) {
99:                 quantity += getQuantity(orderPosition);
100:                 break;
101:             }
102:         }
103: 
104:         return quantity;
105:     }
106: 
107:     public Map<UUID, Integer> returnShoppingBasketPositionsAsMap(EmailType userEmail) {
108:         Map<UUID, Integer> orderPositonMap = new HashMap<>();
109: 
110:         for (AbstractOrderPosition orderPosition : getShoppingBasketPositions(userEmail))
111:             orderPositonMap.put(
112:                     getProductId(orderPosition),
113:                     getQuantity(orderPosition)
114:             );
115: 
116:         return orderPositonMap;
117:     }
118: 
119:     public void deleteAll() {
120:         shoppingBasketRepository.deleteAll();
121:     }
122: }
123: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketNotFoundException.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "Shopping basket not found")
8: public class ShoppingBasketNotFoundException extends ShopException {
9:     public ShoppingBasketNotFoundException(String message) {
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketPositionDto.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: 
10: @Getter
11: @Setter
12: @NoArgsConstructor
13: @AllArgsConstructor
14: public class ShoppingBasketPositionDto {
15:     private UUID productId;
16:     private Integer quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketPositionDtoMapper.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
5: 
6: public class ShoppingBasketPositionDtoMapper {
7:     private ModelMapper modelMapper = new ModelMapper();
8: 
9:     public ShoppingBasketPositionDto positionToPositionDto(AbstractOrderPosition orderPosition) {
10:         return modelMapper.map(orderPosition, ShoppingBasketPositionDto.class);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
7: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
8: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
9: import thkoeln.archilab.ecommerce.solution.orderposition.application.ShoppingBasketSpecificOrderPositionService;
10: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
11: import thkoeln.archilab.ecommerce.solution.product.application.ProductService;
12: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
13: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.valueobject.ShoppingBasketState;
14: import thkoeln.archilab.ecommerce.ShopException;
15: import thkoeln.archilab.ecommerce.solution.warehouse.application.WarehouseService;
16: import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
17: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
18: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
19: 
20: import java.util.*;
21: 
22: @Service
23: public class ShoppingBasketService implements ShoppingBasketUseCases {
24: 
25:     private final ShoppingBasketInternalService shoppingBasketInternalService;
26: 
27:     private final OrderService orderService;
28: 
29:     private final ShoppingBasketSpecificOrderPositionService orderPositionService;
30: 
31:     private final WarehouseService warehouseService;
32: 
33:     private final ShoppingBasketUserService userService;
34: 
35:     private final ProductService productService;
36: 
37:     private final PaymentService paymentService;
38: 
39:     private final DeliveryService deliveryService;
40: 
41:     @Autowired
42:     public ShoppingBasketService(
43:             ShoppingBasketInternalService shoppingBasketInternalService,
44:             OrderService orderService,
45:             ShoppingBasketSpecificOrderPositionService orderPositionService,
46:             WarehouseService warehouseService,
47:             ShoppingBasketUserService userService,
48:             ProductService productService,
49:             PaymentService paymentService,
50:             DeliveryService deliveryService
51:     ) {
52:         this.shoppingBasketInternalService = shoppingBasketInternalService;
53:         this.orderService = orderService;
54:         this.orderPositionService = orderPositionService;
55:         this.warehouseService = warehouseService;
56:         this.userService = userService;
57:         this.productService = productService;
58:         this.paymentService = paymentService;
59:         this.deliveryService = deliveryService;
60:     }
61: 
62: 
63: 
64:     public boolean productInBasket(EmailType email, UUID productId) {
65:         for (AbstractOrderPosition orderPosition : shoppingBasketInternalService.getShoppingBasketPositions(email)) {
66:             if (shoppingBasketInternalService.getProductId(orderPosition).equals(productId))
67:                 return true;
68:         }
69:         return false;
70:     }
71: 
72:     public boolean basketEmpty(EmailType userEmail) {
73:         return shoppingBasketInternalService.getShoppingBasketPositions(userEmail).isEmpty();
74:     }
75: 
76:     public void newShoppingBasket(EmailType userId) {
77:         ShoppingBasket newShoppingBasket = new ShoppingBasket((Email) userId);
78:         newShoppingBasket.setShoppingBasketPositions(new ArrayList<>());
79:         shoppingBasketInternalService.save(newShoppingBasket);
80:     }
81: 
82:     @Override
83:     public void addProductToShoppingBasket(EmailType userEmail, UUID productId, int quantity) {
84:         if (userEmail == null || productId == null) throw new ShopException("Invalid input!");
85:         if (userService.checkNullOrEmptyOrExists(userEmail)) throw new ShopException("User does not exist!");
86:         if (!productService.existsById(productId)) throw new ShopException("No such product exists!");
87:         if (!warehouseService.existsById(productId)) throw new ShopException("No such product in warehouse!");
88:         if (quantity < 0 || warehouseService.getQuantity(productId) < quantity)
89:             throw new ShopException("Invalid quantity!");
90: 
91:         if (getState(userEmail) != ShoppingBasketState.PAYMENT_AUTHORIZED) {
92:             if (getState(userEmail) == ShoppingBasketState.FILLED
93:                     && productInBasket(userEmail, productId)) {
94:                 warehouseService.reduceQuantity(productId, quantity);
95:                 shoppingBasketInternalService.addNewQuantityInOrderPosition(userEmail, productId, quantity);
96:             } else {
97:                 warehouseService.reduceQuantity(productId, quantity);
98:                 shoppingBasketInternalService.addToShoppingBasketPositions(
99:                         userEmail,
100:                         orderPositionService.newOrderPosition(userEmail, productService.findById(productId), quantity)
101:                 );
102:                 shoppingBasketInternalService.changeStateTo(userEmail, ShoppingBasketState.FILLED);
103:             }
104:         }
105:     }
106: 
107:     @Override
108:     public void removeProductFromShoppingBasket(EmailType userEmail, UUID productId, int quantity) {
109:         if (userService.checkNullOrEmptyOrExists(userEmail))
110:             throw new ShopException("User does not exist!");
111:         if (productService.checkNullOrEmpty(productId))
112:             throw new ShopException("No such product exists!");
113:         if (quantity < 0) throw new ShopException("Invalid quantity");
114: 
115:         if (!basketEmpty(userEmail) && productInBasket(userEmail, productId)) {
116:             shoppingBasketInternalService.reduceQuantityInShoppingBasketPosition(userEmail, productId, quantity);
117:             orderPositionService.deleteAllEmptyOrderPositions();
118:             warehouseService.addQuantity(productId, quantity);
119:         } else throw new ShopException("Order with that product does not exist");
120: 
121:         if (basketEmpty(userEmail))
122:             shoppingBasketInternalService.changeStateTo(userEmail, ShoppingBasketState.EMPTY);
123: 
124:     }
125: 
126:     private void standardShoppingBasketChecks(EmailType userEmail, UUID productId) {
127:         if (userService.checkNullOrEmptyOrExists(userEmail))
128:             throw new ShopException("User does not exist!");
129:         if (productService.checkNullOrEmpty(productId) || !productService.existsById(productId))
130:             throw new ShopException("Product does not exist!");
131:         if (basketEmpty(userEmail))
132:             throw new ShopException("Shopping basket is empty!");
133:         if (!productInBasket(userEmail, productId))
134:             throw new ShopException("Product is not in shopping basket");
135:     }
136: 
137:     @Override
138:     public void setCommentForShoppingBasketPosition(EmailType userEmail, UUID productId, String comment) {
139:         standardShoppingBasketChecks(userEmail, productId);
140: 
141:         orderPositionService.setCommentForShoppingBasketPosition(userEmail, productService.findById(productId), comment);
142:     }
143: 
144:     @Override
145:     public String getCommentForShoppingBasketPosition(EmailType userEmail, UUID productId) {
146:         standardShoppingBasketChecks(userEmail, productId);
147: 
148:         return orderPositionService.getCommentForShoppingBasketPosition(userEmail, productService.findById(productId));
149:     }
150: 
151:     @Override
152:     public Map<UUID, Integer> getShoppingBasketAsMap(EmailType userEmail) {
153:         if (userService.checkNullOrEmptyOrExists(userEmail))
154:             throw new ShopException("User does not exist!");
155: 
156:         return shoppingBasketInternalService.returnShoppingBasketPositionsAsMap(userEmail);
157:     }
158: 
159:     private List<AbstractOrderPosition> getShoppingBasketPositionsOfUserWithEmail(EmailType userEmail) {
160:         return shoppingBasketInternalService.findByUserEmail(userEmail).getShoppingBasketPositions();
161:     }
162: 
163:     private MoneyType getSellPrice(AbstractOrderPosition orderPosition) {
164:         return orderPosition.getProduct().getSellPrice();
165:     }
166: 
167:     public MoneyType getShoppingBasketMoneyValue(EmailType userEmail) {
168:         MoneyType moneyValue = getShoppingBasketPositionsOfUserWithEmail(userEmail).get(0).getProduct().getSellPrice();
169:         moneyValue = moneyValue.subtract(moneyValue);
170: 
171:         for (AbstractOrderPosition orderPosition :
172:                 shoppingBasketInternalService.getShoppingBasketPositions(userEmail)) {
173:             int orderPositionQuantity = shoppingBasketInternalService.getQuantity(orderPosition);
174:             MoneyType orderPositionProductSellPrice = getSellPrice(orderPosition);
175:             moneyValue = moneyValue.add(orderPositionProductSellPrice.multiplyBy(orderPositionQuantity));
176:         }
177: 
178:         return moneyValue;
179:     }
180: 
181:     @Override
182:     public MoneyType getShoppingBasketAsMoneyValue(EmailType userEmail) {
183:         if (userService.checkNullOrEmptyOrExists(userEmail))
184:             throw new ShopException("User does not exist!");
185: 
186:         return getShoppingBasketMoneyValue(userEmail);
187:     }
188: 
189:     @Override
190:     public int getReservedInventoryInShoppingBaskets(UUID productId) {
191:         if (productService.checkNullOrEmpty(productId))
192:             throw new ShopException("No such product exists!");
193: 
194:         int reservedQuantity = 0;
195: 
196:         for (ShoppingBasket shoppingBasket : shoppingBasketInternalService.findAll()) {
197:             if (productInBasket(shoppingBasket.getUserEmail(), productId)) {
198:                 reservedQuantity += shoppingBasketInternalService.getQuantityOfProductInBasket(shoppingBasket.getUserEmail(), productId);
199:             }
200:         }
201: 
202:         return reservedQuantity;
203:     }
204: 
205:     @Override
206:     public boolean isEmpty(EmailType userEmail) {
207:         if (userService.checkNullOrEmptyOrExists(userEmail))
208:             throw new ShopException("User does not exist!");
209:         if (shoppingBasketInternalService.existsByUserEmail(userEmail))
210:             return getState(userEmail) == ShoppingBasketState.EMPTY;
211:         else return true;
212:     }
213: 
214:     @Override
215:     public boolean isPaymentAuthorized(EmailType userEmail) {
216:         if (userService.checkNullOrEmptyOrExists(userEmail))
217:             throw new ShopException("User does not exist!");
218:         if (isEmpty(userEmail))
219:             return false;
220:         return getState(userEmail) == ShoppingBasketState.PAYMENT_AUTHORIZED;
221:     }
222: 
223:     private void clearShoppingBasketPositions(EmailType userEmail) {
224:         shoppingBasketInternalService.findByUserEmail(userEmail).getShoppingBasketPositions().clear();
225:         shoppingBasketInternalService.save(shoppingBasketInternalService.findByUserEmail(userEmail));
226:     }
227: 
228:     private ShoppingBasketState getState(EmailType shoppingBasketUserEmail) {
229:         return shoppingBasketInternalService.findByUserEmail(shoppingBasketUserEmail).getShoppingBasketState();
230:     }
231: 
232:     private boolean isOrderDelivered(EmailType userEmail) {
233:         return getState(userEmail) == ShoppingBasketState.DELIVERY_TRIGGERED;
234:     }
235: 
236:     @Override
237:     public void checkout(EmailType userEmail) {
238:         if (userEmail == null || userService.checkNullOrEmptyOrExists(userEmail))
239:             throw new ShopException("User does not exist!");
240:         if (!shoppingBasketInternalService.existsByUserEmail(userEmail))
241:             throw new ShopException("Cart is empty!");
242:         if (shoppingBasketInternalService.getShoppingBasketPositions(userEmail).isEmpty())
243:             throw new ShopException("Cart is empty!");
244: 
245:         if (paymentService.authorizePayment(userEmail, getShoppingBasketAsMoneyValue(userEmail)) != null)
246:             shoppingBasketInternalService.changeStateTo(userEmail, ShoppingBasketState.PAYMENT_AUTHORIZED);
247:         if (isPaymentAuthorized(userEmail)) {
248:             if (deliveryService.triggerDelivery(userService.findByEmail(userEmail), getShoppingBasketAsMap(userEmail)) != null) {
249:                 shoppingBasketInternalService.changeStateTo(userEmail, ShoppingBasketState.DELIVERY_TRIGGERED);
250:             }
251:             if (isOrderDelivered(userEmail)) {
252:                 clearShoppingBasketPositions(userEmail);
253:                 List<AbstractOrderPosition> orderPositions = new ArrayList<>(orderPositionService.findAllOrdersForUser(userEmail));
254:                 orderService.newOrder(userEmail, orderPositions);
255:                 orderPositionService.markOrderPositionsOfUserAsHistory(userEmail);
256:                 shoppingBasketInternalService.changeStateTo(userEmail, ShoppingBasketState.EMPTY);
257:             }
258:         }
259:     }
260: 
261:     @Override
262:     public Map<UUID, Integer> getOrderHistory(EmailType userEmail) {
263:         if (userService.checkNullOrEmptyOrExists(userEmail))
264:             throw new ShopException("User does not exist!");
265: 
266:         return orderPositionService.getMapOfHistoryForUser(userEmail);
267:     }
268: 
269:     @Override
270:     public void deleteAllOrders() {
271:         shoppingBasketInternalService.deleteAll();
272:         orderService.deleteAll();
273:         orderPositionService.deleteAll();
274:     }
275: }
276: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.UserType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: public interface ShoppingBasketUserService {
7:     boolean checkNullOrEmptyOrExists(EmailType email);
8: 
9:     UserType findByEmail(EmailType email);
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\WarehouseSpecificShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.warehouse.application.WarehouseShoppingBasketService;
6: 
7: import java.util.UUID;
8: 
9: @Service
10: public class WarehouseSpecificShoppingBasketService implements WarehouseShoppingBasketService {
11:     private final InventorySpecificShoppingBasketService shoppingBasketService;
12: 
13:     @Autowired
14:     public WarehouseSpecificShoppingBasketService(InventorySpecificShoppingBasketService shoppingBasketService) {
15:         this.shoppingBasketService = shoppingBasketService;
16:     }
17:     public void removeFromReserved(UUID productId) {
18:         shoppingBasketService.removeFromReserved(productId);
19:     }
20: 
21:     public int getReservedInventoryInShoppingBaskets(UUID productId) {
22:         return shoppingBasketService.getReservedInventoryInShoppingBaskets(productId);
23:     }
24: }
25: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\entity\ShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.order.domain.entity.AbstractOrderPosition;
8: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.valueobject.ShoppingBasketState;
9: 
10: import javax.persistence.*;
11: import java.util.ArrayList;
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Entity
16: @Setter
17: @Getter
18: @NoArgsConstructor
19: public class ShoppingBasket {
20:     @Id
21:     @GeneratedValue (strategy = GenerationType.AUTO)
22:     private UUID shoppingBasketId;
23: 
24:     @Embedded
25:     private Email userEmail;
26: 
27:     @OneToMany
28:     private List<AbstractOrderPosition> shoppingBasketPositions = new ArrayList<>();
29: 
30:     private ShoppingBasketState shoppingBasketState = ShoppingBasketState.EMPTY;
31: 
32:     public ShoppingBasket(Email userEmail) {
33:         this.userEmail = userEmail;
34:     }
35: }
36: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\repository\ShoppingBasketRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.entity.ShoppingBasket;
6: 
7: import java.util.UUID;
8: 
9: public interface ShoppingBasketRepository extends CrudRepository<ShoppingBasket, UUID> {
10:     boolean existsByUserEmail(Email userEmail);
11: 
12:     ShoppingBasket findByUserEmail(Email userEmail);
13: 
14:     ShoppingBasket findFirstByUserEmail(Email userEmail);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\valueobject\ShoppingBasketState.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.valueobject;
2: 
3: public enum ShoppingBasketState {
4:     EMPTY,
5:     FILLED,
6:     PAYMENT_AUTHORIZED,
7:     DELIVERY_TRIGGERED
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\DeliverySpecificUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryUserService;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
7: 
8: @Service
9: public class DeliverySpecificUserService implements DeliveryUserService {
10:     private final UserService userService;
11: 
12:     @Autowired
13:     private DeliverySpecificUserService(UserService userService){
14:         this.userService = userService;
15:     }
16: 
17: 
18:     @Override
19:     public boolean checkNullOrEmptyOrExists(EmailType email) {
20:         return userService.checkNullOrEmptyOrExists(email);
21:     }
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\PaymentSpecificUserService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.stereotype.Service;
4: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentUserService;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: @Service
8: public class PaymentSpecificUserService implements PaymentUserService {
9: 
10:     private final UserService userService;
11: 
12:     public PaymentSpecificUserService(UserService userService) {
13:         this.userService = userService;
14:     }
15: 
16:     @Override
17:     public boolean checkNullOrEmptyOrExists(EmailType email) {
18:         return userService.checkNullOrEmptyOrExists(email);
19:     }
20: }
21: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserRegistrationService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
7: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
8: import thkoeln.archilab.ecommerce.solution.orderposition.application.UserSpecificOrderPositionService;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketService;
10: import thkoeln.archilab.ecommerce.solution.user.domain.entity.User;
11: import thkoeln.archilab.ecommerce.ShopException;
12: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
13: import thkoeln.archilab.ecommerce.usecases.UserType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
16: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
17: 
18: @Service
19: public class UserRegistrationService implements UserRegistrationUseCases {
20:     private final UserService userService;
21: 
22:     private final OrderService orderService;
23: 
24:     private final UserSpecificOrderPositionService orderPositionService;
25: 
26:     private final ShoppingBasketService shoppingBasketService;
27: 
28:     @Autowired
29:     public UserRegistrationService(
30:             UserService userService,
31:             OrderService orderService,
32:             UserSpecificOrderPositionService orderPositionService,
33:             ShoppingBasketService shoppingBasketService
34:     ) {
35:        this.userService = userService;
36:        this.orderService = orderService;
37:        this.orderPositionService = orderPositionService;
38:        this.shoppingBasketService = shoppingBasketService;
39:     }
40: 
41:     public <T> boolean nullOrEmpty (T thing) {
42:         if (thing == null)
43:             return true;
44:         if (thing instanceof String)
45:             return ((String) thing).isEmpty();
46:         if (thing instanceof EmailType)
47:             return thing.toString().isEmpty();
48:         if (thing instanceof PersonalAddressType) {
49:             String street = ((PersonalAddressType) thing).getStreet();
50:             String city = ((PersonalAddressType) thing).getCity();
51:             return nullOrEmpty(street) || nullOrEmpty(city) || nullOrEmpty(((PersonalAddressType) thing).getPostalCode());
52:         }
53:         if (thing instanceof PostalCodeType) {
54:             return thing.toString().isEmpty();
55:         }
56:         return false;
57:     }
58: 
59:     @Override
60:     public void register(String name, EmailType email, PersonalAddressType personalAddress) {
61:         if (nullOrEmpty(name) || nullOrEmpty(email) || nullOrEmpty(personalAddress))
62:             throw new ShopException("Invalid user data!");
63:         if (userService.existsByEmail(email)) throw new ShopException("User already exists!");
64: 
65:         User newUser = new User(name, (Email) email, (PersonalAddress) personalAddress);
66:         userService.save(newUser);
67:         shoppingBasketService.newShoppingBasket(email);
68:     }
69: 
70:     @Override
71:     public void changeAddress(EmailType userEmail, PersonalAddressType personalAddress) {
72:         if (userService.checkNullOrEmptyOrExists(userEmail)) throw new ShopException("User does not exist!");
73:         if (nullOrEmpty(personalAddress)) throw new ShopException("Invalid address!");
74: 
75:         User currentUser = userService.findByEmail(userEmail);
76:         currentUser.setAddress((PersonalAddress) personalAddress);
77:         userService.save(currentUser);
78:     }
79: 
80:     @Override
81:     public UserType getUserData(EmailType userEmail) {
82:         if (userService.checkNullOrEmptyOrExists(userEmail)) throw new ShopException("User does not exist!");
83: 
84:         return userService.findByEmail(userEmail);
85:     }
86: 
87:     @Override
88:     public void deleteAllUsers() {
89:         orderPositionService.deleteAll();
90:         orderService.deleteAll();
91:         userService.deleteAll();
92:     }
93: }
94: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketUserService;
7: import thkoeln.archilab.ecommerce.solution.user.domain.entity.User;
8: import thkoeln.archilab.ecommerce.solution.user.domain.repository.UserRepository;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: 
11: @Service
12: public class UserService implements ShoppingBasketUserService {
13:     private final UserRepository userRepository;
14: 
15:     @Autowired
16:     public UserService(UserRepository userRepository) {
17:         this.userRepository = userRepository;
18:     }
19: 
20:     public void save(User user) {
21:         userRepository.save(user);
22:     }
23: 
24:     public boolean existsByEmail(EmailType userEmail) {
25:         return userRepository.existsByEmail((Email) userEmail);
26:     }
27: 
28:     public User findByEmail(EmailType userEmail) {
29:         return userRepository.findByEmail((Email) userEmail);
30:     }
31: 
32:     public boolean checkNullOrEmptyOrExists(EmailType userId) {
33:         return userId == null || userId.toString().isEmpty() || !existsByEmail(userId);
34:     }
35: 
36:     public Iterable<User> findAll() {
37:         return userRepository.findAll();
38:     }
39: 
40:     public void deleteAll() {
41:         userRepository.deleteAll();
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\entity\User.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain.entity;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
8: import thkoeln.archilab.ecommerce.usecases.UserType;
9: 
10: import javax.persistence.*;
11: import java.util.UUID;
12: 
13: @Entity
14: @Setter
15: @Getter
16: @NoArgsConstructor
17: public class User implements UserType {
18: 
19:     @Id
20:     @GeneratedValue (strategy = GenerationType.AUTO)
21:     private UUID userId;
22: 
23:     private String name;
24: 
25:     @Embedded
26:     private Email email;
27:     @Embedded
28:     private PersonalAddress address;
29: 
30:     @Override
31:     public PersonalAddress getPersonalAddress() {
32:         return address;
33:     }
34: 
35:     public User(String name, Email email, PersonalAddress address) {
36:         this.name = name;
37:         this.email = email;
38:         this.address = address;
39:     }
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\repository\UserRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.solution.user.domain.entity.User;
6: 
7: public interface UserRepository extends CrudRepository<User, String> {
8:     boolean existsByEmail(Email email);
9: 
10:     User findByEmail(Email emailType);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\application\InventoryManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.orderposition.application.OrderPositionService;
6: import thkoeln.archilab.ecommerce.solution.warehouse.domain.entity.Warehouse;
7: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
8: import thkoeln.archilab.ecommerce.ShopException;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: public class InventoryManagementService implements InventoryManagementUseCases {
14: 
15:     private final ProductService productService;
16: 
17:     private final WarehouseService warehouseService;
18: 
19:     private final WarehouseShoppingBasketService shoppingBasketService;
20: 
21:     private final OrderPositionService orderPositionService;
22: 
23:     @Autowired
24:     public InventoryManagementService(
25:             ProductService productService,
26:             WarehouseService warehouseService,
27:             WarehouseShoppingBasketService shoppingBasketService,
28:             OrderPositionService orderPositionService
29:     ) {
30:         this.productService = productService;
31:         this.warehouseService = warehouseService;
32:         this.shoppingBasketService = shoppingBasketService;
33:         this.orderPositionService = orderPositionService;
34:     }
35: 
36:     @Override
37:     public void addToInventory(UUID productId, int addedQuantity) {
38:         if (productId == null || !productService.existsById(productId))
39:             throw new ShopException("No such product exists");
40:         if (addedQuantity <= 0)
41:             throw new ShopException("The Quantity has to be at least 0!");
42: 
43:         warehouseService.addToInventory(productId, addedQuantity);
44:     }
45: 
46:     public void removeSomeReservedFromCart(UUID productId, int newTotalAndReservedDifference){
47:         if (newTotalAndReservedDifference > 0) {
48:             orderPositionService.removeFromReserved(productId, newTotalAndReservedDifference);
49:             shoppingBasketService.removeFromReserved(productId);
50:             orderPositionService.deleteAllEmptyOrderPositions();
51:         }
52:     }
53: 
54:     @Override
55:     public void removeFromInventory(UUID productId, int removedQuantity) {
56:         if (warehouseService.checkNullOrEmpty(productId)
57:             || !warehouseService.existsById(productId)) throw new ShopException("No such product exists!");
58: 
59:         int reservedQuantity = shoppingBasketService.getReservedInventoryInShoppingBaskets(productId);
60:         int currentQuantity = warehouseService.findById(productId).getQuantity();
61:         int totalQuantity = reservedQuantity + currentQuantity;
62:         int newTotalQuantity = totalQuantity - removedQuantity;
63:         int newTotalAndReservedDifference = reservedQuantity - newTotalQuantity;
64: 
65:         if (currentQuantity + reservedQuantity < removedQuantity || removedQuantity <= 0)
66:             throw new ShopException("Invalid quantity amount!");
67: 
68:         removeSomeReservedFromCart(productId, newTotalAndReservedDifference);
69:         warehouseService.reduceQuantity(productId, removedQuantity);
70:     }
71: 
72:     @Override
73:     public void changeInventoryTo(UUID productId, int newTotalQuantity) {
74:         if (warehouseService.checkNullOrEmpty(productId)
75:             || !warehouseService.existsById(productId)) throw new ShopException("No such product exists");
76:         if (newTotalQuantity < 0) throw new ShopException("Invalid quantity amount!");
77: 
78:         int reservedQuantity = shoppingBasketService.getReservedInventoryInShoppingBaskets(productId);
79:         int newTotalAndReservedDifference = reservedQuantity - newTotalQuantity;
80: 
81:         removeSomeReservedFromCart(productId, newTotalAndReservedDifference);
82: 
83:         warehouseService.setNewQuantity(productId, newTotalQuantity);
84:     }
85: 
86:     @Override
87:     public int getAvailableInventory(UUID productId) {
88:         if (warehouseService.checkNullOrEmpty(productId)
89:             || !warehouseService.existsById(productId))
90:             throw new ShopException("No such product exists!");
91: 
92:         Warehouse product = warehouseService.findById(productId);
93:         int currentQuantity = product.getQuantity();
94:         int reservedQuantity = shoppingBasketService.getReservedInventoryInShoppingBaskets(productId);
95: 
96:         return currentQuantity + reservedQuantity;
97:     }
98: }
99: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\application\ProductService.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ProductService {
6:     boolean existsById(UUID productId);
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\application\WarehouseService.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.warehouse.domain.entity.Warehouse;
6: import thkoeln.archilab.ecommerce.solution.warehouse.domain.repository.WarehouseRepository;
7: 
8: import java.util.UUID;
9: 
10: @Service
11: public class WarehouseService {
12:     private final WarehouseRepository warehouseRepository;
13: 
14:     @Autowired
15:     public WarehouseService(WarehouseRepository warehouseRepository) {
16:         this.warehouseRepository = warehouseRepository;
17:     }
18: 
19:     public void save(Warehouse warehouse) {
20:         warehouseRepository.save(warehouse);
21:     }
22: 
23:     public Warehouse findById(UUID warehouseId) {
24:         return warehouseRepository.findById(warehouseId).get();
25:     }
26: 
27:     public boolean existsById(UUID warehouseId) {
28:         return warehouseRepository.existsById(warehouseId);
29:     }
30: 
31:     public void addToInventory(UUID productId, int addedQuantity) {
32:         if (existsById(productId)){
33:             findById(productId).setQuantity(getQuantity(productId) + addedQuantity);
34:             save(findById(productId));
35:         } else {
36:             save(new Warehouse(productId, addedQuantity));
37:         }
38:     }
39: 
40:     public void setNewQuantity(UUID productId, int newQuantity) {
41:         findById(productId).setQuantity(newQuantity);
42:         save(findById(productId));
43:     }
44: 
45:     public int getQuantity(UUID warehouseId) {
46:         return findById(warehouseId).getQuantity();
47:     }
48: 
49:     public void reduceQuantity(UUID productId, int quantity) {
50:         findById(productId).setQuantity(getQuantity(productId) - quantity);
51:         save(findById(productId));
52:     }
53: 
54:     public void addQuantity(UUID productId, int quantity) {
55:         findById(productId).setQuantity(getQuantity(productId) + quantity);
56:         save(findById(productId));
57:     }
58: 
59:     public boolean checkNullOrEmpty(UUID productId) {
60:         return productId == null || !existsById(productId);
61:     }
62: 
63:     public void deleteAll() {
64:         warehouseRepository.deleteAll();
65:     }
66: }
67: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\application\WarehouseShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.application;
2: 
3: import java.util.UUID;
4: 
5: public interface WarehouseShoppingBasketService {
6:     int getReservedInventoryInShoppingBaskets(UUID productId);
7: 
8:     void removeFromReserved(UUID productId);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\domain\entity\Warehouse.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.domain.entity;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import javax.persistence.Entity;
9: import javax.persistence.Id;
10: import java.util.UUID;
11: 
12: @Entity
13: @Getter
14: @Setter
15: @NoArgsConstructor
16: @AllArgsConstructor
17: public class Warehouse {
18:     @Id
19:     private UUID productId;
20:     private int quantity;
21: }
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\solution\warehouse\domain\repository\WarehouseRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.warehouse.domain.repository;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.warehouse.domain.entity.Warehouse;
5: 
6: import java.util.UUID;
7: 
8: public interface WarehouseRepository extends CrudRepository<Warehouse, UUID> {
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of products to a user. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a product to a user. The product is identified by its id, and the user by
16:      * his/her name, street, city and postal code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of product ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of products in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( UserType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which products have been delivered to a user, and how many of each product
31:      *
32:      * @param userEmail
33:      * @return the delivery history of the user (map is empty if the user has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the user with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType userEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PersonalAddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PersonalAddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the postal code
18:      */
19:     public PostalCodeType getPostalCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an postal code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param postalCode the postal code
30:      * @return the personalAddress object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - postalCode is null
35:      */
36:      // public static PersonalAddressType of( String street, String city, PostalCodeType postalCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PostalCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PostalCodeType {
6:     /**
7:      * @return the postal code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an postal code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param postalCodeAsString - the postal code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new postal code object matching the given string
22:      * @throws ShopException if ...
23:      *      - postalCodeAsString is null
24:      *      - postalCodeAsString is not a valid postal code (see above)
25:      */
26:      // public static PostalCodeType of( String postalCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
10:  * i.e. adding and removing products in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface InventoryManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given product to the inventory
16:      * @param productId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - productId is null
20:      *      - the product with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToInventory( UUID productId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given product from the inventory.
28:      * If the new total quantity is lower than the currently reserved products, some of currently reserved products
29:      * (in the users' shopping baskets) are removed. This means that some of the reserved products are lost for
30:      * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
31:      * or some of the products were stolen from the warehouse, are broken, etc.)
32:      * @param productId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - productId is null
36:      *      - the product with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current inventory and the currently reserved products together
39:      */
40:     public void removeFromInventory( UUID productId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given product in the inventory.
45:      * If the new total quantity is lower than the currently reserved products, some of currently reserved products
46:      * (in the users' shopping baskets) are removed. This means that some of the reserved products are lost for
47:      * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
48:      * or some of the products were stolen from the warehouse, are broken, etc.)
49:      * @param productId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - productId is null
53:      *      - the product with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeInventoryTo( UUID productId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total inventory of a given product, including the currently reserved products
61:      * @param productId
62:      * @return the current total inventory of the product
63:      * @throws ShopException if ...
64:      *      - productId is null
65:      *      - the product with that id does not exist
66:      */
67:     public int getAvailableInventory( UUID productId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a bank card for a given amount
16:      *
17:      * @param userEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - userEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType userEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a user
31:      * (identified by his/her email)
32:      *
33:      * @param userEmail
34:      * @return the total amount of payments made using this bank card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - userEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType userEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all users.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\ProductCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the product catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface ProductCatalogUseCases {
15:     /**
16:      * Adds a new product to the shop catalog
17:      * @param productId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param sellPrice
23:      * @throws ShopException if ...
24:      *      - productId is null,
25:      *      - the product with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the sell price is null,
30:      *      - the sell price is lower than the purchase price
31:      */
32:     public void addProductToCatalog( UUID productId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType sellPrice );
34: 
35: 
36:     /**
37:      * Removes a product from the shop catalog
38:      * @param productId
39:      * @throws ShopException if
40:      *      - productId is null,
41:      *      - the product with that id does not exist
42:      *      - the product is still in inventory
43:      *      - the product is still reserved in a shopping basket, or part of a completed order
44:      */
45:     public void removeProductFromCatalog( UUID productId );
46: 
47: 
48:     /**
49:      * Get the sell price of a given product
50:      * @param productId
51:      * @return the sell price
52:      * @throws ShopException if ...
53:      *      - productId is null,
54:      *      - the product with that id does not exist
55:      */
56:     public MoneyType getSellPrice( UUID productId );
57: 
58: 
59:     /**
60:      * Clears the product catalog, i.e. removes all products from the catalog, including all the inventory,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteProductCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingBasketUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping basket.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingBasketUseCases {
15:     /**
16:      * Adds a product to the shopping basket of a user
17:      *
18:      * @param userEmail
19:      * @param productId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the user with the given email does not exist,
23:      *      - the product does not exist,
24:      *      - the quantity <= 0,
25:      *      - the product is not available in the requested quantity
26:      */
27:     public void addProductToShoppingBasket( EmailType userEmail, UUID productId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a product from the shopping basket of a user
32:      *
33:      * @param userEmail
34:      * @param productId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - userEmail is null,
38:      *      - the user with the given email does not exist,
39:      *      - the product does not exist
40:      *      - the quantity <= 0,
41:      *      - the product is not in the shopping basket in the requested quantity
42:      */
43:     public void removeProductFromShoppingBasket( EmailType userEmail, UUID productId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping basket position containing a product
48:      *
49:      * @param userEmail
50:      * @param productId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - userEmail is null,
54:      *      - the user with the given email does not exist,
55:      *      - the product does not exist
56:      *      - the product is not in the shopping basket
57:      */
58:     public void setCommentForShoppingBasketPosition( EmailType userEmail, UUID productId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping basket position containing a product
63:      *
64:      * @param userEmail
65:      * @param productId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - userEmail is null,
69:      *      - the user with the given email does not exist,
70:      *      - the product does not exist
71:      *      - the product is not in the shopping basket
72:      */
73:     public String getCommentForShoppingBasketPosition( EmailType userEmail, UUID productId );
74: 
75: 
76:     /**
77:      * Returns a map showing which products are in the shopping basket of a user and how many of each product
78:      *
79:      * @param userEmail
80:      * @return the shopping basket of the user (map is empty if the shopping basket is empty)
81:      * @throws ShopException if ...
82:      *      - userEmail is null,
83:      *      - the user with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingBasketAsMap( EmailType userEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all products in the shopping basket of a user
90:      *
91:      * @param userEmail
92:      * @return the value of shopping basket of the user
93:      * @throws ShopException if ...
94:      *      - userEmail is null,
95:      *      - the user with the given email does not exist
96:      */
97:     public MoneyType getShoppingBasketAsMoneyValue( EmailType userEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific product that are currently reserved in the shopping baskets of all users
103:      * @param productId
104:      * @return the number of reserved products of that type in all shopping baskets
105:      * @throws ShopException
106:      *      - productId is null
107:      *      - if the product id does not exist
108:      */
109:     public int getReservedInventoryInShoppingBaskets( UUID productId );
110: 
111: 
112:     /**
113:      * Checks if the shopping basket of a user is empty
114:      *
115:      * @param userEmail
116:      * @return true if the shopping basket is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - userEmail is null
119:      *    - the user with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType userEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping basket of a user has been authorized to be paid,
126:      * i.e. the shopping basket is not empty, the user has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the user's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param userEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - userEmail is null
134:      *      - the user with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType userEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping basket of a user
141:      *
142:      * @param userEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - userEmail is null
146:      *      - the user with the given email does not exist
147:      *      - the shopping basket is empty
148:      */
149:     public void checkout( EmailType userEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which products have been ordered by a user, and how many of each product
156:      *
157:      * @param userEmail
158:      * @return the order history of the user (map is empty if the user has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the user with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType userEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping baskets in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping baskets), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\UserRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a user.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface UserRegistrationUseCases {
12:     /**
13:      * Registers a new user
14:      *
15:      * @param name
16:      * @param email
17:      * @param personalAddress
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - user with the given email already exists
22:      *      - personalAddress is null
23:      */
24:     public void register( String name, EmailType email, PersonalAddressType personalAddress );
25: 
26: 
27:     /**
28:      * Changes the personalAddress of a user
29:      *
30:      * @param userEmail
31:      * @param personalAddress
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - user with the given email already exists
35:      *      - personalAddress is null
36:      */
37:     public void changeAddress( EmailType userEmail, PersonalAddressType personalAddress );
38: 
39: 
40:     /**
41:      * Returns the data of a user
42:      * @param userEmail
43:      * @return the user data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the user with the given email does not exist
47:      */
48:     public UserType getUserData( EmailType userEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all users, including all orders and shopping baskets
54:      */
55:     public void deleteAllUsers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\main\java\thkoeln\archilab\ecommerce\usecases\UserType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop user
8:  */
9: public interface UserType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public PersonalAddressType getPersonalAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Product" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"user", "shoppingbasket", "product", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "User",
21:             "UserRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingBasket",
25:             "ShoppingBasketRepository",
26:             "Product",
27:             "ProductRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllProducts();
45:         initialMasterDataCreator.inventoryUpAllProducts();
46:         initialMasterDataCreator.registerAllUsers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + USER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = USER_EMAIL[6].toString();
76: 
77:         UUID productId2 = (UUID) PRODUCT_DATA[2][0];
78:         UUID productId4 = (UUID) PRODUCT_DATA[4][0];
79:         UUID productId6 = (UUID) PRODUCT_DATA[6][0];
80:         Float productMoneyAmount2 = ((MoneyType) PRODUCT_DATA[2][5]).getAmount() * 2;
81:         Float productMoneyAmount4 = ((MoneyType) PRODUCT_DATA[4][5]).getAmount() * 4;
82:         Float productMoneyAmount6 = ((MoneyType) PRODUCT_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForUser( emailString, productId2, 2 );
89:         restHelper.makeOrderForUser( emailString, productId4, 4 );
90:         restHelper.makeOrderForUser( emailString, productId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( productMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( productMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( productMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( productMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = USER_EMAIL[3].toString();
118:         UUID productId3 = (UUID) PRODUCT_DATA[3][0];
119:         UUID productId4 = (UUID) PRODUCT_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float productMoneyAmount =
123:                 ((MoneyType) PRODUCT_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) PRODUCT_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingBasketId = restHelper.getShoppingBasketId( emailString );
128:         restHelper.addProductToShoppingBasket( shoppingBasketId, productId3, quantity3 );
129:         restHelper.addProductToShoppingBasket( shoppingBasketId, productId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( productMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingBasketRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingBasketRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllProducts();
47:         initialMasterDataCreator.inventoryUpAllProducts();
48:         initialMasterDataCreator.registerAllUsers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingBasket() throws Exception {
57:         // given
58:         String validUri = "/shoppingBaskets?email=" + USER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingBaskets?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingBaskets?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID productId = (UUID) PRODUCT_DATA[3][0];
78:         String userEmailString = USER_EMAIL[4].toString();
79:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
80: 
81:         String invalidPostUri = "/shoppingBaskets/" + UUID.randomUUID() + "/shoppingBasketPositions";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingBaskets/" + UUID.randomUUID().toString() + "/shoppingBasketPositions/" + productId;
86:         String invalidCheckoutUri1 = "/shoppingBaskets/" + shoppingBasketId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingBaskets/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingProduct() throws Exception {
107:         // given
108:         UUID productId = (UUID) PRODUCT_DATA[3][0];
109:         String userEmailString = USER_EMAIL[7].toString();
110:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
111:         String invalidUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + productId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingBasket() throws Exception {
121:         // given
122:         UUID productId1 = (UUID) PRODUCT_DATA[1][0];
123:         String userEmailString9 = USER_EMAIL[9].toString();
124:         String userEmailString7 = USER_EMAIL[7].toString();
125: 
126:         UUID shoppingBasketId9 = restHelper.getShoppingBasketId( userEmailString9 );
127:         UUID shoppingBasketId7 = restHelper.getShoppingBasketId( userEmailString7 );
128: 
129:         String baseUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/shoppingBasketPositions/";
130:         String checkoutUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingBaskets/" + shoppingBasketId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleProductsToShoppingBasket( userEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingBasketPositions(
137:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + productId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingBasketPositions(
142:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" product
145:         restHelper.addProductToShoppingBasket( shoppingBasketId7, productId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingBasket() throws Exception {
160:         // given
161:         String userEmailString = USER_EMAIL[2].toString();
162:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
163:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingBasketPositions(
170:                 userEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingBasket() throws Exception {
182:         // given
183:         String userEmailString = USER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInInventory() throws Exception {
195:         // given
196:         String userEmailString = USER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String userEmailString = USER_EMAIL[5].toString();
210:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
211:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String userEmailString = USER_EMAIL[1].toString();
229:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
230:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String userEmailString = USER_EMAIL[8].toString();
245:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
246:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleProductsToShoppingBasket( userEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingBasket() throws Exception {
259:         // given
260:         String userEmailString = USER_EMAIL[9].toString();
261:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
262:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForUser( String emailString, UUID productId, Integer quantity ) throws Exception {
36:         UUID shoppingBasketId = getShoppingBasketId( emailString );
37:         addProductToShoppingBasket( shoppingBasketId, productId, quantity );
38:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingBasketId( String emailString ) throws Exception {
43:         // get the shopping basket and extract its id ...
44:         MvcResult shoppingBasket = mockMvc.perform( get( "/shoppingBaskets?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingBasket.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addProductToShoppingBasket( UUID shoppingBasketId, UUID productId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( productId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addProductToShoppingBasket( UUID shoppingBasketId, UUID productId, Integer quantity )
67:             throws Exception {
68:         addProductToShoppingBasket( shoppingBasketId, productId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleProductsToShoppingBasket(
74:             String userEmailString, Integer[] productIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingBasketId = getShoppingBasketId( userEmailString );
77:         String shoppingBasketUri = "shoppingBaskets?email=" + userEmailString;
78:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
79: 
80:         // add all the products to the shopping basket ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < productIndices.length; i++ ) {
84:             UUID productId = (UUID) PRODUCT_DATA[productIndices[i]][0];
85:             addProductToShoppingBasket( shoppingBasketId, productId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( productIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( productIndices[i], 0 ) );
89:                 commentMap.put( productIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleProductsToShoppingBasket(
96:             String userEmailString, Integer[] productIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[productIndices.length];
99:         for ( int i = 0; i < productIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleProductsToShoppingBasket( userEmailString, productIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingBasketPositions( String userEmailString,
108:                                                          Integer[] productIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingBasketId = getShoppingBasketId( userEmailString );
111:         String shoppingBasketUri = "/shoppingBaskets?email=" + userEmailString;
112:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
113: 
114:         // check that the shopping basket contains all the products ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < productIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingBasketUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each product has the correct quantity and comment ...
126:         for ( int i = 0; i < productIndices.length; i++ ) {
127:             UUID productId = (UUID) PRODUCT_DATA[productIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + productId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + productId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingBasketPositions( String userEmailString,
142:                                                          Integer[] productIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[productIndices.length];
145:         for ( int i = 0; i < productIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingBasketPositions( userEmailString, productIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPositionsInLatestOrder(
155:             String userEmailString, Integer[] productIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + userEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < productIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) PRODUCT_DATA[productIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( userEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < productIndices.length; i++ ) {
173:             UUID productId = (UUID) PRODUCT_DATA[productIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderPositions.length()" ).value( productIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderPositions[?(@.productId == '" + productId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderPositions[?(@.productId == '" + productId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID productId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID productId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID productId, Integer quantity, String comment ) {
24:         this.productId = productId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPersonalAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionPersonalAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         PostalCodeType plz = instantiatePostalCode( "12345" );
19: 
20:         // when
21:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getPostalCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         PostalCodeType plz = instantiatePostalCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiatePersonalAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         PostalCodeType plz = instantiatePostalCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         PostalCodeType plz = instantiatePostalCode( "12345" );
63: 
64:         // when
65:         PersonalAddressType instance1 = instantiatePersonalAddress( street, city, plz );
66:         PersonalAddressType instance2 = instantiatePersonalAddress( street, city, plz );
67:         PersonalAddressType instance3 = instantiatePersonalAddress( "Anderestr. 12", city, plz );
68:         PersonalAddressType instance4 = instantiatePersonalAddress( street, "AndereStadt", plz );
69:         PersonalAddressType instance5 = instantiatePersonalAddress( street, city, instantiatePostalCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         PostalCodeType plz = instantiatePostalCode( "12345" );
84: 
85:         // when
86:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setPostalCode", PostalCodeType.class );
104:             fail( "setPostalCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPostalCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionPostalCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         PostalCodeType instance = instantiatePostalCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiatePostalCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiatePostalCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiatePostalCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiatePostalCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiatePostalCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         PostalCodeType instance1 = instantiatePostalCode( "12345" );
48:         PostalCodeType instance2 = instantiatePostalCode( "12345" );
49:         PostalCodeType instance3 = instantiatePostalCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         PostalCodeType instance = instantiatePostalCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setpostalCode", String.class );
65:             fail( "setpostalCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_INVENTORY;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionInventoryManagementTest {
20: 
21:     @Autowired
22:     private InventoryManagementUseCases inventoryManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllProducts();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToInventory() {
37:         // given
38:         initialMasterDataCreator.inventoryUpAllProducts();
39:         UUID productId8 = (UUID) PRODUCT_DATA[8][0];
40: 
41:         // when
42:         int inventory8before = inventoryManagementUseCases.getAvailableInventory( productId8 );
43:         assertEquals( PRODUCT_INVENTORY.get( productId8 ), inventory8before );
44:         inventoryManagementUseCases.addToInventory( productId8, 22 );
45:         int inventory8after = inventoryManagementUseCases.getAvailableInventory( productId8 );
46:         inventoryManagementUseCases.addToInventory( productId8, 1 );
47:         int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( productId8 );
48: 
49:         // then
50:         assertEquals( inventory8before + 22, inventory8after );
51:         assertEquals( inventory8after + 1, inventory8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromInventory() {
57:         // given
58:         initialMasterDataCreator.inventoryUpAllProducts();
59:         UUID productId6 = (UUID) PRODUCT_DATA[6][0];
60:         int inventory6before = PRODUCT_INVENTORY.get( productId6 );
61:         UUID productId9 = (UUID) PRODUCT_DATA[9][0];
62:         int inventory9before = PRODUCT_INVENTORY.get( productId9 );
63:         UUID productId1 = (UUID) PRODUCT_DATA[1][0];
64:         int inventory1before = PRODUCT_INVENTORY.get( productId1 );
65: 
66:         // when
67:         inventoryManagementUseCases.removeFromInventory( productId6, 1 );
68:         int inventory6after = inventoryManagementUseCases.getAvailableInventory( productId6 );
69:         inventoryManagementUseCases.removeFromInventory( productId1, 3 );
70:         int inventory1after = inventoryManagementUseCases.getAvailableInventory( productId1 );
71:         inventoryManagementUseCases.removeFromInventory( productId9, inventory9before );
72:         int inventory9after = inventoryManagementUseCases.getAvailableInventory( productId9 );
73: 
74:         // then
75:         assertEquals( inventory6before - 1, inventory6after );
76:         assertEquals( inventory1before - 3, inventory1after );
77:         assertEquals( 0, inventory9after );
78:     }
79: 
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionProductCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.ProductCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.PRODUCT_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionProductCatalogTest {
22: 
23:     @Autowired
24:     private ProductCatalogUseCases productCatalogUseCases;
25:     @Autowired
26:     private InventoryManagementUseCases inventoryManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddProductToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllProducts();
41: 
42:         // when
43:         MoneyType sellPrice = productCatalogUseCases.getSellPrice( (UUID) PRODUCT_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( PRODUCT_DATA[4][5], sellPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveProductFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllProducts();
53:         UUID productId = (UUID) PRODUCT_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> productCatalogUseCases.getSellPrice( productId ) );
57:         productCatalogUseCases.removeProductFromCatalog( productId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> productCatalogUseCases.getSellPrice( productId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveProductThatIsInInventory() {
68:         // given
69:         initialMasterDataCreator.addAllProducts();
70:         UUID productId = (UUID) PRODUCT_DATA[4][0];
71:         inventoryManagementUseCases.addToInventory( productId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> productCatalogUseCases.removeProductFromCatalog( productId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearProductCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllProducts();
83: 
84:         // when
85:         productCatalogUseCases.deleteProductCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> productCatalogUseCases.getSellPrice( (UUID) PRODUCT_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_d3138f7e-fadb-4551-86c0-a1828ff2ccf4\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionUserRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.UserType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionUserRegistrationTest {
25: 
26:     @Autowired
27:     private UserRegistrationUseCases userRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllUsersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllUsers();
44: 
45:         // when
46:         UserType user3 = userRegistrationUseCases.getUserData( USER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.USER_NAME[3], user3.getName() );
50:         Assertions.assertEquals( USER_EMAIL[3], user3.getEmail() );
51:         Assertions.assertEquals( USER_ADDRESS[3], user3.getPersonalAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterUserWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllUsers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 userRegistrationUseCases.register( "Gandalf The Grey", USER_EMAIL[5],
64:                         USER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterUserWithDuplicateNameOrPersonalAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllUsers();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 userRegistrationUseCases.register( initialMasterDataCreator.USER_NAME[2], newEmail,
77:                         USER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteUsersNoMoreUsers() {
83:         // given
84:         initialMasterDataCreator.registerAllUsers();
85: 
86:         // when
87:         userRegistrationUseCases.deleteAllUsers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> userRegistrationUseCases.getUserData( USER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

[RESPONSE]:
Ich analysiere den Code auf die genannten Smells. Hier sind meine Funde:

---

**thkoeln/archilab/ecommerce/masterdata/FactoryMethodInvoker.java**

FactoryMethodInvoker.java 23-48: Duplication (Original: Zeilen 23-48) : Die Methoden `instantiateEmail`, `instantiatePersonalAddress`, `instantiatePostalCode` und `instantiateMoney` folgen exakt demselben Muster (Reflection-Aufruf der Factory-Methode). Sie unterscheiden sich nur im Typ und Parametern. Dies ist eine klare Duplikation, die durch eine generische Methode reduziert werden könnte.

FactoryMethodInvoker.java 51-79: Duplication (Original: Zeilen 23-48) : Siehe oben.

FactoryMethodInvoker.java 82-107: Duplication (Original: Zeilen 23-48) : Siehe oben.

FactoryMethodInvoker.java 110-135: Duplication (Original: Zeilen 23-48) : Siehe oben.

FactoryMethodInvoker.java 139: Dead code : Die Variable `factoryMethod` wird deklariert, aber nie verwendet (direkt überschrieben durch den Aufruf in Zeile 142).

---

**thkoeln/archilab/ecommerce/solution/delivery/application/DeliveryService.java**

DeliveryService.java 38-48: Duplication (Original: PersonalAddress.java Zeilen 41-43) : Die Methode `nullOrEmpty` dupliziert die Logik der gleichnamigen Methode in `PersonalAddress` (und auch in `UserRegistrationService`). Sie ist zudem komplexer, da sie verschiedene Typen behandelt.

DeliveryService.java 91-92: negative conditionals : Die Bedingung `if (userService.checkNullOrEmptyOrExists(userEmail))` ist doppelt negativ formuliert. Die Methode `checkNullOrEmptyOrExists` prüft auf "null oder leer oder existiert nicht", aber die Bedingung wirft eine Exception, wenn true zurückgegeben wird. Das ist verwirrend. Besser wäre eine Methode wie `isValidUserEmail`.

DeliveryService.java 50-52: Dead code : Die Methode `getEmail` wird nicht genutzt (könnte inline in Zeile 75 verwendet werden).

---

**thkoeln/archilab/ecommerce/solution/order/application/OrderController.java**

OrderController.java 42-46: Duplication (Original: Zeilen 42-46) : Der Code `Email emailString = Email.of(email);` wird zweimal ausgeführt (einmal im try-catch, dann danach). Das ist unnötig.

---

**thkoeln/archilab/ecommerce/solution/order/application/OrderDtoMapper.java**

OrderDtoMapper.java 18-25: Duplication (Original: ShoppingBasketService.java Zeilen 167-179) : Die Logik zur Berechnung des Gesamtpreises (Beginn mit 0, dann Aufsummierung) ist dupliziert. Es gibt ähnliche Code-Blöcke auch in `ShoppingBasketService.getShoppingBasketMoneyValue`.

---

**thkoeln/archilab/ecommerce/solution/orderposition/application/OrderPositionService.java**

OrderPositionService.java 43-52: Duplication (Original: ShoppingBasketSpecificOrderPositionService.java Zeilen 24-33) : Die Methode `findAllOfSpecificType` ist fast identisch mit der in `ShoppingBasketSpecificOrderPositionService`. Gleiches gilt für `ProductSpecificOrderPositionService`.

OrderPositionService.java 54-68: Duplication (Original: ShoppingBasketSpecificOrderPositionService.java Zeilen 91-105) : Die Methode `getMapOfSpecificTypeForUser` ist sehr ähnlich zu `getMapOfSpecificTypeForUser` in `ShoppingBasketSpecificOrderPositionService`.

---

**thkoeln/archilab/ecommerce/solution/orderposition/application/ProductSpecificOrderPositionService.java**

ProductSpecificOrderPositionService.java 25-34: Duplication (Original: OrderPositionService.java Zeilen 43-52) : Siehe oben.

ProductSpecificOrderPositionService.java 36-50: Duplication (Original: OrderPositionService.java Zeilen 54-68) : Die Methode `getMapOfCompleteHistory` ist strukturell sehr ähnlich zu `getMapOfSpecificTypeForUser`.

---

**thkoeln/archilab/ecommerce/solution/orderposition/application/ShoppingBasketSpecificOrderPositionService.java**

ShoppingBasketSpecificOrderPositionService.java 24-33: Duplication (Original: OrderPositionService.java Zeilen 43-52) : Siehe oben.

ShoppingBasketSpecificOrderPositionService.java 91-105: Duplication (Original: OrderPositionService.java Zeilen 54-68) : Siehe oben.

---

**thkoeln/archilab/ecommerce/solution/payment/application/PaymentService.java**

PaymentService.java 70-82: Duplication (Original: OrderDtoMapper.java Zeilen 18-25) : Die Logik zur Berechnung der Gesamtsumme (Beginn mit 0, dann Aufsummierung) ist dupliziert.

PaymentService.java 74-75: negative conditionals : Der Ausdruck `paymentTotal = paymentTotal.subtract(paymentTotal);` ist eine komplizierte Art, auf 0 zu setzen. Besser: direkte Erzeugung von `Money.of(0.00F, "EUR")`.

---

**thkoeln/archilab/ecommerce/solution/shoppingbasket/application/ShoppingBasketController.java**

ShoppingBasketController.java 91-128: missplaced responsibility : Die Methode `addRemoveFunctions` ist sehr lang und enthält Business-Logik, die besser im Service liegen sollte.

---

**thkoeln/archilab/ecommerce/solution/shoppingbasket/application/ShoppingBasketService.java**

ShoppingBasketService.java 167-179: Duplication (Original: OrderDtoMapper.java Zeilen 18-25) : Siehe oben.

ShoppingBasketService.java 232-234: negative conditionals : Die Methode `isOrderDelivered` prüft auf `DELIVERY_TRIGGERED`. Der Zustand heißt aber nicht "delivered", sondern "triggered". Die Negation ist irreführend.

---

**thkoeln/archilab/ecommerce/solution/user/application/UserRegistrationService.java**

UserRegistrationService.java 41-57: Duplication (Original: PersonalAddress.java Zeilen 41-43) : Die Methode `nullOrEmpty` ist eine erweiterte Version der gleichnamigen Methode in `PersonalAddress`. Sie sollte zentralisiert werden.

---

**thkoeln/archilab/ecommerce/solution/warehouse/application/InventoryManagementService.java**

InventoryManagementService.java 46-52: missplaced responsibility : Die Methode `removeSomeReservedFromCart` gehört nicht in den InventoryManagementService, sondern in einen Service, der sich mit ShoppingBaskets beschäftigt.

---

**Layer Violation**:

Es wurden keine direkten Layer-Verstöße gefunden (z.B. Zugriff auf Domain-Layer eines anderen Bounded Context). Allerdings gibt es viele Abhängigkeiten zwischen Services, die jedoch innerhalb desselben Lösungspakets liegen.

**Shared Persistency**:

Es wurden keine Fälle von Shared Persistency gefunden (kein Repository-Zugriff über Package-Grenzen hinweg).

**Anemic Entities**:

- Delivery.java
- AbstractOrderPosition.java
- AbstractProduct.java
- Order.java
- OrderPosition.java
- Payment.java
- Product.java
- ShoppingBasket.java
- User.java
- Warehouse.java

Diese Klassen enthalten fast ausschließlich Getter/Setter und keine Domänenlogik. Sie sind reine Datencontainer.

---

ENDE
Generated by deepseek-reasoner
-----------------------------------