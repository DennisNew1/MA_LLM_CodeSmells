--- DATE: 13.1.2026, 14:03:07 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: 
8: import javax.persistence.Embeddable;
9: import javax.persistence.Embedded;
10: 
11: @Embeddable
12: @EqualsAndHashCode
13: public class Address implements AddressType {
14: 
15:     private String street;
16:     private String city;
17:     @Embedded
18:     private ZipCode zipCode;
19: 
20:     private Address(String street, String city, ZipCodeType zipCode) {
21:         this.street = street;
22:         this.city = city;
23:         this.zipCode = (ZipCode) zipCode;
24:     }
25: 
26:     protected Address() {
27:         //TODO: Delete?
28:     }
29: 
30:     public static Address of( String street, String city, ZipCodeType zipCode ){
31:         if(street == null || street.isEmpty() || city == null || city.isEmpty() || zipCode == null)
32:             throw new ShopException("Invalide data");
33:         return new Address(street, city, zipCode);
34:     }
35: 
36:     @Override
37:     public String getStreet() {
38:         return street;
39:     }
40: 
41:     @Override
42:     public String getCity() {
43:         return city;
44:     }
45: 
46:     @Override
47:     public ZipCodeType getZipCode() {
48:         return zipCode;
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import javax.persistence.Embeddable;
8: 
9: @Embeddable
10: @EqualsAndHashCode
11: public class Email implements EmailType {
12: 
13:     private String email;
14: 
15:     private Email(String email) {
16:         this.email = email;
17:     }
18: 
19:     protected Email() {
20:         //TODO: Delete
21:     }
22: 
23:     public static EmailType of(String emailAsString) {
24:         if (emailAsString == null) throw new ShopException("Email is null");
25:         //validate
26:         String[] parts = emailAsString.split("@");
27:         if (parts.length != 2) throw new ShopException("Doesn't contain exactly one '@' character");
28:         if (parts[0].length() == 0 || parts[1].length() == 0)
29:             throw new ShopException("Not Valide");
30:         if (emailAsString.contains("..")) throw new ShopException("Contains ..");
31:         if(emailAsString.contains(" ")) throw new ShopException("Contains whitespace");
32:         //if(!emailAsString.matches("[a-zA-Z@.]+")) throw new ShopException("False characters");
33:         //TODO: Change
34:         if(emailAsString.contains("#")) throw new ShopException("Error");
35: 
36: 
37:         if (!(emailAsString.endsWith(".de") ||
38:                 emailAsString.endsWith(".at") ||
39:                 emailAsString.endsWith(".ch") ||
40:                 emailAsString.endsWith(".com") ||
41:                 emailAsString.endsWith(".org")
42:         )) throw new ShopException("Domain not Valide: False ending");
43: 
44:         return new Email(emailAsString);
45:     }
46: 
47:     @Override
48:     public String toString() {
49:         return email;
50:     }
51: }
52: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import javax.persistence.Embeddable;
8: 
9: @Embeddable
10: @EqualsAndHashCode
11: public class Money implements MoneyType {
12: 
13:     private Float amount;
14:     private String currency;
15: 
16:     private Money(Float amount, String currency) {
17:         this.amount = amount;
18:         this.currency = currency;
19:     }
20: 
21:     protected Money() {
22:         //TODO: Delete
23:     }
24: 
25:     public static MoneyType of(Float amount, String currency ){
26:         if (amount == null ||currency == null) throw new ShopException("Empty values");
27:         if (amount < 0 ) throw new ShopException("Negative amount");
28:         if (!(currency.equals("EUR") || currency.equals("CHF"))) throw new ShopException("Not EUR or CHF");
29:         return new Money(amount, currency);
30:     }
31: 
32: 
33:     @Override
34:     public Float getAmount() {
35:         return amount;
36:     }
37: 
38:     @Override
39:     public String getCurrency() {
40:         return currency;
41:     }
42: 
43: 
44:     @Override
45:     public MoneyType add(MoneyType otherMoney) {
46:         if (otherMoney == null) throw new ShopException("Money == null");
47:         if(!this.currency.equals(otherMoney.getCurrency())) throw new ShopException("Currency not equal");
48:         return new Money(amount+ otherMoney.getAmount(), currency);
49:     }
50: 
51:     @Override
52:     public MoneyType subtract(MoneyType otherMoney) {
53:         if (otherMoney == null) throw new ShopException("Money == null");
54:         if(!this.currency.equals(otherMoney.getCurrency())) throw new ShopException("Currency not equal");
55:         if(this.amount < otherMoney.getAmount()) throw new ShopException("amount < otherMoney");
56: 
57:         return new Money(this.amount-otherMoney.getAmount(), this.currency);
58:     }
59: 
60:     @Override
61:     public MoneyType multiplyBy(int factor) {
62:         if (factor < 0) throw new ShopException("factor < 0");
63:         return new Money(this.amount*factor, this.currency);
64:     }
65: 
66:     @Override
67:     public boolean largerThan(MoneyType otherMoney) {
68:         if (otherMoney == null) throw new ShopException("Money == null");
69:         if(!this.currency.equals(otherMoney.getCurrency())) throw new ShopException("Currency not equal");
70: 
71:         return this.amount > otherMoney.getAmount();
72:     }
73: 
74: 
75: }
76: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.EqualsAndHashCode;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
6: 
7: import javax.persistence.Embeddable;
8: 
9: @Embeddable
10: @EqualsAndHashCode
11: public class ZipCode implements ZipCodeType {
12: 
13:     private String zipCode;
14: 
15:     protected ZipCode() {
16:         //TODO: Delete
17:     }
18: 
19:     @Override
20:     public String toString() {
21:         return zipCode;
22:     }
23: 
24:     private ZipCode(String zipCode) {
25:         this.zipCode = zipCode;
26:     }
27: 
28: 
29:     public static ZipCodeType of( String zipCodeAsString ){
30:         if (zipCodeAsString == null) throw new ShopException("ZipCode is null");
31:         if(zipCodeAsString.length() != 5) throw new ShopException("ZipCode is not 5 long");
32:         if(zipCodeAsString.endsWith("0000")) throw new ShopException("ZipCode ends with 0000");
33:         return new ZipCode(zipCodeAsString);
34:     }
35: 
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static AddressType instantiateAddress(
52:             String street, String city, ZipCodeType zipCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, ZipCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for AddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, zipCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + zipCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (AddressType) instance;
79:     }
80: 
81: 
82:     public static ZipCodeType instantiateZipCode( String zipCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for ZipCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, zipCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + zipCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (ZipCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * customers and goods. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] CUSTOMER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] CUSTOMER_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static AddressType[] CUSTOMER_ADDRESS = new AddressType[] {
53:             FactoryMethodInvoker.instantiateAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiateZipCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiateAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiateZipCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiateAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiateZipCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiateAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiateZipCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiateAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiateZipCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiateAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiateZipCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiateAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiateZipCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiateAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiateZipCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiateAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiateZipCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiateAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiateZipCode( "45127" ) )
83:     };
84: 
85:     public final static CustomerType[] mockCustomers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] GOOD_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private CustomerRegistrationUseCases customerRegistrationUseCases;
135:     private GoodCatalogUseCases goodCatalogUseCases;
136:     private StockManagementUseCases stockManagementUseCases;
137:     private ShoppingBasketUseCases shoppingBasketUseCases;
138: 
139: 
140:     // good 0 is out of stock, good 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random stock between 5 and 100
142:     public static final Map<UUID, Integer> GOOD_STOCK = new HashMap<>();
143: 
144:     static {
145:         mockCustomers = new CustomerType[CUSTOMER_NAME.length];
146:         for ( int i = 0; i < CUSTOMER_NAME.length; i++ ) {
147:             mockCustomers[i] = new MockCustomer(
148:                     CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] goodData : GOOD_DATA ) {
152:             GOOD_STOCK.put( (UUID) goodData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         GOOD_STOCK.put( (UUID) GOOD_DATA[0][0], 0 );
155:         GOOD_STOCK.put( (UUID) GOOD_DATA[1][0], 10 );
156:         GOOD_STOCK.put( (UUID) GOOD_DATA[2][0], 20 );
157:         GOOD_STOCK.put( (UUID) GOOD_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             CustomerRegistrationUseCases customerRegistrationUseCases,
181:             GoodCatalogUseCases goodCatalogUseCases,
182:             StockManagementUseCases stockManagementUseCases,
183:             ShoppingBasketUseCases shoppingBasketUseCases ) {
184:         this.customerRegistrationUseCases = customerRegistrationUseCases;
185:         this.goodCatalogUseCases = goodCatalogUseCases;
186:         this.stockManagementUseCases = stockManagementUseCases;
187:         this.shoppingBasketUseCases = shoppingBasketUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingBasketUseCases.deleteAllOrders();
193:         goodCatalogUseCases.deleteGoodCatalog();
194:         customerRegistrationUseCases.deleteAllCustomers();
195:     }
196: 
197: 
198:     public void registerAllCustomers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.CUSTOMER_NAME.length; i++ ) {
200:             registerCustomer( InitialMasterDataCreator.CUSTOMER_NAME[i], CUSTOMER_EMAIL[i], CUSTOMER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerCustomer( String name, EmailType email, AddressType address ) {
206:         customerRegistrationUseCases.register( name, email, address );
207:     }
208: 
209:     public void addAllGoods() {
210:         for ( Object[] goodData : GOOD_DATA ) {
211:             addGoodDataToCatalog( goodData );
212:         }
213:     }
214: 
215:     public void addGoodDataToCatalog( Object[] goodData ) {
216:         goodCatalogUseCases.addGoodToCatalog( (UUID) goodData[0], (String) goodData[1], (String) goodData[2],
217:                 (Float) goodData[3], (MoneyType) goodData[4], (MoneyType) goodData[5] );
218:     }
219: 
220: 
221:     public Object[] getGoodDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] goodData = GOOD_DATA[1];
223:         Object[] goodDataInvalid = new Object[goodData.length];
224:         System.arraycopy( goodData, 0, goodDataInvalid, 0, goodData.length );
225:         goodDataInvalid[index] = goodData[index].getClass().cast(
226:                 reason.getInvalidValue( goodData[index] ) );
227:         return goodDataInvalid;
228:     }
229: 
230: 
231:     public void stockUpAllGoods() {
232:         for ( Object[] goodData : GOOD_DATA ) {
233:             if ( GOOD_STOCK.get( goodData[0] ) > 0 )
234:                 stockManagementUseCases.addToStock( (UUID) goodData[0], GOOD_STOCK.get( goodData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockCustomer.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.CustomerType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockCustomer implements CustomerType {
12:     private String name;
13:     private EmailType email;
14:     private AddressType address;
15: 
16: 
17:     public MockCustomer( String name, EmailType email, AddressType address) {
18:         this.name = name;
19:         this.email = email;
20:         this.address = address;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public AddressType getAddress() {
35:         return address;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockCustomer ) ) return false;
42:         MockCustomer that = (MockCustomer) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( address, that.address );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, address );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllCustomers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\application\AdapterService.java ---
1: package thkoeln.archilab.ecommerce.solution.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
6: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketService;
7: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketServiceUseCase;
8: import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.Map;
13: import java.util.UUID;
14: 
15: @Service
16: public class AdapterService implements ShoppingBasketUseCases {
17: 
18:     @Autowired
19:     private OrderService orderService;
20: 
21:     @Autowired
22:     private ShoppingBasketServiceUseCase shoppingBasketService;
23: 
24: 
25:     @Override
26:     public void addGoodToShoppingBasket(EmailType customerEmail, UUID goodId, int quantity) {
27:         shoppingBasketService.addGoodToShoppingBasket(customerEmail, goodId, quantity);
28:     }
29: 
30:     @Override
31:     public void removeGoodFromShoppingBasket(EmailType customerEmail, UUID goodId, int quantity) {
32:         shoppingBasketService.removeGoodFromShoppingBasket(customerEmail, goodId, quantity);
33:     }
34: 
35:     @Override
36:     public void setCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId, String comment) {
37:         shoppingBasketService.setCommentForShoppingBasketPosition(customerEmail, goodId, comment);
38:     }
39: 
40:     @Override
41:     public String getCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId) {
42:         return shoppingBasketService.getCommentForShoppingBasketPosition(customerEmail, goodId);
43:     }
44: 
45:     @Override
46:     public Map<UUID, Integer> getShoppingBasketAsMap(EmailType customerEmail) {
47:         return shoppingBasketService.getShoppingBasketAsMap(customerEmail);
48:     }
49: 
50:     @Override
51:     public MoneyType getShoppingBasketAsMoneyValue(EmailType customerEmail) {
52:         return shoppingBasketService.getShoppingBasketAsMoneyValue(customerEmail);
53:     }
54: 
55:     @Override
56:     public int getReservedStockInShoppingBaskets(UUID goodId) {
57:         return shoppingBasketService.getReservedStockInShoppingBaskets(goodId);
58:     }
59: 
60:     @Override
61:     public boolean isEmpty(EmailType customerEmail) {
62:         return shoppingBasketService.isEmpty(customerEmail);
63:     }
64: 
65:     @Override
66:     public boolean isPaymentAuthorized(EmailType customerEmail) {
67:         return shoppingBasketService.isPaymentAuthorized(customerEmail);
68:     }
69: 
70:     @Override
71:     public void checkout(EmailType customerEmail) {
72:         shoppingBasketService.checkout(customerEmail);
73:     }
74: 
75:     @Override
76:     public Map<UUID, Integer> getOrderHistory(EmailType customerEmail) {
77:         return orderService.getOrderHistory(customerEmail);
78:     }
79: 
80:     @Override
81:     public void deleteAllOrders() {
82:         orderService.deleteAllOrders();
83:     }
84: }
85: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\core\AbstractEntity.java ---
1: package thkoeln.archilab.ecommerce.solution.core;
2: 
3: import lombok.EqualsAndHashCode;
4: import lombok.Getter;
5: 
6: import javax.persistence.Id;
7: import javax.persistence.MappedSuperclass;
8: import java.util.UUID;
9: 
10: @EqualsAndHashCode
11: @MappedSuperclass
12: public abstract class AbstractEntity {
13: 
14:     @Id
15:     @Getter
16:     protected UUID id;
17: 
18:     protected AbstractEntity() {
19:         this.id = UUID.randomUUID();
20:     }
21: 
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\core\FunctionHelper.java ---
1: package thkoeln.archilab.ecommerce.solution.core;
2: 
3: public class FunctionHelper {
4: 
5: 
6:     public static boolean isNegativeOrNull(Float f){
7:         return f == null || f <= 0;
8:     }
9:     public static boolean isNegativeOrNull(int f){
10:         return f <= 0;
11:     }
12: 
13:     public static boolean isLessOrEqualsZero(Float f){
14:         if(f == null) return false;
15:         return f <= 0;
16:     }
17: 
18:     public static boolean isEmpty(String s){
19:         return  s == null || s.equals("");
20:     }
21: 
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\core\ShoppingBasketState.java ---
1: package thkoeln.archilab.ecommerce.solution.core;
2: 
3: public enum ShoppingBasketState {
4:     EMPTY,
5:     FILLED,
6:     PAYMENT_AUTHORIZED,
7:     DELIVERY_TRIGGERED
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerRegistrationService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import org.springframework.transaction.annotation.Transactional;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.solution.core.FunctionHelper;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
10: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.CustomerType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: 
15: import javax.persistence.EntityManager;
16: import javax.persistence.PersistenceContext;
17: 
18: @Service
19: public class CustomerRegistrationService implements CustomerRegistrationUseCases {
20: 
21:     @Autowired
22:     private CustomerRepository customerRepository;
23: 
24:     @Autowired
25:     private ShoppingBasketCustomerService shoppingBasketCustomerService;
26: 
27: 
28:     @PersistenceContext
29:     private EntityManager entityManger;
30: 
31:     @Transactional
32:     @Override
33:     public void register(String name, EmailType email, AddressType address) {
34:         if (FunctionHelper.isEmpty(name) || email == null || address == null)
35:             throw new ShopException("Invalid data");
36:         Customer customer = customerRepository.findByEmail(email);
37:         if (customer != null) throw new ShopException("Duplicated email");
38:         Customer newCustomer = new Customer(name, email, address);
39: 
40:         shoppingBasketCustomerService.createShoppingBasket(newCustomer);
41: 
42:         entityManger.persist(newCustomer);
43:     }
44: 
45:     @Transactional
46:     @Override
47:     public void changeAddress(EmailType customerEmail, AddressType address) {
48:         Customer customer = customerRepository.findByEmail(customerEmail);
49:         if (customer == null) throw new ShopException("Customer not found!");
50:         if (address == null)
51:             throw new ShopException("Invalid data");
52:         customer.setAddress(address);
53:         entityManger.persist(customer);
54: 
55:     }
56: 
57:     @Override
58:     public CustomerType getCustomerData(EmailType customerEmail) {
59:         Customer customer = customerRepository.findByEmail(customerEmail);
60:         if (customer == null) throw new ShopException("Customer not found!");
61:         return customer;
62:     }
63: 
64:     @Override
65:     public void deleteAllCustomers() {
66:         shoppingBasketCustomerService.deleteAllShoppingBaskets();
67:         customerRepository.deleteAll();
68:     }
69: 
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\CustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
6: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerRepository;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
8: 
9: @Service
10: public class CustomerService {
11: 
12:     @Autowired
13:     private CustomerRepository customerRepository;
14: 
15:     public Customer findCustomerByEmail(EmailType email){
16:         return customerRepository.findByEmail(email);
17:     }
18: 
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\application\ShoppingBasketCustomerService.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
4: 
5: public interface ShoppingBasketCustomerService {
6: 
7:     public void createShoppingBasket(Customer customer);
8: 
9:     void deleteAllShoppingBaskets();
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\Customer.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Address;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
8: import thkoeln.archilab.ecommerce.usecases.CustomerType;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
11: 
12: import javax.persistence.Embedded;
13: import javax.persistence.Entity;
14: 
15: @Entity
16: @Getter
17: @NoArgsConstructor
18: public class Customer extends AbstractEntity implements CustomerType {
19:     private String name;
20:     @Embedded
21:     private Email email;
22:     @Embedded
23:     private Address address;
24: 
25: 
26:     public Customer(String name, EmailType email, AddressType address) {
27:         this.name = name;
28:         this.email = (Email) email;
29:         this.address = (Address) address;
30:     }
31: 
32:     public Customer(CustomerType customerType){
33:         this.name = customerType.getName();
34:         this.email = (Email)customerType.getEmail();
35:         this.address = (Address) customerType.getAddress();
36:     }
37: 
38:     public void setAddress(AddressType address) {
39:         this.address = (Address) address;
40:     }
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\CustomerRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.UUID;
7: 
8: public interface CustomerRepository extends CrudRepository<Customer, UUID> {
9: 
10:     Customer findByEmail(EmailType email);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\customer\domain\CustomerShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.customer.domain;
2: 
3: import lombok.Getter;
4: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
5: import thkoeln.archilab.ecommerce.solution.core.ShoppingBasketState;
6: 
7: import javax.persistence.Entity;
8: 
9: @Getter
10: @Entity
11: public abstract class CustomerShoppingBasket extends AbstractEntity {
12:     protected ShoppingBasketState shoppingBasketState = ShoppingBasketState.EMPTY;
13: 
14:     public abstract void setShoppingBasketState(ShoppingBasketState shoppingBasketState);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.core.ShoppingBasketState;
7: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
9: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
10: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryPosition;
11: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryPositionRepository;
12: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
13: import thkoeln.archilab.ecommerce.solution.good.application.GoodService;
14: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
15: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketService;
16: import thkoeln.archilab.ecommerce.usecases.CustomerType;
17: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
18: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
19: 
20: import javax.persistence.EntityManager;
21: import javax.persistence.PersistenceContext;
22: import java.util.HashMap;
23: import java.util.List;
24: import java.util.Map;
25: import java.util.UUID;
26: 
27: @Service
28: public class DeliveryService implements DeliveryUseCases {
29: 
30:     @Autowired
31:     private DeliveryRepository deliveryRepository;
32:     @Autowired
33:     private DeliveryPositionRepository deliveryPositionRepository;
34:     @Autowired
35:     private CustomerService customerService;
36:     @Autowired
37:     private ShoppingBasketService shoppingBasketService;
38:     @Autowired
39:     private GoodService goodService;
40: 
41:     @PersistenceContext
42:     private EntityManager entityManger;
43: 
44:     @Override
45:     public UUID triggerDelivery(CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
46:         if (deliveryRecipient == null || deliveryContent.size() == 0)
47:             throw new ShopException("deliveryContent is null or empty");
48:         int sum = 0;
49:         for (int quantity : deliveryContent.values()) sum += quantity;
50:         if (sum > 20) throw new ShopException("deliveryContent is > 20");
51: 
52:         Customer customer = customerService.findCustomerByEmail(deliveryRecipient.getEmail());
53: 
54:         Delivery newDelivery = new Delivery(customer);
55:         entityManger.persist(newDelivery);
56:         for (Map.Entry<UUID, Integer> entry : deliveryContent.entrySet()) {
57:             Good good = goodService.findGoodByGoodId(entry.getKey());
58:             if (good == null) throw new ShopException("Good not available");
59:             DeliveryPosition deliveryPosition = new DeliveryPosition(entry.getValue(), newDelivery, good);
60:             entityManger.persist(deliveryPosition);
61:         }
62: 
63:         shoppingBasketService.getShoppingBasketByCostumer(customer).setShoppingBasketState(ShoppingBasketState.DELIVERY_TRIGGERED);
64:         entityManger.persist(customer);
65: 
66:         return newDelivery.getId();
67:     }
68: 
69: 
70:     @Override
71:     public Map<UUID, Integer> getDeliveryHistory(EmailType customerEmail) {
72:         if(customerEmail == null) throw new ShopException("Email is empty");
73:         Customer customer = customerService.findCustomerByEmail(customerEmail);
74:         if(customer == null) throw new ShopException("Customer doesn't exists");
75: 
76:         Map<UUID, Integer> deliveryHistory = new HashMap<>();
77: 
78:         List<Delivery> deliveries = deliveryRepository.findAllByCustomer(customer);
79:         for (Delivery delivery : deliveries) {
80:             List<DeliveryPosition> deliveryPositions = deliveryPositionRepository.findAllByDelivery(delivery);
81:             for (DeliveryPosition deliveryPosition : deliveryPositions) {
82:                 int quantity = deliveryHistory.getOrDefault(deliveryPosition.getGood().getGoodId(), 0);
83:                 deliveryHistory.put(deliveryPosition.getGood().getGoodId(), quantity + deliveryPosition.getQuantity());
84:             }
85:         }
86:         return deliveryHistory;
87:     }
88: 
89:     @Override
90:     public void deleteDeliveryHistory() {
91:         deliveryPositionRepository.deleteAll();
92:         deliveryRepository.deleteAll();
93:     }
94: }
95: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
8: 
9: import javax.persistence.CascadeType;
10: import javax.persistence.Entity;
11: import javax.persistence.ManyToOne;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor
16: @AllArgsConstructor
17: public class Delivery  extends AbstractEntity {
18:     @ManyToOne(cascade= CascadeType.ALL)
19:     private Customer customer;
20: 
21: }
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: 
9: import javax.persistence.CascadeType;
10: import javax.persistence.Entity;
11: import javax.persistence.ManyToOne;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor
16: @AllArgsConstructor
17: public class DeliveryPosition extends AbstractEntity {
18:     private int quantity;
19: 
20:     @ManyToOne(cascade= CascadeType.ALL)
21:     private Delivery delivery;
22: 
23:     @ManyToOne(cascade= CascadeType.ALL)
24:     private Good good;
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.List;
6: import java.util.UUID;
7: 
8: public interface DeliveryPositionRepository  extends CrudRepository<DeliveryPosition, UUID> {
9:     List<DeliveryPosition> findAllByDelivery(Delivery delivery);
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
10:     List<Delivery> findAllByCustomer(Customer customer);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.core.FunctionHelper;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
9: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import javax.persistence.EntityManager;
13: import javax.persistence.PersistenceContext;
14: import java.util.UUID;
15: 
16: @Service
17: public class GoodCatalogService implements GoodCatalogUseCases {
18: 
19:     @Autowired
20:     private GoodRepository goodRepository;
21:     @Autowired
22:     private OrderGoodInterface orderService;
23:     @Autowired
24:     private ShoppingBasketGoodInterface shoppingBasketService;
25: 
26:     @PersistenceContext
27:     private EntityManager entityManger;
28: 
29: 
30:     @Override
31:     public void addGoodToCatalog(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType salesPrice) {
32:         if(goodId == null) throw new ShopException("No id provided");
33:         Good good = goodRepository.findByGoodId(goodId);
34:         if(good != null) throw new ShopException("the good id already exists");
35:         if(FunctionHelper.isEmpty(name) || FunctionHelper.isEmpty(description)) throw new ShopException("name or description are null or empty");
36:         if(FunctionHelper.isLessOrEqualsZero(size)) throw new ShopException("the size is <= 0");
37:         if(purchasePrice == null) throw new ShopException("the purchase price is null");
38:         if(salesPrice == null) throw new ShopException("the sales price is null");
39:         if(purchasePrice.largerThan(salesPrice)) throw new ShopException("the sales price is lower than the purchase price");
40: 
41:         Good newGood = new Good(goodId, name, description, size, purchasePrice, salesPrice);
42:         entityManger.persist(newGood);
43:     }
44: 
45:     @Override
46:     public void removeGoodFromCatalog(UUID goodId) {
47:         Good good = goodRepository.findByGoodId(goodId);
48:         if(good == null) throw new ShopException("the good id does not exist");
49:         if(good.getQuantity() > 0) throw new ShopException("the good is still in stock");
50:         if(orderService.getOrderPositionSizeByGood(good) != 0 || shoppingBasketService.getReservedPositionSizeByGood(good) != 0)
51:             throw new ShopException("the good is still reserved in a shopping basket, or part of a completed order");
52: 
53: 
54:         goodRepository.delete(good);
55:     }
56: 
57:     @Override
58:     public MoneyType getSalesPrice(UUID goodId) {
59:         Good good = goodRepository.findByGoodId(goodId);
60:         if(good == null) throw new ShopException("the good id does not exist");
61:         return good.getSalesPrice();
62:     }
63: 
64:     @Override
65:     public void deleteGoodCatalog() {
66:         goodRepository.deleteAll();
67:         //Delete all dependencies
68:     }
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
6: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
7: 
8: import java.util.Optional;
9: import java.util.UUID;
10: 
11: @Service
12: public class GoodService {
13: 
14:     @Autowired
15:     private GoodRepository goodRepository;
16: 
17:     public Good findGoodByGoodId(UUID goodId){
18:         return goodRepository.findByGoodId(goodId);
19:     }
20: }
21: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\OrderGoodInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: 
5: public interface OrderGoodInterface {
6:     int getOrderPositionSizeByGood(Good good);
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\ShoppingBasketGoodInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: 
5: public interface ShoppingBasketGoodInterface {
6:     int getReservedPositionSizeByGood(Good good);
7: 
8:     void updateReservedGoods(Good good);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\StockManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
7: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: 
10: import javax.persistence.EntityManager;
11: import javax.persistence.PersistenceContext;
12: import java.util.UUID;
13: 
14: @Service
15: public class StockManagementService implements StockManagementUseCases {
16: 
17:     @Autowired
18:     private GoodRepository goodRepository;
19:     @Autowired
20:     private ShoppingBasketGoodInterface shoppingBasketService;
21: 
22:     @PersistenceContext
23:     private EntityManager entityManger;
24: 
25:     @Override
26:     public void addToStock(UUID goodId, int addedQuantity) {
27:         if (goodId == null) throw new ShopException("No id provided");
28:         Good good = goodRepository.findByGoodId(goodId);
29:         if (good == null) throw new ShopException("the good id does not exist");
30:         if (addedQuantity <= 0) throw new ShopException("the added quantity is negative");
31: 
32:         good.addQuantity(addedQuantity);
33:         entityManger.persist(good);
34:     }
35: 
36:     @Override
37:     public void removeFromStock(UUID goodId, int removedQuantity) {
38:         if (goodId == null) throw new ShopException("No id provided");
39:         Good good = goodRepository.findByGoodId(goodId);
40:         if (good == null) throw new ShopException("the good id does not exist");
41:         if (removedQuantity <= 0) throw new ShopException("the quantity is negative");
42:         if (good.getQuantity() < removedQuantity)
43:             throw new ShopException("the removed quantity is greater than the current stock and the currently reserved goods together");
44: 
45: 
46:         good.removeQuantity(removedQuantity);
47:         shoppingBasketService.updateReservedGoods(good);
48: 
49:     }
50: 
51: 
52: 
53:     @Override
54:     public void changeStockTo(UUID goodId, int newTotalQuantity) {
55:         if (goodId == null) throw new ShopException("No id provided");
56:         Good good = goodRepository.findByGoodId(goodId);
57:         if (good == null) throw new ShopException("the good id does not exist");
58:         if (newTotalQuantity < 0) throw new ShopException("the quantity is negative");
59: 
60:         good.setQuantity(newTotalQuantity);
61: 
62:         shoppingBasketService.updateReservedGoods(good);
63:     }
64: 
65:     @Override
66:     public int getAvailableStock(UUID goodId) {
67:         if (goodId == null) throw new ShopException("No id provided");
68:         Good g = goodRepository.findByGoodId(goodId);
69:         if (g == null) throw new ShopException("the good id does not exist");
70: 
71:         return g.getQuantity();
72:     }
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @Getter
14: @NoArgsConstructor
15: public class Good extends AbstractEntity {
16:     private UUID goodId;
17:     private String name;
18:     private String description;
19:     private Float size;
20:     @Embedded
21:     @AttributeOverrides({
22:             @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
23:             @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
24:     })
25:     private Money purchasePrice;
26:     @Embedded
27:     @AttributeOverrides({
28:             @AttributeOverride(name="amount", column= @Column(name="salesAmount")),
29:             @AttributeOverride(name="currency", column= @Column(name="salesCurrency"))
30:     })
31:     private Money salesPrice;
32:     private Integer quantity;
33: 
34:     public Good(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType salesPrice) {
35:         this.goodId = goodId;
36:         this.name = name;
37:         this.description = description;
38:         this.size = size;
39:         this.purchasePrice = (Money) purchasePrice;
40:         this.salesPrice = (Money) salesPrice;
41:         this.quantity = 0;
42:     }
43: 
44:     public void addQuantity(int addedQuantity){
45:         this.quantity += addedQuantity;
46:     }
47: 
48:     public void removeQuantity(int quantity) {
49:         this.quantity -= quantity;
50:     }
51: 
52:     public void setQuantity(Integer quantity) {
53:         this.quantity = quantity;
54:     }
55: }
56: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\GoodRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.UUID;
6: 
7: public interface GoodRepository extends CrudRepository<Good, UUID> {
8: 
9:     Good findByGoodId(UUID goodId);
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\EmailDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: @AllArgsConstructor
9: @NoArgsConstructor
10: @Getter
11: @Setter
12: public class EmailDTO {
13:     private String emailString;
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import java.util.List;
10: import java.util.UUID;
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: public class OrderDTO {
17: 
18:     private UUID id;
19:     private EmailDTO email;
20:     private Money price;
21:     private List<OrderPositionDTO> orderPositions;
22: 
23: }
24: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: 
8: import java.util.UUID;
9: 
10: @AllArgsConstructor
11: @NoArgsConstructor
12: @Setter
13: @Getter
14: public class OrderPositionDTO {
15:     private UUID goodId;
16:     private int quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.ResponseEntity;
5: import org.springframework.web.bind.annotation.GetMapping;
6: import org.springframework.web.bind.annotation.RequestParam;
7: import org.springframework.web.bind.annotation.RestController;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.domainprimitives.Email;
10: 
11: import java.util.ArrayList;
12: import java.util.List;
13: 
14: @RestController
15: public class OrderRESTController {
16: 
17:     @Autowired
18:     private OrderService orderService;
19: 
20:     @GetMapping(value = "/orders")
21:     public ResponseEntity<List<OrderDTO>> getAllOrders(){
22:         return ResponseEntity.ok().body(new ArrayList<>());
23:     }
24: 
25:     @GetMapping(value = "/orders", params = {"email"})
26:     public ResponseEntity<List<OrderDTO>> getAllOrders(@RequestParam String email){
27:         try{
28:             List<OrderDTO> list = orderService.getAllOrdersForCustomerEmail(Email.of(email));
29:             return ResponseEntity.ok().body(list);
30:         }catch (ShopException ex){
31:             return ResponseEntity.ok().body(new ArrayList<>());
32:         }
33:     }
34: 
35:     @GetMapping(value = "/orders", params = {"email", "filter"})
36:     public ResponseEntity<List<OrderDTO>> getAllOrdersWithFilter(@RequestParam String email, @RequestParam String filter){
37:         try{
38:             if (filter.equals("latest")){
39:                 List<OrderDTO> list = orderService.getAllOrdersForCustomerEmail(Email.of(email));
40:                 return ResponseEntity.ok().body(List.of(list.get(list.size()-1)));
41:             }else{
42:                 return ResponseEntity.ok().body(new ArrayList<>());
43:             }
44:         }catch (ShopException ex){
45:             return ResponseEntity.ok().body(new ArrayList<>());
46:         }
47:     }
48: }
49: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import org.springframework.transaction.annotation.Transactional;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
10: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
11: import thkoeln.archilab.ecommerce.solution.good.application.OrderGoodInterface;
12: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
13: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
14: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
15: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPositionRepository;
16: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
17: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGood;
18: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
19: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
20: 
21: import java.util.*;
22: 
23: @Service
24: public class OrderService implements OrderGoodInterface {
25: 
26:     @Autowired
27:     private OrderRepository orderRepository;
28:     @Autowired
29:     private OrderPositionRepository orderPositionRepository;
30:     @Autowired
31:     private CustomerService customerService;
32: 
33: 
34:     public Map<UUID, Integer> getOrderHistory(EmailType customerEmail) {
35:         Customer customer = customerService.findCustomerByEmail(customerEmail);
36:         if (customer == null) throw new ShopException("Customer not found!");
37: 
38:         Map<UUID, Integer> orderHistory = new HashMap<>();
39: 
40:         List<Order> orders = orderRepository.findAllByCustomer(customer);
41:         for (Order order : orders) {
42:             List<OrderPosition> orderPositions = orderPositionRepository.findAllByOrder(order);
43:             for (OrderPosition orderPosition : orderPositions) {
44:                 int quantity = orderHistory.getOrDefault(orderPosition.getGood().getGoodId(), 0);
45:                 orderHistory.put(orderPosition.getGood().getGoodId(), quantity + orderPosition.getQuantity());
46:             }
47:         }
48:         return orderHistory;
49:     }
50: 
51:     public MoneyType getOrderAsMoneyValue(Order order) {
52:         if (order == null) throw new ShopException("Order is null");
53:         MoneyType totalPrice = null;
54:         for (OrderPosition orderPosition : orderPositionRepository.findAllByOrder(order)) {
55:             if(totalPrice == null){
56:                 totalPrice = orderPosition.getGood().getSalesPrice().multiplyBy(orderPosition.getQuantity());
57:             }else{
58:                 totalPrice = totalPrice.add(orderPosition.getGood().getSalesPrice().multiplyBy(orderPosition.getQuantity()));
59:             }
60:         }
61:         return totalPrice;
62:     }
63: 
64: 
65:     @Transactional
66:     public void deleteAllOrders() {
67:         orderPositionRepository.deleteAll();
68:         orderRepository.deleteAll();
69:     }
70: 
71: 
72:     public int getOrderPositionSizeByGood(Good good){
73:         return orderPositionRepository.findAllByGood(good).size();
74:     }
75: 
76:     //TODO: DO I use Email or EmailType?
77:     public List<OrderDTO> getAllOrdersForCustomerEmail(EmailType email){
78:         Customer customer = customerService.findCustomerByEmail(email);
79:         if (customer == null) return new ArrayList<>();
80: 
81:         List<OrderDTO> orderDTOList = new ArrayList<>();
82:         List<Order> orders = orderRepository.findAllByCustomer(customer);
83:         for (Order order: orders){
84:             orderDTOList.add(mapToDto(order));
85:         }
86:         return orderDTOList;
87:     }
88: 
89:     public OrderDTO mapToDto(Order order){
90:         ModelMapper modelMapper = new ModelMapper();
91:         OrderDTO orderDTO = modelMapper.map(order, OrderDTO.class);
92:         orderDTO.setEmail(new EmailDTO(order.getCustomer().getEmail().toString()));
93:         orderDTO.setPrice((Money) getOrderAsMoneyValue(order));
94:         List<OrderPositionDTO> orderPositionDTOS = new ArrayList<>();
95:         for(OrderPosition orderPosition: orderPositionRepository.findAllByOrder(order)){
96:             OrderPositionDTO orderPositionDTO = modelMapper.map(orderPosition, OrderPositionDTO.class);
97:             orderPositionDTO.setGoodId(orderPosition.getGood().getGoodId());
98:             orderPositionDTOS.add(orderPositionDTO);
99:         }
100:         orderDTO.setOrderPositions(orderPositionDTOS);
101:         return orderDTO;
102:     }
103: }
104: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
8: 
9: import javax.persistence.CascadeType;
10: import javax.persistence.Entity;
11: import javax.persistence.ManyToOne;
12: import javax.persistence.Table;
13: 
14: @Entity
15: @Getter
16: @NoArgsConstructor
17: @AllArgsConstructor
18: @Table(name = "MyOrder")
19: public class Order extends AbstractEntity {
20:     @ManyToOne(cascade= CascadeType.ALL)
21:     private Customer customer;
22: 
23: }
24: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: 
9: import javax.persistence.CascadeType;
10: import javax.persistence.Entity;
11: import javax.persistence.ManyToOne;
12: 
13: @Entity
14: @Getter
15: @NoArgsConstructor
16: @AllArgsConstructor
17: public class OrderPosition extends AbstractEntity {
18:     private int quantity;
19:     private String comment;
20: 
21:     @ManyToOne(cascade= CascadeType.ALL)
22:     private Order order;
23:     @ManyToOne
24:     private Good good;
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface OrderPositionRepository extends CrudRepository<OrderPosition, UUID> {
10:     List<OrderPosition> findAllByGood(Good good);
11:     List<OrderPosition> findAllByOrder(Order order);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface OrderRepository extends CrudRepository<Order, UUID> {
10:     List<Order> findAllByCustomer(Customer customer);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.core.ShoppingBasketState;
7: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
9: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
11: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketService;
12: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
15: 
16: import javax.persistence.EntityManager;
17: import javax.persistence.PersistenceContext;
18: import java.util.List;
19: import java.util.UUID;
20: 
21: @Service
22: public class PaymentService implements PaymentUseCases {
23: 
24:     @Autowired
25:     private PaymentRepository paymentRepository;
26:     @Autowired
27:     private CustomerService customerService;
28:     @Autowired
29:     private ShoppingBasketService shoppingBasketService;
30: 
31:     @PersistenceContext
32:     private EntityManager entityManger;
33: 
34:     @Override
35:     public UUID authorizePayment(EmailType customerEmail, MoneyType amount) {
36:         if(customerEmail == null) throw new ShopException("Email empty");
37:         Customer customer = customerService.findCustomerByEmail(customerEmail);
38:         if(customer == null) throw new ShopException("Customer not found");
39:         if(amount == null) throw new ShopException("amount == null");
40:         if(amount.getAmount() > 500) throw new ShopException("amount > 500€");
41: 
42:         Payment newPayment = new Payment(customer, amount);
43:         entityManger.persist(newPayment);
44: 
45:         //State
46:         shoppingBasketService.getShoppingBasketByCostumer(customer).setShoppingBasketState(ShoppingBasketState.PAYMENT_AUTHORIZED);
47:         entityManger.persist(customer);
48: 
49:         return newPayment.getId();
50:     }
51: 
52:     @Override
53:     public MoneyType getPaymentTotal(EmailType customerEmail) {
54:         if(customerEmail == null) throw new ShopException("Email empty");
55:         Customer customer = customerService.findCustomerByEmail(customerEmail);
56:         if(customer == null) throw new ShopException("Customer not found");
57: 
58:         List<Payment> payments = paymentRepository.findAllByCustomer(customer);
59:         MoneyType moneySum = null;
60:         for(Payment payment: payments){
61:             if (moneySum == null){
62:                 moneySum = payment.getAmount();
63:             }else{
64:                 moneySum = moneySum.add(payment.getAmount());
65:             }
66:         }
67:         return moneySum;
68: 
69:     }
70: 
71:     @Override
72:     public void deletePaymentHistory() {
73:         paymentRepository.deleteAll();
74:     }
75: }
76: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
9: 
10: import javax.persistence.CascadeType;
11: import javax.persistence.Embedded;
12: import javax.persistence.Entity;
13: import javax.persistence.ManyToOne;
14: 
15: @Entity
16: @Getter
17: @NoArgsConstructor
18: @AllArgsConstructor
19: public class Payment extends AbstractEntity {
20:     @ManyToOne(cascade= CascadeType.ALL)
21:     private Customer customer;
22: 
23:     @Embedded
24:     private MoneyType amount;
25: 
26: }
27: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
10:     List<Payment> findAllByCustomer(Customer customer);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\QuantityCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import lombok.ToString;
7: 
8: import java.util.UUID;
9: 
10: @NoArgsConstructor
11: @Setter
12: @Getter
13: @ToString
14: public class QuantityCommentDTO {
15:     private UUID goodId;
16:     private Integer quantity;
17:     private String comment;
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: 
9: import java.util.UUID;
10: 
11: @AllArgsConstructor
12: @NoArgsConstructor
13: @Getter
14: @Setter
15: public class ShoppingBasketDTO {
16:     private UUID id;
17:     private Email email;
18:     private int totalQuantity;
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.ResponseEntity;
5: import org.springframework.web.bind.annotation.*;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
9: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
10: import thkoeln.archilab.ecommerce.solution.good.application.GoodService;
11: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
12: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGood;
13: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGoodRepository;
14: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
15: 
16: import java.util.UUID;
17: 
18: @RestController
19: public class ShoppingBasketRESTController {
20: 
21:     @Autowired
22:     private ShoppingBasketService shoppingBasketService;
23:     @Autowired
24:     private ShoppingBasketRestUseCase shoppingBasketRestUseCase;
25:     @Autowired
26:     private CustomerService customerService;
27:     @Autowired
28:     private GoodService goodService;
29:     @Autowired
30:     private ReservedGoodRepository reservedGoodRepository;
31: 
32:     @GetMapping("/shoppingBaskets")
33:     public ResponseEntity<ShoppingBasketDTO> getShoppingBasket(@RequestParam String email) {
34:         try {
35:             Customer customer = customerService.findCustomerByEmail(Email.of(email));
36:             if (customer == null) return ResponseEntity.notFound().build();
37:             return ResponseEntity.ok().body(
38:                     shoppingBasketRestUseCase.mapShoppingBasketToDTO(shoppingBasketService.getShoppingBasketByCostumer(customer))
39:             );
40:         }catch (ShopException ex) {
41:             return ResponseEntity.notFound().build();
42:         }
43:     }
44: 
45:     @PostMapping("/shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions")
46:     public ResponseEntity<QuantityCommentDTO> changeShoppingBasket(
47:             @PathVariable("shoppingBasket-id") UUID shoppingBasketId, @RequestBody QuantityCommentDTO quantityCommentDTO) {
48:         try {
49:             ShoppingBasket shoppingBasket = shoppingBasketService.getShoppingBasketById(shoppingBasketId);
50:             Good good = goodService.findGoodByGoodId(quantityCommentDTO.getGoodId());
51: 
52:             if (quantityCommentDTO.getQuantity() > 0) {
53:                 shoppingBasketService.addGoodToShoppingBasket(
54:                         shoppingBasket.getCustomer().getEmail(),
55:                         quantityCommentDTO.getGoodId(),
56:                         quantityCommentDTO.getQuantity()
57:                 );
58:             } else {
59:                 shoppingBasketService.removeGoodFromShoppingBasket(
60:                         shoppingBasket.getCustomer().getEmail(),
61:                         quantityCommentDTO.getGoodId(),
62:                         -quantityCommentDTO.getQuantity()
63:                 );
64:             }
65: 
66: 
67:             if (quantityCommentDTO.getComment() != null)
68:                 shoppingBasketService.setCommentForShoppingBasketPosition(
69:                         shoppingBasket.getCustomer(), quantityCommentDTO.getGoodId(), quantityCommentDTO.getComment()
70:                 );
71: 
72:             return ResponseEntity.status(201).build();
73: 
74:         } catch (ShopException ex) {
75:             return ResponseEntity.status(409).build();
76:         }
77: 
78:     }
79: 
80:     @DeleteMapping("/shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
81:     public ResponseEntity<QuantityCommentDTO> deleteReservedGood(
82:             @PathVariable("shoppingBasket-id") UUID shoppingBasketId, @PathVariable("good-id") UUID goodId) {
83: 
84:         try {
85:             ShoppingBasket shoppingBasket = shoppingBasketService.getShoppingBasketById(shoppingBasketId);
86:             Good good = goodService.findGoodByGoodId(goodId);
87: 
88:             ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
89:             if (reservedGood == null) {
90:                 return ResponseEntity.notFound().build();
91:             }
92: 
93:             shoppingBasketService.removeGoodFromShoppingBasket(shoppingBasket.getCustomer().getEmail(), goodId, reservedGood.getQuantity());
94: 
95:             return ResponseEntity.ok().build();
96:         } catch (ShopException ex) {
97:             return ResponseEntity.notFound().build();
98:         }
99: 
100:     }
101: 
102: 
103:     @GetMapping("/shoppingBaskets/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
104:     public ResponseEntity<QuantityCommentDTO> getQuantityAndComment(
105:             @PathVariable("shoppingBasket-id") UUID shoppingBasketId, @PathVariable("good-id") UUID goodId) {
106: 
107:         try {
108:             ShoppingBasket shoppingBasket = shoppingBasketService.getShoppingBasketById(shoppingBasketId);
109:             Good good = goodService.findGoodByGoodId(goodId);
110: 
111:             if (shoppingBasket == null || good == null) {
112:                 return ResponseEntity.notFound().build();
113:             }
114: 
115:             return ResponseEntity.ok().body(
116:                     shoppingBasketRestUseCase.getQuantityCommentDTOForShoppingBasketGood(shoppingBasket, good)
117:             );
118:         } catch (ShopException ex) {
119:             return ResponseEntity.notFound().build();
120:         }
121: 
122:     }
123: 
124: 
125:     @PutMapping("/shoppingBaskets/{shoppingBasket-id}/checkout")
126:     public ResponseEntity checkout(@PathVariable("shoppingBasket-id") UUID shoppingBasketId) {
127:         try {
128:             Customer customer = shoppingBasketService.getShoppingBasketById(shoppingBasketId).getCustomer();
129: 
130:             if (customer == null) {
131:                 return ResponseEntity.notFound().build();
132:             }
133:             try {
134:                 shoppingBasketService.checkout(customer.getEmail());
135:             }catch (ShopException ex){
136:                 return ResponseEntity.status(409).build();
137:             }
138: 
139: 
140:             return ResponseEntity.ok().build();
141: 
142:         } catch (ShopException ex) {
143:             return ResponseEntity.status(404).build();
144:         }
145:     }
146: }
147: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketRestService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGood;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGoodRepository;
10: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
11: 
12: @Service
13: public class ShoppingBasketRestService implements ShoppingBasketRestUseCase {
14: 
15:     @Autowired
16:     private ShoppingBasketService shoppingBasketService;
17:     @Autowired
18:     private ReservedGoodRepository reservedGoodRepository;
19: 
20: 
21:     @Override
22:     public ShoppingBasketDTO mapShoppingBasketToDTO(ShoppingBasket shoppingBasket){
23:         ModelMapper modelMapper = new ModelMapper();
24:         ShoppingBasketDTO shoppingBasketDTO = modelMapper.map(shoppingBasket, ShoppingBasketDTO.class);
25:         shoppingBasketDTO.setEmail(shoppingBasket.getCustomer().getEmail());
26:         shoppingBasketDTO.setTotalQuantity(shoppingBasketService.getQuantityOfAllReservedGoods(shoppingBasket));
27:         return shoppingBasketDTO;
28:     }
29: 
30:     @Override
31:     public QuantityCommentDTO getQuantityCommentDTOForShoppingBasketGood(ShoppingBasket shoppingBasket, Good good){
32:         ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
33:         if(reservedGood == null) throw new ShopException("404");
34:         QuantityCommentDTO quantityCommentDTO = new QuantityCommentDTO();
35:         quantityCommentDTO.setGoodId(good.getGoodId());
36:         quantityCommentDTO.setQuantity(reservedGood.getQuantity());
37:         quantityCommentDTO.setComment(reservedGood.getComment());
38:         return quantityCommentDTO;
39:     }
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketRestUseCase.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
5: 
6: public interface ShoppingBasketRestUseCase {
7: 
8:     ShoppingBasketDTO mapShoppingBasketToDTO(ShoppingBasket shoppingBasket);
9: 
10:     QuantityCommentDTO getQuantityCommentDTOForShoppingBasketGood(ShoppingBasket shoppingBasket, Good good);
11: 
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import org.springframework.transaction.annotation.Transactional;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.solution.core.FunctionHelper;
9: import thkoeln.archilab.ecommerce.solution.core.ShoppingBasketState;
10: import thkoeln.archilab.ecommerce.solution.customer.application.CustomerService;
11: import thkoeln.archilab.ecommerce.solution.customer.application.ShoppingBasketCustomerService;
12: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
13: import thkoeln.archilab.ecommerce.solution.good.application.GoodService;
14: import thkoeln.archilab.ecommerce.solution.good.application.ShoppingBasketGoodInterface;
15: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
16: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
17: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
18: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGood;
19: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGoodRepository;
20: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
21: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
22: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
23: import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
24: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
25: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
26: 
27: import javax.persistence.EntityManager;
28: import javax.persistence.PersistenceContext;
29: import java.util.*;
30: 
31: 
32: @Service
33: public class ShoppingBasketService implements ShoppingBasketGoodInterface, ShoppingBasketCustomerService, ShoppingBasketServiceUseCase {
34: 
35:     @Autowired
36:     private ReservedGoodRepository reservedGoodRepository;
37: 
38: 
39:     @Autowired
40:     private ShoppingBasketRepository shoppingBasketRepository;
41:     @Autowired
42:     private CustomerService customerService;
43:     @Autowired
44:     private GoodService goodService;
45: 
46:     @Autowired
47:     private PaymentUseCases paymentUseCases;
48: 
49:     @PersistenceContext
50:     private EntityManager entityManger;
51: 
52:     @Override
53:     public void addGoodToShoppingBasket(EmailType customerEmail, UUID goodId, int quantity) {
54:         Customer customer = customerService.findCustomerByEmail(customerEmail);
55:         if (customer == null) throw new ShopException("Customer not found!");
56:         Good good = goodService.findGoodByGoodId(goodId);
57:         if (good == null) throw new ShopException("the good id does not exist");
58:         if (quantity < 0) throw new ShopException("the quantity is negative");
59: 
60:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByGood(good);
61:         int stock = good.getQuantity();
62:         for (ReservedGood reservedGood : reservedGoods) stock -= reservedGood.getQuantity();
63:         if (stock < quantity) throw new ShopException("the good is not available in the requested quantity");
64: 
65:         ShoppingBasket shoppingBasket = getShoppingBasketByCostumer(customer);
66: 
67:         ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
68:         if(reservedGood == null) {
69:             reservedGood = new ReservedGood(quantity, good, shoppingBasket, null);
70:         }else{
71:             reservedGood.addQuantity(quantity);
72:         }
73:         entityManger.persist(reservedGood);
74: 
75:         //State
76:         shoppingBasket.setShoppingBasketState(ShoppingBasketState.FILLED);
77:         entityManger.persist(customer);
78:     }
79: 
80:     @Override
81:     public void removeGoodFromShoppingBasket(EmailType customerEmail, UUID goodId, int quantity) {
82:         Customer customer = customerService.findCustomerByEmail(customerEmail);
83:         if (customer == null) throw new ShopException("Customer not found");
84:         Good good = goodService.findGoodByGoodId(goodId);
85:         if (good == null) throw new ShopException("the good id does not exist");
86:         if (FunctionHelper.isNegativeOrNull(quantity)) throw new ShopException("the quantity is negative");
87:         ShoppingBasket shoppingBasket = getShoppingBasketByCostumer(customer);
88:         ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
89:         if (reservedGood == null || reservedGood.getQuantity() < quantity)
90:             throw new ShopException("the good is not in the cart in the requested quantity");
91: 
92:         int newQuantity = reservedGood.removeQuantity(quantity);
93:         if(newQuantity == 0){
94:             reservedGoodRepository.delete(reservedGood);
95:         }else{
96:             entityManger.persist(reservedGood);
97:         }
98:         //State
99:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByShoppingBasket(shoppingBasket);
100:         if(reservedGoods.size()==0){
101:             shoppingBasket.setShoppingBasketState(ShoppingBasketState.EMPTY);
102:         }else{
103:             shoppingBasket.setShoppingBasketState(ShoppingBasketState.FILLED);
104:         }
105:         entityManger.persist(customer);
106: 
107: 
108:     }
109: 
110:     @Override
111:     public Map<UUID, Integer> getShoppingBasketAsMap(EmailType customerEmail) {
112:         Customer customer = customerService.findCustomerByEmail(customerEmail);
113:         if (customer == null) throw new ShopException("Customer not found!");
114: 
115:         Map<UUID, Integer> cart = new HashMap<>();
116:         for (ReservedGood reservedGood : reservedGoodRepository.findAllByShoppingBasket(getShoppingBasketByCostumer(customer))) {
117:             cart.put(reservedGood.getGood().getGoodId(), reservedGood.getQuantity());
118:         }
119:         return cart;
120:     }
121: 
122:     @Override
123:     public MoneyType getShoppingBasketAsMoneyValue(EmailType customerEmail) {
124:         Customer customer = customerService.findCustomerByEmail(customerEmail);
125:         if (customer == null) throw new ShopException("Customer not found!");
126: 
127: 
128:         MoneyType totalPrice = null;
129:         for (ReservedGood reservedGood : reservedGoodRepository.findAllByShoppingBasket(getShoppingBasketByCostumer(customer))) {
130:             if(totalPrice == null){
131:                 totalPrice = reservedGood.getGood().getSalesPrice().multiplyBy(reservedGood.getQuantity());
132:             }else{
133:                 totalPrice = totalPrice.add(reservedGood.getGood().getSalesPrice().multiplyBy(reservedGood.getQuantity()));
134:             }
135:         }
136:         return totalPrice;
137:     }
138: 
139:     @Override
140:     public int getReservedStockInShoppingBaskets(UUID goodId) {
141:         Good good = goodService.findGoodByGoodId(goodId);
142:         if (good == null) throw new ShopException("the good id does not exist");
143: 
144:         int stock = 0;
145:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByGood(good);
146:         for(ReservedGood reservedGood: reservedGoods){
147:             stock += reservedGood.getQuantity();
148:         }
149:         return stock;
150:     }
151: 
152:     @Override
153:     public boolean isEmpty(EmailType customerEmail) {
154:         if(customerEmail == null) throw new ShopException("Customer email empty");
155:         Customer customer = customerService.findCustomerByEmail(customerEmail);
156:         if (customer == null) throw new ShopException("Customer not found!");
157: 
158:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByShoppingBasket(getShoppingBasketByCostumer(customer));
159:         return reservedGoods.size()==0;
160:     }
161: 
162:     @Override
163:     public boolean isPaymentAuthorized(EmailType customerEmail) {
164:         if(customerEmail == null) throw new ShopException("Customer email empty");
165:         Customer customer = customerService.findCustomerByEmail(customerEmail);
166:         if (customer == null) throw new ShopException("Customer not found!");
167: 
168:         return getShoppingBasketByCostumer(customer).getShoppingBasketState() == ShoppingBasketState.PAYMENT_AUTHORIZED;
169:     }
170: 
171:     @Override
172:     public void checkout(EmailType customerEmail) {
173:         //Trigger Payment
174:         paymentUseCases.authorizePayment(customerEmail, getShoppingBasketAsMoneyValue(customerEmail));
175:         //Errors
176:         Customer customer = customerService.findCustomerByEmail(customerEmail);
177:         if (customer == null) throw new ShopException("Customer not found!");
178:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByShoppingBasket(getShoppingBasketByCostumer(customer));
179:         if (reservedGoods.size() == 0) throw new ShopException("The cart is empty");
180:         int sum = 0;
181:         for (ReservedGood reservedGood : reservedGoods) sum += reservedGood.getQuantity();
182:         if (sum > 20) throw new ShopException("deliveryContent is > 20");
183:         if(getShoppingBasketAsMoneyValue(customerEmail).getAmount() > 500) throw new ShopException("amount > 500€");
184: 
185: 
186:         Order newOrder = new Order(customer);
187:         entityManger.persist(newOrder);
188: 
189:         ShoppingBasket shoppingBasket = getShoppingBasketByCostumer(customer);
190: 
191:         for (ReservedGood reservedGood: reservedGoodRepository.findAllByShoppingBasket(shoppingBasket)){
192:             OrderPosition orderPosition = new OrderPosition(reservedGood.getQuantity(), reservedGood.getComment(), newOrder, reservedGood.getGood());
193:             entityManger.persist(orderPosition);
194:             Good good = reservedGood.getGood();
195:             if(good != null) good.removeQuantity(reservedGood.getQuantity());
196:             reservedGoodRepository.delete(reservedGood);
197:         }
198: 
199:         //State
200:         shoppingBasket.setShoppingBasketState(ShoppingBasketState.EMPTY);
201:         entityManger.persist(shoppingBasket);
202: 
203:     }
204: 
205:     @Override
206:     public int getReservedPositionSizeByGood(Good good){
207:         return reservedGoodRepository.findAllByGood(good).size();
208:     }
209: 
210: 
211:     @Override
212:     public int getQuantityOfAllReservedGoods(ShoppingBasket shoppingBasket){
213:         int quantity = 0;
214:         for (ReservedGood reservedGood: reservedGoodRepository.findAllByShoppingBasket(shoppingBasket)){
215:             quantity+= reservedGood.getQuantity();
216:         }
217:         return quantity;
218:     }
219: 
220:     @Override
221:     public void updateReservedGoods(Good good) {
222:         List<ReservedGood> reservedGoods = reservedGoodRepository.findAllByGood(good);
223:         reservedGoods.sort(Comparator.comparingInt(ReservedGood::getQuantity).reversed());
224: 
225:         int actualQuantity = good.getQuantity();
226:         for (ReservedGood reservedGood : reservedGoods) actualQuantity -= reservedGood.getQuantity();
227: 
228:         //Nothing to Update
229:         if (actualQuantity >= 0) return;
230: 
231:         int toRemove = -actualQuantity;
232:         for (ReservedGood reservedGood : reservedGoods) {
233:             if (reservedGood.getQuantity() >= toRemove) {
234:                 reservedGood.removeQuantity(toRemove);
235:                 entityManger.persist(reservedGood);
236:                 return;
237:             } else {
238:                 toRemove -= reservedGood.getQuantity();
239: 
240:                 //TODO: Ask why??
241:                 //Change this
242:                 reservedGood.setQuantity(0);
243:                 entityManger.persist(reservedGood);
244:                 //To this
245:                 //reservedGood.delete(reservedGoodRepository);
246:             }
247:         }
248:     }
249: 
250: 
251:     @Override
252:     public ShoppingBasket getShoppingBasketByCostumer(Customer customer){
253:         return shoppingBasketRepository.findShoppingBasketByCustomer(customer);
254:     }
255: 
256: 
257:     @Override
258:     public ShoppingBasket getShoppingBasketById(UUID id){
259:         Optional<ShoppingBasket> shoppingBasket = shoppingBasketRepository.findById(id);
260:         if (shoppingBasket.isEmpty()) throw new ShopException("ShoppingBasket not Found");
261:         return shoppingBasket.get();
262:     }
263: 
264:     @Transactional
265:     @Override
266:     public void createShoppingBasket(Customer customer) {
267:         ShoppingBasket shoppingBasket = new ShoppingBasket(customer);
268:         entityManger.persist(shoppingBasket);
269:     }
270: 
271:     @Override
272:     public void deleteAllShoppingBaskets() {
273:         shoppingBasketRepository.deleteAll();
274:     }
275: 
276:     @Override
277:     public void setCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId, String comment) {
278:         Customer customer = customerService.findCustomerByEmail(customerEmail);
279:         if (customer == null) throw new ShopException("Customer not found");
280:         setCommentForShoppingBasketPosition(customer, goodId, comment);
281:     }
282:     public void setCommentForShoppingBasketPosition(Customer customer, UUID goodId, String comment) {
283:         Good good = goodService.findGoodByGoodId(goodId);
284:         if (good == null) throw new ShopException("the good id does not exist!");
285:         ShoppingBasket shoppingBasket = getShoppingBasketByCostumer(customer);
286:         ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
287:         if (reservedGood == null) throw new ShopException("the good is not in the cart");
288: 
289:         reservedGood.setComment(comment);
290:         entityManger.persist(reservedGood);
291:     }
292: 
293:     @Override
294:     public String getCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId) {
295:         Customer customer = customerService.findCustomerByEmail(customerEmail);
296:         if (customer == null) throw new ShopException("Customer not found!");
297:         Good good = goodService.findGoodByGoodId(goodId);
298:         if (good == null) throw new ShopException("the good id does not exist");
299:         ShoppingBasket shoppingBasket = getShoppingBasketByCostumer(customer);
300:         ReservedGood reservedGood = reservedGoodRepository.findByGoodAndShoppingBasket(good, shoppingBasket);
301:         if (reservedGood == null) throw new ShopException("the good is not in the cart");
302: 
303:         return reservedGood.getComment();
304:     }
305: 
306: 
307: 
308: }
309: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketServiceUseCase.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
4: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
7: 
8: import java.util.Map;
9: import java.util.UUID;
10: 
11: public interface ShoppingBasketServiceUseCase {
12: 
13: 
14:     void addGoodToShoppingBasket(EmailType customerEmail, UUID goodId, int quantity);
15: 
16:     void removeGoodFromShoppingBasket(EmailType customerEmail, UUID goodId, int quantity);
17: 
18:     void setCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId, String comment);
19: 
20:     String getCommentForShoppingBasketPosition(EmailType customerEmail, UUID goodId);
21: 
22:     Map<UUID, Integer> getShoppingBasketAsMap(EmailType customerEmail);
23: 
24:     MoneyType getShoppingBasketAsMoneyValue(EmailType customerEmail);
25: 
26:     int getReservedStockInShoppingBaskets(UUID goodId);
27: 
28:     boolean isEmpty(EmailType customerEmail);
29: 
30:     boolean isPaymentAuthorized(EmailType customerEmail);
31: 
32:     void checkout(EmailType customerEmail);
33: 
34:     ShoppingBasket getShoppingBasketById(UUID id);
35: 
36:     ShoppingBasket getShoppingBasketByCostumer(Customer customer);
37: 
38:     int getQuantityOfAllReservedGoods(ShoppingBasket shoppingBasket);
39: }
40: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ReservedGood.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.AbstractEntity;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerShoppingBasket;
8: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
9: 
10: import javax.persistence.CascadeType;
11: import javax.persistence.Entity;
12: import javax.persistence.ManyToOne;
13: 
14: @Entity
15: @Getter
16: @NoArgsConstructor
17: @AllArgsConstructor
18: public class ReservedGood extends AbstractEntity {
19: 
20:     private int quantity;
21: 
22:     @ManyToOne
23:     private Good good;
24: 
25:     @ManyToOne(cascade= CascadeType.ALL)
26:     private CustomerShoppingBasket shoppingBasket;
27: 
28:     private String comment;
29: 
30:     public int removeQuantity(int quantity) {
31:         this.quantity -= quantity;
32:         return this.quantity;
33:     }
34: 
35:     public void addQuantity(int quantity) {
36:         this.quantity += quantity;
37:     }
38: 
39:     public void setQuantity(int quantity) {
40:         this.quantity = quantity;
41:     }
42: 
43:     public void setComment(String comment){
44:         this.comment = comment;
45:     }
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ReservedGoodRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerShoppingBasket;
5: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
6: 
7: import java.util.List;
8: import java.util.UUID;
9: 
10: public interface ReservedGoodRepository extends CrudRepository<ReservedGood, UUID> {
11:     List<ReservedGood> findAllByShoppingBasket(CustomerShoppingBasket shoppingBasket);
12:     ReservedGood findByGoodAndShoppingBasket(Good good, CustomerShoppingBasket shoppingBasket);
13:     List<ReservedGood> findAllByGood(Good good);
14: 
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.solution.core.ShoppingBasketState;
7: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
8: import thkoeln.archilab.ecommerce.solution.customer.domain.CustomerShoppingBasket;
9: 
10: import javax.persistence.CascadeType;
11: import javax.persistence.Entity;
12: import javax.persistence.OneToOne;
13: 
14: @Entity
15: @Getter
16: @NoArgsConstructor
17: @AllArgsConstructor
18: public class ShoppingBasket extends CustomerShoppingBasket {
19: 
20:     @OneToOne(cascade= CascadeType.ALL)
21:     private Customer customer;
22: 
23:     public void setShoppingBasketState(ShoppingBasketState shoppingBasketState) {
24:         this.shoppingBasketState = shoppingBasketState;
25:     }
26: }
27: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.customer.domain.Customer;
5: 
6: import java.util.UUID;
7: 
8: public interface ShoppingBasketRepository extends CrudRepository<ShoppingBasket, UUID> {
9: 
10:     ShoppingBasket findShoppingBasketByCustomer(Customer customer);
11: 
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a customer.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface CustomerRegistrationUseCases {
12:     /**
13:      * Registers a new customer
14:      *
15:      * @param name
16:      * @param email
17:      * @param address
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - customer with the given email already exists
22:      *      - address is null
23:      */
24:     public void register( String name, EmailType email, AddressType address );
25: 
26: 
27:     /**
28:      * Changes the address of a customer
29:      *
30:      * @param customerEmail
31:      * @param address
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - customer with the given email already exists
35:      *      - address is null
36:      */
37:     public void changeAddress( EmailType customerEmail, AddressType address );
38: 
39: 
40:     /**
41:      * Returns the data of a customer
42:      * @param customerEmail
43:      * @return the customer data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the customer with the given email does not exist
47:      */
48:     public CustomerType getCustomerData( EmailType customerEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all customers, including all orders and shopping baskets
54:      */
55:     public void deleteAllCustomers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\CustomerType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop customer
8:  */
9: public interface CustomerType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public AddressType getAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of goods to a customer. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a good to a customer. The good is identified by its id, and the customer by
16:      * his/her name, street, city and zip code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of good ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of goods in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( CustomerType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which goods have been delivered to a customer, and how many of each good
31:      *
32:      * @param customerEmail
33:      * @return the delivery history of the customer (map is empty if the customer has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the customer with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType customerEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\AddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface AddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the zip code
18:      */
19:     public ZipCodeType getZipCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an zip code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param zipCode the zip code
30:      * @return the address object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - zipCode is null
35:      */
36:      // public static AddressType of( String street, String city, ZipCodeType zipCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\ZipCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface ZipCodeType {
6:     /**
7:      * @return the zip code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an zip code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param zipCodeAsString - the zip code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new zip code object matching the given string
22:      * @throws ShopException if ...
23:      *      - zipCodeAsString is null
24:      *      - zipCodeAsString is not a valid zip code (see above)
25:      */
26:      // public static ZipCodeType of( String zipCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\GoodCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the good catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface GoodCatalogUseCases {
15:     /**
16:      * Adds a new good to the shop catalog
17:      * @param goodId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param salesPrice
23:      * @throws ShopException if ...
24:      *      - goodId is null,
25:      *      - the good with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the sales price is null,
30:      *      - the sales price is lower than the purchase price
31:      */
32:     public void addGoodToCatalog( UUID goodId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType salesPrice );
34: 
35: 
36:     /**
37:      * Removes a good from the shop catalog
38:      * @param goodId
39:      * @throws ShopException if
40:      *      - goodId is null,
41:      *      - the good with that id does not exist
42:      *      - the good is still in stock
43:      *      - the good is still reserved in a shopping basket, or part of a completed order
44:      */
45:     public void removeGoodFromCatalog( UUID goodId );
46: 
47: 
48:     /**
49:      * Get the sales price of a given good
50:      * @param goodId
51:      * @return the sales price
52:      * @throws ShopException if ...
53:      *      - goodId is null,
54:      *      - the good with that id does not exist
55:      */
56:     public MoneyType getSalesPrice( UUID goodId );
57: 
58: 
59:     /**
60:      * Clears the good catalog, i.e. removes all goods from the catalog, including all the stock,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteGoodCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a debit card for a given amount
16:      *
17:      * @param customerEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - customerEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType customerEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a customer
31:      * (identified by his/her email)
32:      *
33:      * @param customerEmail
34:      * @return the total amount of payments made using this debit card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - customerEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType customerEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all customers.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingBasketUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping basket.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingBasketUseCases {
15:     /**
16:      * Adds a good to the shopping basket of a customer
17:      *
18:      * @param customerEmail
19:      * @param goodId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the customer with the given email does not exist,
23:      *      - the good does not exist,
24:      *      - the quantity <= 0,
25:      *      - the good is not available in the requested quantity
26:      */
27:     public void addGoodToShoppingBasket( EmailType customerEmail, UUID goodId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a good from the shopping basket of a customer
32:      *
33:      * @param customerEmail
34:      * @param goodId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - customerEmail is null,
38:      *      - the customer with the given email does not exist,
39:      *      - the good does not exist
40:      *      - the quantity <= 0,
41:      *      - the good is not in the shopping basket in the requested quantity
42:      */
43:     public void removeGoodFromShoppingBasket( EmailType customerEmail, UUID goodId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping basket position containing a good
48:      *
49:      * @param customerEmail
50:      * @param goodId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - customerEmail is null,
54:      *      - the customer with the given email does not exist,
55:      *      - the good does not exist
56:      *      - the good is not in the shopping basket
57:      */
58:     public void setCommentForShoppingBasketPosition( EmailType customerEmail, UUID goodId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping basket position containing a good
63:      *
64:      * @param customerEmail
65:      * @param goodId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - customerEmail is null,
69:      *      - the customer with the given email does not exist,
70:      *      - the good does not exist
71:      *      - the good is not in the shopping basket
72:      */
73:     public String getCommentForShoppingBasketPosition( EmailType customerEmail, UUID goodId );
74: 
75: 
76:     /**
77:      * Returns a map showing which goods are in the shopping basket of a customer and how many of each good
78:      *
79:      * @param customerEmail
80:      * @return the shopping basket of the customer (map is empty if the shopping basket is empty)
81:      * @throws ShopException if ...
82:      *      - customerEmail is null,
83:      *      - the customer with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingBasketAsMap( EmailType customerEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all goods in the shopping basket of a customer
90:      *
91:      * @param customerEmail
92:      * @return the value of shopping basket of the customer
93:      * @throws ShopException if ...
94:      *      - customerEmail is null,
95:      *      - the customer with the given email does not exist
96:      */
97:     public MoneyType getShoppingBasketAsMoneyValue( EmailType customerEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific good that are currently reserved in the shopping baskets of all customers
103:      * @param goodId
104:      * @return the number of reserved goods of that type in all shopping baskets
105:      * @throws ShopException
106:      *      - goodId is null
107:      *      - if the good id does not exist
108:      */
109:     public int getReservedStockInShoppingBaskets( UUID goodId );
110: 
111: 
112:     /**
113:      * Checks if the shopping basket of a customer is empty
114:      *
115:      * @param customerEmail
116:      * @return true if the shopping basket is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - customerEmail is null
119:      *    - the customer with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType customerEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping basket of a customer has been authorized to be paid,
126:      * i.e. the shopping basket is not empty, the customer has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the customer's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param customerEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - customerEmail is null
134:      *      - the customer with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType customerEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping basket of a customer
141:      *
142:      * @param customerEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - customerEmail is null
146:      *      - the customer with the given email does not exist
147:      *      - the shopping basket is empty
148:      */
149:     public void checkout( EmailType customerEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which goods have been ordered by a customer, and how many of each good
156:      *
157:      * @param customerEmail
158:      * @return the order history of the customer (map is empty if the customer has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the customer with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType customerEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping baskets in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping baskets), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\usecases\StockManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop stock,
10:  * i.e. adding and removing goods in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface StockManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given good to the stock
16:      * @param goodId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - goodId is null
20:      *      - the good with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToStock( UUID goodId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given good from the stock.
28:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
29:      * (in the customers' shopping baskets) are removed. This means that some of the reserved goods are lost for
30:      * the customer. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
31:      * or some of the goods were stolen from the warehouse, are broken, etc.)
32:      * @param goodId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - goodId is null
36:      *      - the good with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current stock and the currently reserved goods together
39:      */
40:     public void removeFromStock( UUID goodId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given good in the stock.
45:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
46:      * (in the customers' shopping baskets) are removed. This means that some of the reserved goods are lost for
47:      * the customer. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
48:      * or some of the goods were stolen from the warehouse, are broken, etc.)
49:      * @param goodId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - goodId is null
53:      *      - the good with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeStockTo( UUID goodId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total stock of a given good, including the currently reserved goods
61:      * @param goodId
62:      * @return the current total stock of the good
63:      * @throws ShopException if ...
64:      *      - goodId is null
65:      *      - the good with that id does not exist
66:      */
67:     public int getAvailableStock( UUID goodId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Good" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"customer", "shoppingbasket", "good", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "Customer",
21:             "CustomerRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingBasket",
25:             "ShoppingBasketRepository",
26:             "Good",
27:             "GoodRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllGoods();
45:         initialMasterDataCreator.stockUpAllGoods();
46:         initialMasterDataCreator.registerAllCustomers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + CUSTOMER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = CUSTOMER_EMAIL[6].toString();
76: 
77:         UUID goodId2 = (UUID) GOOD_DATA[2][0];
78:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
79:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
80:         Float goodMoneyAmount2 = ((MoneyType) GOOD_DATA[2][5]).getAmount() * 2;
81:         Float goodMoneyAmount4 = ((MoneyType) GOOD_DATA[4][5]).getAmount() * 4;
82:         Float goodMoneyAmount6 = ((MoneyType) GOOD_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForCustomer( emailString, goodId2, 2 );
89:         restHelper.makeOrderForCustomer( emailString, goodId4, 4 );
90:         restHelper.makeOrderForCustomer( emailString, goodId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( goodMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( goodMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = CUSTOMER_EMAIL[3].toString();
118:         UUID goodId3 = (UUID) GOOD_DATA[3][0];
119:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float goodMoneyAmount =
123:                 ((MoneyType) GOOD_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) GOOD_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingBasketId = restHelper.getShoppingBasketId( emailString );
128:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId3, quantity3 );
129:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingBasketRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingBasketRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllGoods();
47:         initialMasterDataCreator.stockUpAllGoods();
48:         initialMasterDataCreator.registerAllCustomers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingBasket() throws Exception {
57:         // given
58:         String validUri = "/shoppingBaskets?email=" + CUSTOMER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingBaskets?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingBaskets?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID goodId = (UUID) GOOD_DATA[3][0];
78:         String customerEmailString = CUSTOMER_EMAIL[4].toString();
79:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
80: 
81:         String invalidPostUri = "/shoppingBaskets/" + UUID.randomUUID() + "/shoppingBasketPositions";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingBaskets/" + UUID.randomUUID().toString() + "/shoppingBasketPositions/" + goodId;
86:         String invalidCheckoutUri1 = "/shoppingBaskets/" + shoppingBasketId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingBaskets/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingGood() throws Exception {
107:         // given
108:         UUID goodId = (UUID) GOOD_DATA[3][0];
109:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
110:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
111:         String invalidUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + goodId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingBasket() throws Exception {
121:         // given
122:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
123:         String customerEmailString9 = CUSTOMER_EMAIL[9].toString();
124:         String customerEmailString7 = CUSTOMER_EMAIL[7].toString();
125: 
126:         UUID shoppingBasketId9 = restHelper.getShoppingBasketId( customerEmailString9 );
127:         UUID shoppingBasketId7 = restHelper.getShoppingBasketId( customerEmailString7 );
128: 
129:         String baseUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/shoppingBasketPositions/";
130:         String checkoutUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingBaskets/" + shoppingBasketId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingBasketPositions(
137:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + goodId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingBasketPositions(
142:                 customerEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" good
145:         restHelper.addGoodToShoppingBasket( shoppingBasketId7, goodId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPositionsInLatestOrder( customerEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPositionsInLatestOrder( customerEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingBasket() throws Exception {
160:         // given
161:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
162:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
163:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingBasketPositions(
170:                 customerEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPositionsInLatestOrder( customerEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingBasket() throws Exception {
182:         // given
183:         String customerEmailString = CUSTOMER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInStock() throws Exception {
195:         // given
196:         String customerEmailString = CUSTOMER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String customerEmailString = CUSTOMER_EMAIL[5].toString();
210:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
211:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPositionsInLatestOrder( customerEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String customerEmailString = CUSTOMER_EMAIL[1].toString();
229:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
230:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String customerEmailString = CUSTOMER_EMAIL[8].toString();
245:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
246:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleGoodsToShoppingBasket( customerEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingBasket() throws Exception {
259:         // given
260:         String customerEmailString = CUSTOMER_EMAIL[9].toString();
261:         UUID shoppingBasketId = restHelper.getShoppingBasketId( customerEmailString );
262:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForCustomer( String emailString, UUID goodId, Integer quantity ) throws Exception {
36:         UUID shoppingBasketId = getShoppingBasketId( emailString );
37:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity );
38:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingBasketId( String emailString ) throws Exception {
43:         // get the shopping basket and extract its id ...
44:         MvcResult shoppingBasket = mockMvc.perform( get( "/shoppingBaskets?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingBasket.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( goodId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity )
67:             throws Exception {
68:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleGoodsToShoppingBasket(
74:             String customerEmailString, Integer[] goodIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingBasketId = getShoppingBasketId( customerEmailString );
77:         String shoppingBasketUri = "shoppingBaskets?email=" + customerEmailString;
78:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
79: 
80:         // add all the goods to the shopping basket ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < goodIndices.length; i++ ) {
84:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
85:             addGoodToShoppingBasket( shoppingBasketId, goodId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( goodIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( goodIndices[i], 0 ) );
89:                 commentMap.put( goodIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleGoodsToShoppingBasket(
96:             String customerEmailString, Integer[] goodIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[goodIndices.length];
99:         for ( int i = 0; i < goodIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleGoodsToShoppingBasket( customerEmailString, goodIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingBasketPositions( String customerEmailString,
108:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingBasketId = getShoppingBasketId( customerEmailString );
111:         String shoppingBasketUri = "/shoppingBaskets?email=" + customerEmailString;
112:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
113: 
114:         // check that the shopping basket contains all the goods ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < goodIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingBasketUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each good has the correct quantity and comment ...
126:         for ( int i = 0; i < goodIndices.length; i++ ) {
127:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + goodId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + goodId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingBasketPositions( String customerEmailString,
142:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[goodIndices.length];
145:         for ( int i = 0; i < goodIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingBasketPositions( customerEmailString, goodIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPositionsInLatestOrder(
155:             String customerEmailString, Integer[] goodIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + customerEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < goodIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) GOOD_DATA[goodIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( customerEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < goodIndices.length; i++ ) {
173:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderPositions.length()" ).value( goodIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID goodId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID goodId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID goodId, Integer quantity, String comment ) {
24:         this.goodId = goodId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.AddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         ZipCodeType plz = instantiateZipCode( "12345" );
19: 
20:         // when
21:         AddressType instance = instantiateAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getZipCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         ZipCodeType plz = instantiateZipCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiateAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         ZipCodeType plz = instantiateZipCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiateAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiateAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiateAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiateAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiateAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         ZipCodeType plz = instantiateZipCode( "12345" );
63: 
64:         // when
65:         AddressType instance1 = instantiateAddress( street, city, plz );
66:         AddressType instance2 = instantiateAddress( street, city, plz );
67:         AddressType instance3 = instantiateAddress( "Anderestr. 12", city, plz );
68:         AddressType instance4 = instantiateAddress( street, "AndereStadt", plz );
69:         AddressType instance5 = instantiateAddress( street, city, instantiateZipCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         ZipCodeType plz = instantiateZipCode( "12345" );
84: 
85:         // when
86:         AddressType instance = instantiateAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setZipCode", ZipCodeType.class );
104:             fail( "setZipCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionZipCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionZipCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         ZipCodeType instance = instantiateZipCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateZipCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiateZipCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiateZipCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiateZipCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiateZipCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         ZipCodeType instance1 = instantiateZipCode( "12345" );
48:         ZipCodeType instance2 = instantiateZipCode( "12345" );
49:         ZipCodeType instance3 = instantiateZipCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         ZipCodeType instance = instantiateZipCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setzipCode", String.class );
65:             fail( "setzipCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionCustomerRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.CustomerRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.CustomerType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CUSTOMER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionCustomerRegistrationTest {
25: 
26:     @Autowired
27:     private CustomerRegistrationUseCases customerRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllCustomersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllCustomers();
44: 
45:         // when
46:         CustomerType customer3 = customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.CUSTOMER_NAME[3], customer3.getName() );
50:         Assertions.assertEquals( CUSTOMER_EMAIL[3], customer3.getEmail() );
51:         Assertions.assertEquals( CUSTOMER_ADDRESS[3], customer3.getAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterCustomerWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllCustomers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 customerRegistrationUseCases.register( "Gandalf The Grey", CUSTOMER_EMAIL[5],
64:                         CUSTOMER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterCustomerWithDuplicateNameOrAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllCustomers();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 customerRegistrationUseCases.register( initialMasterDataCreator.CUSTOMER_NAME[2], newEmail,
77:                         CUSTOMER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteCustomersNoMoreCustomers() {
83:         // given
84:         initialMasterDataCreator.registerAllCustomers();
85: 
86:         // when
87:         customerRegistrationUseCases.deleteAllCustomers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> customerRegistrationUseCases.getCustomerData( CUSTOMER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionGoodCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionGoodCatalogTest {
22: 
23:     @Autowired
24:     private GoodCatalogUseCases goodCatalogUseCases;
25:     @Autowired
26:     private StockManagementUseCases stockManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddGoodToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllGoods();
41: 
42:         // when
43:         MoneyType salesPrice = goodCatalogUseCases.getSalesPrice( (UUID) GOOD_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( GOOD_DATA[4][5], salesPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveGoodFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllGoods();
53:         UUID goodId = (UUID) GOOD_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> goodCatalogUseCases.getSalesPrice( goodId ) );
57:         goodCatalogUseCases.removeGoodFromCatalog( goodId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSalesPrice( goodId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveGoodThatIsInStock() {
68:         // given
69:         initialMasterDataCreator.addAllGoods();
70:         UUID goodId = (UUID) GOOD_DATA[4][0];
71:         stockManagementUseCases.addToStock( goodId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> goodCatalogUseCases.removeGoodFromCatalog( goodId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearGoodCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllGoods();
83: 
84:         // when
85:         goodCatalogUseCases.deleteGoodCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSalesPrice( (UUID) GOOD_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionStockManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_STOCK;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionStockManagementTest {
20: 
21:     @Autowired
22:     private StockManagementUseCases stockManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllGoods();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToStock() {
37:         // given
38:         initialMasterDataCreator.stockUpAllGoods();
39:         UUID goodId8 = (UUID) GOOD_DATA[8][0];
40: 
41:         // when
42:         int stock8before = stockManagementUseCases.getAvailableStock( goodId8 );
43:         assertEquals( GOOD_STOCK.get( goodId8 ), stock8before );
44:         stockManagementUseCases.addToStock( goodId8, 22 );
45:         int stock8after = stockManagementUseCases.getAvailableStock( goodId8 );
46:         stockManagementUseCases.addToStock( goodId8, 1 );
47:         int stock8after2 = stockManagementUseCases.getAvailableStock( goodId8 );
48: 
49:         // then
50:         assertEquals( stock8before + 22, stock8after );
51:         assertEquals( stock8after + 1, stock8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromStock() {
57:         // given
58:         initialMasterDataCreator.stockUpAllGoods();
59:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
60:         int stock6before = GOOD_STOCK.get( goodId6 );
61:         UUID goodId9 = (UUID) GOOD_DATA[9][0];
62:         int stock9before = GOOD_STOCK.get( goodId9 );
63:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
64:         int stock1before = GOOD_STOCK.get( goodId1 );
65: 
66:         // when
67:         stockManagementUseCases.removeFromStock( goodId6, 1 );
68:         int stock6after = stockManagementUseCases.getAvailableStock( goodId6 );
69:         stockManagementUseCases.removeFromStock( goodId1, 3 );
70:         int stock1after = stockManagementUseCases.getAvailableStock( goodId1 );
71:         stockManagementUseCases.removeFromStock( goodId9, stock9before );
72:         int stock9after = stockManagementUseCases.getAvailableStock( goodId9 );
73: 
74:         // then
75:         assertEquals( stock6before - 1, stock6after );
76:         assertEquals( stock1before - 3, stock1after );
77:         assertEquals( 0, stock9after );
78:     }
79: 
80: }
81: 

[RESPONSE]:
# Code Review Ergebnisse

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java

[ShoppingBasketService] [Zeilen 54-55, 83-84]: **Duplication** (Original: Zeilen 54-55): Customer-Lookup und Null-Check werden mehrfach identisch durchgeführt.

[ShoppingBasketService] [Zeilen 112-113, 124-125, 155-156, 165-166, 177-178, 278-279, 295-296]: **Duplication** (Original: Zeilen 54-55): Customer-Lookup mit `findCustomerByEmail` und anschließende Null-Prüfung wiederholt sich vielfach.

[ShoppingBasketService] [Zeile 159]: **Negative Conditional**: `reservedGoods.size()==0` sollte besser als `reservedGoods.isEmpty()` formuliert werden.

[ShoppingBasketService] [Zeile 179]: **Duplication** (Original: Zeile 159): Erneute Prüfung `reservedGoods.size() == 0` anstatt `isEmpty()`.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java

[PaymentService] [Zeilen 36-38, 54-56]: **Duplication** (Original: Zeilen 36-38): Email-Null-Check und Customer-Lookup wiederholen sich.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java

[DeliveryService] [Zeilen 72-74]: **Duplication** (Original: PaymentService Zeilen 36-38): Email-Null-Check und Customer-Lookup identisch.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\StockManagementService.java

[StockManagementService] [Zeilen 27-29, 38-40, 55-57, 67-69]: **Duplication** (Original: Zeilen 27-29): GoodId-Null-Check und Good-Lookup wiederholen sich in jeder Methode identisch.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodCatalogService.java

[GoodCatalogService] [Zeilen 47-48, 59-60]: **Duplication** (Original: StockManagementService Zeilen 27-29): Good-Lookup mit Null-Check wiederholt sich.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java

[OrderService] [Zeilen 35-36]: **Duplication** (Original: ShoppingBasketService Zeilen 54-55): Customer-Lookup und Null-Check identisch.

[OrderService] [Zeile 18]: **Layer Violation**: Import von `thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ReservedGood` - OrderService greift auf Domain-Klasse eines anderen Packages zu (wird importiert aber nicht verwendet).

[OrderService] [Zeile 18]: **Dead Code**: Import von `ReservedGood` wird nicht genutzt.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java

- **Anemic Entity**: Die Klasse besitzt nur Getter via Lombok und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryPosition.java

- **Anemic Entity**: Nur Getter vorhanden, keine Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java

- **Anemic Entity**: Nur Getter, keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java

- **Anemic Entity**: Nur Getter via Lombok, keine Domänenlogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java

- **Anemic Entity**: Nur Getter und einfacher Setter für State, keine echte Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketRESTController.java

[ShoppingBasketRESTController] [Zeile 13]: **Layer Violation**: Import von `ReservedGoodRepository` aus Domain-Schicht eines anderen Packages in den Controller.

[ShoppingBasketRESTController] [Zeile 30]: **Shared Persistency**: `ReservedGoodRepository` wird direkt im Controller injiziert - Repository-Zugriff sollte über den Service erfolgen.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\core\FunctionHelper.java

[FunctionHelper] [Zeile 13-16]: **Dead Code**: Methode `isLessOrEqualsZero` wird nirgends aufgerufen.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\solution\core\ShoppingBasketState.java

[ShoppingBasketState] [Zeile 7]: **Dead Code**: Enum-Wert `DELIVERY_TRIGGERED` wird nur in `DeliveryService` gesetzt, aber nirgendwo abgefragt.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_4bafcc44-c6a8-4a5d-b1c0-6429aa72b5b3\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java

[Money] [Zeilen 46-47, 53-54, 68-69]: **Duplication** (Original: Zeilen 46-47): Null-Check und Currency-Check für `otherMoney` wiederholt sich in `add`, `subtract` und `largerThan`.

ENDE
Generated by claude-opus-4-5-20251101
-----------------------------------