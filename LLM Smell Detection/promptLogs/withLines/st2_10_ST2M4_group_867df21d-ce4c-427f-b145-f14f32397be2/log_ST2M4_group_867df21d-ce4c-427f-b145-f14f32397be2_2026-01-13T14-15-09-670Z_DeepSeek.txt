--- DATE: 13.1.2026, 15:15:09 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        4. Gruppiere nach Datei (mit Pfad). 
        2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
        3. Keine Code-Wiederholung, nur Referenzen.
        5. Wenn fertig, schreibe "ENDE". 
        6. Nutze die Zeilenangaben die mitgeschickt worden sind.



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.*;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: 
8: import javax.persistence.*;
9: 
10: @Embeddable
11: @Getter
12: @Setter(AccessLevel.PROTECTED)
13: @EqualsAndHashCode
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class Address implements PersonalAddressType {
17: 
18:     private String street;
19:     private String city;
20: 
21:     @Embedded
22:     private ZipCode zipCode;
23: 
24:     public static Address of(String street, String city, ZipCodeType zipCode){
25:         if( street == null || city == null || zipCode == null ){
26:             throw new ShopException("street, city or zipcode is null");
27:         }
28:         if ( street.isEmpty() || city.isEmpty() ){
29:             throw new ShopException("street or city is empty");
30:         }
31:         return new Address(street, city, (ZipCode) zipCode);
32:     }
33: 
34: }
35: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import org.hibernate.validator.internal.constraintvalidators.bv.EmailValidator;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: 
11: import javax.persistence.Embeddable;
12: import javax.validation.constraints.NotNull;
13: 
14: @Embeddable
15: @AllArgsConstructor
16: @Getter
17: @NoArgsConstructor
18: @EqualsAndHashCode
19: public class Email implements EmailType {
20:     /**
21:      * @return the email as a string
22:      */
23:     private String emailString;
24: 
25:     public static Email of(String email){
26:         if ( email == null ){
27:             throw new ShopException("email is null");
28:         }
29:         final String emailRegex = "^[A-Za-z0-9]+([.-]?[A-Za-z0-9]+)*@[A-Za-z0-9]+([.-]?[A-Za-z0-9]+)*\\.(de|at|ch|com|org)$";
30:                         if ( !email.matches(emailRegex)){
31:             throw new ShopException("invalid format");
32:         }
33: 
34:         return new Email(email);
35:     }
36: 
37:     @Override
38:     public String toString() {
39:         return this.emailString;
40:     }
41: }
42: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.*;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
7: 
8: import javax.persistence.*;
9: 
10: @Getter
11: @Setter (AccessLevel.PROTECTED)
12: @EqualsAndHashCode
13: @Embeddable
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class Money implements MoneyType {
17:     /**
18:      * @return the amount of money
19:      */
20: 
21:     private Float amount;
22:     private String currency;
23: 
24:     //@Embedded
25:     //@AttributeOverrides({
26:     //        @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
27:     //        @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
28:     //})
29: 
30:     public static Money of(Float amount, String currency){
31:         if ( amount == null ){
32:             throw new ShopException("amount is null");
33:         }
34:         if ( currency == null ){
35:             throw new ShopException("currency is null");
36:         }
37:         if ( amount < 0){
38:             throw new ShopException("amount is too low");
39:         }
40:         if ( !currency.equals("EUR") && !currency.equals("CHF") ){
41:             throw new ShopException("currency is not EUR or CHF");
42:         }
43: 
44:         return new Money(amount, currency);
45:     }
46: 
47:     /**
48:      * @param otherMoney
49:      * @return this + otherMoney, as a new object
50:      * @throws ShopException if ...
51:      *                       - otherMoney is null
52:      *                       - otherMoney.currency != this.currency
53:      */
54:     @Override
55:     public MoneyType add(MoneyType otherMoney) {
56:         if ( otherMoney == null || otherMoney.getCurrency() != this.currency ){
57:             throw new ShopException("otherMoney is null or is unequal to currency");
58:         }
59:         Float add = otherMoney.getAmount() + this.amount;
60:         return new Money(add,this.currency);
61:     }
62: 
63:     /**
64:      * @param otherMoney
65:      * @return this - otherMoney, as a new object
66:      * @throws ShopException if ...
67:      *                       - otherMoney is null
68:      *                       - otherMoney.currency != this.currency
69:      *                       - otherMoney > this
70:      */
71:     @Override
72:     public MoneyType subtract(MoneyType otherMoney) {
73:         if ( otherMoney == null || otherMoney.getCurrency() != this.currency || otherMoney.getAmount() > this.amount){
74:             throw new ShopException("Money is null or unequal currency or given money is more");
75:         }
76:         Float substract = amount - otherMoney.getAmount();
77:         return new Money(substract,currency);
78:     }
79: 
80:     /**
81:      * @param factor
82:      * @return this * factor, as a new object
83:      * @throws ShopException if ...
84:      *                       - factor < 0
85:      */
86:     @Override
87:     public MoneyType multiplyBy(int factor) {
88:         if ( factor < 0 ){
89:             throw new ShopException("factor is larger than 0");
90:         }
91: 
92:         return new Money(this.amount * factor, this.currency);
93:     }
94: 
95:     /**
96:      * @param otherMoney
97:      * @return true, if this > otherMoney
98:      * @throws ShopException if ...
99:      *                       - otherMoney is null
100:      *                       - otherMoney.currency != this.currency
101:      */
102:     @Override
103:     public boolean largerThan(MoneyType otherMoney) {
104: 
105:         if ( otherMoney == null ){
106:             throw new ShopException("other money is null");
107:         }
108: 
109:         if ( otherMoney.getCurrency() != this.currency ){
110:             throw new ShopException("currency is unequal");
111:         }
112: 
113:         return this.amount > otherMoney.getAmount();
114:     }
115: }
116: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.EqualsAndHashCode;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
9: 
10: import javax.persistence.Embeddable;
11: 
12: @Embeddable
13: @Getter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: @EqualsAndHashCode
17: public class ZipCode implements ZipCodeType {
18: 
19:     // public static ZipCodeType of( String zipCodeAsString );
20: 
21:     private String zipCode;
22: 
23:     public static ZipCode of(String zipCode){
24:         if ( zipCode == null ){
25:             throw new ShopException("zipcode is null");
26:         }
27:         if ( !zipCode.matches("\\d{5}$") || zipCode.endsWith("0000")){
28:             throw new ShopException("zipcode is invalid");
29:         }
30:         return new ZipCode(zipCode);
31:     }
32: 
33:     @Override
34:     public String toString(){
35:         return this.zipCode;
36:     }
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static PersonalAddressType instantiatePersonalAddress(
52:             String street, String city, ZipCodeType zipCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, ZipCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for PersonalAddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, zipCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + zipCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (PersonalAddressType) instance;
79:     }
80: 
81: 
82:     public static ZipCodeType instantiateZipCode( String zipCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for ZipCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, zipCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + zipCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (ZipCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * users and goods. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] USER_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] USER_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static PersonalAddressType[] USER_ADDRESS = new PersonalAddressType[] {
53:             FactoryMethodInvoker.instantiatePersonalAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiateZipCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiatePersonalAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiateZipCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiatePersonalAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiateZipCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiatePersonalAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiateZipCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiatePersonalAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiateZipCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiatePersonalAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiateZipCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiatePersonalAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiateZipCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiatePersonalAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiateZipCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiatePersonalAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiateZipCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiatePersonalAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiateZipCode( "45127" ) )
83:     };
84: 
85:     public final static UserType[] mockUsers;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] GOOD_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private UserRegistrationUseCases userRegistrationUseCases;
135:     private GoodCatalogUseCases goodCatalogUseCases;
136:     private InventoryManagementUseCases inventoryManagementUseCases;
137:     private ShoppingBasketUseCases shoppingBasketUseCases;
138: 
139: 
140:     // good 0 is out of inventory, good 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random inventory between 5 and 100
142:     public static final Map<UUID, Integer> GOOD_INVENTORY = new HashMap<>();
143: 
144:     static {
145:         mockUsers = new UserType[USER_NAME.length];
146:         for ( int i = 0; i < USER_NAME.length; i++ ) {
147:             mockUsers[i] = new MockUser(
148:                     USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] goodData : GOOD_DATA ) {
152:             GOOD_INVENTORY.put( (UUID) goodData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         GOOD_INVENTORY.put( (UUID) GOOD_DATA[0][0], 0 );
155:         GOOD_INVENTORY.put( (UUID) GOOD_DATA[1][0], 10 );
156:         GOOD_INVENTORY.put( (UUID) GOOD_DATA[2][0], 20 );
157:         GOOD_INVENTORY.put( (UUID) GOOD_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             UserRegistrationUseCases userRegistrationUseCases,
181:             GoodCatalogUseCases goodCatalogUseCases,
182:             InventoryManagementUseCases inventoryManagementUseCases,
183:             ShoppingBasketUseCases shoppingBasketUseCases ) {
184:         this.userRegistrationUseCases = userRegistrationUseCases;
185:         this.goodCatalogUseCases = goodCatalogUseCases;
186:         this.inventoryManagementUseCases = inventoryManagementUseCases;
187:         this.shoppingBasketUseCases = shoppingBasketUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingBasketUseCases.deleteAllOrders();
193:         goodCatalogUseCases.deleteGoodCatalog();
194:         userRegistrationUseCases.deleteAllUsers();
195:     }
196: 
197: 
198:     public void registerAllUsers() {
199:         for ( int i = 0; i < InitialMasterDataCreator.USER_NAME.length; i++ ) {
200:             registerUser( InitialMasterDataCreator.USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerUser( String name, EmailType email, PersonalAddressType personalAddress ) {
206:         userRegistrationUseCases.register( name, email, personalAddress );
207:     }
208: 
209:     public void addAllGoods() {
210:         for ( Object[] goodData : GOOD_DATA ) {
211:             addGoodDataToCatalog( goodData );
212:         }
213:     }
214: 
215:     public void addGoodDataToCatalog( Object[] goodData ) {
216:         goodCatalogUseCases.addGoodToCatalog( (UUID) goodData[0], (String) goodData[1], (String) goodData[2],
217:                 (Float) goodData[3], (MoneyType) goodData[4], (MoneyType) goodData[5] );
218:     }
219: 
220: 
221:     public Object[] getGoodDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] goodData = GOOD_DATA[1];
223:         Object[] goodDataInvalid = new Object[goodData.length];
224:         System.arraycopy( goodData, 0, goodDataInvalid, 0, goodData.length );
225:         goodDataInvalid[index] = goodData[index].getClass().cast(
226:                 reason.getInvalidValue( goodData[index] ) );
227:         return goodDataInvalid;
228:     }
229: 
230: 
231:     public void inventoryUpAllGoods() {
232:         for ( Object[] goodData : GOOD_DATA ) {
233:             if ( GOOD_INVENTORY.get( goodData[0] ) > 0 )
234:                 inventoryManagementUseCases.addToInventory( (UUID) goodData[0], GOOD_INVENTORY.get( goodData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockUser.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.UserType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockUser implements UserType {
12:     private String name;
13:     private EmailType email;
14:     private PersonalAddressType personalAddress;
15: 
16: 
17:     public MockUser( String name, EmailType email, PersonalAddressType personalAddress) {
18:         this.name = name;
19:         this.email = email;
20:         this.personalAddress = personalAddress;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public PersonalAddressType getPersonalAddress() {
35:         return personalAddress;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockUser ) ) return false;
42:         MockUser that = (MockUser) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( personalAddress, that.personalAddress );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, personalAddress );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllUsers();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
8: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
9: import thkoeln.archilab.ecommerce.solution.user.domain.User;
10: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
11: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
12: import thkoeln.archilab.ecommerce.usecases.UserType;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: 
15: import java.util.HashMap;
16: import java.util.List;
17: import java.util.Map;
18: import java.util.UUID;
19: 
20: @Service
21: public class DeliveryService implements DeliveryUseCases {
22: 
23:     @Autowired
24:     DeliveryRepository deliveryRepository;
25:     @Autowired
26:     UserRepository userRepository;
27: 
28: 
29:     @Override
30:     public UUID triggerDelivery(UserType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
31:         if ( deliveryRecipient == null ){
32:             throw new ShopException("deliveryRecipient is null");
33:         }
34: 
35:         UserType user = deliveryRecipient;
36: 
37:         if ( user.getPersonalAddress().getCity() == null || user.getPersonalAddress().getCity().isEmpty()
38:                 || user.getPersonalAddress().getStreet() == null || user.getPersonalAddress().getStreet().isEmpty()
39:                 || user.getPersonalAddress().getZipCode() == null || user.getPersonalAddress().getZipCode().toString().isEmpty()
40:                 || user.getEmail() == null || user.getEmail().toString().isEmpty()
41:                 || user.getName() == null || user.getName().isEmpty() ){
42:             throw new ShopException("deliveryRecipient Methods null or empty");
43:         }
44: 
45:         if ( deliveryContent == null || deliveryContent.isEmpty() ){
46:             throw new ShopException("deliveryContent is null or empty");
47:         }
48: 
49:         int counter = 0;
50:         for ( Map.Entry<UUID, Integer> entry : deliveryContent.entrySet() ){
51:             counter= entry.getValue() + counter;
52:         }
53:         if ( counter > 20 ){
54:             throw new ShopException("total number of goods is over 20");
55:         }
56: 
57:         Delivery delivery = new Delivery();
58:         Email email = (Email)user.getEmail();
59:         User userUpdate = userRepository.findByEmail(email);
60: 
61:         delivery.setUser(userUpdate);
62:         delivery.setDeliveryMap(deliveryContent);
63:         deliveryRepository.save(delivery);
64:         return delivery.getUuid();
65:     }
66: 
67: 
68:     //NEW
69:     @Override
70:     public Map<UUID, Integer> getDeliveryHistory(EmailType userEmail) {
71:         User user = userRepository.findByEmail(userEmail);
72:         if ( userEmail == null || userEmail.toString().isEmpty() ){
73:             throw new ShopException("userEmail is null or empty");
74:         }
75: 
76:         if ( user == null ){
77:             throw new ShopException("user does not exist");
78:         }
79: 
80:         Map<UUID, Integer> deliveryHistory = new HashMap<>();
81:         List<Delivery> deliveryList = deliveryRepository.findByUser(user);
82: 
83:         for ( Delivery deliveryIterator : deliveryList ){
84:             Map<UUID, Integer> deliveryMap = deliveryIterator.getDeliveryMap();
85:             for ( UUID goodId : deliveryMap.keySet()){
86:                 Integer quantity = deliveryMap.get(goodId);
87:                 if ( deliveryHistory.containsKey(goodId) ){
88:                     deliveryHistory.put(goodId, deliveryHistory.get(goodId)+deliveryIterator.getDeliveryMap().get(goodId));
89:                 } else {
90:                     deliveryHistory.put(goodId, deliveryIterator.getDeliveryMap().get(goodId));
91:                 }
92:             }
93:         }
94: 
95:         return deliveryHistory;
96:     }
97: 
98:     /**
99:      * Deletes all delivery history.
100:      */
101:     @Override
102:     public void deleteDeliveryHistory() {
103:         deliveryRepository.deleteAll();
104:     }
105: }
106: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.user.domain.User;
8: 
9: import javax.persistence.*;
10: import java.util.HashMap;
11: import java.util.Map;
12: import java.util.UUID;
13: 
14: @Getter
15: @Entity
16: @NoArgsConstructor
17: @AllArgsConstructor
18: public class Delivery {
19: 
20:     @Id
21:     @GeneratedValue(strategy = GenerationType.AUTO)
22:     private UUID uuid;
23: 
24:     @Setter
25:     @ElementCollection
26:     private Map<UUID, Integer> deliveryMap = new HashMap<>();
27: 
28:     @Setter
29:     @ManyToOne
30:     private User user;
31: 
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.user.domain.User;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
10:     public List<Delivery> findByUser(User user);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.good.GoodInterfaceShoppingBasket;
8: import thkoeln.archilab.ecommerce.solution.good.GoodOrderPositionInterface;
9: import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
10: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
11: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
12: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
13: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
14: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
16: 
17: import java.util.Optional;
18: import java.util.UUID;
19: import java.util.stream.StreamSupport;
20: 
21: @Service
22: public class GoodService implements GoodCatalogUseCases, InventoryManagementUseCases {
23:     @Autowired
24:     GoodRepository goodRepository;
25:     @Autowired
26:     UserRepository userRepository;
27:     @Autowired
28:     GoodOrderPositionInterface goodOrderPositionInterface;
29:     @Autowired
30:     GoodInterfaceShoppingBasket goodInterface;
31: 
32: 
33:     /**
34:      * Adds a new good to the shop catalog
35:      *
36:      * @param goodId
37:      * @param name
38:      * @param description
39:      * @param size
40:      * @param purchasePrice
41:      * @param sellingPrice
42:      * @throws ShopException if ...
43:      *                       - goodId is null,
44:      *                       - the good with that id already exists,
45:      *                       - name or description are null or empty,
46:      *                       - the size is <= 0 (but can be null!),
47:      *                       - the purchase price is null,
48:      *                       - the selling price is null,
49:      *                       - the selling price is lower than the purchase price
50:      */
51:     @Override
52:     public void addGoodToCatalog(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellingPrice) {
53:         if (goodId == null) {
54:             throw new ShopException("goodId is null");
55:         }
56:         if (goodRepository.findByUuid(goodId) != null) {
57:             throw new ShopException("good already exists");
58:         }
59:         if (name == null || name.isEmpty() || description == null || description.isEmpty()) {
60:             throw new ShopException("Description/Name must be filled");
61:         }
62:         if (size != null && size <= 0) {
63:             throw new ShopException("size is too small");
64:         }
65:         if (purchasePrice == null || purchasePrice.getAmount() <= 0) {
66:             throw new ShopException("purchase price incorrect");
67:         }
68:         if (sellingPrice == null || sellingPrice.getAmount() < 0) {
69:             throw new ShopException("selling price incorrect");
70:         }
71:         if (sellingPrice.getAmount() < purchasePrice.getAmount()) {
72:             throw new ShopException("selling price is lower than purchase price");
73:         }
74: 
75:         Good good = new Good(goodId, name, description, size, (Money) purchasePrice, (Money) sellingPrice);
76:         goodRepository.save(good);
77:     }
78: 
79:     @Override
80:     public void removeGoodFromCatalog(UUID goodId) {
81:         /**
82:          * Removes a good from the shop catalog
83:          * @param goodId
84:          * @throws ShopException if
85:          *      - the good id does not exist
86:          *      - the good is still in inventory
87:          *      - the good is still reserved in a shopping basket, or part of a completed order
88:          */
89:         Good good = goodRepository.findByUuid(goodId);
90:         if (good == null) {
91:             throw new ShopException("Good not found");
92:         }
93:         if (good.getQuantity() > 0) {
94:             throw new ShopException("Product is in inventory");
95:         }
96:         if (goodInterface.getReservedInventoryInShoppingBaskets(goodId) > 0) {
97:             throw new ShopException("removed Quantity is too high");
98:         }
99:         if (goodOrderPositionInterface.findByGood(good) != null) {
100:             throw new ShopException("good is already in order");
101:         }
102:         goodRepository.delete(good);
103: 
104:     }
105: 
106:     /**
107:      * Get the selling price of a given good
108:      *
109:      * @param goodId
110:      * @return the selling price
111:      * @throws ShopException if ...
112:      *                       - goodId is null,
113:      *                       - the good with that id does not exist
114:      */
115:     @Override
116:     public MoneyType getSellingPrice(UUID goodId) {
117:         ///**
118:         // * Get the selling price of a given good
119:         // * @param goodId
120:         // * @return the selling price
121:         // * @throws ShopException if the good id does not exist
122:         // */
123:         if (goodRepository.findByUuid(goodId) == null) {
124:             throw new ShopException("Good doe not exist");
125:         }
126:         return goodRepository.findByUuid(goodId).getSellingPrice();
127:     }
128: 
129:     @Override
130:     public void deleteGoodCatalog() {
131:         /**
132:          * Clears the good catalog, i.e. removes all goods from the catalog, including all the inventory,
133:          * all the reservations and all the orders.
134:          */
135:         goodRepository.deleteAll();
136:     }
137: 
138:     @Override
139:     public void addToInventory(UUID goodId, int addedQuantity) {
140:         /**
141:          * Adds a certain quantity of a given good to the inventory
142:          * @param goodId
143:          * @param addedQuantity
144:          * @throws ShopException if the good id does not exist, or if the added quantity is negative
145:          */
146:         Good good = goodRepository.findByUuid(goodId);
147:         if (good == null) {
148:             throw new ShopException("good does not exist");
149:         }
150:         if (addedQuantity <= 0) {
151:             throw new ShopException("good quantity is negative");
152:         }
153:         int oldQuantity = good.getQuantity();
154:         int newQuantity = oldQuantity + addedQuantity;
155:         if (newQuantity < oldQuantity) {
156:             throw new ShopException("too much quantity");
157:         }
158:         good.setQuantity(newQuantity);
159:         goodRepository.save(good);
160:     }
161: 
162:     @Override
163:     public void removeFromInventory(UUID goodId, int removedQuantity) {
164: 
165:         Good good = goodRepository.findByUuid(goodId);
166:         if (good == null) {
167:             throw new ShopException("good id does not exist");
168:         }
169:         if (removedQuantity <= 0) {
170:             throw new ShopException("removedQuantity is too low");
171:         }
172:         if (removedQuantity > (good.getQuantity() + goodInterface.getReservedInventoryInShoppingBaskets(goodId))) {
173:             throw new ShopException("removedQuantity is too high");
174:         }
175: 
176:         Integer gesamt = removedQuantity - good.getQuantity();
177:         good.setQuantity(good.getQuantity() - removedQuantity);
178:         if (good.getQuantity() < 0) {
179:             good.setQuantity(0);
180:             Iterable<ShoppingBasketType> baskets = goodInterface.findAll();
181:             for (ShoppingBasketType basket : baskets) {
182:                 if (basket.getGoods().containsKey(goodId)) {
183:                     while (gesamt > 0 && basket.getGoods().get(goodId) > 0) {
184:                         gesamt -= 1;
185:                         basket.getGoods().put(goodId, basket.getGoods().get(goodId) - 1);
186:                         goodInterface.saveShoppingBasket(basket);
187:                     }
188:                 }
189:             }
190:         }
191:         goodRepository.save(good);
192:     }
193: 
194:     @Override
195:     public void changeInventoryTo(UUID goodId, int newTotalQuantity) {
196:         Good good = Optional.ofNullable(goodRepository.findByUuid(goodId))
197:                 .orElseThrow(() -> new ShopException("good does not exist"));
198: 
199:         if (newTotalQuantity < 0) {
200:             throw new ShopException("newTotalQuantity is negative");
201:         }
202: 
203:         final Integer[] gesamt = {goodInterface.getReservedInventoryInShoppingBaskets(goodId) - newTotalQuantity};
204:         if (gesamt[0] > 0) {
205:             StreamSupport.stream(goodInterface.findAll().spliterator(), false)
206:                     .filter(basket -> basket.getGoods().containsKey(goodId))
207:                     .forEach(basket -> {
208:                         while (gesamt[0] > 0 && basket.getGoods().get(goodId) > 0) {
209:                             gesamt[0]--;
210:                             basket.getGoods().put(goodId, basket.getGoods().get(goodId) - 1);
211:                             goodInterface.saveShoppingBasket(basket);
212:                         }
213:                     });
214:         }
215:         good.setQuantity(newTotalQuantity);
216:         goodRepository.save(good);
217:     }
218: 
219:     @Override
220:     public int getAvailableInventory(UUID goodId) {
221:         /**
222:          * Get the current total inventory of a given good, including the currently reserved goods
223:          * @param goodId
224:          * @throws ShopException if the good id does not exist
225:          */
226:         Good good = goodRepository.findByUuid(goodId);
227:         if (good == null) {
228:             throw new ShopException("good does not exist");
229:         }
230:         return good.getQuantity();
231:     }
232: 
233: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: 
8: import javax.persistence.*;
9: import java.util.UUID;
10: 
11: @Getter
12: @Entity
13: @NoArgsConstructor
14: public class Good {
15: 
16:     @Id
17:     private UUID uuid;
18: 
19:     @Setter
20:     private String name;
21: 
22:     @Setter
23:     private String description;
24: 
25:     @Setter
26:     private Float size;
27: 
28: 
29:     @Setter
30:     @Embedded
31:     @AttributeOverrides({
32:             @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
33:             @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
34:     })
35:     private Money purchasePrice;
36: 
37:     @Setter
38:     @Embedded
39:     @AttributeOverrides({
40:             @AttributeOverride(name="amount", column= @Column(name="sellingAmount")),
41:             @AttributeOverride(name="currency", column= @Column(name="sellingCurrency"))
42:     })
43:     private Money sellingPrice;
44: 
45:     @Setter
46:     private Integer quantity;
47: 
48:     @Setter
49:     String comment;
50: 
51:     public Good ( UUID uuid, String name, String description, Float size, Money purchasePrice, Money
52:             sellingPrice){
53:         this.uuid = uuid;
54:         this.name = name;
55:         this.description = description;
56:         this.size = size;
57:         this.purchasePrice = purchasePrice;
58:         this.sellingPrice = sellingPrice;
59:         quantity = 0;
60:     }
61: 
62: }
63: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\GoodRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.UUID;
6: 
7: public interface GoodRepository extends CrudRepository<Good, UUID> {
8:     Good findByUuid(UUID uuid);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\GoodInterfaceShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.good;
2: 
3: import java.util.List;
4: import java.util.UUID;
5: 
6: public interface GoodInterfaceShoppingBasket {
7:     public int getReservedInventoryInShoppingBaskets(UUID goodId);
8:     public void saveShoppingBasket(ShoppingBasketType shoppingBasket);
9: 
10:     public ShoppingBasketType getShoppingBasket(UUID shoppingBasketId);
11: 
12:     public List<ShoppingBasketType> findAll();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\GoodOrderPositionInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: 
5: public interface GoodOrderPositionInterface {
6:     public OrderPositionType findByGood(Good good);
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\OrderPositionType.java ---
1: package thkoeln.archilab.ecommerce.solution.good;
2: 
3: public interface OrderPositionType {
4: }
5: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\ShoppingBasketType.java ---
1: package thkoeln.archilab.ecommerce.solution.good;
2: 
3: import java.util.Map;
4: import java.util.UUID;
5: 
6: public interface ShoppingBasketType {
7:     public Map<UUID, Integer> getGoods();
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderApplicationService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: 
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.order.domain.*;
9: import thkoeln.archilab.ecommerce.solution.user.domain.User;
10: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
11: 
12: 
13: import java.util.*;
14: import java.util.function.Function;
15: import java.util.function.Supplier;
16: import java.util.stream.Collectors;
17: import java.util.stream.Stream;
18: 
19: 
20: @Service
21: public class OrderApplicationService {
22:     @Autowired
23:     OrderRepository orderRepository;
24:     @Autowired
25:     OrderPositionRepository orderPositionRepository;
26:     @Autowired
27:     OrderService orderService;
28:     @Autowired
29:     UserRepository userRepository;
30: 
31:     public List<OrderDTO> findLatestCustomer(String email) {
32:         if (email == null) {
33:             throw new OrderException("email not found. (findLatestCustomer 1)");
34:         }
35: 
36:         User user = userRepository.findByEmail(Email.of(email));
37:         if (user == null) {
38:             return Collections.emptyList();
39:         }
40: 
41:         return Optional.ofNullable(orderRepository.findByUser(user))
42:                 .map(orders -> orders.get(orders.size() - 1))
43:                 .map(latestOrder -> {
44:                     OrderDTO latestOrderDTO = new OrderDTO();
45:                     latestOrderDTO.setId(latestOrder.getUuid());
46:                     latestOrderDTO.setOrderPositions(
47:                             latestOrder.getOrderPositions().stream()
48:                                     .map(orderPosition -> {
49:                                         OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
50:                                         orderPositionDTO.setGoodId(orderPosition.getGood().getUuid());
51:                                         orderPositionDTO.setQuantity(orderPosition.getQuantity());
52:                                         orderPositionDTO.setComment(orderPosition.getComment());
53:                                         return orderPositionDTO;
54:                                     })
55:                                     .collect(Collectors.toList())
56:                     );
57:                     latestOrderDTO.setEmail(latestOrder.getUser().getEmail());
58:                     latestOrderDTO.setPrice(totalPriceMethod(latestOrder));
59:                     return Collections.singletonList(latestOrderDTO);
60:                 })
61:                 .orElse(Collections.emptyList());
62:     }
63: 
64:     public List<OrderDTO> findAllCustomer(String email) {
65:         if ( email == null ){
66:             return new ArrayList<OrderDTO>();
67:         }
68:         try {
69:             userRepository.findByEmail(Email.of(email));
70:         } catch (Exception e){
71:             return new ArrayList<OrderDTO>();
72:         }
73: 
74:         User user = userRepository.findByEmail(Email.of(email));
75:         if (user == null) {
76:             return new ArrayList<OrderDTO>();
77:         }
78:         List<Order> orders = orderRepository.findByUser(user);
79: 
80:         List<OrderDTO> orderDTOs = new ArrayList<>();
81: 
82:         for (Order order : orders) {
83:             List<OrderPositionDTO> orderPositionDTOs = new ArrayList<>();
84:             for (OrderPosition orderPosition : order.getOrderPositions()) {
85:                 OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
86:                 orderPositionDTO.setGoodId(orderPosition.getGood().getUuid());
87:                 orderPositionDTO.setQuantity(orderPosition.getQuantity());
88:                 orderPositionDTO.setComment(orderPosition.getComment());
89:                 orderPositionDTOs.add(orderPositionDTO);
90:             }
91: 
92:             OrderDTO orderDTO = new OrderDTO();
93:             orderDTO.setId(order.getUuid());
94:             orderDTO.setOrderPositions(orderPositionDTOs);
95:             orderDTO.setEmail(order.getUser().getEmail());
96:             orderDTO.setPrice( (Money) totalPriceMethod2(order));
97: 
98:             orderDTOs.add(orderDTO);
99:         }
100:         return orderDTOs;
101:     }
102: 
103:     public Money totalPriceMethod (Order order){
104:         List<OrderPosition> list = order.getOrderPositions();
105:         Money totalPriceVariable = Money.of(0f, "EUR");
106: 
107:         for (OrderPosition orderPosition : order.getOrderPositions()){
108:             Money sellingPrice = orderPosition.getGood().getSellingPrice();
109:             Integer quantity = orderPosition.getQuantity();
110: 
111:             Money quantityPrice = (Money) sellingPrice.multiplyBy(quantity);
112: 
113:             totalPriceVariable =  (Money) totalPriceVariable.add(quantityPrice);
114:         }
115:         return totalPriceVariable;
116:     }
117: 
118: 
119:     public Money totalPriceMethod2 (Order order){
120:         List<OrderPosition> list = order.getOrderPositions();
121: 
122:         if (list.isEmpty()) {
123:             throw new OrderException("Order has no positions.");
124:         }
125: 
126:         OrderPosition lastOrderPosition = list.get(list.size() - 1);
127:         Money sellingPrice = lastOrderPosition.getGood().getSellingPrice();
128:         Integer quantity = lastOrderPosition.getQuantity();
129: 
130:         Money quantityPrice = (Money) sellingPrice.multiplyBy(quantity);
131: 
132:         return quantityPrice;
133:     }
134: }
135: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.http.HttpStatus;
6: import org.springframework.http.ResponseEntity;
7: import org.springframework.web.bind.annotation.*;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
10: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
11: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPositionRepository;
12: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
13: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketApplicationService;
14: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
16: 
17: import java.util.List;
18: import java.util.UUID;
19: import java.util.stream.Collectors;
20: import java.util.stream.StreamSupport;
21: 
22: @RestController
23: public class OrderController {
24:     @Autowired
25:     OrderApplicationService orderApplicationService;
26:     @Autowired
27:     OrderRepository orderRepository;
28:     @Autowired
29:     OrderPositionRepository orderPositionRepository;
30:     @Autowired
31:     OrderService orderService;
32: 
33:     @Autowired
34:     public OrderController(OrderApplicationService orderApplicationService,
35:                                     OrderRepository orderRepository){
36:         this.orderApplicationService = orderApplicationService;
37:         this.orderRepository = orderRepository;
38:     }
39: 
40:     @GetMapping("/orders")
41:     public List<OrderDTO> getProducts(@RequestParam(required = false) String email,
42:                                       @RequestParam(required = false) String filter){
43:         if ("latest".equals(filter)){
44:             return orderApplicationService.findLatestCustomer(email);
45:         }
46:         else {
47:             return orderApplicationService.findAllCustomer(email);
48:         }
49:     }
50: 
51: }
52: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
10: import thkoeln.archilab.ecommerce.solution.user.domain.User;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.persistence.Entity;
15: import java.util.List;
16: import java.util.UUID;
17: 
18: @AllArgsConstructor
19: @NoArgsConstructor
20: @Getter
21: @Setter
22: public class OrderDTO {
23:     private UUID id;
24:     private List<OrderPositionDTO> orderPositions;
25:     private Email email;
26:     private Money price;
27: 
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderException.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "not found")
8: public class OrderException extends ShopException {
9:     public OrderException(String message){
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: 
9: import java.util.UUID;
10: 
11: @NoArgsConstructor
12: @AllArgsConstructor
13: @Setter
14: @Getter
15: public class OrderPositionDTO {
16:     private UUID goodId;
17:     private Integer quantity;
18:     private String comment = null;
19: 
20: }
21: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.good.GoodOrderPositionInterface;
6: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
7: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
8: import thkoeln.archilab.ecommerce.solution.order.domain.OrderPositionRepository;
9: 
10: @Service
11: public class OrderService implements GoodOrderPositionInterface {
12:     @Autowired
13:     OrderPositionRepository orderPositionRepository;
14: 
15:     @Override
16:     public OrderPosition findByGood(Good good) {
17:         return orderPositionRepository.findByGood(good);
18:     }
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
9: import thkoeln.archilab.ecommerce.solution.user.domain.User;
10: 
11: import javax.persistence.*;
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Getter
16: @Entity
17: @Table( name = "UOrder")
18: @NoArgsConstructor
19: @AllArgsConstructor
20: public class Order {
21:     @Id
22:     @GeneratedValue(strategy = GenerationType.AUTO)
23:     private UUID uuid;
24: 
25:     @Setter
26:     @OneToMany
27:     private List<OrderPosition> orderPositions;
28: 
29:     @Setter
30:     @ManyToOne
31:     private User user;
32: 
33:     @Setter
34:     @OneToOne
35:     private Payment payment;
36: 
37: //    @Setter
38: //    private Money totalPrice;
39: 
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.good.OrderPositionType;
8: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
9: 
10: import javax.persistence.*;
11: import java.util.UUID;
12: 
13: @Getter
14: @Entity
15: @NoArgsConstructor
16: @AllArgsConstructor
17: public class OrderPosition implements OrderPositionType {
18:     @Id
19:     @GeneratedValue(strategy = GenerationType.AUTO)
20:     private UUID uuid;
21: 
22:     @Setter
23:     private Integer quantity;
24: 
25:     @Setter
26:     @ManyToOne
27:     private Good good;
28: 
29:     @Setter
30:     private String comment;
31: }
32: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
5: 
6: import java.util.UUID;
7: 
8: public interface OrderPositionRepository extends CrudRepository<OrderPosition, UUID> {
9:     OrderPosition findByGood(Good good);
10: }
11: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.user.domain.User;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface OrderRepository extends CrudRepository<Order, UUID> {
10:     public List<Order> findByUser(User user);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderStatus.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: public enum OrderStatus {
4:     EMPTY, FILLED, PAYMENT_AUTHORIZED, DELIVERY_TRIGGERED
5: }
6: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
8: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
9: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
11: import thkoeln.archilab.ecommerce.solution.user.domain.User;
12: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
13: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
16: 
17: import java.util.List;
18: import java.util.UUID;
19: 
20: @Service
21: public class PaymentService implements PaymentUseCases {
22:     @Autowired
23:     GoodRepository goodRepository;
24:     @Autowired
25:     UserRepository userRepository;
26: 
27:     @Autowired
28:     DeliveryRepository deliveryRepository;
29: 
30:     @Autowired
31:     PaymentRepository paymentRepository;
32: 
33: 
34:     /**
35:      * Authorizes a payment from a bank card for a given amount
36:      *
37:      * @param userEmail
38:      * @param amount
39:      * @return the id of the payment, if successfully authorized
40:      * @throws ShopException if ...
41:      *                       - userEmail is null
42:      *                       - the amount is null
43:      *                       - the amount is 0.00 EUR
44:      *                       - the payment cannot be processed, because it is over the limit of 500.00 EUR
45:      */
46:     @Override
47:     public UUID authorizePayment(EmailType userEmail, MoneyType amount) {
48:         User user = userRepository.findByEmail(userEmail);
49: 
50:         if ( userEmail == null || userEmail.toString().isEmpty() ){
51:             throw new ShopException("userEmail is empty or null");
52:         }
53: 
54:         if ( user == null ){
55:             throw new ShopException("user does not exist");
56:         }
57: 
58:         if ( amount == null ){
59:             throw new ShopException("amount is null");
60:         }
61: 
62:         if ( amount.getAmount() <= 0.00 ){
63:             throw new ShopException("amount is too low");
64:         }
65: 
66:         Payment payment = new Payment();
67: 
68:         payment.setUser(user);
69:         payment.setAmount(amount.getAmount());
70:         if ( payment.getAmount() > 500.0 ){
71:             throw new ShopException("amount is too low");
72:         }
73:         paymentRepository.save(payment);
74:         return payment.getUuid();
75:     }
76: 
77:     /**
78:      * Returns the total amount of payments (over the complete history) for a user
79:      * (identified by his/her email)
80:      *
81:      * @param userEmail
82:      * @return the total amount of payments made using this bank card, or 0.00 EUR if there
83:      * weren't any payments yet.
84:      * @throws ShopException if ...
85:      *                       - userEmail is null
86:      */
87:     @Override
88:     public MoneyType getPaymentTotal(EmailType userEmail) {
89:         User user = userRepository.findByEmail(userEmail);
90:         if ( userEmail == null || userEmail.toString().isEmpty() ){
91:             throw new ShopException("user mail is null oder empty");
92:         }
93: 
94:         if ( user == null ){
95:             throw new ShopException("user does not exist");
96:         }
97: 
98:         List<Payment> paymentList = paymentRepository.findPaymentsByUser(user);
99:         float counter = 0;
100:         for ( Payment p : paymentList ){
101:             counter += p.getAmount();
102:         }
103:         Money totalMoney = new Money(counter, "EUR");
104:         return totalMoney;
105:     }
106: 
107:     /**
108:      * Deletes all payment history, for all users.
109:      */
110:     @Override
111:     public void deletePaymentHistory() {
112:         paymentRepository.deleteAll();
113:     }
114: 
115: 
116: }
117: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.user.domain.User;
9: 
10: import javax.persistence.*;
11: import java.util.UUID;
12: 
13: @Getter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: @Entity
17: public class Payment {
18:     @Id
19:     @GeneratedValue(strategy = GenerationType.AUTO)
20:     private UUID uuid;
21: 
22:     @Setter
23:     @Embedded
24:     @AttributeOverrides({
25:             @AttributeOverride(name = "amount", column = @Column(name = "paymentAmount")),
26:             @AttributeOverride(name = "currency", column = @Column(name = "paymentCurrency"))
27:     })
28:     private Money paymentMoney;
29: 
30:     @Setter
31:     private Float amount;
32: 
33:     @Setter
34:     @ManyToOne
35:     private User user;
36: 
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.solution.user.domain.User;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
10:     Payment findByUser(User user);
11:     public List<Payment> findPaymentsByUser(User user);
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketApplicationService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.http.HttpStatus;
6: import org.springframework.http.ResponseEntity;
7: import org.springframework.stereotype.Service;
8: import org.springframework.web.bind.annotation.RequestMapping;
9: import org.springframework.web.bind.annotation.ResponseStatus;
10: import thkoeln.archilab.ecommerce.ShopException;
11: import thkoeln.archilab.ecommerce.domainprimitives.Email;
12: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
13: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
14: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
15: import thkoeln.archilab.ecommerce.solution.order.domain.*;
16: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
17: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
18: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPosition;
19: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPositionRepository;
20: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
21: import thkoeln.archilab.ecommerce.solution.user.domain.User;
22: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
23: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
24: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
25: 
26: import javax.validation.constraints.NotNull;
27: import java.util.*;
28: 
29: @Service
30: public class ShoppingBasketApplicationService {
31:     @Autowired
32:     ShoppingBasketRepository shoppingBasketRepository;
33:     @Autowired
34:     ShoppingBasketService shoppingBasketService;
35:     @Autowired
36:     ShoppingBasketPositionRepository shoppingBasketPositionRepository;
37:     @Autowired
38:     PaymentService paymentService;
39:     @Autowired
40:     OrderRepository orderRepository;
41:     @Autowired
42:     GoodRepository goodRepository;
43:     @Autowired
44:     OrderPositionRepository orderPositionRepository;
45:     @Autowired
46:     DeliveryService deliveryService;
47:     @Autowired
48:     UserRepository userRepository;
49: 
50:     private Email email;
51: 
52: 
53:     @ResponseStatus(HttpStatus.NOT_FOUND)
54:     public ShoppingBasketDTO getShoppingBasketAsDTO(String email) {
55:         System.out.println("end");
56:         try {
57:             ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUserEmail(Email.of(email));
58:             if (shoppingBasket == null) {
59:                 throw new ShoppingBasketNOTFOUND("not found (getShoppingBasketAsDTO 1)");
60:             }
61: 
62: 
63:             ModelMapper modelMapper = new ModelMapper();
64:             ShoppingBasketDTO shoppingBasketDTO = modelMapper.map(shoppingBasket, ShoppingBasketDTO.class);
65: 
66: 
67:             shoppingBasketDTO.setGoods(shoppingBasket.getGoods());
68:             shoppingBasketDTO.setId(shoppingBasket.getUuid());
69:             shoppingBasketDTO.setOrderStatus(shoppingBasket.getOrderStatus());
70:             shoppingBasketDTO.setUserId(shoppingBasket.getUser().getUuid());
71: 
72:             int totalQuantity = shoppingBasket.getGoods().values().stream()
73:                     .mapToInt(Integer::intValue)
74:                     .sum();
75:             shoppingBasketDTO.setTotalQuantity(totalQuantity);
76: 
77:             return ResponseEntity.ok(shoppingBasketDTO).getBody();
78:         } catch (ShopException e) {
79:             throw new ShoppingBasketNOTFOUND("Nout found. (getShoppingBasketAsDTO 2)");
80:         }
81:     }
82: 
83:     public ShoppingBasketPositionDTO getShoppingBasketPosition(UUID shoppingBasketId, UUID goodId){
84: 
85:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
86:                 .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found. (getShoppingBasketPosition 1)"));
87: 
88:         ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
89:         if ( position == null ){
90:             throw new ShoppingBasketNOTFOUND("not found (getShoppingBasketPosition 2)");
91:         }
92:         ModelMapper modelMapper = new ModelMapper();
93:         return modelMapper.map(position, ShoppingBasketPositionDTO.class);
94:     }
95: 
96: 
97:     public void deleteShoppingBasketPosition(UUID shoppingBasketId, UUID goodId){
98:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
99:                 .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found. (delete ShoppingBasketPosition 1)"));
100: 
101:         ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
102:         if (position == null){
103:             throw new ShoppingBasketNOTFOUND("not found (delete ShoppingBasketPosition 2)");
104:         }
105: 
106:         Integer quantityBeforeDeletion = position.getQuantity();
107: 
108:         shoppingBasketPositionRepository.delete(position);
109: 
110:         Map<UUID, Integer> goodsMap = shoppingBasket.getGoods();
111:         if (goodsMap.containsKey(goodId)){
112:             goodsMap.remove(goodId);
113:         }
114:         shoppingBasket.setGoods(goodsMap);
115:         shoppingBasketRepository.save(shoppingBasket);
116: 
117:         Good g = goodRepository.findByUuid(goodId);
118:         if (g != null) {
119:             g.setQuantity(g.getQuantity() + quantityBeforeDeletion);
120:             goodRepository.save(g);
121:         } else {
122:             throw new ShoppingBasketNOTFOUND("Good not found in repository (delete ShoppingBasketPosition 3)");
123:         }
124:     }
125: 
126: 
127: 
128:     public void checkoutShoppingBasket(UUID shoppingBasketId){
129:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
130:                 .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found.(checkout)"));
131: 
132:         EmailType userEmail = shoppingBasket.getUser().getEmail();
133: 
134:         shoppingBasketService.checkout(userEmail);
135:     }
136:     public ShoppingBasketPositionDTO addRemove(UUID shoppingBasketId, ShoppingBasketPositionDTO inputShoppingBasketPositionDTO) {
137:         UUID goodId = inputShoppingBasketPositionDTO.getGoodId();
138:         Integer quantity = inputShoppingBasketPositionDTO.getQuantity();
139:         String comment = inputShoppingBasketPositionDTO.getComment();
140: 
141:         if (quantity == null) {
142:             throw new IllegalArgumentException("Quantity must not be null");
143:         }
144: 
145:         Optional<ShoppingBasket> shoppingBasketOptional = shoppingBasketRepository.findById(shoppingBasketId);
146: 
147:         if (!shoppingBasketOptional.isPresent()) {
148:             throw new ShoppingBasketNOTFOUND("Shopping basket not found. (addRemove)");
149:         }
150: 
151:         ShoppingBasket shoppingBasket = shoppingBasketOptional.get();
152:         User user = shoppingBasket.getUser();
153:         Map<UUID, Integer> goods = shoppingBasket.getGoods();
154: 
155:         Integer availableInventory = goodRepository.findByUuid(goodId).getQuantity();
156:         if (quantity > availableInventory) {
157:             throw new ShoppingBasketCONFLICT("there is not enough goods");
158:         }
159:         if (quantity == 0) {
160:             ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
161:             shoppingBasketPositionRepository.delete(position);
162:         } else if (quantity < 0) {
163:             if (Math.abs(quantity) > goods.getOrDefault(goodId, 0)) {
164:                 throw new ShoppingBasketCONFLICT("Cannot remove more goods than there is in the shopping basket.");
165:             }
166:             ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
167:             position.setComment(comment);
168:             shoppingBasketService.removeGoodFromShoppingBasket(user.getEmail(), goodId, Math.abs(quantity));
169: 
170:         } else {
171:             shoppingBasketService.addGoodToShoppingBasket(user.getEmail(), goodId, quantity);
172:             ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
173:             position.setComment(comment);
174:             shoppingBasketPositionRepository.save(position);
175:         }
176: 
177:         ShoppingBasketPositionDTO createdPosition = new ShoppingBasketPositionDTO();
178:         createdPosition.setGoodId(goodId);
179:         createdPosition.setQuantity(quantity);
180:         createdPosition.setComment(comment);
181: 
182:         return createdPosition;
183:     }
184: }
185: 
186: 
187: 
188: 
189: 
190: 
191: 
192: 
193: 
194: 
195: 
196: 
197: 
198: //    public ShoppingBasketDTO getShoppingBasketAsDTO (String email){
199: //        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser_Email(Email.of(email));
200: //        ModelMapper modelMapper = new ModelMapper();
201: //        ShoppingBasketDTO shoppingBasketDTO = modelMapper.map(shoppingBasket, ShoppingBasketDTO.class);
202: //
203: //        //ShoppingBasketPosition shoppingBasketPosition = shoppingBasket.getShoppingBasketPositions().get();
204: //        //ShoppingBasketPositionDTO shoppingBasketPositionDTO = modelMapper.map(shoppingBasketPosition, ShoppingBasketDTO.class);
205: //        shoppingBasketDTO.setGoods(shoppingBasket.getGoods());
206: //        shoppingBasketDTO.setUuid(shoppingBasket.getUuid());
207: //        shoppingBasketDTO.setOrderStatus(shoppingBasket.getOrderStatus());
208: //        shoppingBasketDTO.setUserId(shoppingBasket.getUser().getUuid());
209: //        shoppingBasketDTO.setShoppingBasketPositions(shoppingBasket.getShoppingBasketPositions());
210: //        return shoppingBasketDTO;
211: //
212: //    }
213: 
214: 
215: //        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
216: //                .orElseThrow(() -> new ShopException("Shopping basket not found."));
217: //
218: //        ShoppingBasketPosition position = shoppingBasketPositionRepository.findById(positionId)
219: //                .orElseThrow(() -> new ShopException("Shopping basket position not found."));
220: //
221: //        if (!shoppingBasket.getShoppingBasketPositions().contains(position)) {
222: //            throw new ShopException("Position does not belong to the shopping basket.");
223: //        }
224: //
225: //        ModelMapper modelMapper = new ModelMapper();
226: //        return modelMapper.map(position, ShoppingBasketPositionDTO.class);
227: 
228: 
229: 
230: //        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
231: //                .orElseThrow(() -> new ShopException("Shopping basket not found."));
232: //
233: //        ShoppingBasketPosition position = shoppingBasketPositionRepository.findById(positionId)
234: //                .orElseThrow(() -> new ShopException("Shopping basket position not found."));
235: //
236: //        if (!shoppingBasket.getShoppingBasketPositions().contains(position)) {
237: //            throw new ShopException("Position does not belong to the shopping basket.");
238: //        }
239: //
240: //        shoppingBasket.getShoppingBasketPositions().remove(position);
241: //        shoppingBasketPositionRepository.delete(position);

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketCONFLICT.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.CONFLICT, reason = "conflict")
8: public class ShoppingBasketCONFLICT extends ShopException {
9:     public ShoppingBasketCONFLICT(String message){
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.http.HttpStatus;
6: import org.springframework.http.ResponseEntity;
7: import org.springframework.web.bind.annotation.*;
8: import org.springframework.web.servlet.support.ServletUriComponentsBuilder;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
10: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
11: 
12: import java.net.URI;
13: import java.util.ArrayList;
14: import java.util.Iterator;
15: import java.util.List;
16: import java.util.UUID;
17: 
18: //@RequestMapping("/shoppingBaskets")
19: @RestController
20: @RequestMapping("/shoppingBaskets")
21: public class ShoppingBasketController {
22:     @Autowired
23:     ShoppingBasketApplicationService shoppingBasketApplicationService;
24: 
25:     @Autowired
26:     ShoppingBasketRepository shoppingBasketRepository;
27: 
28:     @Autowired
29:     public ShoppingBasketController(ShoppingBasketApplicationService shoppingBasketApplicationService,
30:                                     ShoppingBasketRepository shoppingBasketRepository){
31:         this.shoppingBasketApplicationService = shoppingBasketApplicationService;
32:         this.shoppingBasketRepository = shoppingBasketRepository;
33:     }
34: 
35:     @GetMapping
36:     public ResponseEntity<?> getShoppingBasket(@RequestParam String email) {
37:         ShoppingBasketDTO shoppingBasketDTO = shoppingBasketApplicationService.getShoppingBasketAsDTO(email);
38:         return ResponseEntity.ok(shoppingBasketDTO);
39:     }
40: 
41: 
42:     @DeleteMapping("/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
43:     public ResponseEntity<?> deleteShoppingBasketPosition(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
44:                                                           @PathVariable("good-id") UUID goodId) {
45:         shoppingBasketApplicationService.deleteShoppingBasketPosition(shoppingBasketId, goodId);
46:         return ResponseEntity.ok().build();
47:     }
48: 
49:     @GetMapping("/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
50:     public ResponseEntity<?> getShoppingBasketPosition(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
51:                                                        @PathVariable("good-id") UUID positionId) {
52:         ShoppingBasketPositionDTO shoppingBasketPositionDTO =
53:                 shoppingBasketApplicationService.getShoppingBasketPosition(shoppingBasketId, positionId);
54:         return ResponseEntity.ok(shoppingBasketPositionDTO);
55:     }
56: 
57:     @PutMapping("/{shoppingBasket-id}/checkout")
58:     public ResponseEntity<?> checkoutShoppingBasket(@PathVariable("shoppingBasket-id") UUID shoppingBasketId) {
59:         shoppingBasketApplicationService.checkoutShoppingBasket(shoppingBasketId);
60:         return ResponseEntity.ok().build();
61:     }
62: 
63:     @PostMapping ("/{shoppingBasket-id}/shoppingBasketPositions")
64:     public ResponseEntity<?> addRemove(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
65:                                        @RequestBody ShoppingBasketPositionDTO inputShoppingBasketPositionDTO) {
66: 
67:         try {
68:             ShoppingBasketPositionDTO createdPosition = shoppingBasketApplicationService.addRemove(shoppingBasketId, inputShoppingBasketPositionDTO);
69: 
70:             URI returnURI = ServletUriComponentsBuilder
71:                     .fromCurrentRequest()
72:                     .path("/{id}")
73:                     .buildAndExpand(createdPosition.getGoodId())
74:                     .toUri();
75: 
76:             return ResponseEntity.created(returnURI).body(createdPosition);
77:         } catch (ShoppingBasketCONFLICT e) {
78:             return ResponseEntity.status(HttpStatus.CONFLICT).body(e.getMessage());
79:         } catch (Exception e) {
80:             return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(e.getMessage());
81:         }
82:     }
83: }
84: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: import lombok.AllArgsConstructor;
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.order.domain.OrderStatus;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: 
10: import java.util.List;
11: import java.util.Map;
12: import java.util.UUID;
13: 
14: @AllArgsConstructor
15: @NoArgsConstructor
16: @Getter
17: @Setter
18: public class ShoppingBasketDTO {
19:     private UUID id;
20:     private OrderStatus orderStatus;
21:     private Map<UUID, Integer> goods;
22:     private UUID userId;
23:     private Integer totalQuantity = 0;
24:     private Email email;
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketNOTFOUND.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.http.HttpStatus;
4: import org.springframework.web.bind.annotation.ResponseStatus;
5: import thkoeln.archilab.ecommerce.ShopException;
6: 
7: @ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "not found")
8: public class ShoppingBasketNOTFOUND extends ShopException {
9:     public ShoppingBasketNOTFOUND(String message) {
10:         super(message);
11:     }
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
8: 
9: import java.util.UUID;
10: 
11: @AllArgsConstructor
12: @NoArgsConstructor
13: @Getter
14: @Setter
15: public class ShoppingBasketPositionDTO {
16:     private Integer quantity;
17:     private String comment;
18:     private UUID goodId;
19:     private UUID shoppingBasketUuid;
20: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.dao.InvalidDataAccessApiUsageException;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
9: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
10: import thkoeln.archilab.ecommerce.solution.good.GoodInterfaceShoppingBasket;
11: import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
12: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
13: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
14: import thkoeln.archilab.ecommerce.solution.order.domain.*;
15: import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
16: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
17: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPosition;
18: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPositionRepository;
19: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
20: import thkoeln.archilab.ecommerce.solution.user.ShoppingBasketTypeInterface;
21: import thkoeln.archilab.ecommerce.solution.user.UserNeedsBasketInterface;
22: import thkoeln.archilab.ecommerce.solution.user.domain.User;
23: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
24: import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
25: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
26: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
27: 
28: import java.util.*;
29: 
30: @Service
31: public class ShoppingBasketService implements ShoppingBasketUseCases, GoodInterfaceShoppingBasket, UserNeedsBasketInterface {
32:     @Autowired
33:     ShoppingBasketRepository shoppingBasketRepository;
34:     @Autowired
35:     UserRepository userRepository;
36:     @Autowired
37:     OrderRepository orderRepository;
38:     @Autowired
39:     OrderPositionRepository orderPositionRepository;
40:     @Autowired
41:     GoodRepository goodRepository;
42:     @Autowired
43:     PaymentService paymentService;
44:     @Autowired
45:     DeliveryService deliveryService;
46:     @Autowired
47:     DeliveryRepository deliveryRepository;
48:     @Autowired
49:     ShoppingBasketPositionRepository shoppingBasketPositionRepository;
50: 
51: 
52:     @Override
53:     public void addGoodToShoppingBasket(EmailType userEmail, UUID goodId, int quantity) {
54:         User user = userRepository.findByEmail(userEmail);
55:         if (user == null) {
56:             throw new ShopException("User not found");
57:         }
58: 
59:         Good good = goodRepository.findByUuid(goodId);
60:         if (good == null) {
61:             throw new ShopException("Good not found");
62:         }
63: 
64:         if (quantity < 0 || quantity > good.getQuantity()) {
65:             throw new ShopException("Invalid quantity ADD");
66:         }
67: 
68:         ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
69:         if (basket == null) {
70:             basket = new ShoppingBasket();
71:             basket.setUser(user);
72:         }
73: 
74:         Map<UUID, Integer> goods = basket.getGoods();
75:         if (goods.containsKey(goodId)) {
76:             int currentQuantity = goods.get(goodId);
77:             goods.put(goodId, currentQuantity + quantity);
78:         } else {
79:             goods.put(goodId, quantity);
80:         }
81: 
82:         good.setQuantity(good.getQuantity() - quantity);
83:         basket.setGoods(goods);
84: 
85:         ShoppingBasketPosition existingPosition = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
86: 
87:         if (existingPosition != null) {
88:             int currentPositionQuantity = existingPosition.getQuantity();
89:             existingPosition.setQuantity(currentPositionQuantity + quantity);
90: 
91:             existingPosition.setShoppingBasket(basket);
92:             shoppingBasketPositionRepository.save(existingPosition);
93:         }else {
94:             ShoppingBasketPosition newPosition = new ShoppingBasketPosition();
95:             newPosition.setGood(good);
96:             newPosition.setQuantity(quantity);
97:             newPosition.setShoppingBasket(basket);
98: 
99:             shoppingBasketPositionRepository.save(newPosition);
100:         }
101: 
102:         goodRepository.save(good);
103:         shoppingBasketRepository.save(basket);
104:         userRepository.save(user);
105:     }
106: 
107:     @Override
108:     public void removeGoodFromShoppingBasket(EmailType userEmail, UUID goodId, int quantity) throws ShopException {
109:         if (userEmail == null) {
110:             throw new ShopException("User email is null");
111:         }
112: 
113:         User user = userRepository.findByEmail(userEmail);
114:         if (user == null) {
115:             throw new ShopException("User does not exist");
116:         }
117: 
118:         Good good = goodRepository.findByUuid(goodId);
119:         if (good == null) {
120:             throw new ShopException("Good does not exist");
121:         }
122: 
123:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
124:         if (shoppingBasket == null) {
125:             throw new ShopException("User does not have a shopping basket");
126:         }
127: 
128:         Map<UUID, Integer> goods = shoppingBasket.getGoods();
129:         if (goods == null || !goods.containsKey(goodId)) {
130:             throw new ShopException("Good is not in the shopping basket or the basket is empty");
131:         }
132: 
133:         int currentQuantity = goods.get(goodId);
134:         if (quantity <= 0 || quantity > currentQuantity) {
135:             throw new ShopException("Invalid quantity REMOVE");
136:         }
137: 
138:         int newQuantity = currentQuantity - quantity;
139:         if (newQuantity == 0) {
140:             goods.remove(goodId);
141:         } else {
142:             goods.put(goodId, newQuantity);
143:         }
144: 
145:         good.setQuantity(good.getQuantity() + quantity);
146:         goodRepository.save(good);
147: 
148:         ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
149:         if (position != null) {
150:             int currentPositionQuantity = position.getQuantity();
151:             if (quantity > currentPositionQuantity) {
152:                 throw new ShopException("not enough quantity");
153:             }
154:             position.setQuantity(currentPositionQuantity - quantity);
155:             if(position.getQuantity() == 0) {
156:                 shoppingBasketPositionRepository.delete(position);
157:             } else {
158:                 shoppingBasketPositionRepository.save(position);
159:             }
160:         }
161: 
162:         shoppingBasket.setGoods(goods);
163:         shoppingBasketRepository.save(shoppingBasket);
164:     }
165:     /**
166:      * Sets a comment in the shopping basket position containing a good
167:      *
168:      * @param userEmail
169:      * @param goodId
170:      * @param comment   (can be null)
171:      * @throws ShopException if ...
172:      *                       - userEmail is null,
173:      *                       - the user with the given email does not exist,
174:      *                       - the good does not exist
175:      *                       - the good is not in the shopping basket
176:      */
177:     @Override
178:     public void setCommentForShoppingBasketPosition(EmailType userEmail, UUID goodId, String comment) throws ShopException {
179:         if (userEmail == null) {
180:             throw new ShopException("User email is null");
181:         }
182: 
183:         User user = userRepository.findByEmail(userEmail);
184:         if (user == null) {
185:             throw new ShopException("User does not exist");
186:         }
187: 
188:         Good good = goodRepository.findByUuid(goodId);
189:         if (good == null) {
190:             throw new ShopException("Good does not exist");
191:         }
192: 
193:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
194:         if (shoppingBasket == null) {
195:             throw new ShopException("User does not have a shopping basket");
196:         }
197: 
198:         Map<UUID, Integer> goods = shoppingBasket.getGoods();
199:         if (goods == null || !goods.containsKey(goodId)) {
200:             throw new ShopException("Good is not in the shopping basket or the basket is empty");
201:         }
202: 
203: //        Optional<ShoppingBasketPosition> optionalPosition = shoppingBasket.getShoppingBasketPositions().stream()
204: //                .filter(position -> position.getGood().getUuid().equals(goodId))
205: //                .findFirst();
206:         ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
207: 
208:         if (position == null) {
209:             throw new ShopException("Failed to find shopping basket position");
210:         }
211: 
212:         position.setComment(comment);
213:         position.setShoppingBasket(shoppingBasket);
214:         shoppingBasketPositionRepository.save(position);
215:     }
216:     /**
217:      * Returns the comment in the shopping basket position containing a good
218:      *
219:      * @param userEmail
220:      * @param goodId
221:      * @return the comment (can be null)
222:      * @throws ShopException if ...
223:      *                       - userEmail is null,
224:      *                       - the user with the given email does not exist,
225:      *                       - the good does not exist
226:      *                       - the good is not in the shopping basket
227:      */
228:     @Override
229:     public String getCommentForShoppingBasketPosition(EmailType userEmail, UUID goodId) throws ShopException {
230:         if (userEmail == null) {
231:             throw new ShopException("User email cannot be null");
232:         }
233: 
234:         User user = userRepository.findByEmail(userEmail);
235:         if (user == null) {
236:             throw new ShopException("User does not exist");
237:         }
238: 
239:         try {
240:             Optional<Good> optionalGood = goodRepository.findById(goodId);
241:             if (optionalGood.isEmpty()) {
242:                 throw new ShopException("Good does not exist");
243:             }
244:         } catch (InvalidDataAccessApiUsageException e) {
245:             throw new ShopException("Failed to retrieve the good from the repository");
246:         }
247: 
248:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
249:         if (shoppingBasket == null) {
250:             throw new ShopException("User does not have a shopping basket");
251:         }
252: 
253:         boolean goodExistsInBasket = shoppingBasket.getGoods().containsKey(goodId);
254:         if (!goodExistsInBasket) {
255:             throw new ShopException("Good is not in the shopping basket");
256:         }
257: 
258: 
259: 
260:         ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
261: 
262:         if (position == null) {
263:             throw new ShopException("Failed to find shopping basket position");
264:         }
265:         return position.getComment();
266:     }
267:     @Override
268:     public Map<UUID, Integer> getShoppingBasketAsMap(EmailType userEmail) {
269:         /**
270:          * Returns a map showing which goods are in the cart of a user and how many of each good
271:          *
272:          * @param userEmail
273:          * @return the cart of the user (map is empty if the cart is empty)
274:          * @throws ShopException if the user with the given email does not exist
275:          */
276:         User user = userRepository.findByEmail(userEmail);
277:         if ( user == null ){
278:             throw new ShopException("user does not exist");
279:         }
280:         //ShoppingBasket basket = user.getShoppingBasket();
281:         ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
282:         if ( basket == null ){
283:             return Collections.emptyMap();
284:         }
285:         Map<UUID, Integer> cartCopy = new HashMap<>(basket.getGoods());
286:         return cartCopy;
287:     }
288: 
289: 
290:     @Override
291:     public MoneyType getShoppingBasketAsMoneyValue(EmailType userEmail) {
292:         User user =userRepository.findByEmail(userEmail);
293:         if ( user == null ){
294:             throw new ShopException("user does not exist");
295:         }
296:         float amount = 0.0f;
297: 
298:         //Map<UUID, Integer> cart = user.getShoppingBasket().getGoods();
299:         Map<UUID, Integer> cart = shoppingBasketRepository.findShoppingBasketByUser(user).getGoods();
300: 
301:         for ( UUID goodId : cart.keySet() ){
302:             Good good = goodRepository.findByUuid(goodId);
303:             if ( good == null ){
304:                 throw new ShopException("Good not found");
305:             }
306:             amount += good.getSellingPrice().getAmount() * cart.get(goodId);
307:         }
308:         Money totalValue = new Money(amount, "EUR");
309: 
310:         return totalValue;
311:     }
312: 
313:     @Override
314:     public int getReservedInventoryInShoppingBaskets(UUID goodId) {
315:         /**
316:          * Get the number units of a specific good that are currently reserved in the shopping baskets of all users
317:          * @param goodId
318:          * @throws ShopException if the good id does not exist
319:          */
320:         Good good = goodRepository.findByUuid(goodId);
321:         if ( good == null ){
322:             throw new ShopException("good id does not exist");
323:         }
324: 
325:         Iterable<ShoppingBasket> baskets = shoppingBasketRepository.findAll();
326:         int reservedQuantity = 0;
327:         for (ShoppingBasket basket : baskets){
328:             Integer quantity = basket.getGoods().get(goodId);
329:             if ( quantity!=null ){
330:                 reservedQuantity += quantity;
331:             }
332:         }
333:         return reservedQuantity;
334:     }
335: 
336: 
337:     @Override
338:     public boolean isEmpty(EmailType userEmail) {
339:         if ( userEmail == null || userEmail.toString().isEmpty() ){
340:             throw new ShopException("user does not exist or is empty");
341:         }
342:         User user = userRepository.findByEmail(userEmail);
343:         if ( user == null ){
344:             throw new ShopException("user does not exist");
345:         }
346: 
347:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
348:         if ( shoppingBasket.getGoods().isEmpty() ){
349:             return true;
350:         } else return false;
351:     }
352: 
353: 
354:     @Override
355:     public boolean isPaymentAuthorized(EmailType userEmail) {
356:         User user = userRepository.findByEmail(userEmail);
357:         if ( userEmail == null || userEmail.toString().isEmpty() ){
358:             throw new ShopException("email is wrong");
359:         }
360: 
361:         if ( user == null ){
362:             throw new ShopException("user does not exist");
363:         }
364: 
365:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
366:         if (  shoppingBasket.getOrderStatus() != OrderStatus.PAYMENT_AUTHORIZED ){
367:             return false;
368:         }
369:         return true;
370:     }
371: 
372: 
373:     @Override
374:     public void checkout(EmailType userEmail) {
375:         User user = userRepository.findByEmail(userEmail);
376:         if (user == null) throw new ShopException("User does not exist");
377: 
378:         ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
379:         if(basket == null) throw new ShoppingBasketNOTFOUND("Shopping basket not found.");
380: 
381:         try {
382:             Money basketValue = (Money) getShoppingBasketAsMoneyValue(basket.getUser().getEmail());
383:             paymentService.authorizePayment(basket.getUser().getEmail(), basketValue);
384:             basket.setOrderStatus(OrderStatus.PAYMENT_AUTHORIZED);
385: 
386:             deliveryService.triggerDelivery(basket.getUser(), new HashMap<>(basket.getGoods()));
387:             basket.setOrderStatus(OrderStatus.DELIVERY_TRIGGERED);
388: 
389:             Order order = new Order();
390:             order.setUser(basket.getUser());
391:             order.setOrderPositions(new ArrayList<>());
392: 
393:             for (Map.Entry<UUID, Integer> entry : getShoppingBasketAsMap(basket.getUser().getEmail()).entrySet()) {
394:                 OrderPosition orderPosition = new OrderPosition();
395:                 orderPosition.setGood(goodRepository.findByUuid(entry.getKey()));
396:                 orderPosition.setQuantity(entry.getValue());
397:                 orderPosition.setComment(getCommentForShoppingBasketPosition(basket.getUser().getEmail(), entry.getKey()));
398:                 order.getOrderPositions().add(orderPosition);
399:                 orderPositionRepository.save(orderPosition);
400:             }
401: 
402:             basket.setOrderStatus(OrderStatus.EMPTY);
403:             basket.getGoods().clear();
404:             shoppingBasketRepository.save(basket);
405:             orderRepository.save(order);
406: 
407:         } catch (Exception e) {
408:             if(basket.getOrderStatus().equals(OrderStatus.PAYMENT_AUTHORIZED)) {
409:                 throw new ShoppingBasketCONFLICT("too many goods");
410:             } else {
411:                 throw new ShoppingBasketCONFLICT("too low");
412:             }
413:         }
414:     }
415: 
416:     @Override
417:     public Map<UUID, Integer> getOrderHistory(EmailType clientMailAddress) {
418:         User client = userRepository.findByEmail(clientMailAddress);
419:         List<Order> orders = orderRepository.findByUser(client);
420:         Map<UUID, Integer> orderHistory = new HashMap<>();
421:         for (Order order : orders) {
422:             for (OrderPosition orderPosition : order.getOrderPositions()) {
423:                 if (orderHistory.containsKey(orderPosition.getGood().getUuid())) {
424:                     orderHistory.put(orderPosition.getGood().getUuid(), orderHistory.get(orderPosition.getGood().getUuid()) + orderPosition.getQuantity());
425:                 } else {
426:                     orderHistory.put(orderPosition.getGood().getUuid(), orderPosition.getQuantity());
427:                 }
428:             }
429:         }
430:         return orderHistory;
431: 
432:     }
433: 
434: 
435:     @Override
436:     public void deleteAllOrders() {
437:         /**
438:          * Deletes all orders and shopping baskets in the system
439:          */
440:         orderRepository.deleteAll();
441:         shoppingBasketRepository.deleteAll();
442:     }
443: 
444:     @Override
445:     public void saveShoppingBasket(ShoppingBasketType shoppingBasket) {
446:         shoppingBasketRepository.save((ShoppingBasket)shoppingBasket);
447:     }
448: 
449:     @Override
450:     public ShoppingBasketType getShoppingBasket(UUID shoppingBasketId) {
451:         return getShoppingBasket(shoppingBasketId);
452:     }
453: 
454:     @Override
455:     public List<ShoppingBasketType> findAll() {
456:         return new ArrayList<>((List<ShoppingBasket>)shoppingBasketRepository.findAll());
457:     }
458: 
459: 
460:     @Override
461:     public void save(ShoppingBasketTypeInterface shoppingBasket) {
462:         shoppingBasketRepository.save((ShoppingBasket) shoppingBasket);
463:     }
464: 
465:     @Override
466:     public void deleteAll() {
467:         shoppingBasketRepository.deleteAll();
468:     }
469: 
470:     @Override
471:     public ShoppingBasket createBasket(User user) {
472:         ShoppingBasket basket = new ShoppingBasket();
473:         basket.setUser(user);
474:         return basket;
475:     }
476: 
477: 
478: }
479: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
8: import thkoeln.archilab.ecommerce.solution.order.domain.OrderStatus;
9: import thkoeln.archilab.ecommerce.solution.user.ShoppingBasketTypeInterface;
10: import thkoeln.archilab.ecommerce.solution.user.domain.User;
11: 
12: import javax.persistence.*;
13: import java.util.*;
14: 
15: @NoArgsConstructor
16: @AllArgsConstructor
17: @Getter
18: @Entity
19: public class ShoppingBasket implements ShoppingBasketType, ShoppingBasketTypeInterface {
20:     @Setter
21:     @Id
22:     @GeneratedValue(strategy = GenerationType.AUTO)
23:     private UUID uuid;
24: 
25:     @Setter
26:     private OrderStatus orderStatus = OrderStatus.EMPTY;
27: 
28:     @Setter
29:     @ElementCollection
30:     private Map<UUID, Integer> goods = new HashMap<>();
31: 
32:     @Setter
33:     @OneToOne
34:     private User user;
35: 
36: //    @Setter
37: //    @OneToMany(cascade = CascadeType.ALL)
38: //    private List<ShoppingBasketPosition> shoppingBasketPositions = new ArrayList<>();
39: 
40:     @Setter
41:     private Integer totalQuantity;
42: 
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: 
9: import javax.persistence.*;
10: import java.util.UUID;
11: 
12: @Entity
13: @Getter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class ShoppingBasketPosition {
17:     @Setter
18:     @Id
19:     @GeneratedValue(strategy = GenerationType.AUTO)
20:     private UUID uuid;
21: 
22:     @Setter
23:     private Integer quantity;
24: 
25:     @Setter
26:     private String comment;
27: 
28:     @Setter
29:     @ManyToOne
30:     private Good good;
31: 
32:     @Setter
33:     @ManyToOne
34:     ShoppingBasket shoppingBasket;
35: 
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.List;
6: import java.util.UUID;
7: 
8: public interface ShoppingBasketPositionRepository extends CrudRepository<ShoppingBasketPosition, UUID> {
9:     ShoppingBasketPosition findShoppingBasketPositionByGoodUuid(UUID uuid);
10:     List<ShoppingBasketPosition> findShoppingBasketPositionByShoppingBasketUuid(UUID uuid);
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.domainprimitives.Email;
5: import thkoeln.archilab.ecommerce.solution.user.domain.User;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
7: 
8: import java.util.UUID;
9: 
10: public interface ShoppingBasketRepository extends CrudRepository<ShoppingBasket, UUID> {
11:     ShoppingBasket findShoppingBasketByGoodsContaining(UUID uuid);
12:     ShoppingBasket findShoppingBasketByUuid(UUID uuid);
13:     ShoppingBasket findShoppingBasketByUser(User user);
14:     ShoppingBasket findShoppingBasketByUserEmail(Email email);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserService.java ---
1: package thkoeln.archilab.ecommerce.solution.user.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.ZipCode;
9: import thkoeln.archilab.ecommerce.solution.user.UserNeedsBasketInterface;
10: import thkoeln.archilab.ecommerce.solution.user.domain.User;
11: import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
12: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
13: import thkoeln.archilab.ecommerce.usecases.UserType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
15: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
16: 
17: @Service
18: public class UserService implements UserRegistrationUseCases {
19:     @Autowired
20:     UserRepository userRepository;
21: 
22:     @Autowired
23:     UserNeedsBasketInterface userNeedsBasketInterface;
24: 
25: 
26:     @Override
27:     public void register(String name, EmailType email, PersonalAddressType personalAddress) {
28:         User existingUser = userRepository.findByEmail(email);
29:         if ( existingUser != null ){
30:             throw new ShopException("User with given email already exists.");
31:         }
32: 
33:         if( name == null || email == null || personalAddress == null || personalAddress.getStreet() == null || personalAddress.getCity() == null || personalAddress.getZipCode() == null || name.isEmpty() || email.toString().isEmpty() || personalAddress.getStreet().isEmpty() || personalAddress.getCity().isEmpty() || personalAddress.getZipCode().toString().isEmpty()) {
34:             throw new ShopException("Data (name, email, street, city or zipCode) is invalid.");
35:         }
36:         Address address = new Address(personalAddress.getStreet(), personalAddress.getCity(), (ZipCode) personalAddress.getZipCode());
37: 
38:         User newUser = new User(name, (Email) email, address.getStreet(), address.getCity(), address.getZipCode());
39: 
40: 
41:         userRepository.save(newUser);
42:         userNeedsBasketInterface.save(userNeedsBasketInterface.createBasket(newUser));
43: 
44:     }
45: 
46: 
47:     @Override
48:     public void changeAddress(EmailType userEmail, PersonalAddressType personalAddress) {
49:         User user = userRepository.findByEmail( userEmail);
50:         if( user == null )
51:             throw new ShopException("Can not change Address, check user registration.");
52:         if ( personalAddress == null || personalAddress.getStreet() == null || personalAddress.getCity() == null || personalAddress.getZipCode() == null || personalAddress.getStreet().isEmpty() || personalAddress.getCity().isEmpty() || personalAddress.getZipCode().toString().isEmpty())
53:             throw new ShopException("Not able to change. Check attributes.");
54: 
55:         Email userEmailType = Email.of(userEmail.toString());
56:         User newUser = new User(user.getName(), userEmailType, user.getPersonalAddress().getStreet(), user.getPersonalAddress().getCity(), user.getAddress().getZipCode());
57:         userRepository.save(newUser);
58:     }
59: 
60: 
61:     @Override
62:     public UserType getUserData(EmailType userEmail) {
63:         User user = userRepository.findByEmail((Email) userEmail);
64:         if ( userEmail == null )
65:         {
66:             throw new ShopException("email is null");
67:         }
68:         if ( user == null ){
69:             throw new ShopException("user does not exist");
70:         }
71: 
72:         return new User(user.getName(), user.getEmail(),user.getPersonalAddress().getStreet(), user.getPersonalAddress().getCity(), (ZipCode) user.getPersonalAddress().getZipCode());
73:     }
74: 
75:     @Override
76:     public void deleteAllUsers() {
77:         userNeedsBasketInterface.deleteAll();
78:         userRepository.deleteAll();
79:     }
80: 
81: 
82: }
83: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.ZipCode;
9: import thkoeln.archilab.ecommerce.usecases.UserType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
11: 
12: import javax.persistence.*;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @NoArgsConstructor
18: public class User implements UserType {
19: 
20: 
21:     @Id
22:     @GeneratedValue(strategy = GenerationType.AUTO)
23:     private UUID uuid;
24: 
25:     @Setter
26:     private String name;
27: 
28:     @Setter
29:     @Embedded
30:     private Email email;
31: 
32:     @Setter
33:     @Embedded
34:     private Address address;
35: 
36: 
37:     public User(String name, Email email, String street, String city, ZipCode zipCode) {
38:         this.name = name;
39:         this.email = email;
40:         this.address = new Address(street, city, zipCode);
41:     }
42: 
43:     @Override
44:     public PersonalAddressType getPersonalAddress() {
45:         return this.address;
46:     }
47: 
48: }
49: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\UserRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.user.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.UUID;
7: 
8: public interface UserRepository extends CrudRepository<User, UUID> {
9:     User findByEmail(EmailType email);
10:     //User findByEmail(Email email);
11:     //public ShoppingBasket findShoppingBasketByEmail(String email);
12: }

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\ShoppingBasketTypeInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.user;
2: 
3: public interface ShoppingBasketTypeInterface {
4: }
5: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserBasketInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.user;//package thkoeln.archilab.ecommerce.solution.user;
2: //
3: //import thkoeln.archilab.ecommerce.domainprimitives.Email;
4: //import thkoeln.archilab.ecommerce.solution.user.domain.User;
5: //import thkoeln.archilab.ecommerce.usecases.UserType;
6: //import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
7: //
8: //public interface UserBasketInterface {
9: //    public User findByEmail(EmailType email);
10: //    public void setUser(UserType user);
11: //    public void saveUser(UserType user);
12: //}
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserNeedsBasketInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.user;
2: 
3: import thkoeln.archilab.ecommerce.solution.user.domain.User;
4: 
5: public interface UserNeedsBasketInterface {
6:     public void save(ShoppingBasketTypeInterface shoppingBasket);
7:     public void deleteAll();
8:     public ShoppingBasketTypeInterface createBasket(User user);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of goods to a user. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a good to a user. The good is identified by its id, and the user by
16:      * his/her name, street, city and zip code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of good ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of goods in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( UserType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which goods have been delivered to a user, and how many of each good
31:      *
32:      * @param userEmail
33:      * @return the delivery history of the user (map is empty if the user has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the user with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType userEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PersonalAddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PersonalAddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the zip code
18:      */
19:     public ZipCodeType getZipCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an zip code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param zipCode the zip code
30:      * @return the personalAddress object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - zipCode is null
35:      */
36:      // public static PersonalAddressType of( String street, String city, ZipCodeType zipCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\ZipCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface ZipCodeType {
6:     /**
7:      * @return the zip code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an zip code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param zipCodeAsString - the zip code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new zip code object matching the given string
22:      * @throws ShopException if ...
23:      *      - zipCodeAsString is null
24:      *      - zipCodeAsString is not a valid zip code (see above)
25:      */
26:      // public static ZipCodeType of( String zipCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\GoodCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the good catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface GoodCatalogUseCases {
15:     /**
16:      * Adds a new good to the shop catalog
17:      * @param goodId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param sellingPrice
23:      * @throws ShopException if ...
24:      *      - goodId is null,
25:      *      - the good with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the selling price is null,
30:      *      - the selling price is lower than the purchase price
31:      */
32:     public void addGoodToCatalog( UUID goodId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType sellingPrice );
34: 
35: 
36:     /**
37:      * Removes a good from the shop catalog
38:      * @param goodId
39:      * @throws ShopException if
40:      *      - goodId is null,
41:      *      - the good with that id does not exist
42:      *      - the good is still in inventory
43:      *      - the good is still reserved in a shopping basket, or part of a completed order
44:      */
45:     public void removeGoodFromCatalog( UUID goodId );
46: 
47: 
48:     /**
49:      * Get the selling price of a given good
50:      * @param goodId
51:      * @return the selling price
52:      * @throws ShopException if ...
53:      *      - goodId is null,
54:      *      - the good with that id does not exist
55:      */
56:     public MoneyType getSellingPrice( UUID goodId );
57: 
58: 
59:     /**
60:      * Clears the good catalog, i.e. removes all goods from the catalog, including all the inventory,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteGoodCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
10:  * i.e. adding and removing goods in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface InventoryManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given good to the inventory
16:      * @param goodId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - goodId is null
20:      *      - the good with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToInventory( UUID goodId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given good from the inventory.
28:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
29:      * (in the users' shopping baskets) are removed. This means that some of the reserved goods are lost for
30:      * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
31:      * or some of the goods were stolen from the warehouse, are broken, etc.)
32:      * @param goodId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - goodId is null
36:      *      - the good with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current inventory and the currently reserved goods together
39:      */
40:     public void removeFromInventory( UUID goodId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given good in the inventory.
45:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
46:      * (in the users' shopping baskets) are removed. This means that some of the reserved goods are lost for
47:      * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
48:      * or some of the goods were stolen from the warehouse, are broken, etc.)
49:      * @param goodId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - goodId is null
53:      *      - the good with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeInventoryTo( UUID goodId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total inventory of a given good, including the currently reserved goods
61:      * @param goodId
62:      * @return the current total inventory of the good
63:      * @throws ShopException if ...
64:      *      - goodId is null
65:      *      - the good with that id does not exist
66:      */
67:     public int getAvailableInventory( UUID goodId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a bank card for a given amount
16:      *
17:      * @param userEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - userEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType userEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a user
31:      * (identified by his/her email)
32:      *
33:      * @param userEmail
34:      * @return the total amount of payments made using this bank card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - userEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType userEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all users.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingBasketUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping basket.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingBasketUseCases {
15:     /**
16:      * Adds a good to the shopping basket of a user
17:      *
18:      * @param userEmail
19:      * @param goodId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the user with the given email does not exist,
23:      *      - the good does not exist,
24:      *      - the quantity <= 0,
25:      *      - the good is not available in the requested quantity
26:      */
27:     public void addGoodToShoppingBasket( EmailType userEmail, UUID goodId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a good from the shopping basket of a user
32:      *
33:      * @param userEmail
34:      * @param goodId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - userEmail is null,
38:      *      - the user with the given email does not exist,
39:      *      - the good does not exist
40:      *      - the quantity <= 0,
41:      *      - the good is not in the shopping basket in the requested quantity
42:      */
43:     public void removeGoodFromShoppingBasket( EmailType userEmail, UUID goodId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping basket position containing a good
48:      *
49:      * @param userEmail
50:      * @param goodId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - userEmail is null,
54:      *      - the user with the given email does not exist,
55:      *      - the good does not exist
56:      *      - the good is not in the shopping basket
57:      */
58:     public void setCommentForShoppingBasketPosition( EmailType userEmail, UUID goodId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping basket position containing a good
63:      *
64:      * @param userEmail
65:      * @param goodId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - userEmail is null,
69:      *      - the user with the given email does not exist,
70:      *      - the good does not exist
71:      *      - the good is not in the shopping basket
72:      */
73:     public String getCommentForShoppingBasketPosition( EmailType userEmail, UUID goodId );
74: 
75: 
76:     /**
77:      * Returns a map showing which goods are in the shopping basket of a user and how many of each good
78:      *
79:      * @param userEmail
80:      * @return the shopping basket of the user (map is empty if the shopping basket is empty)
81:      * @throws ShopException if ...
82:      *      - userEmail is null,
83:      *      - the user with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingBasketAsMap( EmailType userEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all goods in the shopping basket of a user
90:      *
91:      * @param userEmail
92:      * @return the value of shopping basket of the user
93:      * @throws ShopException if ...
94:      *      - userEmail is null,
95:      *      - the user with the given email does not exist
96:      */
97:     public MoneyType getShoppingBasketAsMoneyValue( EmailType userEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific good that are currently reserved in the shopping baskets of all users
103:      * @param goodId
104:      * @return the number of reserved goods of that type in all shopping baskets
105:      * @throws ShopException
106:      *      - goodId is null
107:      *      - if the good id does not exist
108:      */
109:     public int getReservedInventoryInShoppingBaskets( UUID goodId );
110: 
111: 
112:     /**
113:      * Checks if the shopping basket of a user is empty
114:      *
115:      * @param userEmail
116:      * @return true if the shopping basket is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - userEmail is null
119:      *    - the user with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType userEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping basket of a user has been authorized to be paid,
126:      * i.e. the shopping basket is not empty, the user has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the user's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param userEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - userEmail is null
134:      *      - the user with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType userEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping basket of a user
141:      *
142:      * @param userEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - userEmail is null
146:      *      - the user with the given email does not exist
147:      *      - the shopping basket is empty
148:      */
149:     public void checkout( EmailType userEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which goods have been ordered by a user, and how many of each good
156:      *
157:      * @param userEmail
158:      * @return the order history of the user (map is empty if the user has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the user with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType userEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping baskets in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping baskets), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\UserRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a user.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface UserRegistrationUseCases {
12:     /**
13:      * Registers a new user
14:      *
15:      * @param name
16:      * @param email
17:      * @param personalAddress
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - user with the given email already exists
22:      *      - personalAddress is null
23:      */
24:     public void register( String name, EmailType email, PersonalAddressType personalAddress );
25: 
26: 
27:     /**
28:      * Changes the personalAddress of a user
29:      *
30:      * @param userEmail
31:      * @param personalAddress
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - user with the given email already exists
35:      *      - personalAddress is null
36:      */
37:     public void changeAddress( EmailType userEmail, PersonalAddressType personalAddress );
38: 
39: 
40:     /**
41:      * Returns the data of a user
42:      * @param userEmail
43:      * @return the user data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the user with the given email does not exist
47:      */
48:     public UserType getUserData( EmailType userEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all users, including all orders and shopping baskets
54:      */
55:     public void deleteAllUsers();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\UserType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop user
8:  */
9: public interface UserType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public PersonalAddressType getPersonalAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Good" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"user", "shoppingbasket", "good", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "User",
21:             "UserRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingBasket",
25:             "ShoppingBasketRepository",
26:             "Good",
27:             "GoodRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllGoods();
45:         initialMasterDataCreator.inventoryUpAllGoods();
46:         initialMasterDataCreator.registerAllUsers();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + USER_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = USER_EMAIL[6].toString();
76: 
77:         UUID goodId2 = (UUID) GOOD_DATA[2][0];
78:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
79:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
80:         Float goodMoneyAmount2 = ((MoneyType) GOOD_DATA[2][5]).getAmount() * 2;
81:         Float goodMoneyAmount4 = ((MoneyType) GOOD_DATA[4][5]).getAmount() * 4;
82:         Float goodMoneyAmount6 = ((MoneyType) GOOD_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForUser( emailString, goodId2, 2 );
89:         restHelper.makeOrderForUser( emailString, goodId4, 4 );
90:         restHelper.makeOrderForUser( emailString, goodId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( goodMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( goodMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
110:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = USER_EMAIL[3].toString();
118:         UUID goodId3 = (UUID) GOOD_DATA[3][0];
119:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float goodMoneyAmount =
123:                 ((MoneyType) GOOD_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) GOOD_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingBasketId = restHelper.getShoppingBasketId( emailString );
128:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId3, quantity3 );
129:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingBasketRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingBasketRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllGoods();
47:         initialMasterDataCreator.inventoryUpAllGoods();
48:         initialMasterDataCreator.registerAllUsers();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingBasket() throws Exception {
57:         // given
58:         String validUri = "/shoppingBaskets?email=" + USER_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingBaskets?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingBaskets?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID goodId = (UUID) GOOD_DATA[3][0];
78:         String userEmailString = USER_EMAIL[4].toString();
79:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
80: 
81:         String invalidPostUri = "/shoppingBaskets/" + UUID.randomUUID() + "/shoppingBasketPositions";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingBaskets/" + UUID.randomUUID().toString() + "/shoppingBasketPositions/" + goodId;
86:         String invalidCheckoutUri1 = "/shoppingBaskets/" + shoppingBasketId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingBaskets/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingGood() throws Exception {
107:         // given
108:         UUID goodId = (UUID) GOOD_DATA[3][0];
109:         String userEmailString = USER_EMAIL[7].toString();
110:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
111:         String invalidUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + goodId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingBasket() throws Exception {
121:         // given
122:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
123:         String userEmailString9 = USER_EMAIL[9].toString();
124:         String userEmailString7 = USER_EMAIL[7].toString();
125: 
126:         UUID shoppingBasketId9 = restHelper.getShoppingBasketId( userEmailString9 );
127:         UUID shoppingBasketId7 = restHelper.getShoppingBasketId( userEmailString7 );
128: 
129:         String baseUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/shoppingBasketPositions/";
130:         String checkoutUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingBaskets/" + shoppingBasketId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingBasketPositions(
137:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + goodId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingBasketPositions(
142:                 userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" good
145:         restHelper.addGoodToShoppingBasket( shoppingBasketId7, goodId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingBasket() throws Exception {
160:         // given
161:         String userEmailString = USER_EMAIL[2].toString();
162:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
163:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingBasketPositions(
170:                 userEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingBasket() throws Exception {
182:         // given
183:         String userEmailString = USER_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInInventory() throws Exception {
195:         // given
196:         String userEmailString = USER_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String userEmailString = USER_EMAIL[5].toString();
210:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
211:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String userEmailString = USER_EMAIL[1].toString();
229:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
230:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String userEmailString = USER_EMAIL[8].toString();
245:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
246:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingBasket() throws Exception {
259:         // given
260:         String userEmailString = USER_EMAIL[9].toString();
261:         UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
262:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForUser( String emailString, UUID goodId, Integer quantity ) throws Exception {
36:         UUID shoppingBasketId = getShoppingBasketId( emailString );
37:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity );
38:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingBasketId( String emailString ) throws Exception {
43:         // get the shopping basket and extract its id ...
44:         MvcResult shoppingBasket = mockMvc.perform( get( "/shoppingBaskets?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingBasket.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( goodId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity )
67:             throws Exception {
68:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleGoodsToShoppingBasket(
74:             String userEmailString, Integer[] goodIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingBasketId = getShoppingBasketId( userEmailString );
77:         String shoppingBasketUri = "shoppingBaskets?email=" + userEmailString;
78:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
79: 
80:         // add all the goods to the shopping basket ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < goodIndices.length; i++ ) {
84:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
85:             addGoodToShoppingBasket( shoppingBasketId, goodId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( goodIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( goodIndices[i], 0 ) );
89:                 commentMap.put( goodIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleGoodsToShoppingBasket(
96:             String userEmailString, Integer[] goodIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[goodIndices.length];
99:         for ( int i = 0; i < goodIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleGoodsToShoppingBasket( userEmailString, goodIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingBasketPositions( String userEmailString,
108:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingBasketId = getShoppingBasketId( userEmailString );
111:         String shoppingBasketUri = "/shoppingBaskets?email=" + userEmailString;
112:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
113: 
114:         // check that the shopping basket contains all the goods ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < goodIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingBasketUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each good has the correct quantity and comment ...
126:         for ( int i = 0; i < goodIndices.length; i++ ) {
127:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + goodId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + goodId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingBasketPositions( String userEmailString,
142:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[goodIndices.length];
145:         for ( int i = 0; i < goodIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingBasketPositions( userEmailString, goodIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPositionsInLatestOrder(
155:             String userEmailString, Integer[] goodIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + userEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < goodIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) GOOD_DATA[goodIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( userEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < goodIndices.length; i++ ) {
173:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderPositions.length()" ).value( goodIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID goodId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID goodId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID goodId, Integer quantity, String comment ) {
24:         this.goodId = goodId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPersonalAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionPersonalAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         ZipCodeType plz = instantiateZipCode( "12345" );
19: 
20:         // when
21:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getZipCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         ZipCodeType plz = instantiateZipCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiatePersonalAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         ZipCodeType plz = instantiateZipCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         ZipCodeType plz = instantiateZipCode( "12345" );
63: 
64:         // when
65:         PersonalAddressType instance1 = instantiatePersonalAddress( street, city, plz );
66:         PersonalAddressType instance2 = instantiatePersonalAddress( street, city, plz );
67:         PersonalAddressType instance3 = instantiatePersonalAddress( "Anderestr. 12", city, plz );
68:         PersonalAddressType instance4 = instantiatePersonalAddress( street, "AndereStadt", plz );
69:         PersonalAddressType instance5 = instantiatePersonalAddress( street, city, instantiateZipCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         ZipCodeType plz = instantiateZipCode( "12345" );
84: 
85:         // when
86:         PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setZipCode", ZipCodeType.class );
104:             fail( "setZipCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionZipCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionZipCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         ZipCodeType instance = instantiateZipCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateZipCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiateZipCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiateZipCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiateZipCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiateZipCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         ZipCodeType instance1 = instantiateZipCode( "12345" );
48:         ZipCodeType instance2 = instantiateZipCode( "12345" );
49:         ZipCodeType instance3 = instantiateZipCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         ZipCodeType instance = instantiateZipCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setzipCode", String.class );
65:             fail( "setzipCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionGoodCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionGoodCatalogTest {
22: 
23:     @Autowired
24:     private GoodCatalogUseCases goodCatalogUseCases;
25:     @Autowired
26:     private InventoryManagementUseCases inventoryManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddGoodToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllGoods();
41: 
42:         // when
43:         MoneyType sellingPrice = goodCatalogUseCases.getSellingPrice( (UUID) GOOD_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( GOOD_DATA[4][5], sellingPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveGoodFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllGoods();
53:         UUID goodId = (UUID) GOOD_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> goodCatalogUseCases.getSellingPrice( goodId ) );
57:         goodCatalogUseCases.removeGoodFromCatalog( goodId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSellingPrice( goodId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveGoodThatIsInInventory() {
68:         // given
69:         initialMasterDataCreator.addAllGoods();
70:         UUID goodId = (UUID) GOOD_DATA[4][0];
71:         inventoryManagementUseCases.addToInventory( goodId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> goodCatalogUseCases.removeGoodFromCatalog( goodId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearGoodCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllGoods();
83: 
84:         // when
85:         goodCatalogUseCases.deleteGoodCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSellingPrice( (UUID) GOOD_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_INVENTORY;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionInventoryManagementTest {
20: 
21:     @Autowired
22:     private InventoryManagementUseCases inventoryManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllGoods();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToInventory() {
37:         // given
38:         initialMasterDataCreator.inventoryUpAllGoods();
39:         UUID goodId8 = (UUID) GOOD_DATA[8][0];
40: 
41:         // when
42:         int inventory8before = inventoryManagementUseCases.getAvailableInventory( goodId8 );
43:         assertEquals( GOOD_INVENTORY.get( goodId8 ), inventory8before );
44:         inventoryManagementUseCases.addToInventory( goodId8, 22 );
45:         int inventory8after = inventoryManagementUseCases.getAvailableInventory( goodId8 );
46:         inventoryManagementUseCases.addToInventory( goodId8, 1 );
47:         int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( goodId8 );
48: 
49:         // then
50:         assertEquals( inventory8before + 22, inventory8after );
51:         assertEquals( inventory8after + 1, inventory8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromInventory() {
57:         // given
58:         initialMasterDataCreator.inventoryUpAllGoods();
59:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
60:         int inventory6before = GOOD_INVENTORY.get( goodId6 );
61:         UUID goodId9 = (UUID) GOOD_DATA[9][0];
62:         int inventory9before = GOOD_INVENTORY.get( goodId9 );
63:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
64:         int inventory1before = GOOD_INVENTORY.get( goodId1 );
65: 
66:         // when
67:         inventoryManagementUseCases.removeFromInventory( goodId6, 1 );
68:         int inventory6after = inventoryManagementUseCases.getAvailableInventory( goodId6 );
69:         inventoryManagementUseCases.removeFromInventory( goodId1, 3 );
70:         int inventory1after = inventoryManagementUseCases.getAvailableInventory( goodId1 );
71:         inventoryManagementUseCases.removeFromInventory( goodId9, inventory9before );
72:         int inventory9after = inventoryManagementUseCases.getAvailableInventory( goodId9 );
73: 
74:         // then
75:         assertEquals( inventory6before - 1, inventory6after );
76:         assertEquals( inventory1before - 3, inventory1after );
77:         assertEquals( 0, inventory9after );
78:     }
79: 
80: }
81: 

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionUserRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.UserType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionUserRegistrationTest {
25: 
26:     @Autowired
27:     private UserRegistrationUseCases userRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllUsersRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllUsers();
44: 
45:         // when
46:         UserType user3 = userRegistrationUseCases.getUserData( USER_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.USER_NAME[3], user3.getName() );
50:         Assertions.assertEquals( USER_EMAIL[3], user3.getEmail() );
51:         Assertions.assertEquals( USER_ADDRESS[3], user3.getPersonalAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterUserWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllUsers();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 userRegistrationUseCases.register( "Gandalf The Grey", USER_EMAIL[5],
64:                         USER_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterUserWithDuplicateNameOrPersonalAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllUsers();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 userRegistrationUseCases.register( initialMasterDataCreator.USER_NAME[2], newEmail,
77:                         USER_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteUsersNoMoreUsers() {
83:         // given
84:         initialMasterDataCreator.registerAllUsers();
85: 
86:         // when
87:         userRegistrationUseCases.deleteAllUsers();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> userRegistrationUseCases.getUserData( USER_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

[RESPONSE]:
**Review der Code-Smells**

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java**  
- FactoryMethodInvoker.java Zeilen 24-48, 51-79, 82-107, 110-135: Duplication (die vier Methoden instantiateEmail, instantiatePersonalAddress, instantiateZipCode und instantiateMoney sind strukturell identisch) : Der Code zur Reflexion und Fehlerbehandlung ist in allen vier Methoden dupliziert. Er könnte in eine gemeinsame Hilfsmethode ausgelagert werden.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java**  
- Anemic Entity : Die Domain-Klasse Delivery enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java**  
- Anemic Entity : Die Domain-Klasse Good enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java**  
- Anemic Entity : Die Domain-Klasse Order enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java**  
- Anemic Entity : Die Domain-Klasse OrderPosition enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java**  
- Anemic Entity : Die Domain-Klasse Payment enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java**  
- Anemic Entity : Die Domain-Klasse ShoppingBasket enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPosition.java**  
- Anemic Entity : Die Domain-Klasse ShoppingBasketPosition enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java**  
- Anemic Entity : Die Domain-Klasse User enthält nur Getter/Setter und keine Domänenlogik.

---

**C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserBasketInterface.java**  
- UserBasketInterface.java Zeilen 1-13: Dead Code : Die gesamte Datei ist auskommentiert und wird nicht verwendet.

---

**ENDE**
Generated by deepseek-reasoner
-----------------------------------