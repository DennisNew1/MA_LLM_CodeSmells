--- DATE: 8.1.2026, 20:27:16 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
    Architektur: 4-Layer (Eric Evans).
    Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
    Regeln:
    1. Begründe kurz jeden Fund.
    4. Gruppiere nach Datei (mit Pfad). 
    2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
    3. Keine Code-Wiederholung, nur Referenzen.
    5. Wenn fertig, schreibe "ENDE".



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.*;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import javax.persistence.*;

@Embeddable
@Getter
@Setter(AccessLevel.PROTECTED)
@EqualsAndHashCode
@NoArgsConstructor
@AllArgsConstructor
public class Address implements PersonalAddressType {

    private String street;
    private String city;

    @Embedded
    private ZipCode zipCode;

    public static Address of(String street, String city, ZipCodeType zipCode){
        if( street == null || city == null || zipCode == null ){
            throw new ShopException("street, city or zipcode is null");
        }
        if ( street.isEmpty() || city.isEmpty() ){
            throw new ShopException("street or city is empty");
        }
        return new Address(street, city, (ZipCode) zipCode);
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AllArgsConstructor;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import org.hibernate.validator.internal.constraintvalidators.bv.EmailValidator;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.persistence.Embeddable;
import javax.validation.constraints.NotNull;

@Embeddable
@AllArgsConstructor
@Getter
@NoArgsConstructor
@EqualsAndHashCode
public class Email implements EmailType {
    /**
     * @return the email as a string
     */
    private String emailString;

    public static Email of(String email){
        if ( email == null ){
            throw new ShopException("email is null");
        }
        final String emailRegex = "^[A-Za-z0-9]+([.-]?[A-Za-z0-9]+)*@[A-Za-z0-9]+([.-]?[A-Za-z0-9]+)*\\.(de|at|ch|com|org)$";
                        if ( !email.matches(emailRegex)){
            throw new ShopException("invalid format");
        }

        return new Email(email);
    }

    @Override
    public String toString() {
        return this.emailString;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.*;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.persistence.*;

@Getter
@Setter (AccessLevel.PROTECTED)
@EqualsAndHashCode
@Embeddable
@NoArgsConstructor
@AllArgsConstructor
public class Money implements MoneyType {
    /**
     * @return the amount of money
     */

    private Float amount;
    private String currency;

    //@Embedded
    //@AttributeOverrides({
    //        @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
    //        @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
    //})

    public static Money of(Float amount, String currency){
        if ( amount == null ){
            throw new ShopException("amount is null");
        }
        if ( currency == null ){
            throw new ShopException("currency is null");
        }
        if ( amount < 0){
            throw new ShopException("amount is too low");
        }
        if ( !currency.equals("EUR") && !currency.equals("CHF") ){
            throw new ShopException("currency is not EUR or CHF");
        }

        return new Money(amount, currency);
    }

    /**
     * @param otherMoney
     * @return this + otherMoney, as a new object
     * @throws ShopException if ...
     *                       - otherMoney is null
     *                       - otherMoney.currency != this.currency
     */
    @Override
    public MoneyType add(MoneyType otherMoney) {
        if ( otherMoney == null || otherMoney.getCurrency() != this.currency ){
            throw new ShopException("otherMoney is null or is unequal to currency");
        }
        Float add = otherMoney.getAmount() + this.amount;
        return new Money(add,this.currency);
    }

    /**
     * @param otherMoney
     * @return this - otherMoney, as a new object
     * @throws ShopException if ...
     *                       - otherMoney is null
     *                       - otherMoney.currency != this.currency
     *                       - otherMoney > this
     */
    @Override
    public MoneyType subtract(MoneyType otherMoney) {
        if ( otherMoney == null || otherMoney.getCurrency() != this.currency || otherMoney.getAmount() > this.amount){
            throw new ShopException("Money is null or unequal currency or given money is more");
        }
        Float substract = amount - otherMoney.getAmount();
        return new Money(substract,currency);
    }

    /**
     * @param factor
     * @return this * factor, as a new object
     * @throws ShopException if ...
     *                       - factor < 0
     */
    @Override
    public MoneyType multiplyBy(int factor) {
        if ( factor < 0 ){
            throw new ShopException("factor is larger than 0");
        }

        return new Money(this.amount * factor, this.currency);
    }

    /**
     * @param otherMoney
     * @return true, if this > otherMoney
     * @throws ShopException if ...
     *                       - otherMoney is null
     *                       - otherMoney.currency != this.currency
     */
    @Override
    public boolean largerThan(MoneyType otherMoney) {

        if ( otherMoney == null ){
            throw new ShopException("other money is null");
        }

        if ( otherMoney.getCurrency() != this.currency ){
            throw new ShopException("currency is unequal");
        }

        return this.amount > otherMoney.getAmount();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AllArgsConstructor;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import javax.persistence.Embeddable;

@Embeddable
@Getter
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode
public class ZipCode implements ZipCodeType {

    // public static ZipCodeType of( String zipCodeAsString );

    private String zipCode;

    public static ZipCode of(String zipCode){
        if ( zipCode == null ){
            throw new ShopException("zipcode is null");
        }
        if ( !zipCode.matches("\\d{5}$") || zipCode.endsWith("0000")){
            throw new ShopException("zipcode is invalid");
        }
        return new ZipCode(zipCode);
    }

    @Override
    public String toString(){
        return this.zipCode;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
package thkoeln.archilab.ecommerce.masterdata;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.io.File;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.net.URL;
import java.net.URLDecoder;
import java.nio.charset.StandardCharsets;
import java.util.Enumeration;

import static org.junit.jupiter.api.Assertions.*;

public class FactoryMethodInvoker {

    public static EmailType instantiateEmail( String emailAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for EmailType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, emailAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
        }
        assertNotNull( instance );
        return (EmailType) instance;
    }


    public static PersonalAddressType instantiatePersonalAddress(
            String street, String city, ZipCodeType zipCode ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of",
                    String.class, String.class, ZipCodeType.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for PersonalAddressType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, street, city, zipCode );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" +
                    street + "', '" + city + "', '" + zipCode + "'", e );
        }
        assertNotNull( instance );
        return (PersonalAddressType) instance;
    }


    public static ZipCodeType instantiateZipCode( String zipCodeAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for ZipCodeType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, zipCodeAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + zipCodeAsString + "'", e );
        }
        assertNotNull( instance );
        return (ZipCodeType) instance;
    }


    public static MoneyType instantiateMoney( Float amount, String currency ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for MoneyType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, amount, currency );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
        }
        assertNotNull( instance );
        return (MoneyType) instance;
    }


    private static Class<?> findImplementation( Class<?> interfaceClass ) {
        Method factoryMethod = null;
        try {
            String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
            Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
            assertNotNull( implementingClass );
            return implementingClass;
        } catch (Exception e) {
            fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
            return null; // This line will never be reached, but it's necessary to satisfy the compiler
        }
    }


    private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
            throws ClassNotFoundException, IOException {
        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        String path = packageName.replace( '.', '/' );
        Enumeration<URL> resources = classLoader.getResources( path );
        int count = 0;
        Class<?> result = null;
        while (resources.hasMoreElements()) {
            URL resource = resources.nextElement();
            File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
            File[] files = directory.listFiles();
            for ( File file : files ) {
                if ( file.getName().endsWith( ".class" ) ) {
                    String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
                    Class<?> clazz = Class.forName( className );
                    if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
                        count++;
                        result = clazz;
                    }
                }
            }
        }
        assertEquals( 1, count, "There should be exactly one implementing class" );
        return result;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;
import thkoeln.archilab.ecommerce.usecases.*;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;
import java.util.UUID;


/**
 * This class is used to create the initial master data for the application. This includes
 * users and goods. It is executed on application startup, and is used for testing purposes.
 */
@Component
@SuppressWarnings("PMD")
public class InitialMasterDataCreator {

    public final static String[] USER_NAME = new String[]{
            "Max Müller",
            "Sophie Schmitz",
            "Irene Mihalic",
            "Emilia Fischer",
            "Filiz Polat",
            "Lina Wagner",
            "Leon Becker",
            "Agnieszka Kalterer",
            "Felix Bauer",
            "Lara Schulz"
    };
    public final static EmailType[] USER_EMAIL = new EmailType[] {
            FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
            FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
            FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
            FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
            FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
    };

    public final static PersonalAddressType[] USER_ADDRESS = new PersonalAddressType[] {
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Hauptstraße 1", "Berlin",
                    FactoryMethodInvoker.instantiateZipCode( "10115" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Bahnhofstraße 12", "München",
                    FactoryMethodInvoker.instantiateZipCode( "80331" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Kirchplatz 3", "Hamburg",
                    FactoryMethodInvoker.instantiateZipCode( "20095" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Goethestraße 7", "Frankfurt am Main",
                    FactoryMethodInvoker.instantiateZipCode( "60311" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Mühlenweg 15", "Köln",
                    FactoryMethodInvoker.instantiateZipCode( "50667" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Schulstraße 9", "Düsseldorf",
                    FactoryMethodInvoker.instantiateZipCode( "40213" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Dorfstraße 21", "Stuttgart",
                    FactoryMethodInvoker.instantiateZipCode( "70173" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Marktstraße 5", "Leipzig",
                    FactoryMethodInvoker.instantiateZipCode( "04109" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Rosenweg 14", "Dortmund",
                    FactoryMethodInvoker.instantiateZipCode( "44135" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Wiesenstraße 6", "Essen",
                    FactoryMethodInvoker.instantiateZipCode( "45127" ) )
    };

    public final static UserType[] mockUsers;

    public static final String EUR = "EUR";

    public static final Object[][] GOOD_DATA = new Object[][]{
            {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
                    1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
            {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
                    0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
            {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
                    7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
            {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
                    null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
            {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
                    null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
            {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
                    1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
            {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
                    null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
            {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
                    6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
            {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
                    3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
            {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
                    5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
            {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
                    4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
            {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
                    null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
            {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
                    null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
            {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
                    3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
    };

    private UserRegistrationUseCases userRegistrationUseCases;
    private GoodCatalogUseCases goodCatalogUseCases;
    private InventoryManagementUseCases inventoryManagementUseCases;
    private ShoppingBasketUseCases shoppingBasketUseCases;


    // good 0 is out of inventory, good 1 and 2 have fixed quantities of 10 and 20, respectively, and the
    // others have a random inventory between 5 and 100
    public static final Map<UUID, Integer> GOOD_INVENTORY = new HashMap<>();

    static {
        mockUsers = new UserType[USER_NAME.length];
        for ( int i = 0; i < USER_NAME.length; i++ ) {
            mockUsers[i] = new MockUser(
                    USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i]);
        }
        Random random = new Random();
        for ( Object[] goodData : GOOD_DATA ) {
            GOOD_INVENTORY.put( (UUID) goodData[0], random.nextInt( 100 ) + 20 );
        }
        GOOD_INVENTORY.put( (UUID) GOOD_DATA[0][0], 0 );
        GOOD_INVENTORY.put( (UUID) GOOD_DATA[1][0], 10 );
        GOOD_INVENTORY.put( (UUID) GOOD_DATA[2][0], 20 );
        GOOD_INVENTORY.put( (UUID) GOOD_DATA[3][0], 30 );

    }


    public enum InvalidReason {
        NULL, EMPTY;

        public Object getInvalidValue( Object originalValue ) {
            switch (this) {
                case NULL:
                    return null;
                case EMPTY:
                    return "";
                default:
                    return null;
            }
        }
    }


    @Autowired
    public InitialMasterDataCreator(
            UserRegistrationUseCases userRegistrationUseCases,
            GoodCatalogUseCases goodCatalogUseCases,
            InventoryManagementUseCases inventoryManagementUseCases,
            ShoppingBasketUseCases shoppingBasketUseCases ) {
        this.userRegistrationUseCases = userRegistrationUseCases;
        this.goodCatalogUseCases = goodCatalogUseCases;
        this.inventoryManagementUseCases = inventoryManagementUseCases;
        this.shoppingBasketUseCases = shoppingBasketUseCases;
    }


    public void deleteAll() {
        shoppingBasketUseCases.deleteAllOrders();
        goodCatalogUseCases.deleteGoodCatalog();
        userRegistrationUseCases.deleteAllUsers();
    }


    public void registerAllUsers() {
        for ( int i = 0; i < InitialMasterDataCreator.USER_NAME.length; i++ ) {
            registerUser( InitialMasterDataCreator.USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i] );
        }
    }


    public void registerUser( String name, EmailType email, PersonalAddressType personalAddress ) {
        userRegistrationUseCases.register( name, email, personalAddress );
    }

    public void addAllGoods() {
        for ( Object[] goodData : GOOD_DATA ) {
            addGoodDataToCatalog( goodData );
        }
    }

    public void addGoodDataToCatalog( Object[] goodData ) {
        goodCatalogUseCases.addGoodToCatalog( (UUID) goodData[0], (String) goodData[1], (String) goodData[2],
                (Float) goodData[3], (MoneyType) goodData[4], (MoneyType) goodData[5] );
    }


    public Object[] getGoodDataInvalidAtIndex( int index, InvalidReason reason ) {
        Object[] goodData = GOOD_DATA[1];
        Object[] goodDataInvalid = new Object[goodData.length];
        System.arraycopy( goodData, 0, goodDataInvalid, 0, goodData.length );
        goodDataInvalid[index] = goodData[index].getClass().cast(
                reason.getInvalidValue( goodData[index] ) );
        return goodDataInvalid;
    }


    public void inventoryUpAllGoods() {
        for ( Object[] goodData : GOOD_DATA ) {
            if ( GOOD_INVENTORY.get( goodData[0] ) > 0 )
                inventoryManagementUseCases.addToInventory( (UUID) goodData[0], GOOD_INVENTORY.get( goodData[0] ) );
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockUser.java ---
package thkoeln.archilab.ecommerce.masterdata;

import lombok.Setter;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

import java.util.Objects;

@Setter
public class MockUser implements UserType {
    private String name;
    private EmailType email;
    private PersonalAddressType personalAddress;


    public MockUser( String name, EmailType email, PersonalAddressType personalAddress) {
        this.name = name;
        this.email = email;
        this.personalAddress = personalAddress;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public EmailType getEmail() {
        return email;
    }

    @Override
    public PersonalAddressType getPersonalAddress() {
        return personalAddress;
    }

    @Override
    public boolean equals( Object o ) {
        if ( this == o ) return true;
        if ( !( o instanceof MockUser ) ) return false;
        MockUser that = (MockUser) o;
        return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( personalAddress, that.personalAddress );
    }

    @Override
    public int hashCode() {
        return Objects.hash( getName(), email, personalAddress );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;

@Component
@Profile("!test")
public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
    private Logger logger = LoggerFactory.getLogger( StartupListener.class );

    private InitialMasterDataCreator initialMasterDataCreator;

    @Autowired
    public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
        this.initialMasterDataCreator = initialMasterDataCreator;
    }

    @Override
    public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
        logger.info( "Initializing master data..." );
        initialMasterDataCreator.registerAllUsers();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
package thkoeln.archilab.ecommerce;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;


@SpringBootApplication
public class ProjectApplication {

	/**
	 * Entry method
	 * @param args
	 */
	public static void main(String[] args) {
		SpringApplication.run(ProjectApplication.class, args);
	}
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
package thkoeln.archilab.ecommerce;

public class ShopException extends RuntimeException {
    public ShopException( String message ) {
        super( message );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
package thkoeln.archilab.ecommerce.solution.delivery.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@Service
public class DeliveryService implements DeliveryUseCases {

    @Autowired
    DeliveryRepository deliveryRepository;
    @Autowired
    UserRepository userRepository;


    @Override
    public UUID triggerDelivery(UserType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
        if ( deliveryRecipient == null ){
            throw new ShopException("deliveryRecipient is null");
        }

        UserType user = deliveryRecipient;

        if ( user.getPersonalAddress().getCity() == null || user.getPersonalAddress().getCity().isEmpty()
                || user.getPersonalAddress().getStreet() == null || user.getPersonalAddress().getStreet().isEmpty()
                || user.getPersonalAddress().getZipCode() == null || user.getPersonalAddress().getZipCode().toString().isEmpty()
                || user.getEmail() == null || user.getEmail().toString().isEmpty()
                || user.getName() == null || user.getName().isEmpty() ){
            throw new ShopException("deliveryRecipient Methods null or empty");
        }

        if ( deliveryContent == null || deliveryContent.isEmpty() ){
            throw new ShopException("deliveryContent is null or empty");
        }

        int counter = 0;
        for ( Map.Entry<UUID, Integer> entry : deliveryContent.entrySet() ){
            counter= entry.getValue() + counter;
        }
        if ( counter > 20 ){
            throw new ShopException("total number of goods is over 20");
        }

        Delivery delivery = new Delivery();
        Email email = (Email)user.getEmail();
        User userUpdate = userRepository.findByEmail(email);

        delivery.setUser(userUpdate);
        delivery.setDeliveryMap(deliveryContent);
        deliveryRepository.save(delivery);
        return delivery.getUuid();
    }


    //NEW
    @Override
    public Map<UUID, Integer> getDeliveryHistory(EmailType userEmail) {
        User user = userRepository.findByEmail(userEmail);
        if ( userEmail == null || userEmail.toString().isEmpty() ){
            throw new ShopException("userEmail is null or empty");
        }

        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        Map<UUID, Integer> deliveryHistory = new HashMap<>();
        List<Delivery> deliveryList = deliveryRepository.findByUser(user);

        for ( Delivery deliveryIterator : deliveryList ){
            Map<UUID, Integer> deliveryMap = deliveryIterator.getDeliveryMap();
            for ( UUID goodId : deliveryMap.keySet()){
                Integer quantity = deliveryMap.get(goodId);
                if ( deliveryHistory.containsKey(goodId) ){
                    deliveryHistory.put(goodId, deliveryHistory.get(goodId)+deliveryIterator.getDeliveryMap().get(goodId));
                } else {
                    deliveryHistory.put(goodId, deliveryIterator.getDeliveryMap().get(goodId));
                }
            }
        }

        return deliveryHistory;
    }

    /**
     * Deletes all delivery history.
     */
    @Override
    public void deleteDeliveryHistory() {
        deliveryRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.persistence.*;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

@Getter
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class Delivery {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    @ElementCollection
    private Map<UUID, Integer> deliveryMap = new HashMap<>();

    @Setter
    @ManyToOne
    private User user;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import java.util.List;
import java.util.UUID;

public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
    public List<Delivery> findByUser(User user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodService.java ---
package thkoeln.archilab.ecommerce.solution.good.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.good.GoodInterfaceShoppingBasket;
import thkoeln.archilab.ecommerce.solution.good.GoodOrderPositionInterface;
import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;
import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.Optional;
import java.util.UUID;
import java.util.stream.StreamSupport;

@Service
public class GoodService implements GoodCatalogUseCases, InventoryManagementUseCases {
    @Autowired
    GoodRepository goodRepository;
    @Autowired
    UserRepository userRepository;
    @Autowired
    GoodOrderPositionInterface goodOrderPositionInterface;
    @Autowired
    GoodInterfaceShoppingBasket goodInterface;


    /**
     * Adds a new good to the shop catalog
     *
     * @param goodId
     * @param name
     * @param description
     * @param size
     * @param purchasePrice
     * @param sellingPrice
     * @throws ShopException if ...
     *                       - goodId is null,
     *                       - the good with that id already exists,
     *                       - name or description are null or empty,
     *                       - the size is <= 0 (but can be null!),
     *                       - the purchase price is null,
     *                       - the selling price is null,
     *                       - the selling price is lower than the purchase price
     */
    @Override
    public void addGoodToCatalog(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellingPrice) {
        if (goodId == null) {
            throw new ShopException("goodId is null");
        }
        if (goodRepository.findByUuid(goodId) != null) {
            throw new ShopException("good already exists");
        }
        if (name == null || name.isEmpty() || description == null || description.isEmpty()) {
            throw new ShopException("Description/Name must be filled");
        }
        if (size != null && size <= 0) {
            throw new ShopException("size is too small");
        }
        if (purchasePrice == null || purchasePrice.getAmount() <= 0) {
            throw new ShopException("purchase price incorrect");
        }
        if (sellingPrice == null || sellingPrice.getAmount() < 0) {
            throw new ShopException("selling price incorrect");
        }
        if (sellingPrice.getAmount() < purchasePrice.getAmount()) {
            throw new ShopException("selling price is lower than purchase price");
        }

        Good good = new Good(goodId, name, description, size, (Money) purchasePrice, (Money) sellingPrice);
        goodRepository.save(good);
    }

    @Override
    public void removeGoodFromCatalog(UUID goodId) {
        /**
         * Removes a good from the shop catalog
         * @param goodId
         * @throws ShopException if
         *      - the good id does not exist
         *      - the good is still in inventory
         *      - the good is still reserved in a shopping basket, or part of a completed order
         */
        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("Good not found");
        }
        if (good.getQuantity() > 0) {
            throw new ShopException("Product is in inventory");
        }
        if (goodInterface.getReservedInventoryInShoppingBaskets(goodId) > 0) {
            throw new ShopException("removed Quantity is too high");
        }
        if (goodOrderPositionInterface.findByGood(good) != null) {
            throw new ShopException("good is already in order");
        }
        goodRepository.delete(good);

    }

    /**
     * Get the selling price of a given good
     *
     * @param goodId
     * @return the selling price
     * @throws ShopException if ...
     *                       - goodId is null,
     *                       - the good with that id does not exist
     */
    @Override
    public MoneyType getSellingPrice(UUID goodId) {
        ///**
        // * Get the selling price of a given good
        // * @param goodId
        // * @return the selling price
        // * @throws ShopException if the good id does not exist
        // */
        if (goodRepository.findByUuid(goodId) == null) {
            throw new ShopException("Good doe not exist");
        }
        return goodRepository.findByUuid(goodId).getSellingPrice();
    }

    @Override
    public void deleteGoodCatalog() {
        /**
         * Clears the good catalog, i.e. removes all goods from the catalog, including all the inventory,
         * all the reservations and all the orders.
         */
        goodRepository.deleteAll();
    }

    @Override
    public void addToInventory(UUID goodId, int addedQuantity) {
        /**
         * Adds a certain quantity of a given good to the inventory
         * @param goodId
         * @param addedQuantity
         * @throws ShopException if the good id does not exist, or if the added quantity is negative
         */
        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("good does not exist");
        }
        if (addedQuantity <= 0) {
            throw new ShopException("good quantity is negative");
        }
        int oldQuantity = good.getQuantity();
        int newQuantity = oldQuantity + addedQuantity;
        if (newQuantity < oldQuantity) {
            throw new ShopException("too much quantity");
        }
        good.setQuantity(newQuantity);
        goodRepository.save(good);
    }

    @Override
    public void removeFromInventory(UUID goodId, int removedQuantity) {

        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("good id does not exist");
        }
        if (removedQuantity <= 0) {
            throw new ShopException("removedQuantity is too low");
        }
        if (removedQuantity > (good.getQuantity() + goodInterface.getReservedInventoryInShoppingBaskets(goodId))) {
            throw new ShopException("removedQuantity is too high");
        }

        Integer gesamt = removedQuantity - good.getQuantity();
        good.setQuantity(good.getQuantity() - removedQuantity);
        if (good.getQuantity() < 0) {
            good.setQuantity(0);
            Iterable<ShoppingBasketType> baskets = goodInterface.findAll();
            for (ShoppingBasketType basket : baskets) {
                if (basket.getGoods().containsKey(goodId)) {
                    while (gesamt > 0 && basket.getGoods().get(goodId) > 0) {
                        gesamt -= 1;
                        basket.getGoods().put(goodId, basket.getGoods().get(goodId) - 1);
                        goodInterface.saveShoppingBasket(basket);
                    }
                }
            }
        }
        goodRepository.save(good);
    }

    @Override
    public void changeInventoryTo(UUID goodId, int newTotalQuantity) {
        Good good = Optional.ofNullable(goodRepository.findByUuid(goodId))
                .orElseThrow(() -> new ShopException("good does not exist"));

        if (newTotalQuantity < 0) {
            throw new ShopException("newTotalQuantity is negative");
        }

        final Integer[] gesamt = {goodInterface.getReservedInventoryInShoppingBaskets(goodId) - newTotalQuantity};
        if (gesamt[0] > 0) {
            StreamSupport.stream(goodInterface.findAll().spliterator(), false)
                    .filter(basket -> basket.getGoods().containsKey(goodId))
                    .forEach(basket -> {
                        while (gesamt[0] > 0 && basket.getGoods().get(goodId) > 0) {
                            gesamt[0]--;
                            basket.getGoods().put(goodId, basket.getGoods().get(goodId) - 1);
                            goodInterface.saveShoppingBasket(basket);
                        }
                    });
        }
        good.setQuantity(newTotalQuantity);
        goodRepository.save(good);
    }

    @Override
    public int getAvailableInventory(UUID goodId) {
        /**
         * Get the current total inventory of a given good, including the currently reserved goods
         * @param goodId
         * @throws ShopException if the good id does not exist
         */
        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("good does not exist");
        }
        return good.getQuantity();
    }

}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java ---
package thkoeln.archilab.ecommerce.solution.good.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;

import javax.persistence.*;
import java.util.UUID;

@Getter
@Entity
@NoArgsConstructor
public class Good {

    @Id
    private UUID uuid;

    @Setter
    private String name;

    @Setter
    private String description;

    @Setter
    private Float size;


    @Setter
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
            @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
    })
    private Money purchasePrice;

    @Setter
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name="amount", column= @Column(name="sellingAmount")),
            @AttributeOverride(name="currency", column= @Column(name="sellingCurrency"))
    })
    private Money sellingPrice;

    @Setter
    private Integer quantity;

    @Setter
    String comment;

    public Good ( UUID uuid, String name, String description, Float size, Money purchasePrice, Money
            sellingPrice){
        this.uuid = uuid;
        this.name = name;
        this.description = description;
        this.size = size;
        this.purchasePrice = purchasePrice;
        this.sellingPrice = sellingPrice;
        quantity = 0;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\GoodRepository.java ---
package thkoeln.archilab.ecommerce.solution.good.domain;

import org.springframework.data.repository.CrudRepository;

import java.util.UUID;

public interface GoodRepository extends CrudRepository<Good, UUID> {
    Good findByUuid(UUID uuid);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\GoodInterfaceShoppingBasket.java ---
package thkoeln.archilab.ecommerce.solution.good;

import java.util.List;
import java.util.UUID;

public interface GoodInterfaceShoppingBasket {
    public int getReservedInventoryInShoppingBaskets(UUID goodId);
    public void saveShoppingBasket(ShoppingBasketType shoppingBasket);

    public ShoppingBasketType getShoppingBasket(UUID shoppingBasketId);

    public List<ShoppingBasketType> findAll();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\GoodOrderPositionInterface.java ---
package thkoeln.archilab.ecommerce.solution.good;

import thkoeln.archilab.ecommerce.solution.good.domain.Good;

public interface GoodOrderPositionInterface {
    public OrderPositionType findByGood(Good good);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\OrderPositionType.java ---
package thkoeln.archilab.ecommerce.solution.good;

public interface OrderPositionType {
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\ShoppingBasketType.java ---
package thkoeln.archilab.ecommerce.solution.good;

import java.util.Map;
import java.util.UUID;

public interface ShoppingBasketType {
    public Map<UUID, Integer> getGoods();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderApplicationService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.order.domain.*;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;


import java.util.*;
import java.util.function.Function;
import java.util.function.Supplier;
import java.util.stream.Collectors;
import java.util.stream.Stream;


@Service
public class OrderApplicationService {
    @Autowired
    OrderRepository orderRepository;
    @Autowired
    OrderPositionRepository orderPositionRepository;
    @Autowired
    OrderService orderService;
    @Autowired
    UserRepository userRepository;

    public List<OrderDTO> findLatestCustomer(String email) {
        if (email == null) {
            throw new OrderException("email not found. (findLatestCustomer 1)");
        }

        User user = userRepository.findByEmail(Email.of(email));
        if (user == null) {
            return Collections.emptyList();
        }

        return Optional.ofNullable(orderRepository.findByUser(user))
                .map(orders -> orders.get(orders.size() - 1))
                .map(latestOrder -> {
                    OrderDTO latestOrderDTO = new OrderDTO();
                    latestOrderDTO.setId(latestOrder.getUuid());
                    latestOrderDTO.setOrderPositions(
                            latestOrder.getOrderPositions().stream()
                                    .map(orderPosition -> {
                                        OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
                                        orderPositionDTO.setGoodId(orderPosition.getGood().getUuid());
                                        orderPositionDTO.setQuantity(orderPosition.getQuantity());
                                        orderPositionDTO.setComment(orderPosition.getComment());
                                        return orderPositionDTO;
                                    })
                                    .collect(Collectors.toList())
                    );
                    latestOrderDTO.setEmail(latestOrder.getUser().getEmail());
                    latestOrderDTO.setPrice(totalPriceMethod(latestOrder));
                    return Collections.singletonList(latestOrderDTO);
                })
                .orElse(Collections.emptyList());
    }

    public List<OrderDTO> findAllCustomer(String email) {
        if ( email == null ){
            return new ArrayList<OrderDTO>();
        }
        try {
            userRepository.findByEmail(Email.of(email));
        } catch (Exception e){
            return new ArrayList<OrderDTO>();
        }

        User user = userRepository.findByEmail(Email.of(email));
        if (user == null) {
            return new ArrayList<OrderDTO>();
        }
        List<Order> orders = orderRepository.findByUser(user);

        List<OrderDTO> orderDTOs = new ArrayList<>();

        for (Order order : orders) {
            List<OrderPositionDTO> orderPositionDTOs = new ArrayList<>();
            for (OrderPosition orderPosition : order.getOrderPositions()) {
                OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
                orderPositionDTO.setGoodId(orderPosition.getGood().getUuid());
                orderPositionDTO.setQuantity(orderPosition.getQuantity());
                orderPositionDTO.setComment(orderPosition.getComment());
                orderPositionDTOs.add(orderPositionDTO);
            }

            OrderDTO orderDTO = new OrderDTO();
            orderDTO.setId(order.getUuid());
            orderDTO.setOrderPositions(orderPositionDTOs);
            orderDTO.setEmail(order.getUser().getEmail());
            orderDTO.setPrice( (Money) totalPriceMethod2(order));

            orderDTOs.add(orderDTO);
        }
        return orderDTOs;
    }

    public Money totalPriceMethod (Order order){
        List<OrderPosition> list = order.getOrderPositions();
        Money totalPriceVariable = Money.of(0f, "EUR");

        for (OrderPosition orderPosition : order.getOrderPositions()){
            Money sellingPrice = orderPosition.getGood().getSellingPrice();
            Integer quantity = orderPosition.getQuantity();

            Money quantityPrice = (Money) sellingPrice.multiplyBy(quantity);

            totalPriceVariable =  (Money) totalPriceVariable.add(quantityPrice);
        }
        return totalPriceVariable;
    }


    public Money totalPriceMethod2 (Order order){
        List<OrderPosition> list = order.getOrderPositions();

        if (list.isEmpty()) {
            throw new OrderException("Order has no positions.");
        }

        OrderPosition lastOrderPosition = list.get(list.size() - 1);
        Money sellingPrice = lastOrderPosition.getGood().getSellingPrice();
        Integer quantity = lastOrderPosition.getQuantity();

        Money quantityPrice = (Money) sellingPrice.multiplyBy(quantity);

        return quantityPrice;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderController.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPositionRepository;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.ShoppingBasketApplicationService;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;
import java.util.stream.StreamSupport;

@RestController
public class OrderController {
    @Autowired
    OrderApplicationService orderApplicationService;
    @Autowired
    OrderRepository orderRepository;
    @Autowired
    OrderPositionRepository orderPositionRepository;
    @Autowired
    OrderService orderService;

    @Autowired
    public OrderController(OrderApplicationService orderApplicationService,
                                    OrderRepository orderRepository){
        this.orderApplicationService = orderApplicationService;
        this.orderRepository = orderRepository;
    }

    @GetMapping("/orders")
    public List<OrderDTO> getProducts(@RequestParam(required = false) String email,
                                      @RequestParam(required = false) String filter){
        if ("latest".equals(filter)){
            return orderApplicationService.findLatestCustomer(email);
        }
        else {
            return orderApplicationService.findAllCustomer(email);
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.persistence.Entity;
import java.util.List;
import java.util.UUID;

@AllArgsConstructor
@NoArgsConstructor
@Getter
@Setter
public class OrderDTO {
    private UUID id;
    private List<OrderPositionDTO> orderPositions;
    private Email email;
    private Money price;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderException.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;
import thkoeln.archilab.ecommerce.ShopException;

@ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "not found")
public class OrderException extends ShopException {
    public OrderException(String message){
        super(message);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDTO.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;

import java.util.UUID;

@NoArgsConstructor
@AllArgsConstructor
@Setter
@Getter
public class OrderPositionDTO {
    private UUID goodId;
    private Integer quantity;
    private String comment = null;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.good.GoodOrderPositionInterface;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPositionRepository;

@Service
public class OrderService implements GoodOrderPositionInterface {
    @Autowired
    OrderPositionRepository orderPositionRepository;

    @Override
    public OrderPosition findByGood(Good good) {
        return orderPositionRepository.findByGood(good);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.persistence.*;
import java.util.List;
import java.util.UUID;

@Getter
@Entity
@Table( name = "UOrder")
@NoArgsConstructor
@AllArgsConstructor
public class Order {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    @OneToMany
    private List<OrderPosition> orderPositions;

    @Setter
    @ManyToOne
    private User user;

    @Setter
    @OneToOne
    private Payment payment;

//    @Setter
//    private Money totalPrice;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.good.OrderPositionType;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;

import javax.persistence.*;
import java.util.UUID;

@Getter
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class OrderPosition implements OrderPositionType {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    private Integer quantity;

    @Setter
    @ManyToOne
    private Good good;

    @Setter
    private String comment;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPositionRepository.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;

import java.util.UUID;

public interface OrderPositionRepository extends CrudRepository<OrderPosition, UUID> {
    OrderPosition findByGood(Good good);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import java.util.List;
import java.util.UUID;

public interface OrderRepository extends CrudRepository<Order, UUID> {
    public List<Order> findByUser(User user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderStatus.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

public enum OrderStatus {
    EMPTY, FILLED, PAYMENT_AUTHORIZED, DELIVERY_TRIGGERED
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
package thkoeln.archilab.ecommerce.solution.payment.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.List;
import java.util.UUID;

@Service
public class PaymentService implements PaymentUseCases {
    @Autowired
    GoodRepository goodRepository;
    @Autowired
    UserRepository userRepository;

    @Autowired
    DeliveryRepository deliveryRepository;

    @Autowired
    PaymentRepository paymentRepository;


    /**
     * Authorizes a payment from a bank card for a given amount
     *
     * @param userEmail
     * @param amount
     * @return the id of the payment, if successfully authorized
     * @throws ShopException if ...
     *                       - userEmail is null
     *                       - the amount is null
     *                       - the amount is 0.00 EUR
     *                       - the payment cannot be processed, because it is over the limit of 500.00 EUR
     */
    @Override
    public UUID authorizePayment(EmailType userEmail, MoneyType amount) {
        User user = userRepository.findByEmail(userEmail);

        if ( userEmail == null || userEmail.toString().isEmpty() ){
            throw new ShopException("userEmail is empty or null");
        }

        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        if ( amount == null ){
            throw new ShopException("amount is null");
        }

        if ( amount.getAmount() <= 0.00 ){
            throw new ShopException("amount is too low");
        }

        Payment payment = new Payment();

        payment.setUser(user);
        payment.setAmount(amount.getAmount());
        if ( payment.getAmount() > 500.0 ){
            throw new ShopException("amount is too low");
        }
        paymentRepository.save(payment);
        return payment.getUuid();
    }

    /**
     * Returns the total amount of payments (over the complete history) for a user
     * (identified by his/her email)
     *
     * @param userEmail
     * @return the total amount of payments made using this bank card, or 0.00 EUR if there
     * weren't any payments yet.
     * @throws ShopException if ...
     *                       - userEmail is null
     */
    @Override
    public MoneyType getPaymentTotal(EmailType userEmail) {
        User user = userRepository.findByEmail(userEmail);
        if ( userEmail == null || userEmail.toString().isEmpty() ){
            throw new ShopException("user mail is null oder empty");
        }

        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        List<Payment> paymentList = paymentRepository.findPaymentsByUser(user);
        float counter = 0;
        for ( Payment p : paymentList ){
            counter += p.getAmount();
        }
        Money totalMoney = new Money(counter, "EUR");
        return totalMoney;
    }

    /**
     * Deletes all payment history, for all users.
     */
    @Override
    public void deletePaymentHistory() {
        paymentRepository.deleteAll();
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.persistence.*;
import java.util.UUID;

@Getter
@NoArgsConstructor
@AllArgsConstructor
@Entity
public class Payment {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name = "amount", column = @Column(name = "paymentAmount")),
            @AttributeOverride(name = "currency", column = @Column(name = "paymentCurrency"))
    })
    private Money paymentMoney;

    @Setter
    private Float amount;

    @Setter
    @ManyToOne
    private User user;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import java.util.List;
import java.util.UUID;

public interface PaymentRepository extends CrudRepository<Payment, UUID> {
    Payment findByUser(User user);
    public List<Payment> findPaymentsByUser(User user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketApplicationService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseStatus;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;
import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
import thkoeln.archilab.ecommerce.solution.order.domain.*;
import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPosition;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPositionRepository;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.validation.constraints.NotNull;
import java.util.*;

@Service
public class ShoppingBasketApplicationService {
    @Autowired
    ShoppingBasketRepository shoppingBasketRepository;
    @Autowired
    ShoppingBasketService shoppingBasketService;
    @Autowired
    ShoppingBasketPositionRepository shoppingBasketPositionRepository;
    @Autowired
    PaymentService paymentService;
    @Autowired
    OrderRepository orderRepository;
    @Autowired
    GoodRepository goodRepository;
    @Autowired
    OrderPositionRepository orderPositionRepository;
    @Autowired
    DeliveryService deliveryService;
    @Autowired
    UserRepository userRepository;

    private Email email;


    @ResponseStatus(HttpStatus.NOT_FOUND)
    public ShoppingBasketDTO getShoppingBasketAsDTO(String email) {
        System.out.println("end");
        try {
            ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUserEmail(Email.of(email));
            if (shoppingBasket == null) {
                throw new ShoppingBasketNOTFOUND("not found (getShoppingBasketAsDTO 1)");
            }


            ModelMapper modelMapper = new ModelMapper();
            ShoppingBasketDTO shoppingBasketDTO = modelMapper.map(shoppingBasket, ShoppingBasketDTO.class);


            shoppingBasketDTO.setGoods(shoppingBasket.getGoods());
            shoppingBasketDTO.setId(shoppingBasket.getUuid());
            shoppingBasketDTO.setOrderStatus(shoppingBasket.getOrderStatus());
            shoppingBasketDTO.setUserId(shoppingBasket.getUser().getUuid());

            int totalQuantity = shoppingBasket.getGoods().values().stream()
                    .mapToInt(Integer::intValue)
                    .sum();
            shoppingBasketDTO.setTotalQuantity(totalQuantity);

            return ResponseEntity.ok(shoppingBasketDTO).getBody();
        } catch (ShopException e) {
            throw new ShoppingBasketNOTFOUND("Nout found. (getShoppingBasketAsDTO 2)");
        }
    }

    public ShoppingBasketPositionDTO getShoppingBasketPosition(UUID shoppingBasketId, UUID goodId){

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
                .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found. (getShoppingBasketPosition 1)"));

        ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
        if ( position == null ){
            throw new ShoppingBasketNOTFOUND("not found (getShoppingBasketPosition 2)");
        }
        ModelMapper modelMapper = new ModelMapper();
        return modelMapper.map(position, ShoppingBasketPositionDTO.class);
    }


    public void deleteShoppingBasketPosition(UUID shoppingBasketId, UUID goodId){
        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
                .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found. (delete ShoppingBasketPosition 1)"));

        ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
        if (position == null){
            throw new ShoppingBasketNOTFOUND("not found (delete ShoppingBasketPosition 2)");
        }

        Integer quantityBeforeDeletion = position.getQuantity();

        shoppingBasketPositionRepository.delete(position);

        Map<UUID, Integer> goodsMap = shoppingBasket.getGoods();
        if (goodsMap.containsKey(goodId)){
            goodsMap.remove(goodId);
        }
        shoppingBasket.setGoods(goodsMap);
        shoppingBasketRepository.save(shoppingBasket);

        Good g = goodRepository.findByUuid(goodId);
        if (g != null) {
            g.setQuantity(g.getQuantity() + quantityBeforeDeletion);
            goodRepository.save(g);
        } else {
            throw new ShoppingBasketNOTFOUND("Good not found in repository (delete ShoppingBasketPosition 3)");
        }
    }



    public void checkoutShoppingBasket(UUID shoppingBasketId){
        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
                .orElseThrow(() -> new ShoppingBasketNOTFOUND("Shopping basket not found.(checkout)"));

        EmailType userEmail = shoppingBasket.getUser().getEmail();

        shoppingBasketService.checkout(userEmail);
    }
    public ShoppingBasketPositionDTO addRemove(UUID shoppingBasketId, ShoppingBasketPositionDTO inputShoppingBasketPositionDTO) {
        UUID goodId = inputShoppingBasketPositionDTO.getGoodId();
        Integer quantity = inputShoppingBasketPositionDTO.getQuantity();
        String comment = inputShoppingBasketPositionDTO.getComment();

        if (quantity == null) {
            throw new IllegalArgumentException("Quantity must not be null");
        }

        Optional<ShoppingBasket> shoppingBasketOptional = shoppingBasketRepository.findById(shoppingBasketId);

        if (!shoppingBasketOptional.isPresent()) {
            throw new ShoppingBasketNOTFOUND("Shopping basket not found. (addRemove)");
        }

        ShoppingBasket shoppingBasket = shoppingBasketOptional.get();
        User user = shoppingBasket.getUser();
        Map<UUID, Integer> goods = shoppingBasket.getGoods();

        Integer availableInventory = goodRepository.findByUuid(goodId).getQuantity();
        if (quantity > availableInventory) {
            throw new ShoppingBasketCONFLICT("there is not enough goods");
        }
        if (quantity == 0) {
            ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
            shoppingBasketPositionRepository.delete(position);
        } else if (quantity < 0) {
            if (Math.abs(quantity) > goods.getOrDefault(goodId, 0)) {
                throw new ShoppingBasketCONFLICT("Cannot remove more goods than there is in the shopping basket.");
            }
            ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
            position.setComment(comment);
            shoppingBasketService.removeGoodFromShoppingBasket(user.getEmail(), goodId, Math.abs(quantity));

        } else {
            shoppingBasketService.addGoodToShoppingBasket(user.getEmail(), goodId, quantity);
            ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
            position.setComment(comment);
            shoppingBasketPositionRepository.save(position);
        }

        ShoppingBasketPositionDTO createdPosition = new ShoppingBasketPositionDTO();
        createdPosition.setGoodId(goodId);
        createdPosition.setQuantity(quantity);
        createdPosition.setComment(comment);

        return createdPosition;
    }
}













//    public ShoppingBasketDTO getShoppingBasketAsDTO (String email){
//        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser_Email(Email.of(email));
//        ModelMapper modelMapper = new ModelMapper();
//        ShoppingBasketDTO shoppingBasketDTO = modelMapper.map(shoppingBasket, ShoppingBasketDTO.class);
//
//        //ShoppingBasketPosition shoppingBasketPosition = shoppingBasket.getShoppingBasketPositions().get();
//        //ShoppingBasketPositionDTO shoppingBasketPositionDTO = modelMapper.map(shoppingBasketPosition, ShoppingBasketDTO.class);
//        shoppingBasketDTO.setGoods(shoppingBasket.getGoods());
//        shoppingBasketDTO.setUuid(shoppingBasket.getUuid());
//        shoppingBasketDTO.setOrderStatus(shoppingBasket.getOrderStatus());
//        shoppingBasketDTO.setUserId(shoppingBasket.getUser().getUuid());
//        shoppingBasketDTO.setShoppingBasketPositions(shoppingBasket.getShoppingBasketPositions());
//        return shoppingBasketDTO;
//
//    }


//        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
//                .orElseThrow(() -> new ShopException("Shopping basket not found."));
//
//        ShoppingBasketPosition position = shoppingBasketPositionRepository.findById(positionId)
//                .orElseThrow(() -> new ShopException("Shopping basket position not found."));
//
//        if (!shoppingBasket.getShoppingBasketPositions().contains(position)) {
//            throw new ShopException("Position does not belong to the shopping basket.");
//        }
//
//        ModelMapper modelMapper = new ModelMapper();
//        return modelMapper.map(position, ShoppingBasketPositionDTO.class);



//        ShoppingBasket shoppingBasket = shoppingBasketRepository.findById(shoppingBasketId)
//                .orElseThrow(() -> new ShopException("Shopping basket not found."));
//
//        ShoppingBasketPosition position = shoppingBasketPositionRepository.findById(positionId)
//                .orElseThrow(() -> new ShopException("Shopping basket position not found."));
//
//        if (!shoppingBasket.getShoppingBasketPositions().contains(position)) {
//            throw new ShopException("Position does not belong to the shopping basket.");
//        }
//
//        shoppingBasket.getShoppingBasketPositions().remove(position);
//        shoppingBasketPositionRepository.delete(position);

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketCONFLICT.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;
import thkoeln.archilab.ecommerce.ShopException;

@ResponseStatus(code = HttpStatus.CONFLICT, reason = "conflict")
public class ShoppingBasketCONFLICT extends ShopException {
    public ShoppingBasketCONFLICT(String message){
        super(message);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketController.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;

import java.net.URI;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.UUID;

//@RequestMapping("/shoppingBaskets")
@RestController
@RequestMapping("/shoppingBaskets")
public class ShoppingBasketController {
    @Autowired
    ShoppingBasketApplicationService shoppingBasketApplicationService;

    @Autowired
    ShoppingBasketRepository shoppingBasketRepository;

    @Autowired
    public ShoppingBasketController(ShoppingBasketApplicationService shoppingBasketApplicationService,
                                    ShoppingBasketRepository shoppingBasketRepository){
        this.shoppingBasketApplicationService = shoppingBasketApplicationService;
        this.shoppingBasketRepository = shoppingBasketRepository;
    }

    @GetMapping
    public ResponseEntity<?> getShoppingBasket(@RequestParam String email) {
        ShoppingBasketDTO shoppingBasketDTO = shoppingBasketApplicationService.getShoppingBasketAsDTO(email);
        return ResponseEntity.ok(shoppingBasketDTO);
    }


    @DeleteMapping("/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
    public ResponseEntity<?> deleteShoppingBasketPosition(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
                                                          @PathVariable("good-id") UUID goodId) {
        shoppingBasketApplicationService.deleteShoppingBasketPosition(shoppingBasketId, goodId);
        return ResponseEntity.ok().build();
    }

    @GetMapping("/{shoppingBasket-id}/shoppingBasketPositions/{good-id}")
    public ResponseEntity<?> getShoppingBasketPosition(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
                                                       @PathVariable("good-id") UUID positionId) {
        ShoppingBasketPositionDTO shoppingBasketPositionDTO =
                shoppingBasketApplicationService.getShoppingBasketPosition(shoppingBasketId, positionId);
        return ResponseEntity.ok(shoppingBasketPositionDTO);
    }

    @PutMapping("/{shoppingBasket-id}/checkout")
    public ResponseEntity<?> checkoutShoppingBasket(@PathVariable("shoppingBasket-id") UUID shoppingBasketId) {
        shoppingBasketApplicationService.checkoutShoppingBasket(shoppingBasketId);
        return ResponseEntity.ok().build();
    }

    @PostMapping ("/{shoppingBasket-id}/shoppingBasketPositions")
    public ResponseEntity<?> addRemove(@PathVariable("shoppingBasket-id") UUID shoppingBasketId,
                                       @RequestBody ShoppingBasketPositionDTO inputShoppingBasketPositionDTO) {

        try {
            ShoppingBasketPositionDTO createdPosition = shoppingBasketApplicationService.addRemove(shoppingBasketId, inputShoppingBasketPositionDTO);

            URI returnURI = ServletUriComponentsBuilder
                    .fromCurrentRequest()
                    .path("/{id}")
                    .buildAndExpand(createdPosition.getGoodId())
                    .toUri();

            return ResponseEntity.created(returnURI).body(createdPosition);
        } catch (ShoppingBasketCONFLICT e) {
            return ResponseEntity.status(HttpStatus.CONFLICT).body(e.getMessage());
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(e.getMessage());
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketDTO.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderStatus;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.List;
import java.util.Map;
import java.util.UUID;

@AllArgsConstructor
@NoArgsConstructor
@Getter
@Setter
public class ShoppingBasketDTO {
    private UUID id;
    private OrderStatus orderStatus;
    private Map<UUID, Integer> goods;
    private UUID userId;
    private Integer totalQuantity = 0;
    private Email email;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketNOTFOUND.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;
import thkoeln.archilab.ecommerce.ShopException;

@ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "not found")
public class ShoppingBasketNOTFOUND extends ShopException {
    public ShoppingBasketNOTFOUND(String message) {
        super(message);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketPositionDTO.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;

import java.util.UUID;

@AllArgsConstructor
@NoArgsConstructor
@Getter
@Setter
public class ShoppingBasketPositionDTO {
    private Integer quantity;
    private String comment;
    private UUID goodId;
    private UUID shoppingBasketUuid;
}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.InvalidDataAccessApiUsageException;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
import thkoeln.archilab.ecommerce.solution.good.GoodInterfaceShoppingBasket;
import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;
import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
import thkoeln.archilab.ecommerce.solution.order.domain.*;
import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPosition;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketPositionRepository;
import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
import thkoeln.archilab.ecommerce.solution.user.ShoppingBasketTypeInterface;
import thkoeln.archilab.ecommerce.solution.user.UserNeedsBasketInterface;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.*;

@Service
public class ShoppingBasketService implements ShoppingBasketUseCases, GoodInterfaceShoppingBasket, UserNeedsBasketInterface {
    @Autowired
    ShoppingBasketRepository shoppingBasketRepository;
    @Autowired
    UserRepository userRepository;
    @Autowired
    OrderRepository orderRepository;
    @Autowired
    OrderPositionRepository orderPositionRepository;
    @Autowired
    GoodRepository goodRepository;
    @Autowired
    PaymentService paymentService;
    @Autowired
    DeliveryService deliveryService;
    @Autowired
    DeliveryRepository deliveryRepository;
    @Autowired
    ShoppingBasketPositionRepository shoppingBasketPositionRepository;


    @Override
    public void addGoodToShoppingBasket(EmailType userEmail, UUID goodId, int quantity) {
        User user = userRepository.findByEmail(userEmail);
        if (user == null) {
            throw new ShopException("User not found");
        }

        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("Good not found");
        }

        if (quantity < 0 || quantity > good.getQuantity()) {
            throw new ShopException("Invalid quantity ADD");
        }

        ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if (basket == null) {
            basket = new ShoppingBasket();
            basket.setUser(user);
        }

        Map<UUID, Integer> goods = basket.getGoods();
        if (goods.containsKey(goodId)) {
            int currentQuantity = goods.get(goodId);
            goods.put(goodId, currentQuantity + quantity);
        } else {
            goods.put(goodId, quantity);
        }

        good.setQuantity(good.getQuantity() - quantity);
        basket.setGoods(goods);

        ShoppingBasketPosition existingPosition = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);

        if (existingPosition != null) {
            int currentPositionQuantity = existingPosition.getQuantity();
            existingPosition.setQuantity(currentPositionQuantity + quantity);

            existingPosition.setShoppingBasket(basket);
            shoppingBasketPositionRepository.save(existingPosition);
        }else {
            ShoppingBasketPosition newPosition = new ShoppingBasketPosition();
            newPosition.setGood(good);
            newPosition.setQuantity(quantity);
            newPosition.setShoppingBasket(basket);

            shoppingBasketPositionRepository.save(newPosition);
        }

        goodRepository.save(good);
        shoppingBasketRepository.save(basket);
        userRepository.save(user);
    }

    @Override
    public void removeGoodFromShoppingBasket(EmailType userEmail, UUID goodId, int quantity) throws ShopException {
        if (userEmail == null) {
            throw new ShopException("User email is null");
        }

        User user = userRepository.findByEmail(userEmail);
        if (user == null) {
            throw new ShopException("User does not exist");
        }

        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("Good does not exist");
        }

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if (shoppingBasket == null) {
            throw new ShopException("User does not have a shopping basket");
        }

        Map<UUID, Integer> goods = shoppingBasket.getGoods();
        if (goods == null || !goods.containsKey(goodId)) {
            throw new ShopException("Good is not in the shopping basket or the basket is empty");
        }

        int currentQuantity = goods.get(goodId);
        if (quantity <= 0 || quantity > currentQuantity) {
            throw new ShopException("Invalid quantity REMOVE");
        }

        int newQuantity = currentQuantity - quantity;
        if (newQuantity == 0) {
            goods.remove(goodId);
        } else {
            goods.put(goodId, newQuantity);
        }

        good.setQuantity(good.getQuantity() + quantity);
        goodRepository.save(good);

        ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);
        if (position != null) {
            int currentPositionQuantity = position.getQuantity();
            if (quantity > currentPositionQuantity) {
                throw new ShopException("not enough quantity");
            }
            position.setQuantity(currentPositionQuantity - quantity);
            if(position.getQuantity() == 0) {
                shoppingBasketPositionRepository.delete(position);
            } else {
                shoppingBasketPositionRepository.save(position);
            }
        }

        shoppingBasket.setGoods(goods);
        shoppingBasketRepository.save(shoppingBasket);
    }
    /**
     * Sets a comment in the shopping basket position containing a good
     *
     * @param userEmail
     * @param goodId
     * @param comment   (can be null)
     * @throws ShopException if ...
     *                       - userEmail is null,
     *                       - the user with the given email does not exist,
     *                       - the good does not exist
     *                       - the good is not in the shopping basket
     */
    @Override
    public void setCommentForShoppingBasketPosition(EmailType userEmail, UUID goodId, String comment) throws ShopException {
        if (userEmail == null) {
            throw new ShopException("User email is null");
        }

        User user = userRepository.findByEmail(userEmail);
        if (user == null) {
            throw new ShopException("User does not exist");
        }

        Good good = goodRepository.findByUuid(goodId);
        if (good == null) {
            throw new ShopException("Good does not exist");
        }

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if (shoppingBasket == null) {
            throw new ShopException("User does not have a shopping basket");
        }

        Map<UUID, Integer> goods = shoppingBasket.getGoods();
        if (goods == null || !goods.containsKey(goodId)) {
            throw new ShopException("Good is not in the shopping basket or the basket is empty");
        }

//        Optional<ShoppingBasketPosition> optionalPosition = shoppingBasket.getShoppingBasketPositions().stream()
//                .filter(position -> position.getGood().getUuid().equals(goodId))
//                .findFirst();
        ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);

        if (position == null) {
            throw new ShopException("Failed to find shopping basket position");
        }

        position.setComment(comment);
        position.setShoppingBasket(shoppingBasket);
        shoppingBasketPositionRepository.save(position);
    }
    /**
     * Returns the comment in the shopping basket position containing a good
     *
     * @param userEmail
     * @param goodId
     * @return the comment (can be null)
     * @throws ShopException if ...
     *                       - userEmail is null,
     *                       - the user with the given email does not exist,
     *                       - the good does not exist
     *                       - the good is not in the shopping basket
     */
    @Override
    public String getCommentForShoppingBasketPosition(EmailType userEmail, UUID goodId) throws ShopException {
        if (userEmail == null) {
            throw new ShopException("User email cannot be null");
        }

        User user = userRepository.findByEmail(userEmail);
        if (user == null) {
            throw new ShopException("User does not exist");
        }

        try {
            Optional<Good> optionalGood = goodRepository.findById(goodId);
            if (optionalGood.isEmpty()) {
                throw new ShopException("Good does not exist");
            }
        } catch (InvalidDataAccessApiUsageException e) {
            throw new ShopException("Failed to retrieve the good from the repository");
        }

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if (shoppingBasket == null) {
            throw new ShopException("User does not have a shopping basket");
        }

        boolean goodExistsInBasket = shoppingBasket.getGoods().containsKey(goodId);
        if (!goodExistsInBasket) {
            throw new ShopException("Good is not in the shopping basket");
        }



        ShoppingBasketPosition position = shoppingBasketPositionRepository.findShoppingBasketPositionByGoodUuid(goodId);

        if (position == null) {
            throw new ShopException("Failed to find shopping basket position");
        }
        return position.getComment();
    }
    @Override
    public Map<UUID, Integer> getShoppingBasketAsMap(EmailType userEmail) {
        /**
         * Returns a map showing which goods are in the cart of a user and how many of each good
         *
         * @param userEmail
         * @return the cart of the user (map is empty if the cart is empty)
         * @throws ShopException if the user with the given email does not exist
         */
        User user = userRepository.findByEmail(userEmail);
        if ( user == null ){
            throw new ShopException("user does not exist");
        }
        //ShoppingBasket basket = user.getShoppingBasket();
        ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if ( basket == null ){
            return Collections.emptyMap();
        }
        Map<UUID, Integer> cartCopy = new HashMap<>(basket.getGoods());
        return cartCopy;
    }


    @Override
    public MoneyType getShoppingBasketAsMoneyValue(EmailType userEmail) {
        User user =userRepository.findByEmail(userEmail);
        if ( user == null ){
            throw new ShopException("user does not exist");
        }
        float amount = 0.0f;

        //Map<UUID, Integer> cart = user.getShoppingBasket().getGoods();
        Map<UUID, Integer> cart = shoppingBasketRepository.findShoppingBasketByUser(user).getGoods();

        for ( UUID goodId : cart.keySet() ){
            Good good = goodRepository.findByUuid(goodId);
            if ( good == null ){
                throw new ShopException("Good not found");
            }
            amount += good.getSellingPrice().getAmount() * cart.get(goodId);
        }
        Money totalValue = new Money(amount, "EUR");

        return totalValue;
    }

    @Override
    public int getReservedInventoryInShoppingBaskets(UUID goodId) {
        /**
         * Get the number units of a specific good that are currently reserved in the shopping baskets of all users
         * @param goodId
         * @throws ShopException if the good id does not exist
         */
        Good good = goodRepository.findByUuid(goodId);
        if ( good == null ){
            throw new ShopException("good id does not exist");
        }

        Iterable<ShoppingBasket> baskets = shoppingBasketRepository.findAll();
        int reservedQuantity = 0;
        for (ShoppingBasket basket : baskets){
            Integer quantity = basket.getGoods().get(goodId);
            if ( quantity!=null ){
                reservedQuantity += quantity;
            }
        }
        return reservedQuantity;
    }


    @Override
    public boolean isEmpty(EmailType userEmail) {
        if ( userEmail == null || userEmail.toString().isEmpty() ){
            throw new ShopException("user does not exist or is empty");
        }
        User user = userRepository.findByEmail(userEmail);
        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if ( shoppingBasket.getGoods().isEmpty() ){
            return true;
        } else return false;
    }


    @Override
    public boolean isPaymentAuthorized(EmailType userEmail) {
        User user = userRepository.findByEmail(userEmail);
        if ( userEmail == null || userEmail.toString().isEmpty() ){
            throw new ShopException("email is wrong");
        }

        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        ShoppingBasket shoppingBasket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if (  shoppingBasket.getOrderStatus() != OrderStatus.PAYMENT_AUTHORIZED ){
            return false;
        }
        return true;
    }


    @Override
    public void checkout(EmailType userEmail) {
        User user = userRepository.findByEmail(userEmail);
        if (user == null) throw new ShopException("User does not exist");

        ShoppingBasket basket = shoppingBasketRepository.findShoppingBasketByUser(user);
        if(basket == null) throw new ShoppingBasketNOTFOUND("Shopping basket not found.");

        try {
            Money basketValue = (Money) getShoppingBasketAsMoneyValue(basket.getUser().getEmail());
            paymentService.authorizePayment(basket.getUser().getEmail(), basketValue);
            basket.setOrderStatus(OrderStatus.PAYMENT_AUTHORIZED);

            deliveryService.triggerDelivery(basket.getUser(), new HashMap<>(basket.getGoods()));
            basket.setOrderStatus(OrderStatus.DELIVERY_TRIGGERED);

            Order order = new Order();
            order.setUser(basket.getUser());
            order.setOrderPositions(new ArrayList<>());

            for (Map.Entry<UUID, Integer> entry : getShoppingBasketAsMap(basket.getUser().getEmail()).entrySet()) {
                OrderPosition orderPosition = new OrderPosition();
                orderPosition.setGood(goodRepository.findByUuid(entry.getKey()));
                orderPosition.setQuantity(entry.getValue());
                orderPosition.setComment(getCommentForShoppingBasketPosition(basket.getUser().getEmail(), entry.getKey()));
                order.getOrderPositions().add(orderPosition);
                orderPositionRepository.save(orderPosition);
            }

            basket.setOrderStatus(OrderStatus.EMPTY);
            basket.getGoods().clear();
            shoppingBasketRepository.save(basket);
            orderRepository.save(order);

        } catch (Exception e) {
            if(basket.getOrderStatus().equals(OrderStatus.PAYMENT_AUTHORIZED)) {
                throw new ShoppingBasketCONFLICT("too many goods");
            } else {
                throw new ShoppingBasketCONFLICT("too low");
            }
        }
    }

    @Override
    public Map<UUID, Integer> getOrderHistory(EmailType clientMailAddress) {
        User client = userRepository.findByEmail(clientMailAddress);
        List<Order> orders = orderRepository.findByUser(client);
        Map<UUID, Integer> orderHistory = new HashMap<>();
        for (Order order : orders) {
            for (OrderPosition orderPosition : order.getOrderPositions()) {
                if (orderHistory.containsKey(orderPosition.getGood().getUuid())) {
                    orderHistory.put(orderPosition.getGood().getUuid(), orderHistory.get(orderPosition.getGood().getUuid()) + orderPosition.getQuantity());
                } else {
                    orderHistory.put(orderPosition.getGood().getUuid(), orderPosition.getQuantity());
                }
            }
        }
        return orderHistory;

    }


    @Override
    public void deleteAllOrders() {
        /**
         * Deletes all orders and shopping baskets in the system
         */
        orderRepository.deleteAll();
        shoppingBasketRepository.deleteAll();
    }

    @Override
    public void saveShoppingBasket(ShoppingBasketType shoppingBasket) {
        shoppingBasketRepository.save((ShoppingBasket)shoppingBasket);
    }

    @Override
    public ShoppingBasketType getShoppingBasket(UUID shoppingBasketId) {
        return getShoppingBasket(shoppingBasketId);
    }

    @Override
    public List<ShoppingBasketType> findAll() {
        return new ArrayList<>((List<ShoppingBasket>)shoppingBasketRepository.findAll());
    }


    @Override
    public void save(ShoppingBasketTypeInterface shoppingBasket) {
        shoppingBasketRepository.save((ShoppingBasket) shoppingBasket);
    }

    @Override
    public void deleteAll() {
        shoppingBasketRepository.deleteAll();
    }

    @Override
    public ShoppingBasket createBasket(User user) {
        ShoppingBasket basket = new ShoppingBasket();
        basket.setUser(user);
        return basket;
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.good.ShoppingBasketType;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderStatus;
import thkoeln.archilab.ecommerce.solution.user.ShoppingBasketTypeInterface;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.persistence.*;
import java.util.*;

@NoArgsConstructor
@AllArgsConstructor
@Getter
@Entity
public class ShoppingBasket implements ShoppingBasketType, ShoppingBasketTypeInterface {
    @Setter
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    private OrderStatus orderStatus = OrderStatus.EMPTY;

    @Setter
    @ElementCollection
    private Map<UUID, Integer> goods = new HashMap<>();

    @Setter
    @OneToOne
    private User user;

//    @Setter
//    @OneToMany(cascade = CascadeType.ALL)
//    private List<ShoppingBasketPosition> shoppingBasketPositions = new ArrayList<>();

    @Setter
    private Integer totalQuantity;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPosition.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.good.domain.Good;

import javax.persistence.*;
import java.util.UUID;

@Entity
@Getter
@NoArgsConstructor
@AllArgsConstructor
public class ShoppingBasketPosition {
    @Setter
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    private Integer quantity;

    @Setter
    private String comment;

    @Setter
    @ManyToOne
    private Good good;

    @Setter
    @ManyToOne
    ShoppingBasket shoppingBasket;

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPositionRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;

import org.springframework.data.repository.CrudRepository;

import java.util.List;
import java.util.UUID;

public interface ShoppingBasketPositionRepository extends CrudRepository<ShoppingBasketPosition, UUID> {
    ShoppingBasketPosition findShoppingBasketPositionByGoodUuid(UUID uuid);
    List<ShoppingBasketPosition> findShoppingBasketPositionByShoppingBasketUuid(UUID uuid);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.UUID;

public interface ShoppingBasketRepository extends CrudRepository<ShoppingBasket, UUID> {
    ShoppingBasket findShoppingBasketByGoodsContaining(UUID uuid);
    ShoppingBasket findShoppingBasketByUuid(UUID uuid);
    ShoppingBasket findShoppingBasketByUser(User user);
    ShoppingBasket findShoppingBasketByUserEmail(Email email);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserService.java ---
package thkoeln.archilab.ecommerce.solution.user.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.ZipCode;
import thkoeln.archilab.ecommerce.solution.user.UserNeedsBasketInterface;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

@Service
public class UserService implements UserRegistrationUseCases {
    @Autowired
    UserRepository userRepository;

    @Autowired
    UserNeedsBasketInterface userNeedsBasketInterface;


    @Override
    public void register(String name, EmailType email, PersonalAddressType personalAddress) {
        User existingUser = userRepository.findByEmail(email);
        if ( existingUser != null ){
            throw new ShopException("User with given email already exists.");
        }

        if( name == null || email == null || personalAddress == null || personalAddress.getStreet() == null || personalAddress.getCity() == null || personalAddress.getZipCode() == null || name.isEmpty() || email.toString().isEmpty() || personalAddress.getStreet().isEmpty() || personalAddress.getCity().isEmpty() || personalAddress.getZipCode().toString().isEmpty()) {
            throw new ShopException("Data (name, email, street, city or zipCode) is invalid.");
        }
        Address address = new Address(personalAddress.getStreet(), personalAddress.getCity(), (ZipCode) personalAddress.getZipCode());

        User newUser = new User(name, (Email) email, address.getStreet(), address.getCity(), address.getZipCode());


        userRepository.save(newUser);
        userNeedsBasketInterface.save(userNeedsBasketInterface.createBasket(newUser));

    }


    @Override
    public void changeAddress(EmailType userEmail, PersonalAddressType personalAddress) {
        User user = userRepository.findByEmail( userEmail);
        if( user == null )
            throw new ShopException("Can not change Address, check user registration.");
        if ( personalAddress == null || personalAddress.getStreet() == null || personalAddress.getCity() == null || personalAddress.getZipCode() == null || personalAddress.getStreet().isEmpty() || personalAddress.getCity().isEmpty() || personalAddress.getZipCode().toString().isEmpty())
            throw new ShopException("Not able to change. Check attributes.");

        Email userEmailType = Email.of(userEmail.toString());
        User newUser = new User(user.getName(), userEmailType, user.getPersonalAddress().getStreet(), user.getPersonalAddress().getCity(), user.getAddress().getZipCode());
        userRepository.save(newUser);
    }


    @Override
    public UserType getUserData(EmailType userEmail) {
        User user = userRepository.findByEmail((Email) userEmail);
        if ( userEmail == null )
        {
            throw new ShopException("email is null");
        }
        if ( user == null ){
            throw new ShopException("user does not exist");
        }

        return new User(user.getName(), user.getEmail(),user.getPersonalAddress().getStreet(), user.getPersonalAddress().getCity(), (ZipCode) user.getPersonalAddress().getZipCode());
    }

    @Override
    public void deleteAllUsers() {
        userNeedsBasketInterface.deleteAll();
        userRepository.deleteAll();
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java ---
package thkoeln.archilab.ecommerce.solution.user.domain;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Address;
import thkoeln.archilab.ecommerce.domainprimitives.Email;
import thkoeln.archilab.ecommerce.domainprimitives.ZipCode;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

import javax.persistence.*;
import java.util.UUID;

@Entity
@Getter
@NoArgsConstructor
public class User implements UserType {


    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID uuid;

    @Setter
    private String name;

    @Setter
    @Embedded
    private Email email;

    @Setter
    @Embedded
    private Address address;


    public User(String name, Email email, String street, String city, ZipCode zipCode) {
        this.name = name;
        this.email = email;
        this.address = new Address(street, city, zipCode);
    }

    @Override
    public PersonalAddressType getPersonalAddress() {
        return this.address;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\UserRepository.java ---
package thkoeln.archilab.ecommerce.solution.user.domain;

import org.springframework.data.repository.CrudRepository;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.UUID;

public interface UserRepository extends CrudRepository<User, UUID> {
    User findByEmail(EmailType email);
    //User findByEmail(Email email);
    //public ShoppingBasket findShoppingBasketByEmail(String email);
}

--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\ShoppingBasketTypeInterface.java ---
package thkoeln.archilab.ecommerce.solution.user;

public interface ShoppingBasketTypeInterface {
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserBasketInterface.java ---
package thkoeln.archilab.ecommerce.solution.user;//package thkoeln.archilab.ecommerce.solution.user;
//
//import thkoeln.archilab.ecommerce.domainprimitives.Email;
//import thkoeln.archilab.ecommerce.solution.user.domain.User;
//import thkoeln.archilab.ecommerce.usecases.UserType;
//import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
//
//public interface UserBasketInterface {
//    public User findByEmail(EmailType email);
//    public void setUser(UserType user);
//    public void saveUser(UserType user);
//}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserNeedsBasketInterface.java ---
package thkoeln.archilab.ecommerce.solution.user;

import thkoeln.archilab.ecommerce.solution.user.domain.User;

public interface UserNeedsBasketInterface {
    public void save(ShoppingBasketTypeInterface shoppingBasket);
    public void deleteAll();
    public ShoppingBasketTypeInterface createBasket(User user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with logistics,
 * i.e. the delivery of goods to a user. It is probably incomplete, and will grow over time.
 */
public interface DeliveryUseCases {
    /**
     * Delivers a good to a user. The good is identified by its id, and the user by
     * his/her name, street, city and zip code.
     * @param deliveryRecipient
     * @param deliveryContent - a map of good ids and quantities
     * @return the id of the delivery, if successfully triggered
     * @throws ShopException if ...
     *      - deliveryRecipient is null
     *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
     *      - deliveryContent is null or empty
     *      - the total number of goods in the delivery is > 20
     */
    public UUID triggerDelivery( UserType deliveryRecipient, Map<UUID, Integer> deliveryContent );


    /**
     * Returns a map showing which goods have been delivered to a user, and how many of each good
     *
     * @param userEmail
     * @return the delivery history of the user (map is empty if the user has not had any deliveries yet)
     * @throws ShopException if
     *      - email is null
     *      - the user with the given email does not exist
     */
    public Map<UUID, Integer> getDeliveryHistory( EmailType userEmail );



    /**
     *  Deletes all delivery history.
     */
    public void deleteDeliveryHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface EmailType {
    /**
     * @return the email as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an email, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param emailAsString - the email as a string.
     *      We will use a much simplified validation method to check if the email is valid:
     *      - it must contain exactly one '@' character.
     *      - the part before the '@' and the part after the '@' must not be empty, contain of
     *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
     *      - the parts before and after the '@' may contain one or several '.' as separators
     *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
     *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
     *        (for simplicity we do not allow any other domains)
     * @return a new EmailType object matching the given email
     * @throws ShopException if ...
     *      - emailAsString is null
     *      - emailAsString is not a valid email (see above)
     */
     // public static EmailType of( String emailAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface MoneyType {
    /**
     * @return the amount of money
     */
    public Float getAmount();


    /**
     * @return the currency of the money
     */
    public String getCurrency();


    /**
     * @param otherMoney
     * @return this + otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public MoneyType add( MoneyType otherMoney );


    /**
     * @param otherMoney
     * @return this - otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     *      - otherMoney > this
     */
    public MoneyType subtract( MoneyType otherMoney );


    /**
     * @param factor
     * @return this * factor, as a new object
     * @throws ShopException if ...
     *     - factor < 0
     */
    public MoneyType multiplyBy( int factor );

    /**
     * @param otherMoney
     * @return true, if this > otherMoney
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public boolean largerThan( MoneyType otherMoney );


    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates a money object from an amount and a currency (as string).
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param amount the amount of money (must be >= 0)
     * @param currency the currency of the money (allowed values: "EUR", "CHF")
     * @return a new Money object with the given amount and currency
     * @throws ShopException if ...
     *   - amount is null
     *   - amount < 0
     *   - currency is null
     *   - currency is not one of the allowed values
     */
     // public static MoneyType of( Float amount, String currency );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PersonalAddressType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface PersonalAddressType {
    /**
     * @return the street as a string
     */
    public String getStreet();

    /**
     * @return the city as a string
     */
    public String getCity();

    /**
     * @return the zip code
     */
    public ZipCodeType getZipCode();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an zip code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param street the street as a string
     * @param city the city as a string
     * @param zipCode the zip code
     * @return the personalAddress object matching the parameters
     * @throws ShopException if ...
     *      - street is null or empty
     *      - city is null or empty
     *      - zipCode is null
     */
     // public static PersonalAddressType of( String street, String city, ZipCodeType zipCode );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\ZipCodeType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface ZipCodeType {
    /**
     * @return the zip code as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an zip code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param zipCodeAsString - the zip code as a string.
     *      We will use a much simplified validation method to check if the postal code is valid:
     *      - It must contain exactly 5 digits.
     *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
     * @return a new zip code object matching the given string
     * @throws ShopException if ...
     *      - zipCodeAsString is null
     *      - zipCodeAsString is not a valid zip code (see above)
     */
     // public static ZipCodeType of( String zipCodeAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\GoodCatalogUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the good catalog.
 * The interface is probably incomplete, and will grow over time.
 */

public interface GoodCatalogUseCases {
    /**
     * Adds a new good to the shop catalog
     * @param goodId
     * @param name
     * @param description
     * @param size
     * @param purchasePrice
     * @param sellingPrice
     * @throws ShopException if ...
     *      - goodId is null,
     *      - the good with that id already exists,
     *      - name or description are null or empty,
     *      - the size is <= 0 (but can be null!),
     *      - the purchase price is null,
     *      - the selling price is null,
     *      - the selling price is lower than the purchase price
     */
    public void addGoodToCatalog( UUID goodId, String name, String description, Float size,
                                           MoneyType purchasePrice, MoneyType sellingPrice );


    /**
     * Removes a good from the shop catalog
     * @param goodId
     * @throws ShopException if
     *      - goodId is null,
     *      - the good with that id does not exist
     *      - the good is still in inventory
     *      - the good is still reserved in a shopping basket, or part of a completed order
     */
    public void removeGoodFromCatalog( UUID goodId );


    /**
     * Get the selling price of a given good
     * @param goodId
     * @return the selling price
     * @throws ShopException if ...
     *      - goodId is null,
     *      - the good with that id does not exist
     */
    public MoneyType getSellingPrice( UUID goodId );


    /**
     * Clears the good catalog, i.e. removes all goods from the catalog, including all the inventory,
     * all the reservations and all the orders.
     */
    public void deleteGoodCatalog();

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\InventoryManagementUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the shop inventory,
 * i.e. adding and removing goods in the warehouse. The interface is probably incomplete, and
 * will grow over time.
 */
public interface InventoryManagementUseCases {
    /**
     * Adds a certain quantity of a given good to the inventory
     * @param goodId
     * @param addedQuantity
     * @throws ShopException if ...
     *      - goodId is null
     *      - the good with that id does not exist
     *      - addedQuantity <= 0
     */
    public void addToInventory( UUID goodId, int addedQuantity );


    /**
     * Removes a certain quantity of a given good from the inventory.
     * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
     * (in the users' shopping baskets) are removed. This means that some of the reserved goods are lost for
     * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
     * or some of the goods were stolen from the warehouse, are broken, etc.)
     * @param goodId
     * @param removedQuantity
     * @throws ShopException if ...
     *      - goodId is null
     *      - the good with that id does not exist
     *      - removedQuantity <= 0
     *      - the removed quantity is greater than the current inventory and the currently reserved goods together
     */
    public void removeFromInventory( UUID goodId, int removedQuantity );


    /**
     * Changes the total quantity of a given good in the inventory.
     * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
     * (in the users' shopping baskets) are removed. This means that some of the reserved goods are lost for
     * the user. (This is necessary because there probably was a mistake in the inventory management, a mis-counting,
     * or some of the goods were stolen from the warehouse, are broken, etc.)
     * @param goodId
     * @param newTotalQuantity
     * @throws ShopException if ...
     *      - goodId is null
     *      - the good with that id does not exist
     *      - newTotalQuantity < 0
     */
    public void changeInventoryTo( UUID goodId, int newTotalQuantity );


    /**
     * Get the current total inventory of a given good, including the currently reserved goods
     * @param goodId
     * @return the current total inventory of the good
     * @throws ShopException if ...
     *      - goodId is null
     *      - the good with that id does not exist
     */
    public int getAvailableInventory( UUID goodId );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with payments.
 */
public interface PaymentUseCases {

    /**
     * Authorizes a payment from a bank card for a given amount
     *
     * @param userEmail
     * @param moneyAmount
     * @return the id of the payment, if successfully authorized
     * @throws ShopException if ...
     *      - userEmail is null
     *      - the amount is null
     *      - the amount is 0.00 EUR
     *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
     */
    public UUID authorizePayment( EmailType userEmail, MoneyType moneyAmount );


    /**
     * Returns the total amount of payments (over the complete history) for a user
     * (identified by his/her email)
     *
     * @param userEmail
     * @return the total amount of payments made using this bank card, or 0.00 EUR if there
     *         weren't any payments yet.
     * @throws ShopException if ...
     *      - userEmail is null
     */
    public MoneyType getPaymentTotal( EmailType userEmail );


    /**
     * Deletes all payment history, for all users.
     */
    public void deletePaymentHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingBasketUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with the shopping basket.
 * The interface is probably incomplete, and will grow over time.
 */
public interface ShoppingBasketUseCases {
    /**
     * Adds a good to the shopping basket of a user
     *
     * @param userEmail
     * @param goodId
     * @param quantity
     * @throws ShopException if ...
     *      - the user with the given email does not exist,
     *      - the good does not exist,
     *      - the quantity <= 0,
     *      - the good is not available in the requested quantity
     */
    public void addGoodToShoppingBasket( EmailType userEmail, UUID goodId, int quantity );


    /**
     * Removes a good from the shopping basket of a user
     *
     * @param userEmail
     * @param goodId
     * @param quantity
     * @throws ShopException if ...
     *      - userEmail is null,
     *      - the user with the given email does not exist,
     *      - the good does not exist
     *      - the quantity <= 0,
     *      - the good is not in the shopping basket in the requested quantity
     */
    public void removeGoodFromShoppingBasket( EmailType userEmail, UUID goodId, int quantity );


    /**
     * Sets a comment in the shopping basket position containing a good
     *
     * @param userEmail
     * @param goodId
     * @param comment (can be null)
     * @throws ShopException if ...
     *      - userEmail is null,
     *      - the user with the given email does not exist,
     *      - the good does not exist
     *      - the good is not in the shopping basket
     */
    public void setCommentForShoppingBasketPosition( EmailType userEmail, UUID goodId, String comment );


    /**
     * Returns the comment in the shopping basket position containing a good
     *
     * @param userEmail
     * @param goodId
     * @return the comment (can be null)
     * @throws ShopException if ...
     *      - userEmail is null,
     *      - the user with the given email does not exist,
     *      - the good does not exist
     *      - the good is not in the shopping basket
     */
    public String getCommentForShoppingBasketPosition( EmailType userEmail, UUID goodId );


    /**
     * Returns a map showing which goods are in the shopping basket of a user and how many of each good
     *
     * @param userEmail
     * @return the shopping basket of the user (map is empty if the shopping basket is empty)
     * @throws ShopException if ...
     *      - userEmail is null,
     *      - the user with the given email does not exist
     */
    public Map<UUID, Integer> getShoppingBasketAsMap( EmailType userEmail );


    /**
     * Returns the current value of all goods in the shopping basket of a user
     *
     * @param userEmail
     * @return the value of shopping basket of the user
     * @throws ShopException if ...
     *      - userEmail is null,
     *      - the user with the given email does not exist
     */
    public MoneyType getShoppingBasketAsMoneyValue( EmailType userEmail );



    /**
     * Get the number units of a specific good that are currently reserved in the shopping baskets of all users
     * @param goodId
     * @return the number of reserved goods of that type in all shopping baskets
     * @throws ShopException
     *      - goodId is null
     *      - if the good id does not exist
     */
    public int getReservedInventoryInShoppingBaskets( UUID goodId );


    /**
     * Checks if the shopping basket of a user is empty
     *
     * @param userEmail
     * @return true if the shopping basket is empty, false otherwise
     * @throws ShopException if ...
     *    - userEmail is null
     *    - the user with the given email does not exist
     */
    public boolean isEmpty( EmailType userEmail );


    /**
     * Checks if the payment for a specific shopping basket of a user has been authorized to be paid,
     * i.e. the shopping basket is not empty, the user has given his/her payment details, and the payment
     * has been authorized (under the limits of the user's credit card). However, the order
     * has not yet been placed yet, and the logistics details have not yet been given.
     *
     * @param userEmail
     * @return true if the payment has been authorized, false otherwise
     * @throws ShopException if ...
     *      - userEmail is null
     *      - the user with the given email does not exist
     */
    public boolean isPaymentAuthorized( EmailType userEmail );


    /**
     * Checks out the shopping basket of a user
     *
     * @param userEmail
     * @throws ShopException if ... 
     * @throws ShopException if ...
     *      - userEmail is null
     *      - the user with the given email does not exist
     *      - the shopping basket is empty
     */
    public void checkout( EmailType userEmail );




    /**
     * Returns a map showing which goods have been ordered by a user, and how many of each good
     *
     * @param userEmail
     * @return the order history of the user (map is empty if the user has not ordered anything yet)
     * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
     * @throws ShopException if
     *      - the email is null
     *      - the user with the given email does not exist
     */
    public Map<UUID, Integer> getOrderHistory( EmailType userEmail );



    /**
     * Deletes all orders and shopping baskets in the system
     * @Deprecated Might be split into two methods later (delete orders and delete shopping baskets), with
     *             the order deletion moved to a dedicated OrderUseCases interface later
     *             (but still valid in this milestone)
     */
    public void deleteAllOrders();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\UserRegistrationUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

/**
 * This interface contains methods needed in the context of use cases dealing with registering a user.
 * The interface is probably incomplete, and will grow over time.
 */
public interface UserRegistrationUseCases {
    /**
     * Registers a new user
     *
     * @param name
     * @param email
     * @param personalAddress
     * @throws ShopException if ...
     *      - name is null or empty
     *      - email is null
     *      - user with the given email already exists
     *      - personalAddress is null
     */
    public void register( String name, EmailType email, PersonalAddressType personalAddress );


    /**
     * Changes the personalAddress of a user
     *
     * @param userEmail
     * @param personalAddress
     * @throws ShopException if ...
     *      - email is null
     *      - user with the given email already exists
     *      - personalAddress is null
     */
    public void changeAddress( EmailType userEmail, PersonalAddressType personalAddress );


    /**
     * Returns the data of a user
     * @param userEmail
     * @return the user data
     * @throws ShopException if ...
     *      - email is null
     *      - the user with the given email does not exist
     */
    public UserType getUserData( EmailType userEmail );



    /**
     * Deletes all users, including all orders and shopping baskets
     */
    public void deleteAllUsers();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\usecases\UserType.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

/**
 * This interface expresses the essence of a shop user
 */
public interface UserType {
    public String getName();
    public EmailType getEmail();
    public PersonalAddressType getPersonalAddress();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;

import static com.tngtech.archunit.library.Architectures.layeredArchitecture;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln")
@SuppressWarnings("PMD")
public class E3DDDOutsideSolutionRulesTest {

    @ArchTest
    static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
            layeredArchitecture()
                    .consideringAllDependencies()
                    .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
                    .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
                    .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
                    .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
                    .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )

                    .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
                    .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Service;

import javax.persistence.Entity;
import javax.persistence.Id;

import java.util.UUID;

import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
@SuppressWarnings("PMD")
public class E3DDDRulesTest {

    @ArchTest
    static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
            noClasses().that().resideInAPackage("..domain..")
                    .should().dependOnClassesThat().resideInAPackage("..application..");

    @ArchTest
    static final ArchRule entitiesMustResideInADomainPackage =
            classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
                    .as("Entities must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule entitiesMustNotAccessRepositories =
            noClasses().that().areAnnotatedWith( Entity.class )
                    .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );

    @ArchTest
    static final ArchRule repositoriesMustResideInADomainPackage =
            classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
                    .as("Repositories must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule repositoryNamesMustHaveProperSuffix =
            classes().that().areAssignableTo( CrudRepository.class )
                    .should().haveSimpleNameEndingWith("Repository");

    @ArchTest
    static final ArchRule servicesMustResideInAnApplicationPackage =
            classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
                    .as("Application Services must reside in a package '..application..'");

    @ArchTest
    static final ArchRule serviceNamesMustHaveProperSuffix =
            classes().that().areAnnotatedWith( Service.class )
                    .should().haveSimpleNameEndingWith("Service");

    @ArchTest
    static final ArchRule noClassesOnTopLevel =
            classes().should().resideInAPackage( "..solution.*.." );

    @ArchTest
    static final ArchRule noNonIdFieldsOfTypeIUUID =
            fields()
                    .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
                    .and().areNotAnnotatedWith( Id.class )
                    .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Good" )
                    .should().notHaveRawType( UUID.class );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClass;
import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import com.tngtech.archunit.lang.ArchRule;
import com.tngtech.archunit.library.dependencies.SliceAssignment;
import com.tngtech.archunit.library.dependencies.SliceIdentifier;
import org.junit.jupiter.api.Test;

import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;

public class E3NoCycleTest {
    private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");

    private SliceAssignment inAllClasses() {
        return new SliceAssignment() {
            @Override
            public String getDescription() {
                return "every class in it's own slice";
            }

            @Override
            public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
                return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
            }
        };
    }

    @Test
    public void testNoCyclicDependenciesBetweenClasses() {
        slices().assignedFrom(inAllClasses())
                .namingSlices("$1[$2.$3]")
                .should().beFreeOfCycles()
                .check(importedClasses);
    }

    @Test
    public void testNoCyclicDependenciesBetweenPackages() {
        ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
        rule.check(importedClasses);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3PackageStructureTest {

    private static final String[] REQUIRED_PACKAGES = {"user", "shoppingbasket", "good", "order"};
    private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
    private JavaClasses importedClasses;


    @BeforeEach
    public void setUp() {
        importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
    }

    @Test
    void testRequiredPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage;
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredDomainPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected domain sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredApplicationPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected application sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import org.junit.jupiter.api.Test;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
import org.springframework.core.type.classreading.MetadataReader;
import org.springframework.core.type.classreading.MetadataReaderFactory;

import java.io.IOException;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;

import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3RequiredClassesTest {


    private static final String[] REQUIRED_CLASSES = {
            "User",
            "UserRepository",
            "Order",
            "OrderRepository",
            "ShoppingBasket",
            "ShoppingBasketRepository",
            "Good",
            "GoodRepository"
    };

    @Test
    public void testRequiredClassesDeclared() throws IOException {
        String basePackage = "thkoeln.archilab.ecommerce";
        String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";

        PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );

        Set<String> foundClasses = new HashSet<>();

        Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
            try {
                MetadataReader reader = readerFactory.getMetadataReader( resource );
                foundClasses.add( reader.getClassMetadata().getClassName() );
            } catch (IOException e) {
                e.printStackTrace();
            }
        } );

        Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
            boolean found = foundClasses.stream().anyMatch(className ->
                    className.startsWith(basePackage) && className.endsWith("." + requiredClass)
            );
            assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
        });
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E1OrdertRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private EmailType nonExistingEmail;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllGoods();
        initialMasterDataCreator.inventoryUpAllGoods();
        initialMasterDataCreator.registerAllUsers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingEmail = instantiateEmail( "harry@sally.de" );
    }


    @Test
    public void testGetNoOrders() throws Exception {
        // given
        // when
        // then
        mockMvc.perform( get( "/orders" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?email=" + USER_EMAIL[3].toString() ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
    }


    @Test void testMakeThreeOrders() throws Exception {
        // given
        String emailString = USER_EMAIL[6].toString();

        UUID goodId2 = (UUID) GOOD_DATA[2][0];
        UUID goodId4 = (UUID) GOOD_DATA[4][0];
        UUID goodId6 = (UUID) GOOD_DATA[6][0];
        Float goodMoneyAmount2 = ((MoneyType) GOOD_DATA[2][5]).getAmount() * 2;
        Float goodMoneyAmount4 = ((MoneyType) GOOD_DATA[4][5]).getAmount() * 4;
        Float goodMoneyAmount6 = ((MoneyType) GOOD_DATA[6][5]).getAmount() * 6;

        String uriAllOrders = "/orders?email=" + emailString;
        String uriLatestOrder = uriAllOrders + "&filter=latest";

        // when
        restHelper.makeOrderForUser( emailString, goodId2, 2 );
        restHelper.makeOrderForUser( emailString, goodId4, 4 );
        restHelper.makeOrderForUser( emailString, goodId6, 6 );

        // then get all orders ...
        mockMvc.perform( get( uriAllOrders ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 3 ) )

                .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount2 ) )

                .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[1].price.amount" ).value( goodMoneyAmount4 ) )

                .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
                .andExpect( jsonPath( "$[2].price.amount" ).value( goodMoneyAmount6 ) );

        // ... and the latest order
        mockMvc.perform( get( uriLatestOrder ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount6 ) );
    }


    @Test
    public void testIfMoneySumInOrderIsCorrect() throws Exception {
        // given
        String emailString = USER_EMAIL[3].toString();
        UUID goodId3 = (UUID) GOOD_DATA[3][0];
        UUID goodId4 = (UUID) GOOD_DATA[4][0];
        Integer quantity3 = 14;
        Integer quantity4 = 5;
        Float goodMoneyAmount =
                ((MoneyType) GOOD_DATA[3][5]).getAmount() * quantity3 +
                ((MoneyType) GOOD_DATA[4][5]).getAmount() * quantity4;

        // when
        UUID shoppingBasketId = restHelper.getShoppingBasketId( emailString );
        restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId3, quantity3 );
        restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId4, quantity4 );
        mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
                .andExpect( status().isOk() );

        // then
        mockMvc.perform( get(
                "/orders?email=" + emailString + "&filter=latest") )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount ) );
    }



}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingBasketRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E2ShoppingBasketRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private EmailType nonExistingEmail;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllGoods();
        initialMasterDataCreator.inventoryUpAllGoods();
        initialMasterDataCreator.registerAllUsers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingEmail = instantiateEmail( "harry@sally.de" );
    }


    @Test
    public void testEmptyShoppingBasket() throws Exception {
        // given
        String validUri = "/shoppingBaskets?email=" + USER_EMAIL[4].toString();
        String invalidUri1 = "/shoppingBaskets?email=" + nonExistingEmail.toString();
        String invalidUri2 = "/shoppingBaskets?email=justaninvalidemailaddress";

        // when
        // then
        mockMvc.perform( get( validUri ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
        mockMvc.perform( get( invalidUri1 ) )
                .andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidUri2 ) )
                .andExpect( status().isNotFound() );
    }


    @Test
    public void testInvalidUris() throws Exception {
        // given
        UUID goodId = (UUID) GOOD_DATA[3][0];
        String userEmailString = USER_EMAIL[4].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );

        String invalidPostUri = "/shoppingBaskets/" + UUID.randomUUID() + "/shoppingBasketPositions";
        String invalidPatchGetDeleteUri1 =
                "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + UUID.randomUUID();
        String invalidPatchGetDeleteUri2 =
                "/shoppingBaskets/" + UUID.randomUUID().toString() + "/shoppingBasketPositions/" + goodId;
        String invalidCheckoutUri1 = "/shoppingBaskets/" + shoppingBasketId + "/chekkout";
        String invalidCheckoutUri2 = "/shoppingBaskets/" + UUID.randomUUID() + "/checkout";

        // when
        // then
        mockMvc.perform( post( invalidPostUri )
                .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testQueryNonExistingGood() throws Exception {
        // given
        UUID goodId = (UUID) GOOD_DATA[3][0];
        String userEmailString = USER_EMAIL[7].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String invalidUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + goodId;

        // when
        // then
        mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testDeleteFromShoppingBasket() throws Exception {
        // given
        UUID goodId1 = (UUID) GOOD_DATA[1][0];
        String userEmailString9 = USER_EMAIL[9].toString();
        String userEmailString7 = USER_EMAIL[7].toString();

        UUID shoppingBasketId9 = restHelper.getShoppingBasketId( userEmailString9 );
        UUID shoppingBasketId7 = restHelper.getShoppingBasketId( userEmailString7 );

        String baseUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/shoppingBasketPositions/";
        String checkoutUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/checkout";
        String checkoutUri7 = "/shoppingBaskets/" + shoppingBasketId7 + "/checkout";

        // when
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString9,
                new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
        restHelper.checkMultipleShoppingBasketPositions(
                userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
                new String[]{"c1", "c4", "c6"} );
        mockMvc.perform( delete( baseUri9 + goodId1 ) )
                .andExpect( status().isOk() );
        restHelper.checkMultipleShoppingBasketPositions(
                userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
                new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
        // ... and another customer can still buy 10 of the "Nr. 1" good
        restHelper.addGoodToShoppingBasket( shoppingBasketId7, goodId1, 10,
                "still10", null );

        // then
        mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString9,
                new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
        mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString7,
                new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
    }


    @Test
    public void testAddToAndRemoveFromShoppingBasket() throws Exception {
        // given
        String userEmailString = USER_EMAIL[2].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";

        // when
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
                new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
        restHelper.checkMultipleShoppingBasketPositions(
                userEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
                new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
                new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
    }


    @Test
    public void testRemoveMoreThanThereIsInShoppingBasket() throws Exception {
        // given
        String userEmailString = USER_EMAIL[2].toString();

        // when
        // then
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testAddMoreThanIsInInventory() throws Exception {
        // given
        String userEmailString = USER_EMAIL[7].toString();

        // when
        // then
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[5].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";

        // when
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
    }



    @Test
    public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[1].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";

        // when
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[8].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";

        // when
        restHelper.addMultipleGoodsToShoppingBasket( userEmailString,
                new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testNoCheckoutForEmptyShoppingBasket() throws Exception {
        // given
        String userEmailString = USER_EMAIL[9].toString();
        UUID shoppingBasketId = restHelper.getShoppingBasketId( userEmailString );
        String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";

        // when
        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.ResultActions;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;

public class RESTHelper {
    private MockMvc mockMvc;

    public static final ResultMatcher NOT_FOUND = status().isNotFound();
    public static final ResultMatcher OK = status().isOk();
    public static final ResultMatcher CREATED = status().isCreated();
    public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
    public static final ResultMatcher CONFLICT = status().isConflict();

    public RESTHelper( MockMvc mockMvc ) {
        this.mockMvc = mockMvc;
    }

    public void makeOrderForUser( String emailString, UUID goodId, Integer quantity ) throws Exception {
        UUID shoppingBasketId = getShoppingBasketId( emailString );
        addGoodToShoppingBasket( shoppingBasketId, goodId, quantity );
        mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
                .andExpect( OK );
    }

    public UUID getShoppingBasketId( String emailString ) throws Exception {
        // get the shopping basket and extract its id ...
        MvcResult shoppingBasket = mockMvc.perform( get( "/shoppingBaskets?email=" + emailString ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.id" ).isNotEmpty() )
                .andReturn();
        ObjectMapper objectMapper = new ObjectMapper();
        IdDTO idDTO = objectMapper.readValue( shoppingBasket.getResponse().getContentAsString(), IdDTO.class );
        return idDTO.getId();
    }

    public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity,
                                                 String comment, ResultMatcher expectedStatus )
                                                throws Exception {
        ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
        ObjectMapper objectMapper = new ObjectMapper();
        QuantityAndCommentDTO dto = new QuantityAndCommentDTO( goodId, quantity, comment );
        String quantityJson = objectMapper.writeValueAsString( dto );
        mockMvc.perform( post( "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions" )
                .contentType( APPLICATION_JSON ).content( quantityJson ) )
                .andExpect( status );
    }


    public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity )
            throws Exception {
        addGoodToShoppingBasket( shoppingBasketId, goodId, quantity, null, null );
    }



    public void addMultipleGoodsToShoppingBasket(
            String userEmailString, Integer[] goodIndices, Integer[] quantities, String[] comments,
            ResultMatcher[] expectedAddStatuses ) throws Exception {
        UUID shoppingBasketId = getShoppingBasketId( userEmailString );
        String shoppingBasketUri = "shoppingBaskets?email=" + userEmailString;
        String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";

        // add all the goods to the shopping basket ...
        Map<Integer, Integer> quantityMap = new HashMap<>();
        Map<Integer, String> commentMap = new HashMap<>();
        for ( int i = 0; i < goodIndices.length; i++ ) {
            UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
            addGoodToShoppingBasket( shoppingBasketId, goodId, quantities[i], comments[i], expectedAddStatuses[i] );
            if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
                quantityMap.put( goodIndices[i],
                        quantities[i] + quantityMap.getOrDefault( goodIndices[i], 0 ) );
                commentMap.put( goodIndices[i], comments[i] );
            }
        }
    }


    public void addMultipleGoodsToShoppingBasket(
            String userEmailString, Integer[] goodIndices, Integer[] quantities,
            String[] comments ) throws Exception {
        ResultMatcher[] expectedAddStatuses = new ResultMatcher[goodIndices.length];
        for ( int i = 0; i < goodIndices.length; i++ ) {
            expectedAddStatuses[i] = CREATED;
        }
        addMultipleGoodsToShoppingBasket( userEmailString, goodIndices, quantities,
                comments, expectedAddStatuses );
    }


    public void checkMultipleShoppingBasketPositions( String userEmailString,
                                                         Integer[] goodIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
        UUID shoppingBasketId = getShoppingBasketId( userEmailString );
        String shoppingBasketUri = "/shoppingBaskets?email=" + userEmailString;
        String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";

        // check that the shopping basket contains all the goods ...
        int totalQuantity = 0;
        for ( int i = 0; i < goodIndices.length; i++ ) {
            if ( expectedQuantities[i] != null ) {
                totalQuantity += expectedQuantities[i];
            }
        }
        mockMvc.perform( get( shoppingBasketUri ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );

        // check that each good has the correct quantity and comment ...
        for ( int i = 0; i < goodIndices.length; i++ ) {
            UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
            if ( expectedToBeFound[i] ) {
                mockMvc.perform( get( baseUri + goodId ) )
                        .andExpect( OK )
                        .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
                        .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
            } else {
                mockMvc.perform( get( baseUri + goodId ) )
                        .andExpect( NOT_FOUND );
            }
        }
    }


    public void checkMultipleShoppingBasketPositions( String userEmailString,
                                                         Integer[] goodIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments ) throws Exception {
        Boolean[] expectedToBeFound = new Boolean[goodIndices.length];
        for ( int i = 0; i < goodIndices.length; i++ ) {
            expectedToBeFound[i] = true;
        }
        checkMultipleShoppingBasketPositions( userEmailString, goodIndices, expectedQuantities,
                expectedComments, expectedToBeFound );
    }



    public void checkMultipleOrderPositionsInLatestOrder(
            String userEmailString, Integer[] goodIndices, Integer[] expectedQuantities,
            String[] expectedComments ) throws Exception {
        String latestOrderUri = "/orders?email=" + userEmailString + "&filter=latest";

        // Calculate the total price of the order ...
        float totalPrice = 0f;
        for ( int i = 0; i < goodIndices.length; i++ ) {
            totalPrice += expectedQuantities[i] * ((MoneyType) GOOD_DATA[goodIndices[i]][5]).getAmount();
        }

        // ... and check that the order has the correct total price (and other data)
        ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
                .andExpect( jsonPath( "$[0].email.emailString" ).value( userEmailString ) );

        // Now check that all the expected parts are there
        for ( int i = 0; i < goodIndices.length; i++ ) {
            UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
            resultActions.andExpect(
                    jsonPath( "$[0].orderPositions.length()" ).value( goodIndices.length ) );
            resultActions.andExpect(
                    jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].quantity" )
                            .value( expectedQuantities[i] ) );
            if ( expectedComments[i] != null ) {
                resultActions.andExpect(
                        jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].comment" )
                                .value( expectedComments[i] ) );
            }
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a comment, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class CommentDTO {
    private UUID goodId;
    private String comment;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just the id of an entity, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class IdDTO {
    private UUID id;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a quantity, used in testing.
 */


@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class QuantityAndCommentDTO {
    private UUID goodId;
    private Integer quantity;
    private String comment;

    public QuantityAndCommentDTO( UUID goodId, Integer quantity, String comment ) {
        this.goodId = goodId;
        this.quantity = quantity;
        this.comment = comment;
    }
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionEmailTest {

    @Test
    public void testToString() {
        // given
        String input = "test@example.com";

        // when
        EmailType instance = instantiateEmail( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
        assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateEmail( null ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        EmailType instance1 = instantiateEmail( "test@example.com" );
        EmailType instance2 = instantiateEmail( "test@example.com" );
        EmailType instance3 = instantiateEmail( "different@example.com" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        EmailType instance = instantiateEmail( "test@example.com" );

        // then
        try {
            instance.getClass().getMethod( "setEmail", String.class );
            fail( "setEmail method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionMoneyTest {

    @Test
    public void testGetAmount() {
        // given
        Float inputAmount = 10.0f;

        // when
        MoneyType instance = instantiateMoney( inputAmount, "EUR" );

        // then
        assertEquals( inputAmount, instance.getAmount() );
    }

    @Test
    public void testGetCurrency() {
        // given
        String inputCurrency = "EUR";

        // when
        MoneyType instance = instantiateMoney( 10.0f, inputCurrency );

        // then
        assertEquals( inputCurrency, instance.getCurrency() );
    }

    @Test
    public void testAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );

        // when
        MoneyType result12 = instance1.add( instance2 );
        MoneyType result13 = instance1.add( instance3 );

        // then
        assertEquals( 30.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 10.0f, result13.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
    }

    @Test
    public void testInvalidAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
    }

    @Test
    public void testSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );

        // when
        MoneyType result12 = instance1.subtract( instance2 );
        MoneyType result13 = instance1.subtract( instance3 );
        MoneyType result14 = instance1.subtract( instance4 );

        // then
        assertEquals( 10.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 30.0f, result13.getAmount() );
        assertEquals( "EUR", result13.getCurrency() );
        assertEquals( 0.0f, result14.getAmount() );
        assertEquals( "EUR", result14.getCurrency() );
    }

    @Test
    public void testInvalidSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
        assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
    }

    @Test
    public void testMultiplyBy() {
        // given
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // when
        MoneyType result = instance.multiplyBy( 3 );

        // then
        assertEquals( 30.0f, result.getAmount() );
        assertEquals( "EUR", result.getCurrency() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
    }

    @Test
    public void testLargerThan() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );

        // when
        // then
        assertTrue( instance2.largerThan( instance1 ) );
        assertFalse( instance1.largerThan( instance2 ) );
        assertFalse( instance1.largerThan( instance3 ) );
        assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
    }


    @Test
    public void testValueObjectEquality() {
        // given
        // when
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // then
        try {
            instance.getClass().getMethod( "setAmount", Float.class );
            fail( "setAmount method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }

        try {
            instance.getClass().getMethod( "setCurrency", String.class );
            fail( "setCurrency method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPersonalAddressTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionPersonalAddressTest {

    @Test
    public void testGetterMethods() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );

        // then
        assertEquals( street, instance.getStreet() );
        assertEquals( city, instance.getCity() );
        assertEquals( plz, instance.getZipCode() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        // then
        assertDoesNotThrow( () -> instantiatePersonalAddress( street, city, plz ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        // then
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( null, city, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( "", city, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, null, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, "", plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, city, null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance1 = instantiatePersonalAddress( street, city, plz );
        PersonalAddressType instance2 = instantiatePersonalAddress( street, city, plz );
        PersonalAddressType instance3 = instantiatePersonalAddress( "Anderestr. 12", city, plz );
        PersonalAddressType instance4 = instantiatePersonalAddress( street, "AndereStadt", plz );
        PersonalAddressType instance5 = instantiatePersonalAddress( street, city, instantiateZipCode( "54321" ) );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
        assertNotEquals( instance1, instance4 );
        assertNotEquals( instance1, instance5 );
    }

    @Test
    public void testImmutability() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );

        // then
        try {
            instance.getClass().getMethod( "setStreet", String.class );
            fail( "setStreet method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setCity", String.class );
            fail( "setCity method should not exist" );

        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setZipCode", ZipCodeType.class );
            fail( "setZipCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionZipCodeTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionZipCodeTest {

    @Test
    public void testToString() {
        // given
        String input = "12345";

        // when
        ZipCodeType instance = instantiateZipCode( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateZipCode( "12345" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateZipCode( "123456" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( "1234" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( "20000" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        ZipCodeType instance1 = instantiateZipCode( "12345" );
        ZipCodeType instance2 = instantiateZipCode( "12345" );
        ZipCodeType instance3 = instantiateZipCode( "54321" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        ZipCodeType instance = instantiateZipCode( "12345" );

        // then
        try {
            instance.getClass().getMethod( "setzipCode", String.class );
            fail( "setzipCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionGoodCatalogTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;
import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;

@SpringBootTest
@Transactional
public class RegressionGoodCatalogTest {

    @Autowired
    private GoodCatalogUseCases goodCatalogUseCases;
    @Autowired
    private InventoryManagementUseCases inventoryManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
    }



    @Test
    public void testAddGoodToCatalog() {
        // given
        initialMasterDataCreator.addAllGoods();

        // when
        MoneyType sellingPrice = goodCatalogUseCases.getSellingPrice( (UUID) GOOD_DATA[4][0] );

        // then
        assertEquals( GOOD_DATA[4][5], sellingPrice );
    }

    @Test
    public void testRemoveGoodFromCatalog() {
        // given
        initialMasterDataCreator.addAllGoods();
        UUID goodId = (UUID) GOOD_DATA[4][0];

        // when
        assertDoesNotThrow( () -> goodCatalogUseCases.getSellingPrice( goodId ) );
        goodCatalogUseCases.removeGoodFromCatalog( goodId );

        // then
        assertThrows( ShopException.class, () -> goodCatalogUseCases.getSellingPrice( goodId ) );
    }




    @Test
    public void testRemoveGoodThatIsInInventory() {
        // given
        initialMasterDataCreator.addAllGoods();
        UUID goodId = (UUID) GOOD_DATA[4][0];
        inventoryManagementUseCases.addToInventory( goodId, 3 );

        // when
        // then
        assertThrows( ShopException.class, () -> goodCatalogUseCases.removeGoodFromCatalog( goodId ) );
    }


    @Test
    public void testClearGoodCatalog() {
        // given
        initialMasterDataCreator.addAllGoods();

        // when
        goodCatalogUseCases.deleteGoodCatalog();

        // then
        assertThrows( ShopException.class, () -> goodCatalogUseCases.getSellingPrice( (UUID) GOOD_DATA[4][0] ) );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionInventoryManagementTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.InventoryManagementUseCases;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_INVENTORY;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;

@SpringBootTest
@Transactional
public class RegressionInventoryManagementTest {

    @Autowired
    private InventoryManagementUseCases inventoryManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        initialMasterDataCreator.addAllGoods();
    }



    @Test
    public void testAddToInventory() {
        // given
        initialMasterDataCreator.inventoryUpAllGoods();
        UUID goodId8 = (UUID) GOOD_DATA[8][0];

        // when
        int inventory8before = inventoryManagementUseCases.getAvailableInventory( goodId8 );
        assertEquals( GOOD_INVENTORY.get( goodId8 ), inventory8before );
        inventoryManagementUseCases.addToInventory( goodId8, 22 );
        int inventory8after = inventoryManagementUseCases.getAvailableInventory( goodId8 );
        inventoryManagementUseCases.addToInventory( goodId8, 1 );
        int inventory8after2 = inventoryManagementUseCases.getAvailableInventory( goodId8 );

        // then
        assertEquals( inventory8before + 22, inventory8after );
        assertEquals( inventory8after + 1, inventory8after2 );
    }


    @Test
    public void testRemoveFromInventory() {
        // given
        initialMasterDataCreator.inventoryUpAllGoods();
        UUID goodId6 = (UUID) GOOD_DATA[6][0];
        int inventory6before = GOOD_INVENTORY.get( goodId6 );
        UUID goodId9 = (UUID) GOOD_DATA[9][0];
        int inventory9before = GOOD_INVENTORY.get( goodId9 );
        UUID goodId1 = (UUID) GOOD_DATA[1][0];
        int inventory1before = GOOD_INVENTORY.get( goodId1 );

        // when
        inventoryManagementUseCases.removeFromInventory( goodId6, 1 );
        int inventory6after = inventoryManagementUseCases.getAvailableInventory( goodId6 );
        inventoryManagementUseCases.removeFromInventory( goodId1, 3 );
        int inventory1after = inventoryManagementUseCases.getAvailableInventory( goodId1 );
        inventoryManagementUseCases.removeFromInventory( goodId9, inventory9before );
        int inventory9after = inventoryManagementUseCases.getAvailableInventory( goodId9 );

        // then
        assertEquals( inventory6before - 1, inventory6after );
        assertEquals( inventory1before - 3, inventory1after );
        assertEquals( 0, inventory9after );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionUserRegistrationTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;

import javax.transaction.Transactional;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_ADDRESS;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
public class RegressionUserRegistrationTest {

    @Autowired
    private UserRegistrationUseCases userRegistrationUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    private EmailType nonExistingEmail;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        nonExistingEmail = instantiateEmail( "this@nononono.de" );
    }


    @Test
    public void testAllUsersRegistered() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        UserType user3 = userRegistrationUseCases.getUserData( USER_EMAIL[3] );

        // then
        Assertions.assertEquals( initialMasterDataCreator.USER_NAME[3], user3.getName() );
        Assertions.assertEquals( USER_EMAIL[3], user3.getEmail() );
        Assertions.assertEquals( USER_ADDRESS[3], user3.getPersonalAddress() );
    }


    @Test
    public void testRegisterUserWithDuplicateEmail() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        // then
        assertThrows( ShopException.class, () ->
                userRegistrationUseCases.register( "Gandalf The Grey", USER_EMAIL[5],
                        USER_ADDRESS[5] ) );
    }

    @Test
    public void testRegisterUserWithDuplicateNameOrPersonalAddress() {
        // given
        initialMasterDataCreator.registerAllUsers();
        EmailType newEmail = instantiateEmail( "some@this.de" );

        // when
        // then
        assertDoesNotThrow(() ->
                userRegistrationUseCases.register( initialMasterDataCreator.USER_NAME[2], newEmail,
                        USER_ADDRESS[2] ) );
    }


    @Test
    public void testDeleteUsersNoMoreUsers() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        userRegistrationUseCases.deleteAllUsers();

        // then
        assertThrows( ShopException.class, () -> userRegistrationUseCases.getUserData( USER_EMAIL[0] ) );
    }

}


[RESPONSE]:
# Code Review Ergebnisse

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java

[DeliveryService.java] Zeile(n) 7-8: **layer violation** : DeliveryService im application-Layer greift direkt auf `User` und `UserRepository` aus `solution.user.domain` zu. Dies verletzt die Schichtenarchitektur, da auf die Domain-Schicht eines anderen Packages zugegriffen wird.

[DeliveryService.java] Zeile(n) 8: **shared persistency** : `UserRepository` aus dem `user`-Package wird hier injiziert und verwendet, obwohl es zum `user`-Domain-Package gehört.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java

[Delivery.java] Zeile(n) 6: **layer violation** : Die Domain-Entity `Delivery` hat eine direkte Abhängigkeit zu `User` aus `solution.user.domain`, was eine Kopplung zwischen Domain-Schichten verschiedener Packages darstellt.

[Delivery.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodService.java

[GoodService.java] Zeile(n) 8: **shared persistency** : `UserRepository` aus dem `user`-Package wird injiziert, obwohl dieser Service zum `good`-Package gehört.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java

[Good.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderApplicationService.java

[OrderApplicationService.java] Zeile(n) 8-9: **shared persistency** : `UserRepository` aus dem `user`-Package wird im `order`-Package verwendet.

[OrderApplicationService.java] Zeile(n) 61-95, Original 38-60: **Duplication** : Die Methoden `findAllCustomer` und `findLatestCustomer` enthalten ähnliche Logik zum Mapping von `Order` zu `OrderDTO` und `OrderPosition` zu `OrderPositionDTO`.

[OrderApplicationService.java] Zeile(n) 97-107, Original 110-121: **Duplication** : `totalPriceMethod` und `totalPriceMethod2` haben sehr ähnliche Strukturen und könnten zusammengeführt werden.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java

[Order.java] Zeile(n) 7-8: **layer violation** : Die Domain-Entity `Order` hat direkte Abhängigkeiten zu `Payment` aus `solution.payment.domain` und `User` aus `solution.user.domain`.

[Order.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java

[OrderPosition.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java

[PaymentService.java] Zeile(n) 10-11: **shared persistency** : `UserRepository` aus dem `user`-Package und `DeliveryRepository` aus dem `delivery`-Package werden im `payment`-Package verwendet.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java

[Payment.java] Zeile(n) 6: **layer violation** : Die Domain-Entity `Payment` hat eine direkte Abhängigkeit zu `User` aus `solution.user.domain`.

[Payment.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java

[ShoppingBasketService.java] Zeile(n) 14-17: **shared persistency** : `UserRepository`, `OrderRepository`, `OrderPositionRepository`, `GoodRepository` und `DeliveryRepository` aus anderen Packages werden verwendet.

[ShoppingBasketService.java] Zeile(n) 63-74, Original 95-109: **Duplication** : Die Logik zum Aktualisieren von `goods`-Map und Speichern von `ShoppingBasketPosition` in `addGoodToShoppingBasket` und `removeGoodFromShoppingBasket` ist sehr ähnlich.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java

[ShoppingBasket.java] Zeile(n) 7: **layer violation** : Die Domain-Entity `ShoppingBasket` hat eine direkte Abhängigkeit zu `User` aus `solution.user.domain`.

[ShoppingBasket.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketPosition.java

[ShoppingBasketPosition.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java

[User.java] - **Anemic Entity** : Die Klasse enthält nur Getter/Setter und keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\solution\user\UserBasketInterface.java

[UserBasketInterface.java] Zeile(n) 1-12: **dead code** : Die gesamte Klasse ist auskommentiert und wird nirgendwo verwendet.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java

[Email.java] Zeile(n) 7: **dead code** : Import `EmailValidator` aus Hibernate wird nicht verwendet.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_867df21d-ce4c-427f-b145-f14f32397be2\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java

[Money.java] Zeile(n) 5: **dead code** : Import `org.springframework.stereotype.Service` wird nicht verwendet.

ENDE
Generated by claude-opus-4-5-20251101
-----------------------------------