--- DATE: 8.1.2026, 20:48:35 ---

[PROMPT]:
Du bist ein erfahrener Java-Reviewer.
    Architektur: 4-Layer (Eric Evans).
    Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
    Regeln:
    1. Begründe kurz jeden Fund.
    4. Gruppiere nach Datei (mit Pfad). 
    2. Format unter der Datei je Smell: [Dateiname (ohne Pfad)] [Zeile(n) X]: [Smell] [Nur bei Duplizierung: die original Zeile(n)] : [Begründung].
    3. Keine Code-Wiederholung, nur Referenzen.
    5. Wenn fertig, schreibe "ENDE".



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\MailAddress.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AccessLevel;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import javax.persistence.Embeddable;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

@Getter
@Embeddable
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class MailAddress implements MailAddressType {
    private String mailAddressString;

    private MailAddress(String mailAddressString){
        this.mailAddressString = mailAddressString;
    }

    public static MailAddress of( String mailAddressAsString ){
        if (mailAddressAsString == null) throw new ShopException("Mail address must not be null!");
        String regex = "^[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+)*@"
                + "[^-][A-Za-z0-9-]*(\\.[A-Za-z0-9-]+)*(\\.[deatcomrgh]+)$";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(mailAddressAsString);
        if(!matcher.matches()){
            throw new ShopException("No valid Mail Address!");
        }
        return new MailAddress(mailAddressAsString);
    }

    @Override
    public String toString(){
        return mailAddressString;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AccessLevel;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.persistence.Embeddable;
import java.util.Arrays;

@Getter
@Embeddable
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Money implements MoneyType {
    private Float amount;
    private String currency;


    private Money(Float amount, String currency){
        this.amount = amount;
        this.currency = currency;
    }

    public static Money of(Float amount, String currency ){
        if (amount == null) throw new ShopException("Amount must not be null");
        if (amount < 0) throw new ShopException("Amount must be over zero");
        if (currency == null) throw new ShopException("Currency must not be null");
        String[] allowedValues = {"EUR", "CHF"};
        if (!Arrays.asList(allowedValues).contains(currency))throw new ShopException("Currency is not available");
        return new Money(amount, currency);
    }

    @Override
    public MoneyType add(MoneyType otherMoney) {
        if (otherMoney == null) throw new ShopException("Other money is null");
        if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
        return Money.of(this.getAmount()+ otherMoney.getAmount(), this.getCurrency());
    }

    @Override
    public MoneyType subtract(MoneyType otherMoney) {
        if (otherMoney == null) throw new ShopException("Other money is null");
        if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
        if (otherMoney.getAmount() > this.getAmount()) throw new ShopException("Invalid Amount");
        return Money.of(this.getAmount() - otherMoney.getAmount(), this.getCurrency());
    }

    @Override
    public MoneyType multiplyBy(int factor) {
        if (factor < 0)throw new ShopException("Factor must not be negative");
        return Money.of(this.getAmount() * factor, this.getCurrency());
    }

    @Override
    public boolean largerThan(MoneyType otherMoney) {
        if (otherMoney == null) throw new ShopException("Other money is null");
        if (otherMoney.getCurrency() != this.getCurrency()) throw new ShopException("Currency is diffrent");
        if (otherMoney.getAmount() < this.getAmount()) return true;
        else return false;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PersonalAddress.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AccessLevel;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import javax.persistence.Embeddable;
import javax.persistence.Embedded;

@Getter
@Embeddable
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class PersonalAddress implements PersonalAddressType{
    private String street;
    private String city;
    @Embedded
    private ZipCode zipCode;

    private PersonalAddress(String street, String city, ZipCodeType zipCode){
        this.street = street;
        this.city = city;
        this.zipCode = (ZipCode) zipCode;
    }

    public static PersonalAddress of( String street, String city, ZipCodeType zipCode ){
        if (street == null || street.isEmpty()) throw new ShopException("Street is null or empty");
        if (city == null || city.isEmpty()) throw new ShopException("City is null or empty");
        if (zipCode == null) throw new ShopException("Zip code is null");
        return new PersonalAddress(street, city, zipCode);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java ---
package thkoeln.archilab.ecommerce.domainprimitives;

import lombok.AccessLevel;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NoArgsConstructor;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import javax.persistence.Embeddable;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

@Getter
@Embeddable
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class ZipCode implements ZipCodeType {
    private String content;

    private ZipCode(String content){
        this.content = content;
    }

    public static ZipCodeType of( String zipCodeAsString ){
        if (zipCodeAsString == null) throw new ShopException("Zip code must not be null");
        String regex = "^[0-9]{5}";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(zipCodeAsString);
        if(!matcher.matches()){
            throw new ShopException("No valid zip code!");
        }
        if(zipCodeAsString.endsWith("0000")) throw new ShopException("No valid zip code");
        return new ZipCode(zipCodeAsString);
    }

    @Override
    public String toString(){
        return content;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
package thkoeln.archilab.ecommerce.masterdata;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.io.File;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.net.URL;
import java.net.URLDecoder;
import java.nio.charset.StandardCharsets;
import java.util.Enumeration;

import static org.junit.jupiter.api.Assertions.*;

public class FactoryMethodInvoker {

    public static MailAddressType instantiateMailAddress( String mailAddressAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for MailAddressType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, mailAddressAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + mailAddressAsString + "'", e );
        }
        assertNotNull( instance );
        return (MailAddressType) instance;
    }


    public static PersonalAddressType instantiatePersonalAddress(
            String street, String city, ZipCodeType zipCode ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of",
                    String.class, String.class, ZipCodeType.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for PersonalAddressType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, street, city, zipCode );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" +
                    street + "', '" + city + "', '" + zipCode + "'", e );
        }
        assertNotNull( instance );
        return (PersonalAddressType) instance;
    }


    public static ZipCodeType instantiateZipCode( String zipCodeAsString ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for ZipCodeType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, zipCodeAsString );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + zipCodeAsString + "'", e );
        }
        assertNotNull( instance );
        return (ZipCodeType) instance;
    }


    public static MoneyType instantiateMoney( Float amount, String currency ) {
        Method factoryMethod = null;
        try {
            Class<?> interfaceClass = Class.forName(
                    "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
            Class<?> implementingClass = findImplementation( interfaceClass );

            factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
            assertNotNull( factoryMethod );
            int modifiers = factoryMethod.getModifiers();
            assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
        } catch (Exception e) {
            fail( "Failed to find implementation for MoneyType", e );
        }

        Object instance = null;
        try {
            instance = factoryMethod.invoke( null, amount, currency );
        } catch (Exception e) {
            if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
                    instanceof ShopException ) throw new ShopException( e.getMessage() );
            fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
        }
        assertNotNull( instance );
        return (MoneyType) instance;
    }


    private static Class<?> findImplementation( Class<?> interfaceClass ) {
        Method factoryMethod = null;
        try {
            String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
            Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
            assertNotNull( implementingClass );
            return implementingClass;
        } catch (Exception e) {
            fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
            return null; // This line will never be reached, but it's necessary to satisfy the compiler
        }
    }


    private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
            throws ClassNotFoundException, IOException {
        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        String path = packageName.replace( '.', '/' );
        Enumeration<URL> resources = classLoader.getResources( path );
        int count = 0;
        Class<?> result = null;
        while (resources.hasMoreElements()) {
            URL resource = resources.nextElement();
            File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
            File[] files = directory.listFiles();
            for ( File file : files ) {
                if ( file.getName().endsWith( ".class" ) ) {
                    String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
                    Class<?> clazz = Class.forName( className );
                    if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
                        count++;
                        result = clazz;
                    }
                }
            }
        }
        assertEquals( 1, count, "There should be exactly one implementing class" );
        return result;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;
import thkoeln.archilab.ecommerce.usecases.*;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;
import java.util.UUID;


/**
 * This class is used to create the initial master data for the application. This includes
 * users and things. It is executed on application startup, and is used for testing purposes.
 */
@Component
@SuppressWarnings("PMD")
public class InitialMasterDataCreator {

    public final static String[] USER_NAME = new String[]{
            "Max Müller",
            "Sophie Schmitz",
            "Irene Mihalic",
            "Emilia Fischer",
            "Filiz Polat",
            "Lina Wagner",
            "Leon Becker",
            "Agnieszka Kalterer",
            "Felix Bauer",
            "Lara Schulz"
    };
    public final static MailAddressType[] USER_EMAIL = new MailAddressType[] {
            FactoryMethodInvoker.instantiateMailAddress( "max.mueller@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "sophie.schmitz@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "irene@wearefreedomnow.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "emilia.fischer@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "j877d3@gmail.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "lina.wagner@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "leon.becker@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "agna@here.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "felix.bauer@example.com" ),
            FactoryMethodInvoker.instantiateMailAddress( "lara.schulz@example.com" )
    };

    public final static PersonalAddressType[] USER_ADDRESS = new PersonalAddressType[] {
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Hauptstraße 1", "Berlin",
                    FactoryMethodInvoker.instantiateZipCode( "10115" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Bahnhofstraße 12", "München",
                    FactoryMethodInvoker.instantiateZipCode( "80331" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Kirchplatz 3", "Hamburg",
                    FactoryMethodInvoker.instantiateZipCode( "20095" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Goethestraße 7", "Frankfurt am Main",
                    FactoryMethodInvoker.instantiateZipCode( "60311" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Mühlenweg 15", "Köln",
                    FactoryMethodInvoker.instantiateZipCode( "50667" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Schulstraße 9", "Düsseldorf",
                    FactoryMethodInvoker.instantiateZipCode( "40213" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Dorfstraße 21", "Stuttgart",
                    FactoryMethodInvoker.instantiateZipCode( "70173" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Marktstraße 5", "Leipzig",
                    FactoryMethodInvoker.instantiateZipCode( "04109" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Rosenweg 14", "Dortmund",
                    FactoryMethodInvoker.instantiateZipCode( "44135" ) ),
            FactoryMethodInvoker.instantiatePersonalAddress(
                    "Wiesenstraße 6", "Essen",
                    FactoryMethodInvoker.instantiateZipCode( "45127" ) )
    };

    public final static UserType[] mockUsers;

    public static final String EUR = "EUR";

    public static final Object[][] THING_DATA = new Object[][]{
            {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
                    1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
            {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
                    0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
            {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
                    7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
            {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
                    null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
            {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
                    null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
            {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
                    1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
            {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
                    null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
            {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
                    6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
            {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
                    3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
            {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
                    5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
            {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
                    4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
            {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
                    null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
            {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
                    null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
            {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
                    3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
                    FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
    };

    private UserRegistrationUseCases userRegistrationUseCases;
    private ThingCatalogUseCases thingCatalogUseCases;
    private StockManagementUseCases stockManagementUseCases;
    private ShoppingCartUseCases shoppingCartUseCases;


    // thing 0 is out of stock, thing 1 and 2 have fixed quantities of 10 and 20, respectively, and the
    // others have a random stock between 5 and 100
    public static final Map<UUID, Integer> THING_STOCK = new HashMap<>();

    static {
        mockUsers = new UserType[USER_NAME.length];
        for ( int i = 0; i < USER_NAME.length; i++ ) {
            mockUsers[i] = new MockUser(
                    USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i]);
        }
        Random random = new Random();
        for ( Object[] thingData : THING_DATA ) {
            THING_STOCK.put( (UUID) thingData[0], random.nextInt( 100 ) + 20 );
        }
        THING_STOCK.put( (UUID) THING_DATA[0][0], 0 );
        THING_STOCK.put( (UUID) THING_DATA[1][0], 10 );
        THING_STOCK.put( (UUID) THING_DATA[2][0], 20 );
        THING_STOCK.put( (UUID) THING_DATA[3][0], 30 );

    }


    public enum InvalidReason {
        NULL, EMPTY;

        public Object getInvalidValue( Object originalValue ) {
            switch (this) {
                case NULL:
                    return null;
                case EMPTY:
                    return "";
                default:
                    return null;
            }
        }
    }


    @Autowired
    public InitialMasterDataCreator(
            UserRegistrationUseCases userRegistrationUseCases,
            ThingCatalogUseCases thingCatalogUseCases,
            StockManagementUseCases stockManagementUseCases,
            ShoppingCartUseCases shoppingCartUseCases ) {
        this.userRegistrationUseCases = userRegistrationUseCases;
        this.thingCatalogUseCases = thingCatalogUseCases;
        this.stockManagementUseCases = stockManagementUseCases;
        this.shoppingCartUseCases = shoppingCartUseCases;
    }


    public void deleteAll() {
        shoppingCartUseCases.deleteAllOrders();
        thingCatalogUseCases.deleteThingCatalog();
        userRegistrationUseCases.deleteAllUsers();
    }


    public void registerAllUsers() {
        for ( int i = 0; i < InitialMasterDataCreator.USER_NAME.length; i++ ) {
            registerUser( InitialMasterDataCreator.USER_NAME[i], USER_EMAIL[i], USER_ADDRESS[i] );
        }
    }


    public void registerUser( String name, MailAddressType mailAddress, PersonalAddressType personalAddress ) {
        userRegistrationUseCases.register( name, mailAddress, personalAddress );
    }

    public void addAllThings() {
        for ( Object[] thingData : THING_DATA ) {
            addThingDataToCatalog( thingData );
        }
    }

    public void addThingDataToCatalog( Object[] thingData ) {
        thingCatalogUseCases.addThingToCatalog( (UUID) thingData[0], (String) thingData[1], (String) thingData[2],
                (Float) thingData[3], (MoneyType) thingData[4], (MoneyType) thingData[5] );
    }


    public Object[] getThingDataInvalidAtIndex( int index, InvalidReason reason ) {
        Object[] thingData = THING_DATA[1];
        Object[] thingDataInvalid = new Object[thingData.length];
        System.arraycopy( thingData, 0, thingDataInvalid, 0, thingData.length );
        thingDataInvalid[index] = thingData[index].getClass().cast(
                reason.getInvalidValue( thingData[index] ) );
        return thingDataInvalid;
    }


    public void stockUpAllThings() {
        for ( Object[] thingData : THING_DATA ) {
            if ( THING_STOCK.get( thingData[0] ) > 0 )
                stockManagementUseCases.addToStock( (UUID) thingData[0], THING_STOCK.get( thingData[0] ) );
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockUser.java ---
package thkoeln.archilab.ecommerce.masterdata;

import lombok.Setter;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

import java.util.Objects;

@Setter
public class MockUser implements UserType {
    private String name;
    private MailAddressType mailAddress;
    private PersonalAddressType personalAddress;


    public MockUser( String name, MailAddressType mailAddress, PersonalAddressType personalAddress) {
        this.name = name;
        this.mailAddress = mailAddress;
        this.personalAddress = personalAddress;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public MailAddressType getMailAddress() {
        return mailAddress;
    }

    @Override
    public PersonalAddressType getPersonalAddress() {
        return personalAddress;
    }

    @Override
    public boolean equals( Object o ) {
        if ( this == o ) return true;
        if ( !( o instanceof MockUser ) ) return false;
        MockUser that = (MockUser) o;
        return Objects.equals( getName(), that.getName() ) && Objects.equals( mailAddress, that.mailAddress ) && Objects.equals( personalAddress, that.personalAddress );
    }

    @Override
    public int hashCode() {
        return Objects.hash( getName(), mailAddress, personalAddress );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
package thkoeln.archilab.ecommerce.masterdata;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Profile;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;

@Component
@Profile("!test")
public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
    private Logger logger = LoggerFactory.getLogger( StartupListener.class );

    private InitialMasterDataCreator initialMasterDataCreator;

    @Autowired
    public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
        this.initialMasterDataCreator = initialMasterDataCreator;
    }

    @Override
    public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
        logger.info( "Initializing master data..." );
        initialMasterDataCreator.registerAllUsers();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
package thkoeln.archilab.ecommerce;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;


@SpringBootApplication
public class ProjectApplication {

	/**
	 * Entry method
	 * @param args
	 */
	public static void main(String[] args) {
		SpringApplication.run(ProjectApplication.class, args);
	}
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
package thkoeln.archilab.ecommerce;

public class ShopException extends RuntimeException {
    public ShopException( String message ) {
        super( message );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\core\domain\AbstractUser.java ---
package thkoeln.archilab.ecommerce.solution.core.domain;

import lombok.Getter;
import lombok.Setter;
import thkoeln.archilab.ecommerce.usecases.UserType;

import javax.persistence.Entity;
import javax.persistence.Id;
import java.util.UUID;

@Entity
@Getter
@Setter
public abstract class AbstractUser implements UserType {
    @Id
    final UUID id = UUID.randomUUID();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryRecipientService.java ---
package thkoeln.archilab.ecommerce.solution.delivery.application;

import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

public interface DeliveryRecipientService {
    public UserType findUserByMail(MailAddressType userMailAddress);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
package thkoeln.archilab.ecommerce.solution.delivery.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@Service
public class DeliveryService implements DeliveryUseCases {

    @Autowired
    private DeliveryRecipientService deliveryRecipientService;
    @Autowired
    private DeliveryRepository deliveryRepository;

    @Override
    public UUID triggerDelivery(UserType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
        if (deliveryRecipient == null) throw new ShopException("Delivery recipient is null");
        if (deliveryRecipient.getMailAddress() == null || deliveryRecipient.getName() == null ||
                deliveryRecipient.getName().isBlank() || deliveryRecipient.getPersonalAddress() == null)
                    throw new ShopException("Content in delivery recipient is empty");
        int totalQuantity = 0;
        for (Integer quantity : deliveryContent.values()){
            totalQuantity += quantity;
            if (totalQuantity > 20) throw new ShopException("To many items");
        }
        Delivery delivery = new Delivery(
                (User) deliveryRecipientService.findUserByMail(deliveryRecipient.getMailAddress()), deliveryContent);
        deliveryRepository.save(delivery);
        return delivery.getId();
    }

    @Override
    public Map<UUID, Integer> getDeliveryHistory(MailAddressType userMailAddress) {
        if (userMailAddress == null) throw new ShopException("User mail address is null");
        List<Delivery> userDeliveries =
                deliveryRepository.findByDeliveryRecipient
                        ((User) deliveryRecipientService.findUserByMail(userMailAddress));
        Map<UUID, Integer> deliveryHistory = new HashMap<>();
        for (Delivery delivery : userDeliveries) {
            Map<UUID, Integer> deliveryContent = delivery.getDeliveryContent();
            for (Map.Entry<UUID, Integer> entry : deliveryContent.entrySet()){
                if (deliveryHistory.containsKey(entry.getKey())){
                    deliveryHistory.replace(entry.getKey(), deliveryHistory.get(entry.getKey())+entry.getValue());
                    continue;
                }
                deliveryHistory.put(entry.getKey(), entry.getValue());
            }
        }
        return deliveryHistory;
    }

    @Override
    public void deleteDeliveryHistory() {
        deliveryRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;

import javax.persistence.ElementCollection;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.ManyToOne;
import java.util.Map;
import java.util.UUID;



@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Delivery {
    @Id
    final UUID id = UUID.randomUUID();

    @ManyToOne
    public AbstractUser deliveryRecipient;

    @ElementCollection
    Map<UUID, Integer> deliveryContent;

    public Delivery(AbstractUser deliveryRecipient, Map<UUID, Integer> deliveryContent){
        this.deliveryRecipient = deliveryRecipient;
        this.deliveryContent = deliveryContent;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
package thkoeln.archilab.ecommerce.solution.delivery.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
import java.util.List;
import java.util.UUID;

@Repository
public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
    public List<Delivery> findByDeliveryRecipient(AbstractUser deliveryUser);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;

import java.util.ArrayList;
import java.util.UUID;

@Setter
@Getter
@AllArgsConstructor
@NoArgsConstructor
public class OrderDTO {
    private UUID orderId;
    private MailAddress mailAddress;
    private Money price;
    private ArrayList<OrderPositionDTO> orderPositions;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderPositionDTO.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;

@Setter
@Getter
@AllArgsConstructor
@NoArgsConstructor
public class OrderPositionDTO {
    private UUID thingId;
    private int quantity;
    private String comment;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderRESTController.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import java.util.ArrayList;

@RestController
public class OrderRESTController {
    private OrderService orderService;

    @Autowired
    public OrderRESTController(OrderService orderService){
        this.orderService = orderService;
    }

    @GetMapping(value = "/orders")
    @ResponseBody
    public ResponseEntity<ArrayList<OrderDTO>> getOrders(@RequestParam(required = false) String mailAddress,
                                                         @RequestParam(required = false) String filter){
        if (mailAddress == null || mailAddress.isEmpty())
            return ResponseEntity.ok().body(new ArrayList<>());
        try{
            MailAddress mailAddressObject = MailAddress.of(mailAddress);
            ArrayList<OrderDTO> userOrders = orderService.findByUserAsDTO(mailAddressObject);
            if ("latest".equals(filter)){
                ArrayList<OrderDTO> latestOrder = new ArrayList<>();
                if (userOrders.size() != 0) latestOrder.add(userOrders.get(userOrders.size()-1));
                return ResponseEntity.ok().body(latestOrder);
            }
            return ResponseEntity.ok().body(userOrders);
        }catch(ShopException shopException){
            return ResponseEntity.ok().body(new ArrayList<>());
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.*;

@Service
public class OrderService {
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private ThingCatalogService thingCatalogService;
    @Autowired
    private OrderUserService orderUserService;

    public List<Order> findByUser(MailAddressType userMailAddress){
        return orderRepository.findByUser((User) orderUserService.findUserByMail(userMailAddress));
    }

    public ArrayList<OrderDTO> findByUserAsDTO(MailAddressType userMailAddress){
        try{
            orderUserService.findUserByMail(userMailAddress);
        }
        catch (ShopException shopException) {
            return new ArrayList<>();
        }
        Iterable<Order> foundUserOrders =
                findByUser(userMailAddress);
        ArrayList<OrderDTO> foundDTOs = new ArrayList<>();
        ModelMapper modelMapper = new ModelMapper();
        for (Order order : foundUserOrders){
            Iterable<OrderPosition> orderPositions = order.getOrderPositions();
            OrderDTO dto = modelMapper.map(order, OrderDTO.class);
            dto.setMailAddress((MailAddress) order.getUser().getMailAddress());
            dto.setPrice((Money) getFullPrice(order));
            ArrayList<OrderPositionDTO> orderPositionDTOS = new ArrayList<>();
            for (OrderPosition op: orderPositions){
                OrderPositionDTO orderPositionDTO = modelMapper.map(op, OrderPositionDTO.class);
                orderPositionDTOS.add(orderPositionDTO);
            }
            dto.setOrderPositions(orderPositionDTOS);
            foundDTOs.add(dto);
        }
        return foundDTOs;
    }

    public Iterable<Order> findAll(){
        return orderRepository.findAll();
    }

    public ArrayList<OrderDTO> findAllAsDTO(){
        Iterable<Order> allOrders = findAll();
        ArrayList allDTOs = new ArrayList<OrderDTO>();
        ModelMapper modelMapper = new ModelMapper();
        for (Order order : allOrders){
            allDTOs.add(modelMapper.map(order, OrderDTO.class));
        }
        return allDTOs;
    }

    private MoneyType getFullPrice(Order order){
        MoneyType fullPrice = Money.of(0.0f, "EUR");
        for (OrderPosition op: order.getOrderPositions()) {
            fullPrice = fullPrice.add(op.getThing().getSellingPrice().multiplyBy(op.getQuantity()));
        }
        return fullPrice;
    }

    public Order initializeOrder(MailAddressType userMail){
        Order order = new Order((User) orderUserService.findUserByMail(userMail));
        orderRepository.save(order);
        return order;
    }

    public void addToOrder(Order order, UUID thingId, int quantity, String comment){
        order.getOrderPositions().add(
                new OrderPosition(quantity,
                        thingCatalogService.findThingInCatalog(thingId),
                        comment));
        orderRepository.save(order);
    }

    public void deleteAll() {
        orderRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderUserService.java ---
package thkoeln.archilab.ecommerce.solution.order.application;

import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

public interface OrderUserService {
    public UserType findUserByMail(MailAddressType userMailAddress);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
import javax.persistence.*;
import java.util.HashSet;
import java.util.Set;
import java.util.UUID;

@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Table(name = "neuername")
public class Order {

    @Id
    final UUID id = UUID.randomUUID();

    @ManyToOne
    private AbstractUser user;

    @ElementCollection( targetClass = OrderPosition.class, fetch = FetchType.EAGER)
    private Set<OrderPosition> orderPositions = new HashSet<>();

    public void addOrderPosition(Thing thing, int quantity, String comment){
        orderPositions.add(new OrderPosition(quantity, thing, comment));
    }

    public Order(AbstractUser user){
        this.user = user;
        this.orderPositions = new HashSet<OrderPosition>();
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import lombok.*;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;

import javax.persistence.Embeddable;
import javax.persistence.OneToOne;
import java.util.UUID;

@Embeddable
@Getter
@AllArgsConstructor
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class OrderPosition {

    private int quantity;

    @OneToOne
    private Thing thing;

    private String comment;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
package thkoeln.archilab.ecommerce.solution.order.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
import java.util.List;
import java.util.UUID;

@Repository
public interface OrderRepository extends CrudRepository<Order, UUID> {
    public List<Order> findByUser(AbstractUser user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
package thkoeln.archilab.ecommerce.solution.payment.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.List;
import java.util.UUID;

@Service
public class PaymentService implements PaymentUseCases {
    @Autowired
    private PaymentUserService paymentUserService;
    @Autowired
    private PaymentRepository paymentRepository;


    @Override
    public UUID authorizePayment(MailAddressType userMailAddress, MoneyType amount) {
        if (userMailAddress == null) throw new ShopException("Mail is empty");
        if (amount == null || amount.getAmount() <= 0.00)throw new ShopException("Amount must not be 0 or lower");
        if (amount.getAmount() > 500.00)throw new ShopException("Amount is over the limit");
        Payment payment = new Payment(
                (User) paymentUserService.findUserByMail(userMailAddress), (Money) amount);
        paymentRepository.save(payment);
        return payment.getId();
    }

    @Override
    public MoneyType getPaymentTotal(MailAddressType userMailAddress) {
        if (userMailAddress == null)
            throw new ShopException("User mail address is null or empty");
        List<Payment> userPayments =
                paymentRepository.findByDeliveryRecipient(
                        (User) paymentUserService.findUserByMail(userMailAddress));
        if (userPayments.isEmpty()) return null;
        MoneyType total = Money.of(0.00F, userPayments.get(0).getAmount().getCurrency());
        for (Payment userPayment : userPayments){
            total = total.add(userPayment.getAmount());
        }
        return total;
    }

    @Override
    public void deletePaymentHistory() {
        paymentRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentUserService.java ---
package thkoeln.archilab.ecommerce.solution.payment.application;

import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

public interface PaymentUserService {
    public UserType findUserByMail(MailAddressType userMailAddress);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.ManyToOne;
import java.util.UUID;

@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Payment {

    @Id
    final UUID id = UUID.randomUUID();

    @ManyToOne
    private AbstractUser deliveryRecipient;

    private Money amount;

    public Payment(AbstractUser deliveryRecipient, Money amount){
        this.deliveryRecipient = deliveryRecipient;
        this.amount = amount;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
package thkoeln.archilab.ecommerce.solution.payment.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
import java.util.List;
import java.util.UUID;

@Repository
public interface PaymentRepository extends CrudRepository<Payment, UUID> {
    public List<Payment> findByDeliveryRecipient(AbstractUser deliveryUser);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartAppService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPositionRepository;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCartRepository;
import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import java.util.List;
import java.util.Map;
import java.util.UUID;
@Service
public class ShoppingCartAppService {
    @Autowired
    public ShoppingCartService shoppingCartService;
    @Autowired
    public ShoppingCartRepository shoppingCartRepository;
    @Autowired
    public CartPositionRepository cartPositionRepository;
    @Autowired
    private ThingCatalogService thingCatalogService;

    public ShoppingCart findById(UUID shoppingCartId){
        if (shoppingCartId == null || shoppingCartRepository.findById(shoppingCartId).isEmpty()){
            throw new ShopException("ShoppingCart id does not exists");
        }
        return shoppingCartRepository.findById(shoppingCartId).get();
    }

    public Integer getTotalQuantityOfOneCar(MailAddressType mailAddress){
        Map<UUID, Integer> things = shoppingCartService.getShoppingCartAsMap(mailAddress);
        Integer totalquantity = 0;
        for (Integer quantity : things.values()) {
            totalquantity += quantity;
        }
        return totalquantity;
    }

    public CartPosition getCartPositionOfThing(ShoppingCart shoppingCart, UUID thingId){
        Thing thing= thingCatalogService.findThingInCatalog(thingId);
        List<CartPosition> cartPositions = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
        if(cartPositions.size()==0)throw new ShopException("Thing is not in your Cart!");
        return cartPositions.get(0);
    }

    public void deleteCartPositionOfThing(ShoppingCart shoppingCart, UUID thingId){
        CartPosition cartPosition = getCartPositionOfThing(shoppingCart, thingId);
        shoppingCartService.removeThingFromShoppingCart(shoppingCart.getUser().getMailAddress(),
                                                        thingId,
                                                        cartPosition.getQuantity());
        cartPositionRepository.delete(cartPosition);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDTO.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;

import java.util.UUID;

@Setter
@Getter
@AllArgsConstructor
@NoArgsConstructor
public class ShoppingCartDTO {
    private UUID id;
    private MailAddress mailAddress;
    private Integer totalQuantity;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartDTOMapperService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import java.util.UUID;

@Service
public class ShoppingCartDTOMapperService {
    @Autowired
    public ShoppingCartService shoppingCartService;
    @Autowired
    public ShoppingCartAppService shoppingCartAppService;
    @Autowired
    public ThingCatalogService thingCatalogService;
    public ShoppingCartDTO findByIdAsDTO(UUID shoppingCartId){
        ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
        ModelMapper modelMapper = new ModelMapper();
        return modelMapper.map(shoppingCart, ShoppingCartDTO.class);
    }

    public ShoppingCartDTO findShoppingCartByUserAsDTO(MailAddressType mailAddressType){
        ShoppingCart shoppingCart = shoppingCartService.findShoppingCartByUser(mailAddressType);
        ModelMapper modelMapper = new ModelMapper();
        ShoppingCartDTO dto = modelMapper.map(shoppingCart, ShoppingCartDTO.class);
        dto.setTotalQuantity(shoppingCartAppService.getTotalQuantityOfOneCar(mailAddressType));
        return dto;
    }

    public ShoppingCartPositionDTO getCartPositionAsDTO(ShoppingCart shoppingCart, UUID thingId){
        CartPosition cartPosition = shoppingCartAppService.getCartPositionOfThing(shoppingCart, thingId);
        ModelMapper modelMapper = new ModelMapper();
        return modelMapper.map(cartPosition, ShoppingCartPositionDTO.class);
    }

    public CartPosition getDTOAsCartPosition(ShoppingCartPositionDTO dto){
        ModelMapper modelMapper = new ModelMapper();
        CartPosition cartPosition = modelMapper.map(dto, CartPosition.class);
        cartPosition.setThing(thingCatalogService.findThingInCatalog(dto.getThingId()));
        return cartPosition;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartPositionDTO.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class ShoppingCartPositionDTO {
    private UUID thingId;
    private Integer quantity;
    private String comment;
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartRESTController.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.junit.platform.commons.function.Try;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataIntegrityViolationException;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.util.NestedServletException;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.ShoppingCart;
import thkoeln.archilab.ecommerce.solution.user.application.UserService;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.transaction.Transactional;
import java.util.UUID;

@RestController
@Transactional
public class ShoppingCartRESTController {
    private ShoppingCartService shoppingCartService;
    private ShoppingCartDTOMapperService shoppingCartDTOMapperService;
    private ShoppingCartAppService shoppingCartAppService;

    private UserService userService;

    @Autowired
    public ShoppingCartRESTController
            (ShoppingCartService shoppingCartService,
             ShoppingCartDTOMapperService shoppingCartDTOMapperService,
             ShoppingCartAppService shoppingCartAppService,
             UserService userService){
        this.shoppingCartService = shoppingCartService;
        this.shoppingCartDTOMapperService = shoppingCartDTOMapperService;
        this.shoppingCartAppService = shoppingCartAppService;
        this.userService = userService;
    }

    @GetMapping("/shoppingCarts")
    @ResponseBody
    public ResponseEntity<ShoppingCartDTO> getShoppingCartByUserMail(
            @RequestParam String mailAddress
    ){
        ShoppingCartDTO shoppingCartDTO;
        try {
            MailAddress mailAddressObject = MailAddress.of(mailAddress);
            shoppingCartDTO = shoppingCartDTOMapperService.findShoppingCartByUserAsDTO(mailAddressObject);
        } catch (ShopException shopException){
            return new ResponseEntity<>(HttpStatus.NOT_FOUND);
        }
        return ResponseEntity.ok().body(shoppingCartDTO);
    }

    @PostMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions")
    public ResponseEntity addShoppingCartPosition(@PathVariable UUID shoppingCartId,
                                                  @RequestBody ShoppingCartPositionDTO shoppingCartPositionDTO){
        ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
        CartPosition cartPosition = shoppingCartDTOMapperService.getDTOAsCartPosition(shoppingCartPositionDTO);

        if (cartPosition.getQuantity() < 0){
            CartPosition shoppingCartPosition = shoppingCartAppService.getCartPositionOfThing(
                    shoppingCart, cartPosition.getThing().getId());
            shoppingCartPosition.setComment(cartPosition.getComment());
            try {
                shoppingCartService.removeThingFromShoppingCart(
                        shoppingCart.getUser().getMailAddress(),
                        cartPosition.getThing().getId(),
                        Math.abs(cartPosition.getQuantity()));
            }
            catch (ShopException shopException){
                return new ResponseEntity<>(HttpStatus.CONFLICT);
            }
//            shoppingCartService.removeThingFromShoppingCart(
//                    shoppingCart.getUser().getMailAddress(),
//                    cartPosition.getThing().getId(),
//                    Math.abs(cartPosition.getQuantity()));
            if (shoppingCartAppService.getCartPositionOfThing(
                    shoppingCart, cartPosition.getThing().getId())
                    .getQuantity() == 0){
                shoppingCartAppService.deleteCartPositionOfThing(shoppingCart, cartPosition.getThing().getId());
            }
            return new ResponseEntity(HttpStatus.CREATED);
        }
        try {
            shoppingCartService.addThingToShoppingCart(
                    shoppingCart.getUser().getMailAddress(),
                    cartPosition.getThing().getId(),
                    cartPosition.getQuantity());
        } catch (ShopException shopException){
            return new ResponseEntity<>(HttpStatus.CONFLICT);
        }
        CartPosition newCartPosition = shoppingCartAppService.getCartPositionOfThing(shoppingCart, cartPosition.getThing().getId());
        newCartPosition.setComment(cartPosition.getComment());
        return new ResponseEntity(HttpStatus.CREATED);
    }

    @DeleteMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions/{thingId}")
    public ResponseEntity deleteShoppingCartPositionForThing(@PathVariable UUID shoppingCartId,
                                                             @PathVariable UUID thingId){
        try{
            ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
            shoppingCartAppService.deleteCartPositionOfThing(shoppingCart, thingId);
        }catch (ShopException shopException){
            return new ResponseEntity(HttpStatus.NOT_FOUND);
        }
        return new ResponseEntity(HttpStatus.OK);
    }

    @GetMapping("/shoppingCarts/{shoppingCartId}/shoppingCartPositions/{thingId}")
    public ResponseEntity<ShoppingCartPositionDTO> getShoppingCartPosition(@PathVariable UUID shoppingCartId,
                                                                           @PathVariable UUID thingId){
        try{
            ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
            ShoppingCartPositionDTO shoppingCartPositionDTO = shoppingCartDTOMapperService.getCartPositionAsDTO(
                    shoppingCart, thingId
            );
        }catch (ShopException shopException){
            return new ResponseEntity(HttpStatus.NOT_FOUND);
        }
        ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
        ShoppingCartPositionDTO shoppingCartPositionDTO = shoppingCartDTOMapperService.getCartPositionAsDTO(
                shoppingCart, thingId
        );
        if (shoppingCartPositionDTO != null) {
            return ResponseEntity.ok().body(shoppingCartPositionDTO);
        } else {
            return ResponseEntity.notFound().build();
        }
    }

    @PutMapping("/shoppingCarts/{shoppingCartId}/checkout")
    public ResponseEntity shoppingCartCheckout(@PathVariable UUID shoppingCartId){
        try{
            ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
        }catch (ShopException shopException){
            return new ResponseEntity(HttpStatus.NOT_FOUND);
        }
        try{
            ShoppingCart shoppingCart = shoppingCartAppService.findById(shoppingCartId);
            shoppingCartService.checkout(shoppingCart.getUser().getMailAddress());
        }catch (ShopException shopException){
            return new ResponseEntity(HttpStatus.CONFLICT);
        }

        return new ResponseEntity(HttpStatus.OK);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryService;
import thkoeln.archilab.ecommerce.solution.order.application.OrderService;
import thkoeln.archilab.ecommerce.solution.order.domain.Order;
import thkoeln.archilab.ecommerce.solution.order.domain.OrderPosition;
import thkoeln.archilab.ecommerce.solution.payment.application.PaymentService;
import thkoeln.archilab.ecommerce.solution.shoppingcart.domain.*;
import thkoeln.archilab.ecommerce.solution.thing.application.ShoppingCartCorrections;
import thkoeln.archilab.ecommerce.solution.thing.application.ThingCatalogService;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
import thkoeln.archilab.ecommerce.solution.user.application.ShoppingCartFactory;
import thkoeln.archilab.ecommerce.solution.user.application.UserService;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.usecases.ShoppingCartUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.*;

@Service
public class ShoppingCartService implements ShoppingCartUseCases, ShoppingCartFactory,
                                            ShoppingCartCorrections {

    @Autowired
    private ShoppingCartRepository shoppingCartRepository;
    @Autowired
    private UserService userService;
    @Autowired
    private ThingCatalogService thingCatalogService;
    @Autowired
    private OrderService orderService;
    @Autowired
    private CartPositionRepository cartPositionRepository;
    @Autowired
    private DeliveryService deliveryService;
    @Autowired
    private PaymentService paymentService;

    public ShoppingCart findShoppingCartByUser(MailAddressType mailAddress){
        return shoppingCartRepository.findByUser((User) userService.findUserByMail(mailAddress));
    }

    private void quantityCheck(int quantity) {
        if (quantity < 0) throw new ShopException("Quantity must not be negative");
    }

    private void authorizePayment(MailAddressType userMailAddress){
        shoppingCartRepository.findByUser((User)userService.findUserByMail(userMailAddress)).setPaymentAuthorized(true);
    }

    private void triggerDelivery(MailAddressType userMailAddress){
        shoppingCartRepository.findByUser((User)userService.findUserByMail(userMailAddress)).setDeliveryTriggered(true);
    }

    @Override
    public void createShoppingCart(MailAddressType userMailAddress) {
        ShoppingCart shoppingCart = new ShoppingCart((User) userService.findUserByMail(userMailAddress));
        shoppingCart.setStatus(ShoppingCartFillingStatus.EMPTY);
        shoppingCartRepository.save(shoppingCart);
    }

    @Override
    public void deleteAllCarts() {
        shoppingCartRepository.deleteAll();
    }

    @Override
    public void removeStockCartCorrection(UUID thingId, Integer removedQuantity) {
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        List<CartPosition> cartPositionList = cartPositionRepository.findByThing(thing);
        int remainingQuantity = removedQuantity-thing.getStockQuantity();
        while (remainingQuantity != 0){
            for (CartPosition cP : cartPositionList){
                ShoppingCart sC = cP.getShoppingCart();
                int cPQuantity = cP.getQuantity();
                if (cPQuantity == 0)continue;
                if (cPQuantity >= remainingQuantity){
                    cP.setQuantity(cPQuantity-remainingQuantity);
                    thing.removeFromStock(remainingQuantity);
                    thing.removeReservation(remainingQuantity);
                    remainingQuantity = 0;
                    cartPositionRepository.save(cP);
                    thingCatalogService.saveChanges(thingId);
                    break;
                }
                cP.setQuantity(0);
                thing.removeFromStock(cPQuantity);
                thing.removeReservation(cPQuantity);
                cartPositionRepository.save(cP);
                thingCatalogService.saveChanges(thingId);
                remainingQuantity -= cPQuantity;
            }
        }
    }

    @Override
    public void changeStockCartCorrection(UUID thingId, Integer newTotalQuantity) {
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        int diff = thing.getReservedQuantity()-newTotalQuantity;
        List<CartPosition> cartPositionList = cartPositionRepository.findByThing(thing);
        while(diff != 0){
            for (CartPosition cP : cartPositionList){
                ShoppingCart sC = cP.getShoppingCart();
                int cPQuantity = cP.getQuantity();
                if (cPQuantity == 0)continue;
                if (cPQuantity >= diff){
                    cP.setQuantity(cPQuantity-diff);
                    thing.removeReservation(diff);
                    diff = 0;
                    cartPositionRepository.save(cP);
                    thingCatalogService.saveChanges(thingId);
                    break;
                }
                cP.setQuantity(0);
                thing.removeFromStock(cPQuantity);
                thing.removeReservation(cPQuantity);
                cartPositionRepository.save(cP);
                thingCatalogService.saveChanges(thingId);
                diff -= cPQuantity;
            }
        }
        thing.setStockQuantity(0);
        thingCatalogService.saveChanges(thingId);
    }


    @Override
    public void addThingToShoppingCart(MailAddressType userMailAddress, UUID thingId, int quantity) {
        User user = (User) userService.findUserByMail(userMailAddress);
        quantityCheck(quantity);
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        if (thing.getStockQuantity() < quantity){
            throw new ShopException("the thing is not available in the requested quantity");
        }
        ShoppingCart shoppingCart = shoppingCartRepository.findByUser(user);
        if(cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing).isEmpty()){
            CartPosition cartPosition = new CartPosition(thing, quantity, shoppingCart);
            cartPositionRepository.save(cartPosition);
        }else{
            List<CartPosition> cartPositions = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
            CartPosition cartPosition = cartPositions.get(0);
            cartPosition.setQuantity(cartPosition.getQuantity()+quantity);
            cartPositionRepository.save(cartPosition);
        }
        shoppingCart.setStatus(ShoppingCartFillingStatus.FILLED);
        thing.reserve(quantity);
    }

    @Override
    public void removeThingFromShoppingCart(MailAddressType userMailAddress, UUID thingId, int quantity) {
        quantityCheck(quantity);
        User user = (User) userService.findUserByMail(userMailAddress);
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        if (cartPositionRepository.findByShoppingCartAndThing(shoppingCartRepository.findByUser(user), thing).isEmpty())
            throw new ShopException("The thing is not in your cart");
        List<CartPosition>cartPositionList =
                cartPositionRepository.findByShoppingCartAndThing(shoppingCartRepository.findByUser(user), thing);
        if (cartPositionList.get(0).getQuantity() < quantity){
            throw new ShopException("So many things are not in your cart");
        }if (quantity == cartPositionList.get(0).getQuantity()) cartPositionList.get(0).setQuantity(0);
        else cartPositionList.get(0).setQuantity(cartPositionList.get(0).getQuantity()-quantity);
        cartPositionRepository.save(cartPositionList.get(0));
        if (cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user)).isEmpty())
            shoppingCartRepository.findByUser(user).setStatus(ShoppingCartFillingStatus.EMPTY);
        shoppingCartRepository.save(shoppingCartRepository.findByUser(user));
        thing.removeReservation(quantity);
    }

    @Override
    public void setCommentForShoppingCartPosition(MailAddressType userMailAddress, UUID thingId, String comment) {
        ShoppingCart shoppingCart =
                shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        List<CartPosition> cartPositionList = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
        if (cartPositionList.isEmpty() || cartPositionList.get(0).getQuantity() == 0)
            throw new ShopException("Thing is not in shopping cart!");
        cartPositionList.get(0).setComment(comment);
    }

    @Override
    public String getCommentForShoppingCartPosition(MailAddressType userMailAddress, UUID thingId) {
        ShoppingCart shoppingCart =
                shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        List<CartPosition> cartPositionList = cartPositionRepository.findByShoppingCartAndThing(shoppingCart, thing);
        if (cartPositionList.isEmpty() || cartPositionList.get(0).getQuantity() == 0)
            throw new ShopException("Thing is not in shopping cart!");
        return cartPositionList.get(0).getComment();
    }

    @Override
    public Map<UUID, Integer> getShoppingCartAsMap(MailAddressType userMailAddress) {
        User user = (User) userService.findUserByMail(userMailAddress);
        List<CartPosition>cartPositionList =
                cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
        HashMap<UUID, Integer> things = new HashMap<>();
        for(CartPosition c: cartPositionList){
            things.put(c.getThing().getId(), c.getQuantity());
        }
        return things;
    }

    @Override
    public MoneyType getShoppingCartAsMoneyValue(MailAddressType userMailAddress) {
        User user = (User) userService.findUserByMail(userMailAddress);
        List<CartPosition>cartPositionList =
                cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
        MoneyType value = Money.of(0.00F, cartPositionList.get(0).getThing().getSellingPrice().getCurrency());
        for (CartPosition c: cartPositionList){
            value = value.add(c.getThing().getSellingPrice().multiplyBy(c.getQuantity()));
        }
        return value;
    }

    @Override
    public int getReservedStockInShoppingCarts(UUID thingId) {
        Thing thing = thingCatalogService.findThingInCatalog(thingId);
        return thing.getReservedQuantity();
    }

    @Override
    public boolean isEmpty(MailAddressType userMailAddress) {
        ShoppingCart shoppingCart =
                shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
        return shoppingCart.getStatus().equals(ShoppingCartFillingStatus.EMPTY);
    }

    @Override
    public boolean isPaymentAuthorized(MailAddressType userMailAddress) {
        ShoppingCart shoppingCart = shoppingCartRepository.findByUser
                ((User) userService.findUserByMail(userMailAddress));
        return shoppingCart.paymentAuthorized;
    }

    private Map<UUID, Integer> areCartPositionsEmpty(MailAddress userMailAddress){
        int temp = 0;
        HashMap<UUID, Integer> cartPositions = (HashMap<UUID, Integer>) getShoppingCartAsMap(userMailAddress);
        for (int quantity : cartPositions.values()){
            if (quantity == 0){
                temp++;
                if (temp == cartPositions.size()) throw new ShopException("Error");
            }else break;
        }
        return cartPositions;
    }

    @Override
    public void checkout(MailAddressType userMailAddress) {
        User user = (User) userService.findUserByMail(userMailAddress);
        if (isEmpty(userMailAddress)){
            throw new ShopException("Cart is empty!");
        }
        List<CartPosition> cartPositions =
                cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user));
        paymentService.authorizePayment(userMailAddress, getShoppingCartAsMoneyValue(userMailAddress));
        authorizePayment(userMailAddress);
        deliveryService.triggerDelivery(user, getShoppingCartAsMap(userMailAddress));
        triggerDelivery(userMailAddress);
        cartPositionRepository.deleteAll(
                cartPositionRepository.findByShoppingCart(shoppingCartRepository.findByUser(user)));
        emptyCart(userMailAddress);
        Order order = orderService.initializeOrder(userMailAddress);
        for (CartPosition cp:cartPositions){
            orderService.addToOrder(order, cp.getThing().getId(), cp.getQuantity(), cp.getComment());
        }
    }

    @Override
    public Map<UUID, Integer> getOrderHistory(MailAddressType userMailAddress) {
        userService.findUserByMail(userMailAddress);
        HashMap<UUID, Integer> orderHistory = new HashMap<>();
        List<Order>orders = orderService.findByUser(userMailAddress);
        Set<OrderPosition> orderPositions = new HashSet<>();
        for (Order order : orders){
            orderPositions.addAll(order.getOrderPositions());
        }
        for (OrderPosition oP: orderPositions) {
            if (orderHistory.containsKey(oP.getThing().getId())){
                int oldValue = orderHistory.get(oP.getThing().getId());
                orderHistory.replace(oP.getThing().getId(), oldValue+oP.getQuantity());
                continue;
            }
            orderHistory.put(oP.getThing().getId(), oP.getQuantity());
        }
        return orderHistory;
    }

    private void emptyCart(MailAddressType userMailAddress){
        ShoppingCart shoppingCart =
                shoppingCartRepository.findByUser((User) userService.findUserByMail(userMailAddress));
        shoppingCart.setStatus(ShoppingCartFillingStatus.EMPTY);
        shoppingCart.setPaymentAuthorized(false);
        shoppingCart.setDeliveryTriggered(false);
        shoppingCartRepository.save(shoppingCart);
    }

    @Override
    public void deleteAllOrders() {
        shoppingCartRepository.deleteAll();
        cartPositionRepository.deleteAll();
        orderService.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\CartPosition.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;


import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.ManyToOne;
import java.util.UUID;

@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class CartPosition {

    @Id
    final UUID id = UUID.randomUUID();

    private int quantity;

    @ManyToOne
    private ShoppingCart shoppingCart;

    @ManyToOne
    private Thing thing;

    private String comment;

    public CartPosition(Thing thing, int quantity, ShoppingCart shoppingCart) {
        this.thing = thing;
        this.quantity = quantity;
        this.shoppingCart = shoppingCart;
    }


}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\CartPositionRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;

import java.util.List;
import java.util.UUID;

@Repository
public interface CartPositionRepository extends CrudRepository<CartPosition, UUID> {
    public List<CartPosition> findByThing(Thing thing);
    public List<CartPosition> findByShoppingCart(ShoppingCart shoppingCart);
    public List<CartPosition> findByShoppingCartAndThing(ShoppingCart shoppingCart, Thing thing);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;


import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import javax.persistence.*;
import java.util.*;

@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class ShoppingCart {
    @Id
    final UUID id = UUID.randomUUID();

    @OneToOne
    private User user;

    @Enumerated(EnumType.STRING)
    private ShoppingCartFillingStatus status;

    public boolean paymentAuthorized = false;

    public boolean deliveryTriggered = false;

    private int totalQuantity;

    public ShoppingCart(User user){
        this.user = user;
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartFillingStatus.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

public enum ShoppingCartFillingStatus {
    EMPTY, FILLED
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCartRepository.java ---
package thkoeln.archilab.ecommerce.solution.shoppingcart.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.solution.user.domain.User;


import java.util.UUID;

@Repository
public interface ShoppingCartRepository extends CrudRepository<ShoppingCart, UUID> {
    public ShoppingCart findByUser(User user);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\ShoppingCartCorrections.java ---
package thkoeln.archilab.ecommerce.solution.thing.application;

import java.util.UUID;

public interface ShoppingCartCorrections {
    public void removeStockCartCorrection (UUID thingId, Integer removedQuantity);
    public void changeStockCartCorrection (UUID thingId, Integer newTotalQuantity);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\StockManagementService.java ---
package thkoeln.archilab.ecommerce.solution.thing.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
import thkoeln.archilab.ecommerce.solution.thing.domain.ThingRepository;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
import java.util.UUID;

@Service
public class StockManagementService implements StockManagementUseCases {
    @Autowired
    private ThingRepository thingRepository;
    @Autowired
    private ShoppingCartCorrections shoppingCartCorrections;

    public void thingIdCheck(UUID thingId){
        if (thingRepository.findById(thingId).isEmpty()) throw new ShopException("Thing does not exists");
    }

    @Override
    public void addToStock(UUID thingId, int addedQuantity) {
        thingIdCheck(thingId);
        if(addedQuantity <= 0){
            throw new ShopException("Added quantity must not be negative!");
        }
        Thing thing = thingRepository.findById(thingId).get();
        thing.addToStock(addedQuantity);
    }

    @Override
    public void removeFromStock(UUID thingId, int removedQuantity) {
        thingIdCheck(thingId);
        Thing thing = thingRepository.findById(thingId).get();
        if(removedQuantity <= 0){
            throw new ShopException("Removed quantity must not be negative!");
        }
        if (thing.getStockQuantity()+thing.getReservedQuantity() < removedQuantity){
            throw new ShopException("Stock quantity too low!");
        }
        if (thing.getStockQuantity() < removedQuantity){
            shoppingCartCorrections.removeStockCartCorrection(thingId, removedQuantity);
        }
        thing.removeFromStock(removedQuantity);
    }

    @Override
    public void changeStockTo(UUID thingId, int newTotalQuantity) {
        thingIdCheck(thingId);
        Thing thing = thingRepository.findById(thingId).get();
        if(newTotalQuantity < 0){
            throw new ShopException("New total quantity must not be negative!");
        }
        if (thing.getReservedQuantity() > newTotalQuantity){
            shoppingCartCorrections.changeStockCartCorrection(thingId, newTotalQuantity);
        }
        else {
            thing.setStockQuantity(newTotalQuantity-thing.getReservedQuantity());
            thingRepository.save(thing);
        }

    }

    @Override
    public int getAvailableStock(UUID thingId) {
        thingIdCheck(thingId);
        return thingRepository.findById(thingId).get().getStockQuantity();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\application\ThingCatalogService.java ---
package thkoeln.archilab.ecommerce.solution.thing.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.Money;
import thkoeln.archilab.ecommerce.solution.thing.domain.Thing;
import thkoeln.archilab.ecommerce.solution.thing.domain.ThingRepository;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.ThingCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;

@Service
public class ThingCatalogService implements ThingCatalogUseCases {
    @Autowired
    private ThingRepository thingRepository;

    public Thing findThingInCatalog(UUID thingId){
        if (thingId == null || thingRepository.findById(thingId).isEmpty()){
            throw new ShopException("Thing id does not exists");
        }

        return thingRepository.findById(thingId).get();
    }

    @Override
    public void addThingToCatalog(UUID thingId, String name, String description, Float size, MoneyType purchasePrice, MoneyType sellingPrice) {
        if (thingId == null){
            throw new ShopException("Invalid id");
        }
        if (thingRepository.findById(thingId).isPresent()){
            throw new ShopException("Id is already taken!");
        }
        if ( name == null  || name.isEmpty() || description == null || description.isEmpty()){
            throw new ShopException("Invalid data in name or description");
        }
        if (purchasePrice == null || purchasePrice.getAmount() <= 0.0){
            throw new ShopException("Invalid purchase price");
        }
        if (sellingPrice == null || sellingPrice.getAmount() <= 0.0 || purchasePrice.largerThan(sellingPrice)){
            throw new ShopException("Invalid selling price");
        }
        if (size == null){
            Thing thing = new Thing(thingId, name, description, (Money) purchasePrice, (Money) sellingPrice);
            thingRepository.save(thing);
        }
        else{
            if (size <= 0){
                throw new ShopException("Invalid size");
            }
            Thing thing = new Thing(thingId, name, description, size, (Money) purchasePrice, (Money) sellingPrice);
            thingRepository.save(thing);
        }
    }

    @Override
    public void removeThingFromCatalog(UUID thingId) {
        Thing thing = findThingInCatalog(thingId);
        if (thing.getStockQuantity() > 0){
            throw new ShopException("Thing is still in stock");
        }
        if (thingRepository.findById(thingId).get().getReservedQuantity() > 0){
            throw new ShopException("Thing is currently reserved");
        }
        
        thingRepository.delete(thing);
    }

    @Override
    public MoneyType getSellingPrice(UUID thingId) {
        if (thingRepository.findById(thingId).isEmpty()){
            throw new ShopException("Thing id does not exists");
        }

        Thing thing = thingRepository.findById(thingId).get();
        return thing.getSellingPrice();
    }

    public void saveChanges(UUID thingId){
        thingRepository.save(findThingInCatalog(thingId));
    }

    @Override
    public void deleteThingCatalog() {
        thingRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\domain\Thing.java ---
package thkoeln.archilab.ecommerce.solution.thing.domain;

import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import thkoeln.archilab.ecommerce.domainprimitives.Money;

import javax.persistence.*;

import java.util.UUID;

@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Thing {


    @Id
    private UUID id;
    @Setter
    private String name;
    @Setter
    private String description;
    @Setter
    private float size;
    @Setter
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name="amount", column= @Column(name="purchaseAmount")),
            @AttributeOverride(name="currency", column= @Column(name="purchaseCurrency"))
    })
    private Money purchasePrice;
    @Setter
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name="amount", column= @Column(name="sellingAmount")),
            @AttributeOverride(name="currency", column= @Column(name="sellingCurrency"))
    })
    private Money sellingPrice;
    @Setter
    private int stockQuantity;
    @Setter
    private int reservedQuantity;

    public Thing(UUID id, String name, String description, float size, Money purchasePrice, Money sellingPrice){
        this.id = id;
        this.name = name;
        this.description = description;
        this.size = size;
        this.purchasePrice = purchasePrice;
        this.sellingPrice= sellingPrice;
    }

    public Thing(UUID id, String name, String description, Money purchasePrice, Money sellingPrice){
        this.id = id;
        this.name = name;
        this.description = description;
        this.purchasePrice = purchasePrice;
        this.sellingPrice= sellingPrice;
    }

    public void addToStock(int quantity){
        stockQuantity += quantity;
    }

    public void removeFromStock(int quantity){
        stockQuantity -= quantity;
    }

    public void reserve(int quantity) {
        removeFromStock(quantity);
        reservedQuantity += quantity;
    }

    public void removeReservation(int quantity) {
        addToStock(quantity);
        reservedQuantity -= quantity;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\domain\ThingRepository.java ---
package thkoeln.archilab.ecommerce.solution.thing.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

import java.util.UUID;

@Repository
public interface ThingRepository extends CrudRepository<Thing, UUID> {
    public Thing findByName(String name);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\ShoppingCartFactory.java ---
package thkoeln.archilab.ecommerce.solution.user.application;

import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

public interface ShoppingCartFactory {
    public void createShoppingCart(MailAddressType userMailAddress);
    public void deleteAllCarts();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\application\UserService.java ---
package thkoeln.archilab.ecommerce.solution.user.application;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataIntegrityViolationException;
import org.springframework.stereotype.Service;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
import thkoeln.archilab.ecommerce.solution.delivery.application.DeliveryRecipientService;
import thkoeln.archilab.ecommerce.solution.order.application.OrderUserService;
import thkoeln.archilab.ecommerce.solution.payment.application.PaymentUserService;
import thkoeln.archilab.ecommerce.solution.user.domain.User;
import thkoeln.archilab.ecommerce.solution.user.domain.UserRepository;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

@Service
public class UserService implements UserRegistrationUseCases, DeliveryRecipientService, OrderUserService,
                                    PaymentUserService {
    @Autowired
    private UserRepository userRepository;
    @Autowired
    private ShoppingCartFactory shoppingCartFactory;


    @Override
    public UserType findUserByMail(MailAddressType userMailAddress){
        if (userMailAddress == null) throw new ShopException("Mail address must not be null");
        try {
            if (userRepository.findByMailAddress((MailAddress) userMailAddress) != null) {
                return (UserType) userRepository.findByMailAddress((MailAddress) userMailAddress);
            }
            else throw new ShopException("User does not exists");
        } catch (DataIntegrityViolationException dataIntegrityViolationException){
            throw new ShopException("No users left");
        }
    }

    @Override
    public void register(String name, MailAddressType mailAddress, PersonalAddressType personalAddress) {
        if (mailAddress == null){
            throw new ShopException("Invalid data");
        }
        if (name == null || name.isEmpty()){
            throw new ShopException("Invalid data");
        }
        if (personalAddress == null) throw new ShopException("Invalid data");
        if (userRepository.findByMailAddress((MailAddress) mailAddress) != null) {
            throw new ShopException("Your mail is already registered");
        }
        User user = new User((MailAddress) mailAddress, name, (PersonalAddress) personalAddress);
        userRepository.save(user);
        shoppingCartFactory.createShoppingCart(user.getMailAddress());
    }

    @Override
    public void changeAddress(MailAddressType userMailAddress, PersonalAddressType personalAddress) {
        if (userMailAddress == null || personalAddress == null) {
            throw new ShopException("Invalid data");
        }
        User user = (User) findUserByMail(userMailAddress);
        user.changeAddress((PersonalAddress) personalAddress);
    }

    @Override
    public UserType getUserData(MailAddressType userMailAddress) {
        try{
            return findUserByMail(userMailAddress);
        }
        catch (DataIntegrityViolationException dataIntegrityViolationException) {
            throw new ShopException("No users left");
        }
    }

    @Override
    public void deleteAllUsers() {
        shoppingCartFactory.deleteAllCarts();
        userRepository.deleteAll();
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\User.java ---
package thkoeln.archilab.ecommerce.solution.user.domain;

import lombok.*;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.domainprimitives.PersonalAddress;
import thkoeln.archilab.ecommerce.solution.core.domain.AbstractUser;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.Id;
import java.util.UUID;

@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class User extends AbstractUser {

    @Id
    final UUID id = UUID.randomUUID();

    @Embedded
    private MailAddress mailAddress;

    private String name;

    @Embedded
    private PersonalAddress address;

    public User(MailAddress mailAddress, String name, PersonalAddress personalAddress) {
        this.mailAddress = mailAddress;
        this.name = name;
        this.address = personalAddress;
    }

    public void changeAddress(PersonalAddress personalAddress){
        address = personalAddress;
    }

    @Override
    public PersonalAddressType getPersonalAddress() {
        return address;
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\user\domain\UserRepository.java ---
package thkoeln.archilab.ecommerce.solution.user.domain;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;
import thkoeln.archilab.ecommerce.domainprimitives.MailAddress;
import thkoeln.archilab.ecommerce.solution.user.domain.User;

import java.util.Optional;
import java.util.UUID;

@Repository
public interface UserRepository extends CrudRepository<User, UUID> {
    public User findByMailAddress(MailAddress mailAddress);
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with logistics,
 * i.e. the delivery of things to a user. It is probably incomplete, and will grow over time.
 */
public interface DeliveryUseCases {
    /**
     * Delivers a thing to a user. The thing is identified by its id, and the user by
     * his/her name, street, city and zip code.
     * @param deliveryRecipient
     * @param deliveryContent - a map of thing ids and quantities
     * @return the id of the delivery, if successfully triggered
     * @throws ShopException if ...
     *      - deliveryRecipient is null
     *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
     *      - deliveryContent is null or empty
     *      - the total number of things in the delivery is > 20
     */
    public UUID triggerDelivery( UserType deliveryRecipient, Map<UUID, Integer> deliveryContent );


    /**
     * Returns a map showing which things have been delivered to a user, and how many of each thing
     *
     * @param userMailAddress
     * @return the delivery history of the user (map is empty if the user has not had any deliveries yet)
     * @throws ShopException if
     *      - mailAddress is null
     *      - the user with the given mail address does not exist
     */
    public Map<UUID, Integer> getDeliveryHistory( MailAddressType userMailAddress );



    /**
     *  Deletes all delivery history.
     */
    public void deleteDeliveryHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MailAddressType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface MailAddressType {
    /**
     * @return the mail address as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an mail address, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param mailAddressAsString - the mail address as a string.
     *      We will use a much simplified validation method to check if the mail address is valid:
     *      - it must contain exactly one '@' character.
     *      - the part before the '@' and the part after the '@' must not be empty, contain of
     *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
     *      - the parts before and after the '@' may contain one or several '.' as separators
     *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
     *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
     *        (for simplicity we do not allow any other domains)
     * @return a new MailAddressType object matching the given mail address
     * @throws ShopException if ...
     *      - mailAddressAsString is null
     *      - mailAddressAsString is not a valid mail address (see above)
     */
     // public static MailAddressType of( String mailAddressAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface MoneyType {
    /**
     * @return the amount of money
     */
    public Float getAmount();


    /**
     * @return the currency of the money
     */
    public String getCurrency();


    /**
     * @param otherMoney
     * @return this + otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public MoneyType add( MoneyType otherMoney );


    /**
     * @param otherMoney
     * @return this - otherMoney, as a new object
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     *      - otherMoney > this
     */
    public MoneyType subtract( MoneyType otherMoney );


    /**
     * @param factor
     * @return this * factor, as a new object
     * @throws ShopException if ...
     *     - factor < 0
     */
    public MoneyType multiplyBy( int factor );

    /**
     * @param otherMoney
     * @return true, if this > otherMoney
     * @throws ShopException if ...
     *      - otherMoney is null
     *      - otherMoney.currency != this.currency
     */
    public boolean largerThan( MoneyType otherMoney );


    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates a money object from an amount and a currency (as string).
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param amount the amount of money (must be >= 0)
     * @param currency the currency of the money (allowed values: "EUR", "CHF")
     * @return a new Money object with the given amount and currency
     * @throws ShopException if ...
     *   - amount is null
     *   - amount < 0
     *   - currency is null
     *   - currency is not one of the allowed values
     */
     // public static MoneyType of( Float amount, String currency );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PersonalAddressType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface PersonalAddressType {
    /**
     * @return the street as a string
     */
    public String getStreet();

    /**
     * @return the city as a string
     */
    public String getCity();

    /**
     * @return the zip code
     */
    public ZipCodeType getZipCode();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an zip code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param street the street as a string
     * @param city the city as a string
     * @param zipCode the zip code
     * @return the personalAddress object matching the parameters
     * @throws ShopException if ...
     *      - street is null or empty
     *      - city is null or empty
     *      - zipCode is null
     */
     // public static PersonalAddressType of( String street, String city, ZipCodeType zipCode );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\ZipCodeType.java ---
package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;

import thkoeln.archilab.ecommerce.ShopException;

public interface ZipCodeType {
    /**
     * @return the zip code as a string
     */
    public String toString();

    /**
     * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
     * implementing class to provide a static factory method (simply named "of(...)"),
     * which creates an zip code, given as a string.
     * We specify this factory method here as a comment, using the Javadoc documentation style.
     *
     * @param zipCodeAsString - the zip code as a string.
     *      We will use a much simplified validation method to check if the postal code is valid:
     *      - It must contain exactly 5 digits.
     *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
     * @return a new zip code object matching the given string
     * @throws ShopException if ...
     *      - zipCodeAsString is null
     *      - zipCodeAsString is not a valid zip code (see above)
     */
     // public static ZipCodeType of( String zipCodeAsString );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with payments.
 */
public interface PaymentUseCases {

    /**
     * Authorizes a payment from a bank card for a given amount
     *
     * @param userMailAddress
     * @param moneyAmount
     * @return the id of the payment, if successfully authorized
     * @throws ShopException if ...
     *      - userMailAddress is null
     *      - the amount is null
     *      - the amount is 0.00 EUR
     *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
     */
    public UUID authorizePayment( MailAddressType userMailAddress, MoneyType moneyAmount );


    /**
     * Returns the total amount of payments (over the complete history) for a user
     * (identified by his/her mail address)
     *
     * @param userMailAddress
     * @return the total amount of payments made using this bank card, or 0.00 EUR if there
     *         weren't any payments yet.
     * @throws ShopException if ...
     *      - userMailAddress is null
     */
    public MoneyType getPaymentTotal( MailAddressType userMailAddress );


    /**
     * Deletes all payment history, for all users.
     */
    public void deletePaymentHistory();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingCartUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.Map;
import java.util.UUID;

/**
 * This interface contains methods needed in the context of use cases dealing with the shopping cart.
 * The interface is probably incomplete, and will grow over time.
 */
public interface ShoppingCartUseCases {
    /**
     * Adds a thing to the shopping cart of a user
     *
     * @param userMailAddress
     * @param thingId
     * @param quantity
     * @throws ShopException if ...
     *      - the user with the given mailAddress does not exist,
     *      - the thing does not exist,
     *      - the quantity <= 0,
     *      - the thing is not available in the requested quantity
     */
    public void addThingToShoppingCart( MailAddressType userMailAddress, UUID thingId, int quantity );


    /**
     * Removes a thing from the shopping cart of a user
     *
     * @param userMailAddress
     * @param thingId
     * @param quantity
     * @throws ShopException if ...
     *      - userMailAddress is null,
     *      - the user with the given mailAddress does not exist,
     *      - the thing does not exist
     *      - the quantity <= 0,
     *      - the thing is not in the shopping cart in the requested quantity
     */
    public void removeThingFromShoppingCart( MailAddressType userMailAddress, UUID thingId, int quantity );


    /**
     * Sets a comment in the shopping cart position containing a thing
     *
     * @param userMailAddress
     * @param thingId
     * @param comment (can be null)
     * @throws ShopException if ...
     *      - userMailAddress is null,
     *      - the user with the given mailAddress does not exist,
     *      - the thing does not exist
     *      - the thing is not in the shopping cart
     */
    public void setCommentForShoppingCartPosition( MailAddressType userMailAddress, UUID thingId, String comment );


    /**
     * Returns the comment in the shopping cart position containing a thing
     *
     * @param userMailAddress
     * @param thingId
     * @return the comment (can be null)
     * @throws ShopException if ...
     *      - userMailAddress is null,
     *      - the user with the given mailAddress does not exist,
     *      - the thing does not exist
     *      - the thing is not in the shopping cart
     */
    public String getCommentForShoppingCartPosition( MailAddressType userMailAddress, UUID thingId );


    /**
     * Returns a map showing which things are in the shopping cart of a user and how many of each thing
     *
     * @param userMailAddress
     * @return the shopping cart of the user (map is empty if the shopping cart is empty)
     * @throws ShopException if ...
     *      - userMailAddress is null,
     *      - the user with the given mailAddress does not exist
     */
    public Map<UUID, Integer> getShoppingCartAsMap( MailAddressType userMailAddress );


    /**
     * Returns the current value of all things in the shopping cart of a user
     *
     * @param userMailAddress
     * @return the value of shopping cart of the user
     * @throws ShopException if ...
     *      - userMailAddress is null,
     *      - the user with the given mailAddress does not exist
     */
    public MoneyType getShoppingCartAsMoneyValue( MailAddressType userMailAddress );



    /**
     * Get the number units of a specific thing that are currently reserved in the shopping carts of all users
     * @param thingId
     * @return the number of reserved things of that type in all shopping carts
     * @throws ShopException
     *      - thingId is null
     *      - if the thing id does not exist
     */
    public int getReservedStockInShoppingCarts( UUID thingId );


    /**
     * Checks if the shopping cart of a user is empty
     *
     * @param userMailAddress
     * @return true if the shopping cart is empty, false otherwise
     * @throws ShopException if ...
     *    - userMailAddress is null
     *    - the user with the given mail address does not exist
     */
    public boolean isEmpty( MailAddressType userMailAddress );


    /**
     * Checks if the payment for a specific shopping cart of a user has been authorized to be paid,
     * i.e. the shopping cart is not empty, the user has given his/her payment details, and the payment
     * has been authorized (under the limits of the user's credit card). However, the order
     * has not yet been placed yet, and the logistics details have not yet been given.
     *
     * @param userMailAddress
     * @return true if the payment has been authorized, false otherwise
     * @throws ShopException if ...
     *      - userMailAddress is null
     *      - the user with the given mail address does not exist
     */
    public boolean isPaymentAuthorized( MailAddressType userMailAddress );


    /**
     * Checks out the shopping cart of a user
     *
     * @param userMailAddress
     * @throws ShopException if ... 
     * @throws ShopException if ...
     *      - userMailAddress is null
     *      - the user with the given mail address does not exist
     *      - the shopping cart is empty
     */
    public void checkout( MailAddressType userMailAddress );




    /**
     * Returns a map showing which things have been ordered by a user, and how many of each thing
     *
     * @param userMailAddress
     * @return the order history of the user (map is empty if the user has not ordered anything yet)
     * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
     * @throws ShopException if
     *      - the mail address is null
     *      - the user with the given mail address does not exist
     */
    public Map<UUID, Integer> getOrderHistory( MailAddressType userMailAddress );



    /**
     * Deletes all orders and shopping carts in the system
     * @Deprecated Might be split into two methods later (delete orders and delete shopping carts), with
     *             the order deletion moved to a dedicated OrderUseCases interface later
     *             (but still valid in this milestone)
     */
    public void deleteAllOrders();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\StockManagementUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the shop stock,
 * i.e. adding and removing things in the warehouse. The interface is probably incomplete, and
 * will grow over time.
 */
public interface StockManagementUseCases {
    /**
     * Adds a certain quantity of a given thing to the stock
     * @param thingId
     * @param addedQuantity
     * @throws ShopException if ...
     *      - thingId is null
     *      - the thing with that id does not exist
     *      - addedQuantity <= 0
     */
    public void addToStock( UUID thingId, int addedQuantity );


    /**
     * Removes a certain quantity of a given thing from the stock.
     * If the new total quantity is lower than the currently reserved things, some of currently reserved things
     * (in the users' shopping baskets) are removed. This means that some of the reserved things are lost for
     * the user. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
     * or some of the things were stolen from the warehouse, are broken, etc.)
     * @param thingId
     * @param removedQuantity
     * @throws ShopException if ...
     *      - thingId is null
     *      - the thing with that id does not exist
     *      - removedQuantity <= 0
     *      - the removed quantity is greater than the current stock and the currently reserved things together
     */
    public void removeFromStock( UUID thingId, int removedQuantity );


    /**
     * Changes the total quantity of a given thing in the stock.
     * If the new total quantity is lower than the currently reserved things, some of currently reserved things
     * (in the users' shopping baskets) are removed. This means that some of the reserved things are lost for
     * the user. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
     * or some of the things were stolen from the warehouse, are broken, etc.)
     * @param thingId
     * @param newTotalQuantity
     * @throws ShopException if ...
     *      - thingId is null
     *      - the thing with that id does not exist
     *      - newTotalQuantity < 0
     */
    public void changeStockTo( UUID thingId, int newTotalQuantity );


    /**
     * Get the current total stock of a given thing, including the currently reserved things
     * @param thingId
     * @return the current total stock of the thing
     * @throws ShopException if ...
     *      - thingId is null
     *      - the thing with that id does not exist
     */
    public int getAvailableStock( UUID thingId );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\ThingCatalogUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.UUID;


/**
 * This interface contains methods needed in the context of use cases dealing with managing the thing catalog.
 * The interface is probably incomplete, and will grow over time.
 */

public interface ThingCatalogUseCases {
    /**
     * Adds a new thing to the shop catalog
     * @param thingId
     * @param name
     * @param description
     * @param size
     * @param purchasePrice
     * @param sellingPrice
     * @throws ShopException if ...
     *      - thingId is null,
     *      - the thing with that id already exists,
     *      - name or description are null or empty,
     *      - the size is <= 0 (but can be null!),
     *      - the purchase price is null,
     *      - the selling price is null,
     *      - the selling price is lower than the purchase price
     */
    public void addThingToCatalog( UUID thingId, String name, String description, Float size,
                                           MoneyType purchasePrice, MoneyType sellingPrice );


    /**
     * Removes a thing from the shop catalog
     * @param thingId
     * @throws ShopException if
     *      - thingId is null,
     *      - the thing with that id does not exist
     *      - the thing is still in stock
     *      - the thing is still reserved in a shopping cart, or part of a completed order
     */
    public void removeThingFromCatalog( UUID thingId );


    /**
     * Get the selling price of a given thing
     * @param thingId
     * @return the selling price
     * @throws ShopException if ...
     *      - thingId is null,
     *      - the thing with that id does not exist
     */
    public MoneyType getSellingPrice( UUID thingId );


    /**
     * Clears the thing catalog, i.e. removes all things from the catalog, including all the stock,
     * all the reservations and all the orders.
     */
    public void deleteThingCatalog();

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\UserRegistrationUseCases.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

/**
 * This interface contains methods needed in the context of use cases dealing with registering a user.
 * The interface is probably incomplete, and will grow over time.
 */
public interface UserRegistrationUseCases {
    /**
     * Registers a new user
     *
     * @param name
     * @param mailAddress
     * @param personalAddress
     * @throws ShopException if ...
     *      - name is null or empty
     *      - mailAddress is null
     *      - user with the given mail address already exists
     *      - personalAddress is null
     */
    public void register( String name, MailAddressType mailAddress, PersonalAddressType personalAddress );


    /**
     * Changes the personalAddress of a user
     *
     * @param userMailAddress
     * @param personalAddress
     * @throws ShopException if ...
     *      - mailAddress is null
     *      - user with the given mail address already exists
     *      - personalAddress is null
     */
    public void changeAddress( MailAddressType userMailAddress, PersonalAddressType personalAddress );


    /**
     * Returns the data of a user
     * @param userMailAddress
     * @return the user data
     * @throws ShopException if ...
     *      - mailAddress is null
     *      - the user with the given mail address does not exist
     */
    public UserType getUserData( MailAddressType userMailAddress );



    /**
     * Deletes all users, including all orders and shopping carts
     */
    public void deleteAllUsers();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\usecases\UserType.java ---
package thkoeln.archilab.ecommerce.usecases;

import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;

/**
 * This interface expresses the essence of a shop user
 */
public interface UserType {
    public String getName();
    public MailAddressType getMailAddress();
    public PersonalAddressType getPersonalAddress();
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;

import static com.tngtech.archunit.library.Architectures.layeredArchitecture;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln")
@SuppressWarnings("PMD")
public class E3DDDOutsideSolutionRulesTest {

    @ArchTest
    static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
            layeredArchitecture()
                    .consideringAllDependencies()
                    .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
                    .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
                    .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
                    .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
                    .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )

                    .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
                    .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.junit.AnalyzeClasses;
import com.tngtech.archunit.junit.ArchTag;
import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Service;

import javax.persistence.Entity;
import javax.persistence.Id;

import java.util.UUID;

import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;

@ArchTag("layerRules")
@AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
@SuppressWarnings("PMD")
public class E3DDDRulesTest {

    @ArchTest
    static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
            noClasses().that().resideInAPackage("..domain..")
                    .should().dependOnClassesThat().resideInAPackage("..application..");

    @ArchTest
    static final ArchRule entitiesMustResideInADomainPackage =
            classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
                    .as("Entities must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule entitiesMustNotAccessRepositories =
            noClasses().that().areAnnotatedWith( Entity.class )
                    .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );

    @ArchTest
    static final ArchRule repositoriesMustResideInADomainPackage =
            classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
                    .as("Repositories must reside in a package '..domain..'");

    @ArchTest
    static final ArchRule repositoryNamesMustHaveProperSuffix =
            classes().that().areAssignableTo( CrudRepository.class )
                    .should().haveSimpleNameEndingWith("Repository");

    @ArchTest
    static final ArchRule servicesMustResideInAnApplicationPackage =
            classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
                    .as("Application Services must reside in a package '..application..'");

    @ArchTest
    static final ArchRule serviceNamesMustHaveProperSuffix =
            classes().that().areAnnotatedWith( Service.class )
                    .should().haveSimpleNameEndingWith("Service");

    @ArchTest
    static final ArchRule noClassesOnTopLevel =
            classes().should().resideInAPackage( "..solution.*.." );

    @ArchTest
    static final ArchRule noNonIdFieldsOfTypeIUUID =
            fields()
                    .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
                    .and().areNotAnnotatedWith( Id.class )
                    .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Thing" )
                    .should().notHaveRawType( UUID.class );
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClass;
import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import com.tngtech.archunit.lang.ArchRule;
import com.tngtech.archunit.library.dependencies.SliceAssignment;
import com.tngtech.archunit.library.dependencies.SliceIdentifier;
import org.junit.jupiter.api.Test;

import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;

public class E3NoCycleTest {
    private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");

    private SliceAssignment inAllClasses() {
        return new SliceAssignment() {
            @Override
            public String getDescription() {
                return "every class in it's own slice";
            }

            @Override
            public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
                return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
            }
        };
    }

    @Test
    public void testNoCyclicDependenciesBetweenClasses() {
        slices().assignedFrom(inAllClasses())
                .namingSlices("$1[$2.$3]")
                .should().beFreeOfCycles()
                .check(importedClasses);
    }

    @Test
    public void testNoCyclicDependenciesBetweenPackages() {
        ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
        rule.check(importedClasses);
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3PackageStructureTest {

    private static final String[] REQUIRED_PACKAGES = {"user", "shoppingcart", "thing", "order"};
    private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
    private JavaClasses importedClasses;


    @BeforeEach
    public void setUp() {
        importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
    }

    @Test
    void testRequiredPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage;
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredDomainPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected domain sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

    @Test
    void testRequiredApplicationPackagesAreThere() {
        for ( String requiredPackage : REQUIRED_PACKAGES ) {
            String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
            assertThat( importedClasses.containPackage( packageName ) )
                    .as( "Expected application sub-package %s not found!", packageName )
                    .isTrue();
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
package thkoeln.archilab.ecommerce.codereview;

import org.junit.jupiter.api.Test;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
import org.springframework.core.type.classreading.MetadataReader;
import org.springframework.core.type.classreading.MetadataReaderFactory;

import java.io.IOException;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;

import static org.junit.jupiter.api.Assertions.assertTrue;

public class E3RequiredClassesTest {


    private static final String[] REQUIRED_CLASSES = {
            "User",
            "UserRepository",
            "Order",
            "OrderRepository",
            "ShoppingCart",
            "ShoppingCartRepository",
            "Thing",
            "ThingRepository"
    };

    @Test
    public void testRequiredClassesDeclared() throws IOException {
        String basePackage = "thkoeln.archilab.ecommerce";
        String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";

        PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );

        Set<String> foundClasses = new HashSet<>();

        Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
            try {
                MetadataReader reader = readerFactory.getMetadataReader( resource );
                foundClasses.add( reader.getClassMetadata().getClassName() );
            } catch (IOException e) {
                e.printStackTrace();
            }
        } );

        Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
            boolean found = foundClasses.stream().anyMatch(className ->
                    className.startsWith(basePackage) && className.endsWith("." + requiredClass)
            );
            assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
        });
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E1OrdertRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private MailAddressType nonExistingMailAddress;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllThings();
        initialMasterDataCreator.stockUpAllThings();
        initialMasterDataCreator.registerAllUsers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingMailAddress = instantiateMailAddress( "harry@sally.de" );
    }


    @Test
    public void testGetNoOrders() throws Exception {
        // given
        // when
        // then
        mockMvc.perform( get( "/orders" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?mailAddress=" + nonExistingMailAddress ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?mailAddress=invalidEmailString" ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
        mockMvc.perform( get( "/orders?mailAddress=" + USER_EMAIL[3].toString() ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 0 ) );
    }


    @Test void testMakeThreeOrders() throws Exception {
        // given
        String mailAddressString = USER_EMAIL[6].toString();

        UUID thingId2 = (UUID) THING_DATA[2][0];
        UUID thingId4 = (UUID) THING_DATA[4][0];
        UUID thingId6 = (UUID) THING_DATA[6][0];
        Float thingMoneyAmount2 = ((MoneyType) THING_DATA[2][5]).getAmount() * 2;
        Float thingMoneyAmount4 = ((MoneyType) THING_DATA[4][5]).getAmount() * 4;
        Float thingMoneyAmount6 = ((MoneyType) THING_DATA[6][5]).getAmount() * 6;

        String uriAllOrders = "/orders?mailAddress=" + mailAddressString;
        String uriLatestOrder = uriAllOrders + "&filter=latest";

        // when
        restHelper.makeOrderForUser( mailAddressString, thingId2, 2 );
        restHelper.makeOrderForUser( mailAddressString, thingId4, 4 );
        restHelper.makeOrderForUser( mailAddressString, thingId6, 6 );

        // then get all orders ...
        mockMvc.perform( get( uriAllOrders ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 3 ) )

                .andExpect( jsonPath( "$[0].mailAddress.mailAddressString" ).value( mailAddressString ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount2 ) )

                .andExpect( jsonPath( "$[1].mailAddress.mailAddressString" ).value( mailAddressString ) )
                .andExpect( jsonPath( "$[1].price.amount" ).value( thingMoneyAmount4 ) )

                .andExpect( jsonPath( "$[2].mailAddress.mailAddressString" ).value( mailAddressString ) )
                .andExpect( jsonPath( "$[2].price.amount" ).value( thingMoneyAmount6 ) );

        // ... and the latest order
        mockMvc.perform( get( uriLatestOrder ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount6 ) );
    }


    @Test
    public void testIfMoneySumInOrderIsCorrect() throws Exception {
        // given
        String mailAddressString = USER_EMAIL[3].toString();
        UUID thingId3 = (UUID) THING_DATA[3][0];
        UUID thingId4 = (UUID) THING_DATA[4][0];
        Integer quantity3 = 14;
        Integer quantity4 = 5;
        Float thingMoneyAmount =
                ((MoneyType) THING_DATA[3][5]).getAmount() * quantity3 +
                ((MoneyType) THING_DATA[4][5]).getAmount() * quantity4;

        // when
        UUID shoppingCartId = restHelper.getShoppingCartId( mailAddressString );
        restHelper.addThingToShoppingCart( shoppingCartId, thingId3, quantity3 );
        restHelper.addThingToShoppingCart( shoppingCartId, thingId4, quantity4 );
        mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
                .andExpect( status().isOk() );

        // then
        mockMvc.perform( get(
                "/orders?mailAddress=" + mailAddressString + "&filter=latest") )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( thingMoneyAmount ) );
    }



}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingCartRESTTest.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
@AutoConfigureMockMvc
@ActiveProfiles("test")
public class E2ShoppingCartRESTTest {

    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;
    @Autowired
    private MockMvc mockMvc;

    private RESTHelper restHelper;
    private MailAddressType nonExistingMailAddress;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();

        initialMasterDataCreator.addAllThings();
        initialMasterDataCreator.stockUpAllThings();
        initialMasterDataCreator.registerAllUsers();

        restHelper = new RESTHelper( mockMvc );
        nonExistingMailAddress = instantiateMailAddress( "harry@sally.de" );
    }


    @Test
    public void testEmptyShoppingCart() throws Exception {
        // given
        String validUri = "/shoppingCarts?mailAddress=" + USER_EMAIL[4].toString();
        String invalidUri1 = "/shoppingCarts?mailAddress=" + nonExistingMailAddress.toString();
        String invalidUri2 = "/shoppingCarts?mailAddress=justaninvalidemailaddress";

        // when
        // then
        mockMvc.perform( get( validUri ) )
                .andExpect( status().isOk() )
                .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
        mockMvc.perform( get( invalidUri1 ) )
                .andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidUri2 ) )
                .andExpect( status().isNotFound() );
    }


    @Test
    public void testInvalidUris() throws Exception {
        // given
        UUID thingId = (UUID) THING_DATA[3][0];
        String userEmailString = USER_EMAIL[4].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );

        String invalidPostUri = "/shoppingCarts/" + UUID.randomUUID() + "/shoppingCartPositions";
        String invalidPatchGetDeleteUri1 =
                "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/" + UUID.randomUUID();
        String invalidPatchGetDeleteUri2 =
                "/shoppingCarts/" + UUID.randomUUID().toString() + "/shoppingCartPositions/" + thingId;
        String invalidCheckoutUri1 = "/shoppingCarts/" + shoppingCartId + "/chekkout";
        String invalidCheckoutUri2 = "/shoppingCarts/" + UUID.randomUUID() + "/checkout";

        // when
        // then
        mockMvc.perform( post( invalidPostUri )
                .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );

        mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
        mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testQueryNonExistingThing() throws Exception {
        // given
        UUID thingId = (UUID) THING_DATA[3][0];
        String userEmailString = USER_EMAIL[7].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String invalidUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/" + thingId;

        // when
        // then
        mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
    }


    @Test
    public void testDeleteFromShoppingCart() throws Exception {
        // given
        UUID thingId1 = (UUID) THING_DATA[1][0];
        String userEmailString9 = USER_EMAIL[9].toString();
        String userEmailString7 = USER_EMAIL[7].toString();

        UUID shoppingCartId9 = restHelper.getShoppingCartId( userEmailString9 );
        UUID shoppingCartId7 = restHelper.getShoppingCartId( userEmailString7 );

        String baseUri9 = "/shoppingCarts/" + shoppingCartId9 + "/shoppingCartPositions/";
        String checkoutUri9 = "/shoppingCarts/" + shoppingCartId9 + "/checkout";
        String checkoutUri7 = "/shoppingCarts/" + shoppingCartId7 + "/checkout";

        // when
        restHelper.addMultipleThingsToShoppingCart( userEmailString9,
                new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
        restHelper.checkMultipleShoppingCartPositions(
                userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
                new String[]{"c1", "c4", "c6"} );
        mockMvc.perform( delete( baseUri9 + thingId1 ) )
                .andExpect( status().isOk() );
        restHelper.checkMultipleShoppingCartPositions(
                userEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
                new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
        // ... and another customer can still buy 10 of the "Nr. 1" thing
        restHelper.addThingToShoppingCart( shoppingCartId7, thingId1, 10,
                "still10", null );

        // then
        mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString9,
                new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
        mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString7,
                new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
    }


    @Test
    public void testAddToAndRemoveFromShoppingCart() throws Exception {
        // given
        String userEmailString = USER_EMAIL[2].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
                new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
        restHelper.checkMultipleShoppingCartPositions(
                userEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
                new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
                new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
    }


    @Test
    public void testRemoveMoreThanThereIsInShoppingCart() throws Exception {
        // given
        String userEmailString = USER_EMAIL[2].toString();

        // when
        // then
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testAddMoreThanIsInStock() throws Exception {
        // given
        String userEmailString = USER_EMAIL[7].toString();

        // when
        // then
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
                new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
    }


    @Test
    public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[5].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
        restHelper.checkMultipleOrderPositionsInLatestOrder( userEmailString,
                new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
    }



    @Test
    public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[1].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
        // given
        String userEmailString = USER_EMAIL[8].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        restHelper.addMultipleThingsToShoppingCart( userEmailString,
                new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );

        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }


    @Test
    public void testNoCheckoutForEmptyShoppingCart() throws Exception {
        // given
        String userEmailString = USER_EMAIL[9].toString();
        UUID shoppingCartId = restHelper.getShoppingCartId( userEmailString );
        String checkoutUri = "/shoppingCarts/" + shoppingCartId + "/checkout";

        // when
        // then
        mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
package thkoeln.archilab.ecommerce.e1e2resttests;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.ResultActions;
import org.springframework.test.web.servlet.ResultMatcher;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;

public class RESTHelper {
    private MockMvc mockMvc;

    public static final ResultMatcher NOT_FOUND = status().isNotFound();
    public static final ResultMatcher OK = status().isOk();
    public static final ResultMatcher CREATED = status().isCreated();
    public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
    public static final ResultMatcher CONFLICT = status().isConflict();

    public RESTHelper( MockMvc mockMvc ) {
        this.mockMvc = mockMvc;
    }

    public void makeOrderForUser( String mailAddressString, UUID thingId, Integer quantity ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( mailAddressString );
        addThingToShoppingCart( shoppingCartId, thingId, quantity );
        mockMvc.perform( put( "/shoppingCarts/" + shoppingCartId.toString() + "/checkout" ) )
                .andExpect( OK );
    }

    public UUID getShoppingCartId( String mailAddressString ) throws Exception {
        // get the shopping cart and extract its id ...
        MvcResult shoppingCart = mockMvc.perform( get( "/shoppingCarts?mailAddress=" + mailAddressString ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.id" ).isNotEmpty() )
                .andReturn();
        ObjectMapper objectMapper = new ObjectMapper();
        IdDTO idDTO = objectMapper.readValue( shoppingCart.getResponse().getContentAsString(), IdDTO.class );
        return idDTO.getId();
    }

    public void addThingToShoppingCart( UUID shoppingCartId, UUID thingId, Integer quantity,
                                                 String comment, ResultMatcher expectedStatus )
                                                throws Exception {
        ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
        ObjectMapper objectMapper = new ObjectMapper();
        QuantityAndCommentDTO dto = new QuantityAndCommentDTO( thingId, quantity, comment );
        String quantityJson = objectMapper.writeValueAsString( dto );
        mockMvc.perform( post( "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions" )
                .contentType( APPLICATION_JSON ).content( quantityJson ) )
                .andExpect( status );
    }


    public void addThingToShoppingCart( UUID shoppingCartId, UUID thingId, Integer quantity )
            throws Exception {
        addThingToShoppingCart( shoppingCartId, thingId, quantity, null, null );
    }



    public void addMultipleThingsToShoppingCart(
            String userEmailString, Integer[] thingIndices, Integer[] quantities, String[] comments,
            ResultMatcher[] expectedAddStatuses ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( userEmailString );
        String shoppingCartUri = "shoppingCarts?mailAddress=" + userEmailString;
        String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/";

        // add all the things to the shopping cart ...
        Map<Integer, Integer> quantityMap = new HashMap<>();
        Map<Integer, String> commentMap = new HashMap<>();
        for ( int i = 0; i < thingIndices.length; i++ ) {
            UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
            addThingToShoppingCart( shoppingCartId, thingId, quantities[i], comments[i], expectedAddStatuses[i] );
            if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
                quantityMap.put( thingIndices[i],
                        quantities[i] + quantityMap.getOrDefault( thingIndices[i], 0 ) );
                commentMap.put( thingIndices[i], comments[i] );
            }
        }
    }


    public void addMultipleThingsToShoppingCart(
            String userEmailString, Integer[] thingIndices, Integer[] quantities,
            String[] comments ) throws Exception {
        ResultMatcher[] expectedAddStatuses = new ResultMatcher[thingIndices.length];
        for ( int i = 0; i < thingIndices.length; i++ ) {
            expectedAddStatuses[i] = CREATED;
        }
        addMultipleThingsToShoppingCart( userEmailString, thingIndices, quantities,
                comments, expectedAddStatuses );
    }


    public void checkMultipleShoppingCartPositions( String userEmailString,
                                                         Integer[] thingIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
        UUID shoppingCartId = getShoppingCartId( userEmailString );
        String shoppingCartUri = "/shoppingCarts?mailAddress=" + userEmailString;
        String baseUri = "/shoppingCarts/" + shoppingCartId + "/shoppingCartPositions/";

        // check that the shopping cart contains all the things ...
        int totalQuantity = 0;
        for ( int i = 0; i < thingIndices.length; i++ ) {
            if ( expectedQuantities[i] != null ) {
                totalQuantity += expectedQuantities[i];
            }
        }
        mockMvc.perform( get( shoppingCartUri ) )
                .andExpect( OK )
                .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );

        // check that each thing has the correct quantity and comment ...
        for ( int i = 0; i < thingIndices.length; i++ ) {
            UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
            if ( expectedToBeFound[i] ) {
                mockMvc.perform( get( baseUri + thingId ) )
                        .andExpect( OK )
                        .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
                        .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
            } else {
                mockMvc.perform( get( baseUri + thingId ) )
                        .andExpect( NOT_FOUND );
            }
        }
    }


    public void checkMultipleShoppingCartPositions( String userEmailString,
                                                         Integer[] thingIndices, Integer[] expectedQuantities,
                                                         String[] expectedComments ) throws Exception {
        Boolean[] expectedToBeFound = new Boolean[thingIndices.length];
        for ( int i = 0; i < thingIndices.length; i++ ) {
            expectedToBeFound[i] = true;
        }
        checkMultipleShoppingCartPositions( userEmailString, thingIndices, expectedQuantities,
                expectedComments, expectedToBeFound );
    }



    public void checkMultipleOrderPositionsInLatestOrder(
            String userEmailString, Integer[] thingIndices, Integer[] expectedQuantities,
            String[] expectedComments ) throws Exception {
        String latestOrderUri = "/orders?mailAddress=" + userEmailString + "&filter=latest";

        // Calculate the total price of the order ...
        float totalPrice = 0f;
        for ( int i = 0; i < thingIndices.length; i++ ) {
            totalPrice += expectedQuantities[i] * ((MoneyType) THING_DATA[thingIndices[i]][5]).getAmount();
        }

        // ... and check that the order has the correct total price (and other data)
        ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
                .andExpect( jsonPath( "$.length()" ).value( 1 ) )
                .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
                .andExpect( jsonPath( "$[0].mailAddress.mailAddressString" ).value( userEmailString ) );

        // Now check that all the expected parts are there
        for ( int i = 0; i < thingIndices.length; i++ ) {
            UUID thingId = (UUID) THING_DATA[thingIndices[i]][0];
            resultActions.andExpect(
                    jsonPath( "$[0].orderPositions.length()" ).value( thingIndices.length ) );
            resultActions.andExpect(
                    jsonPath( "$[0].orderPositions[?(@.thingId == '" + thingId + "')].quantity" )
                            .value( expectedQuantities[i] ) );
            if ( expectedComments[i] != null ) {
                resultActions.andExpect(
                        jsonPath( "$[0].orderPositions[?(@.thingId == '" + thingId + "')].comment" )
                                .value( expectedComments[i] ) );
            }
        }
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a comment, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class CommentDTO {
    private UUID thingId;
    private String comment;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just the id of an entity, used in testing.
 */

@AllArgsConstructor
@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class IdDTO {
    private UUID id;
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import lombok.*;

import java.util.UUID;

/**
 * A DTO containing just a quantity, used in testing.
 */


@NoArgsConstructor
@Setter
@Getter
@ToString
@JsonIgnoreProperties(ignoreUnknown = true)
public class QuantityAndCommentDTO {
    private UUID thingId;
    private Integer quantity;
    private String comment;

    public QuantityAndCommentDTO( UUID thingId, Integer quantity, String comment ) {
        this.thingId = thingId;
        this.quantity = quantity;
        this.comment = comment;
    }
}



--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMailAddressTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionMailAddressTest {

    @Test
    public void testToString() {
        // given
        String input = "test@example.com";

        // when
        MailAddressType instance = instantiateMailAddress( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "99Z@example.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "GGGhh@s77.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "a@4.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "Max.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "Max.Gideon.Hammer@example.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.this.com" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.de" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.at" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.ch" ) );
        assertDoesNotThrow( () -> instantiateMailAddress( "test@example.org" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateMailAddress( null ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "testexample.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "Max..Gideon.Hammer@example.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@examplecom" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example..com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test#example@that.com" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.biz" ) );
        assertThrows( ShopException.class, () -> instantiateMailAddress( "test@example.42" ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        MailAddressType instance1 = instantiateMailAddress( "test@example.com" );
        MailAddressType instance2 = instantiateMailAddress( "test@example.com" );
        MailAddressType instance3 = instantiateMailAddress( "different@example.com" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        MailAddressType instance = instantiateMailAddress( "test@example.com" );

        // then
        try {
            instance.getClass().getMethod( "setMailAddress", String.class );
            fail( "setMailAddress method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionMoneyTest {

    @Test
    public void testGetAmount() {
        // given
        Float inputAmount = 10.0f;

        // when
        MoneyType instance = instantiateMoney( inputAmount, "EUR" );

        // then
        assertEquals( inputAmount, instance.getAmount() );
    }

    @Test
    public void testGetCurrency() {
        // given
        String inputCurrency = "EUR";

        // when
        MoneyType instance = instantiateMoney( 10.0f, inputCurrency );

        // then
        assertEquals( inputCurrency, instance.getCurrency() );
    }

    @Test
    public void testAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );

        // when
        MoneyType result12 = instance1.add( instance2 );
        MoneyType result13 = instance1.add( instance3 );

        // then
        assertEquals( 30.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 10.0f, result13.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
    }

    @Test
    public void testInvalidAddTo() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
    }

    @Test
    public void testSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );

        // when
        MoneyType result12 = instance1.subtract( instance2 );
        MoneyType result13 = instance1.subtract( instance3 );
        MoneyType result14 = instance1.subtract( instance4 );

        // then
        assertEquals( 10.0f, result12.getAmount() );
        assertEquals( "EUR", result12.getCurrency() );
        assertEquals( 30.0f, result13.getAmount() );
        assertEquals( "EUR", result13.getCurrency() );
        assertEquals( 0.0f, result14.getAmount() );
        assertEquals( "EUR", result14.getCurrency() );
    }

    @Test
    public void testInvalidSubtractFrom() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );

        // when
        // then
        assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
        assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
    }

    @Test
    public void testMultiplyBy() {
        // given
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // when
        MoneyType result = instance.multiplyBy( 3 );

        // then
        assertEquals( 30.0f, result.getAmount() );
        assertEquals( "EUR", result.getCurrency() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
        assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
    }

    @Test
    public void testLargerThan() {
        // given
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );

        // when
        // then
        assertTrue( instance2.largerThan( instance1 ) );
        assertFalse( instance1.largerThan( instance2 ) );
        assertFalse( instance1.largerThan( instance3 ) );
        assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
    }


    @Test
    public void testValueObjectEquality() {
        // given
        // when
        MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
        MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        MoneyType instance = instantiateMoney( 10.0f, "EUR" );

        // then
        try {
            instance.getClass().getMethod( "setAmount", Float.class );
            fail( "setAmount method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }

        try {
            instance.getClass().getMethod( "setCurrency", String.class );
            fail( "setCurrency method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPersonalAddressTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PersonalAddressType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionPersonalAddressTest {

    @Test
    public void testGetterMethods() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );

        // then
        assertEquals( street, instance.getStreet() );
        assertEquals( city, instance.getCity() );
        assertEquals( plz, instance.getZipCode() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        // then
        assertDoesNotThrow( () -> instantiatePersonalAddress( street, city, plz ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        // then
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( null, city, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( "", city, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, null, plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, "", plz ) );
        assertThrows( ShopException.class, () -> instantiatePersonalAddress( street, city, null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance1 = instantiatePersonalAddress( street, city, plz );
        PersonalAddressType instance2 = instantiatePersonalAddress( street, city, plz );
        PersonalAddressType instance3 = instantiatePersonalAddress( "Anderestr. 12", city, plz );
        PersonalAddressType instance4 = instantiatePersonalAddress( street, "AndereStadt", plz );
        PersonalAddressType instance5 = instantiatePersonalAddress( street, city, instantiateZipCode( "54321" ) );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
        assertNotEquals( instance1, instance4 );
        assertNotEquals( instance1, instance5 );
    }

    @Test
    public void testImmutability() {
        // given
        String street = "Irgendeinestraße 42";
        String city = "Irgendeinestadt";
        ZipCodeType plz = instantiateZipCode( "12345" );

        // when
        PersonalAddressType instance = instantiatePersonalAddress( street, city, plz );

        // then
        try {
            instance.getClass().getMethod( "setStreet", String.class );
            fail( "setStreet method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setCity", String.class );
            fail( "setCity method should not exist" );

        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
        try {
            instance.getClass().getMethod( "setZipCode", ZipCodeType.class );
            fail( "setZipCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionZipCodeTest.java ---
package thkoeln.archilab.ecommerce.regression.domainprimitives;

import org.junit.jupiter.api.Test;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.ZipCodeType;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;

class RegressionZipCodeTest {

    @Test
    public void testToString() {
        // given
        String input = "12345";

        // when
        ZipCodeType instance = instantiateZipCode( input );

        // then
        assertEquals( input, instance.toString() );
    }

    @Test
    public void testFactoryMethodValid() {
        // given
        // when
        // then
        assertDoesNotThrow( () -> instantiateZipCode( "12345" ) );
    }

    @Test
    public void testFactoryMethodInvalid() {
        // given
        // when
        // then
        assertThrows( ShopException.class, () -> instantiateZipCode( "123456" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( "1234" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( "20000" ) );
        assertThrows( ShopException.class, () -> instantiateZipCode( null ) );
    }

    @Test
    public void testValueObjectEquality() {
        // given
        // when
        ZipCodeType instance1 = instantiateZipCode( "12345" );
        ZipCodeType instance2 = instantiateZipCode( "12345" );
        ZipCodeType instance3 = instantiateZipCode( "54321" );

        // then
        assertEquals( instance1, instance2 );
        assertNotEquals( instance1, instance3 );
    }

    @Test
    public void testImmutability() {
        // given
        // when
        ZipCodeType instance = instantiateZipCode( "12345" );

        // then
        try {
            instance.getClass().getMethod( "setzipCode", String.class );
            fail( "setzipCode method should not exist" );
        } catch (NoSuchMethodException e) {
            // Success: the object is immutable
        }
    }
}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionStockManagementTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_STOCK;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;

@SpringBootTest
@Transactional
public class RegressionStockManagementTest {

    @Autowired
    private StockManagementUseCases stockManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;


    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        initialMasterDataCreator.addAllThings();
    }



    @Test
    public void testAddToStock() {
        // given
        initialMasterDataCreator.stockUpAllThings();
        UUID thingId8 = (UUID) THING_DATA[8][0];

        // when
        int stock8before = stockManagementUseCases.getAvailableStock( thingId8 );
        assertEquals( THING_STOCK.get( thingId8 ), stock8before );
        stockManagementUseCases.addToStock( thingId8, 22 );
        int stock8after = stockManagementUseCases.getAvailableStock( thingId8 );
        stockManagementUseCases.addToStock( thingId8, 1 );
        int stock8after2 = stockManagementUseCases.getAvailableStock( thingId8 );

        // then
        assertEquals( stock8before + 22, stock8after );
        assertEquals( stock8after + 1, stock8after2 );
    }


    @Test
    public void testRemoveFromStock() {
        // given
        initialMasterDataCreator.stockUpAllThings();
        UUID thingId6 = (UUID) THING_DATA[6][0];
        int stock6before = THING_STOCK.get( thingId6 );
        UUID thingId9 = (UUID) THING_DATA[9][0];
        int stock9before = THING_STOCK.get( thingId9 );
        UUID thingId1 = (UUID) THING_DATA[1][0];
        int stock1before = THING_STOCK.get( thingId1 );

        // when
        stockManagementUseCases.removeFromStock( thingId6, 1 );
        int stock6after = stockManagementUseCases.getAvailableStock( thingId6 );
        stockManagementUseCases.removeFromStock( thingId1, 3 );
        int stock1after = stockManagementUseCases.getAvailableStock( thingId1 );
        stockManagementUseCases.removeFromStock( thingId9, stock9before );
        int stock9after = stockManagementUseCases.getAvailableStock( thingId9 );

        // then
        assertEquals( stock6before - 1, stock6after );
        assertEquals( stock1before - 3, stock1after );
        assertEquals( 0, stock9after );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionThingCatalogTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
import thkoeln.archilab.ecommerce.usecases.ThingCatalogUseCases;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;

import javax.transaction.Transactional;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.*;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.THING_DATA;

@SpringBootTest
@Transactional
public class RegressionThingCatalogTest {

    @Autowired
    private ThingCatalogUseCases thingCatalogUseCases;
    @Autowired
    private StockManagementUseCases stockManagementUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
    }



    @Test
    public void testAddThingToCatalog() {
        // given
        initialMasterDataCreator.addAllThings();

        // when
        MoneyType sellingPrice = thingCatalogUseCases.getSellingPrice( (UUID) THING_DATA[4][0] );

        // then
        assertEquals( THING_DATA[4][5], sellingPrice );
    }

    @Test
    public void testRemoveThingFromCatalog() {
        // given
        initialMasterDataCreator.addAllThings();
        UUID thingId = (UUID) THING_DATA[4][0];

        // when
        assertDoesNotThrow( () -> thingCatalogUseCases.getSellingPrice( thingId ) );
        thingCatalogUseCases.removeThingFromCatalog( thingId );

        // then
        assertThrows( ShopException.class, () -> thingCatalogUseCases.getSellingPrice( thingId ) );
    }




    @Test
    public void testRemoveThingThatIsInStock() {
        // given
        initialMasterDataCreator.addAllThings();
        UUID thingId = (UUID) THING_DATA[4][0];
        stockManagementUseCases.addToStock( thingId, 3 );

        // when
        // then
        assertThrows( ShopException.class, () -> thingCatalogUseCases.removeThingFromCatalog( thingId ) );
    }


    @Test
    public void testClearThingCatalog() {
        // given
        initialMasterDataCreator.addAllThings();

        // when
        thingCatalogUseCases.deleteThingCatalog();

        // then
        assertThrows( ShopException.class, () -> thingCatalogUseCases.getSellingPrice( (UUID) THING_DATA[4][0] ) );
    }

}


--- FILE: C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionUserRegistrationTest.java ---
package thkoeln.archilab.ecommerce.regression;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import thkoeln.archilab.ecommerce.ShopException;
import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
import thkoeln.archilab.ecommerce.usecases.UserRegistrationUseCases;
import thkoeln.archilab.ecommerce.usecases.UserType;
import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MailAddressType;

import javax.transaction.Transactional;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateMailAddress;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_ADDRESS;
import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.USER_EMAIL;

@SpringBootTest
@Transactional
public class RegressionUserRegistrationTest {

    @Autowired
    private UserRegistrationUseCases userRegistrationUseCases;
    @Autowired
    private InitialMasterDataCreator initialMasterDataCreator;

    private MailAddressType nonExistingMailAddress;

    @BeforeEach
    public void setUp() {
        initialMasterDataCreator.deleteAll();
        nonExistingMailAddress = instantiateMailAddress( "this@nononono.de" );
    }


    @Test
    public void testAllUsersRegistered() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        UserType user3 = userRegistrationUseCases.getUserData( USER_EMAIL[3] );

        // then
        Assertions.assertEquals( initialMasterDataCreator.USER_NAME[3], user3.getName() );
        Assertions.assertEquals( USER_EMAIL[3], user3.getMailAddress() );
        Assertions.assertEquals( USER_ADDRESS[3], user3.getPersonalAddress() );
    }


    @Test
    public void testRegisterUserWithDuplicateMailAddress() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        // then
        assertThrows( ShopException.class, () ->
                userRegistrationUseCases.register( "Gandalf The Grey", USER_EMAIL[5],
                        USER_ADDRESS[5] ) );
    }

    @Test
    public void testRegisterUserWithDuplicateNameOrPersonalAddress() {
        // given
        initialMasterDataCreator.registerAllUsers();
        MailAddressType newMailAddress = instantiateMailAddress( "some@this.de" );

        // when
        // then
        assertDoesNotThrow(() ->
                userRegistrationUseCases.register( initialMasterDataCreator.USER_NAME[2], newMailAddress,
                        USER_ADDRESS[2] ) );
    }


    @Test
    public void testDeleteUsersNoMoreUsers() {
        // given
        initialMasterDataCreator.registerAllUsers();

        // when
        userRegistrationUseCases.deleteAllUsers();

        // then
        assertThrows( ShopException.class, () -> userRegistrationUseCases.getUserData( USER_EMAIL[0] ) );
    }

}


[RESPONSE]:
# Code Review Ergebnisse

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\MailAddress.java

[MailAddress.java] [Zeile 23]: **Duplication** (Original: ZipCode.java Zeile 23-28): Regex-Validierungsmuster mit Pattern.compile und Matcher ist strukturell identisch zu ZipCode.of().

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java

[Money.java] [Zeilen 36-37]: **Duplication** (Original: Zeilen 42-43, 49-50, 57-58): Null-Check und Currency-Check für otherMoney wird in add(), subtract() und largerThan() identisch wiederholt.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\ZipCode.java

[ZipCode.java] [Zeilen 23-28]: **Duplication** (Original: MailAddress.java Zeilen 23-28): Regex-Validierungsmuster mit Pattern.compile und Matcher ist strukturell identisch zu MailAddress.of().

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartRESTController.java

[ShoppingCartRESTController.java] [Zeilen 74-77]: **Dead Code**: Auskommentierter Code sollte entfernt werden.

[ShoppingCartRESTController.java] [Zeilen 100-102]: **Duplication** (Original: Zeilen 105-107): Der try-catch-Block mit `shoppingCartAppService.findById(shoppingCartId)` wird unmittelbar danach identisch wiederholt.

[ShoppingCartRESTController.java] [Zeilen 113-115]: **Duplication** (Original: Zeilen 118-120): Der try-catch-Block mit `shoppingCartAppService.findById(shoppingCartId)` wird unmittelbar danach identisch wiederholt.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\application\ShoppingCartService.java

[ShoppingCartService.java] [Zeilen 95-100]: **Duplication** (Original: Zeilen 117-122): Die Schleifen-Logik zum Reduzieren von CartPositions ist in removeStockCartCorrection() und changeStockCartCorrection() nahezu identisch.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java

[ShoppingCart.java] [Zeile 28]: **Dead Code**: Das Feld `totalQuantity` wird nirgendwo verwendet (wird in ShoppingCartAppService.getTotalQuantityOfOneCar() berechnet, aber nicht aus dieser Entity gelesen/geschrieben).

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java

[OrderService.java] [Zeile 10]: **Layer Violation**: Import von `thkoeln.archilab.ecommerce.solution.shoppingcart.domain.CartPosition` - Der Order-Application-Layer greift auf die Domain-Schicht eines anderen Packages (shoppingcart) zu. Import wird aber nicht genutzt.

[OrderService.java] [Zeile 10]: **Dead Code**: Import `CartPosition` wird nicht verwendet.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java

[Order.java] [Zeilen 28-30]: **Dead Code**: Die Methode `addOrderPosition()` wird nirgendwo aufgerufen.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\thing\domain\ThingRepository.java

[ThingRepository.java] [Zeile 11]: **Dead Code**: Die Methode `findByName()` wird nirgendwo aufgerufen.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java

- **Anemic Entity**: Die Klasse enthält nur Getter/Setter (via Lombok) und einen Konstruktor, aber keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java

- **Anemic Entity**: Die Klasse enthält nur Getter/Setter (via Lombok) und einen Konstruktor, aber keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\CartPosition.java

- **Anemic Entity**: Die Klasse enthält nur Getter/Setter (via Lombok) und einen Konstruktor, aber keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingcart\domain\ShoppingCart.java

- **Anemic Entity**: Die Klasse enthält nur Getter/Setter (via Lombok) und einen Konstruktor, aber keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderPosition.java

- **Anemic Entity**: Die Klasse enthält nur Getter und einen Konstruktor, aber keine Geschäftslogik.

---

## C:\workspace\Masterarbeit\Repositories\Rest\ST2M4_group_b46f3e42-e580-4fe4-bef1-c5df140fe047\src\main\java\thkoeln\archilab\ecommerce\solution\core\domain\AbstractUser.java

- **Anemic Entity**: Die abstrakte Klasse enthält nur Getter/Setter und implementiert ein Interface ohne eigene Logik.

ENDE
Generated by claude-opus-4-5-20251101
-----------------------------------