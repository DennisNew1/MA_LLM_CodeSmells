--- DATE: 14.2.2026, 16:23:13 ---

[PROMPT]:
Agiere als extrem strenger Java Code-Auditor. Dein Ziel ist MAXIMALER RECALL. Es ist viel schlimmer, einen Code Smell zu übersehen (False Negative), als einen zu melden, der keiner ist (False Positive). Wenn du unsicher bist oder es ein Grenzfall ist: MELDE IHN TROTZDEM und markiere ihn als 'Verdacht'. Sei lieber übervorsichtig als nachlässig.
        Architektur: 4-Layer (Eric Evans).
        Aufgabe: Finde folgende Smells: Duplication: duplizierte Codestücke die mehrmals vorkommen und eingespart werden könnten. Gib hierbei sowohl die duplizierte als auch die originale Zeile an. Bei längeren kopierten Abschnitten gib auch hier die Zeilen als Bereich an.  negative conditionals: Es handelt sich hierbei um negativ oder doppelt negativ formulierte Bedingungen und Variablen. Einfach formulierte Negierungen in if-Anweisungen sind okay solange sie verständlich sind.  dead code: Nicht genutzer Code. Klassen, Methoden und Variablen die nie aufgerufen werden.  layer violation: Es wurde sich nicht an die Package und Ebenenstruktur gehalten. Zum Beispiel Zugriff auf den Domainlayer eines anderen Pakets. missplaced resonsibility: Dieser Code ist an der falschen Stelle. Entweder gehört er in ein anderes Package oder in einen andere Schicht oder in eine andere Klasse. Shared persistency: Zugriff auf die Repositories der Domainschicht eines anderen Packages. Anemic Entity: Domain Entities in der Domainschicht die nur über Getter oder Setter verfügen aber sonst keine Funktionen. Ausgenommen sind Repositories. Für diesen Smell brauchst du keinen Zeilenangabe, da er für die gesamte Klasse gilt. Schreib einfach nur einmal -Anemic Entity- sonst zu der enstrechenden Datei.
        Regeln:
        1. Begründe kurz jeden Fund.
        2. Gruppiere nach Datei (mit Pfad). 
        3. Keine Code-Wiederholung, nur Referenzen.
        4. Nutze die Zeilenangaben die mitgeschickt worden sind.
        5. Formatiere die Antwort als Json mit folgender Struktur: 
        {
        "projektName": "ProjektordnerName",
        "llm": "NameDerLLM",
        "codeSmells": [
            {
            "class": "FactoryMethodInvoker",
            "duplication": [
                { 
                "line": "33", 
                "reasoning": "Identische Logik zur Instanziierung wird hier wiederholt." 
                },
                { 
                "line": "44", 
                "reasoning": "Redundanter Aufruf, der bereits in Zeile 33 abgedeckt ist." 
                }
            ],
            "deadCode": [
                { 
                "line": "139-139", 
                "reasoning": "Diese Methode wird im gesamten Projektkontext nicht aufgerufen." 
                }
            ]
            },
            {
            "class": "InitialMasterDataCreator",
            "deadCode": [
                { 
                "line": "4-4", 
                "reasoning": "Import-Statement für eine Bibliothek, die nicht mehr verwendet wird." 
                },
                { 
                "line": "165-165", 
                "reasoning": "Variable wurde deklariert, aber der Wert wird nie ausgelesen." 
                }
            ]
            }
        ]
        }
        



--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Address.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.EqualsAndHashCode;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
9: 
10: import javax.persistence.Embeddable;
11: import javax.persistence.Embedded;
12: 
13: @NoArgsConstructor
14: @AllArgsConstructor
15: @Embeddable //ValueObject
16: @EqualsAndHashCode
17: public class Address implements HomeAddressType {
18:     @Embedded
19:     private PostalCode postcode;
20:     private String city;
21:     private String street;
22: 
23:     public Address(PostalCodeType postcode, String city, String street) {
24:         if (postcode == null || city == null || city.isEmpty() || street == null || street.isEmpty()) {
25:             throw new ShopException("Address parameter is empty! Invalid!");
26:         }
27:         this.postcode = (PostalCode) postcode;
28:         this.city = city;
29:         this.street = street;
30:     }
31: 
32:     public static HomeAddressType of(String street, String city, PostalCodeType postalCode) {
33:         return new Address(postalCode, city, street);
34:     }
35: 
36:     /**
37:      * @return the street as a string
38:      */
39:     @Override
40:     public String getStreet() {
41:         return this.street;
42:     }
43: 
44:     /**
45:      * @return the city as a string
46:      */
47:     @Override
48:     public String getCity() {
49:         return this.city;
50:     }
51: 
52:     /**
53:      * @return the postal code
54:      */
55:     @Override
56:     public PostalCodeType getPostalCode() {
57:         return this.postcode;
58:     }
59: }
60: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\AllowedCurrencies.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: public enum AllowedCurrencies {
4:     EUR("EUR"),
5:     CHF("CHF");
6: 
7:     private final String value;
8: 
9:     AllowedCurrencies(String value) {
10:         this.value = value;
11:     }
12: 
13:     public String getValue() {
14:         return value;
15:     }
16: }
17: 
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Email.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import com.fasterxml.jackson.annotation.JsonProperty;
4: import lombok.AllArgsConstructor;
5: import lombok.EqualsAndHashCode;
6: import lombok.NoArgsConstructor;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: 
10: import javax.persistence.Embeddable;
11: 
12: @NoArgsConstructor
13: @AllArgsConstructor
14: @Embeddable
15: //ValueObject as Domain primitve
16: @EqualsAndHashCode
17: public class Email implements EmailType {
18:     @JsonProperty
19:     private String emailString;
20: 
21:     //Factory Method
22:     public static EmailType of(String emailString) {
23:         String regexPattern = "^[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*\\.(de|at|ch|com|org)$";
24:         if (emailString == null || emailString.isEmpty() || !emailString.matches(regexPattern)) {
25:             throw new ShopException("Invalid Email! Format does not match requirements");
26:         }
27:         return new Email(emailString);
28:     }
29: 
30:     public static String asString(EmailType emailType) {
31:         return emailType.toString();
32:     }
33: 
34:     @Override
35:     public String toString() {
36:         return String.format(emailString);
37:     }
38: 
39:     public static boolean isValidFormat(String emailString){
40:         String regexPattern = "^[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*@[A-Za-z0-9]+(\\.[A-Za-z0-9]+)*\\.(de|at|ch|com|org)$";
41:         if (emailString.matches(regexPattern)) {
42:             return true;
43:         } else {
44:             return false;
45:         }
46:     }
47: 
48: }
49: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\Money.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.EqualsAndHashCode;
5: import lombok.NoArgsConstructor;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import javax.persistence.Embeddable;
10: import javax.persistence.Transient;
11: import java.util.Arrays;
12: 
13: @NoArgsConstructor
14: @AllArgsConstructor
15: @Embeddable
16: //ValueObject as Domain primitve
17: @EqualsAndHashCode
18: public class Money implements MoneyType {
19: 
20:     private Float amount;
21: 
22:     private String currency;
23: 
24:     public static MoneyType of(Float amount, String currency) {
25:         if (amount == null || currency == null || amount < 0 || !Arrays.stream(AllowedCurrencies.values()).anyMatch(c -> c.getValue().equals(currency))) {
26:             throw new ShopException("Can not create negative/null MoneyType!");
27:         } else {
28:             return new Money(amount, currency);
29:         }
30:     }
31: 
32:     /**
33:      * @return the amount of money
34:      */
35:     @Transient
36:     @Override
37:     public Float getAmount() {
38:         return this.amount;
39:     }
40: 
41:     /**
42:      * @return the currency of the money
43:      */
44:     @Transient
45:     @Override
46:     public String getCurrency() {
47:         return this.currency;
48:     }
49: 
50:     /**
51:      * @param otherMoney
52:      * @return this + otherMoney, as a new object
53:      * @throws ShopException if ...
54:      *                       - otherMoney is null
55:      *                       - otherMoney.currency != this.currency
56:      */
57:     @Override
58:     public MoneyType add(MoneyType otherMoney) {
59:         if (otherMoney == null || !otherMoney.getCurrency().equals(this.getCurrency())) {
60:             throw new ShopException("The amount to be added does not match a number or the right currency");
61:         }
62:         Money newMoneyType = new Money();
63:         Float newAmount = this.getAmount() + otherMoney.getAmount();
64:         newMoneyType.amount = newAmount;
65:         newMoneyType.currency = this.currency;
66:         return newMoneyType;
67:     }
68: 
69:     /**
70:      * @param otherMoney
71:      * @return this - otherMoney, as a new object
72:      * @throws ShopException if ...
73:      *                       - otherMoney is null
74:      *                       - otherMoney.currency != this.currency
75:      *                       - otherMoney > this
76:      */
77:     @Override
78:     public MoneyType subtract(MoneyType otherMoney) {
79:         if (otherMoney == null || !otherMoney.getCurrency().equals(this.getCurrency()) ||
80:                 otherMoney.getAmount() > this.getAmount()) {
81:             throw new ShopException("The amount to be removed is larger as it can to be removed or" +
82:                     "does not match the given currency!");
83:         }
84:         Money newMoneyType = new Money();
85:         Float newAmount = this.getAmount() - otherMoney.getAmount();
86:         newMoneyType.amount = newAmount;
87:         newMoneyType.currency = this.currency;
88:         return newMoneyType;
89:     }
90: 
91:     /**
92:      * @param factor
93:      * @return this * factor, as a new object
94:      * @throws ShopException if ...
95:      *                       - factor < 0
96:      */
97:     @Override
98:     public MoneyType multiplyBy(int factor) {
99:         if (factor < 0) {
100:             throw new ShopException("The given factor is to low! (Factor < 0)");
101:         }
102:         Money newMoneyType = new Money();
103:         Float newAmount = this.getAmount() * factor;
104:         newMoneyType.amount = newAmount;
105:         newMoneyType.currency = this.currency;
106:         return newMoneyType;
107:     }
108: 
109:     /**
110:      * @param otherMoney
111:      * @return true, if this > otherMoney
112:      * @throws ShopException if ...
113:      *                       - otherMoney is null
114:      *                       - otherMoney.currency != this.currency
115:      */
116:     @Override
117:     public boolean largerThan(MoneyType otherMoney) {
118:         if (otherMoney == null || !this.getCurrency().equals(otherMoney.getCurrency())) {
119:             throw new ShopException("The given MoneyType is null or does not match the same currency!");
120:         }
121:         return this.getAmount() > otherMoney.getAmount();
122:     }
123: }
124: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\domainprimitives\PostalCode.java ---
1: package thkoeln.archilab.ecommerce.domainprimitives;
2: 
3: import lombok.*;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import javax.persistence.Embeddable;
8: 
9: @NoArgsConstructor
10: @AllArgsConstructor
11: @Setter
12: @Getter
13: @Embeddable
14: //ValueObject as Domain primitve
15: @EqualsAndHashCode
16: public class PostalCode implements PostalCodeType {
17:     private String postalCode;
18: 
19:     /*We will use a much simplified validation method to check if the postal code is valid:
20:      *      - It must contain exactly 5 digits.
21:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
22:      * */
23: 
24:     public static PostalCode of(String postalCode) {
25:         String regexPattern = "^[0-9][0-9]{3}[1-9]|[1-9][0-9]{2}[1-9][0-9]$";
26:         if (postalCode == null || !postalCode.matches(regexPattern) || postalCode.length() != 5) {
27:             throw new ShopException("Invalid PostalCode!");
28:         }
29:         return new PostalCode(postalCode);
30:     }
31: 
32:     @Override
33:     public String toString() {
34:         return String.format(postalCode);
35:     }
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\masterdata\FactoryMethodInvoker.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.io.File;
10: import java.io.IOException;
11: import java.lang.reflect.InvocationTargetException;
12: import java.lang.reflect.Method;
13: import java.lang.reflect.Modifier;
14: import java.net.URL;
15: import java.net.URLDecoder;
16: import java.nio.charset.StandardCharsets;
17: import java.util.Enumeration;
18: 
19: import static org.junit.jupiter.api.Assertions.*;
20: 
21: public class FactoryMethodInvoker {
22: 
23:     public static EmailType instantiateEmail( String emailAsString ) {
24:         Method factoryMethod = null;
25:         try {
26:             Class<?> interfaceClass = Class.forName(
27:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType" );
28:             Class<?> implementingClass = findImplementation( interfaceClass );
29: 
30:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
31:             assertNotNull( factoryMethod );
32:             int modifiers = factoryMethod.getModifiers();
33:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
34:         } catch (Exception e) {
35:             fail( "Failed to find implementation for EmailType", e );
36:         }
37: 
38:         Object instance = null;
39:         try {
40:             instance = factoryMethod.invoke( null, emailAsString );
41:         } catch (Exception e) {
42:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
43:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
44:             fail( "Failed to invoke factory method 'of' for '" + emailAsString + "'", e );
45:         }
46:         assertNotNull( instance );
47:         return (EmailType) instance;
48:     }
49: 
50: 
51:     public static HomeAddressType instantiateHomeAddress(
52:             String street, String city, PostalCodeType postalCode ) {
53:         Method factoryMethod = null;
54:         try {
55:             Class<?> interfaceClass = Class.forName(
56:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType" );
57:             Class<?> implementingClass = findImplementation( interfaceClass );
58: 
59:             factoryMethod = implementingClass.getDeclaredMethod( "of",
60:                     String.class, String.class, PostalCodeType.class );
61:             assertNotNull( factoryMethod );
62:             int modifiers = factoryMethod.getModifiers();
63:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
64:         } catch (Exception e) {
65:             fail( "Failed to find implementation for HomeAddressType", e );
66:         }
67: 
68:         Object instance = null;
69:         try {
70:             instance = factoryMethod.invoke( null, street, city, postalCode );
71:         } catch (Exception e) {
72:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
73:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
74:             fail( "Failed to invoke factory method 'of' for '" +
75:                     street + "', '" + city + "', '" + postalCode + "'", e );
76:         }
77:         assertNotNull( instance );
78:         return (HomeAddressType) instance;
79:     }
80: 
81: 
82:     public static PostalCodeType instantiatePostalCode( String postalCodeAsString ) {
83:         Method factoryMethod = null;
84:         try {
85:             Class<?> interfaceClass = Class.forName(
86:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType" );
87:             Class<?> implementingClass = findImplementation( interfaceClass );
88: 
89:             factoryMethod = implementingClass.getDeclaredMethod( "of", String.class );
90:             assertNotNull( factoryMethod );
91:             int modifiers = factoryMethod.getModifiers();
92:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
93:         } catch (Exception e) {
94:             fail( "Failed to find implementation for PostalCodeType", e );
95:         }
96: 
97:         Object instance = null;
98:         try {
99:             instance = factoryMethod.invoke( null, postalCodeAsString );
100:         } catch (Exception e) {
101:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
102:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
103:             fail( "Failed to invoke factory method 'of' for '" + postalCodeAsString + "'", e );
104:         }
105:         assertNotNull( instance );
106:         return (PostalCodeType) instance;
107:     }
108: 
109: 
110:     public static MoneyType instantiateMoney( Float amount, String currency ) {
111:         Method factoryMethod = null;
112:         try {
113:             Class<?> interfaceClass = Class.forName(
114:                     "thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType" );
115:             Class<?> implementingClass = findImplementation( interfaceClass );
116: 
117:             factoryMethod = implementingClass.getDeclaredMethod( "of", Float.class, String.class );
118:             assertNotNull( factoryMethod );
119:             int modifiers = factoryMethod.getModifiers();
120:             assertTrue( Modifier.isStatic( modifiers ), "The method 'of' should be static" );
121:         } catch (Exception e) {
122:             fail( "Failed to find implementation for MoneyType", e );
123:         }
124: 
125:         Object instance = null;
126:         try {
127:             instance = factoryMethod.invoke( null, amount, currency );
128:         } catch (Exception e) {
129:             if ( e instanceof InvocationTargetException && ( (InvocationTargetException) e ).getTargetException()
130:                     instanceof ShopException ) throw new ShopException( e.getMessage() );
131:             fail( "Failed to invoke factory method 'of' for '" + amount + "', '" + currency + "'", e );
132:         }
133:         assertNotNull( instance );
134:         return (MoneyType) instance;
135:     }
136: 
137: 
138:     private static Class<?> findImplementation( Class<?> interfaceClass ) {
139:         Method factoryMethod = null;
140:         try {
141:             String packageName = "thkoeln.archilab.ecommerce.domainprimitives";
142:             Class<?> implementingClass = findImplementingClass( packageName, interfaceClass );
143:             assertNotNull( implementingClass );
144:             return implementingClass;
145:         } catch (Exception e) {
146:             fail( "Cannot find implementation for " + interfaceClass.getSimpleName(), e );
147:             return null; // This line will never be reached, but it's necessary to satisfy the compiler
148:         }
149:     }
150: 
151: 
152:     private static Class<?> findImplementingClass( String packageName, Class<?> interfaceClass )
153:             throws ClassNotFoundException, IOException {
154:         ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
155:         String path = packageName.replace( '.', '/' );
156:         Enumeration<URL> resources = classLoader.getResources( path );
157:         int count = 0;
158:         Class<?> result = null;
159:         while (resources.hasMoreElements()) {
160:             URL resource = resources.nextElement();
161:             File directory = new File( URLDecoder.decode( resource.getFile(), StandardCharsets.UTF_8 ) );
162:             File[] files = directory.listFiles();
163:             for ( File file : files ) {
164:                 if ( file.getName().endsWith( ".class" ) ) {
165:                     String className = packageName + '.' + file.getName().substring( 0, file.getName().length() - 6 );
166:                     Class<?> clazz = Class.forName( className );
167:                     if ( interfaceClass.isAssignableFrom( clazz ) && !clazz.isInterface() && !Modifier.isAbstract( clazz.getModifiers() ) ) {
168:                         count++;
169:                         result = clazz;
170:                     }
171:                 }
172:             }
173:         }
174:         assertEquals( 1, count, "There should be exactly one implementing class" );
175:         return result;
176:     }
177: }
178: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\masterdata\InitialMasterDataCreator.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.ApplicationListener;
5: import org.springframework.context.annotation.Profile;
6: import org.springframework.context.event.ContextRefreshedEvent;
7: import org.springframework.stereotype.Component;
8: import thkoeln.archilab.ecommerce.usecases.*;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import java.util.HashMap;
14: import java.util.Map;
15: import java.util.Random;
16: import java.util.UUID;
17: 
18: 
19: /**
20:  * This class is used to create the initial master data for the application. This includes
21:  * clients and goods. It is executed on application startup, and is used for testing purposes.
22:  */
23: @Component
24: @SuppressWarnings("PMD")
25: public class InitialMasterDataCreator {
26: 
27:     public final static String[] CLIENT_NAME = new String[]{
28:             "Max Müller",
29:             "Sophie Schmitz",
30:             "Irene Mihalic",
31:             "Emilia Fischer",
32:             "Filiz Polat",
33:             "Lina Wagner",
34:             "Leon Becker",
35:             "Agnieszka Kalterer",
36:             "Felix Bauer",
37:             "Lara Schulz"
38:     };
39:     public final static EmailType[] CLIENT_EMAIL = new EmailType[] {
40:             FactoryMethodInvoker.instantiateEmail( "max.mueller@example.com" ),
41:             FactoryMethodInvoker.instantiateEmail( "sophie.schmitz@example.com" ),
42:             FactoryMethodInvoker.instantiateEmail( "irene@wearefreedomnow.com" ),
43:             FactoryMethodInvoker.instantiateEmail( "emilia.fischer@example.com" ),
44:             FactoryMethodInvoker.instantiateEmail( "j877d3@gmail.com" ),
45:             FactoryMethodInvoker.instantiateEmail( "lina.wagner@example.com" ),
46:             FactoryMethodInvoker.instantiateEmail( "leon.becker@example.com" ),
47:             FactoryMethodInvoker.instantiateEmail( "agna@here.com" ),
48:             FactoryMethodInvoker.instantiateEmail( "felix.bauer@example.com" ),
49:             FactoryMethodInvoker.instantiateEmail( "lara.schulz@example.com" )
50:     };
51: 
52:     public final static HomeAddressType[] CLIENT_ADDRESS = new HomeAddressType[] {
53:             FactoryMethodInvoker.instantiateHomeAddress(
54:                     "Hauptstraße 1", "Berlin",
55:                     FactoryMethodInvoker.instantiatePostalCode( "10115" ) ),
56:             FactoryMethodInvoker.instantiateHomeAddress(
57:                     "Bahnhofstraße 12", "München",
58:                     FactoryMethodInvoker.instantiatePostalCode( "80331" ) ),
59:             FactoryMethodInvoker.instantiateHomeAddress(
60:                     "Kirchplatz 3", "Hamburg",
61:                     FactoryMethodInvoker.instantiatePostalCode( "20095" ) ),
62:             FactoryMethodInvoker.instantiateHomeAddress(
63:                     "Goethestraße 7", "Frankfurt am Main",
64:                     FactoryMethodInvoker.instantiatePostalCode( "60311" ) ),
65:             FactoryMethodInvoker.instantiateHomeAddress(
66:                     "Mühlenweg 15", "Köln",
67:                     FactoryMethodInvoker.instantiatePostalCode( "50667" ) ),
68:             FactoryMethodInvoker.instantiateHomeAddress(
69:                     "Schulstraße 9", "Düsseldorf",
70:                     FactoryMethodInvoker.instantiatePostalCode( "40213" ) ),
71:             FactoryMethodInvoker.instantiateHomeAddress(
72:                     "Dorfstraße 21", "Stuttgart",
73:                     FactoryMethodInvoker.instantiatePostalCode( "70173" ) ),
74:             FactoryMethodInvoker.instantiateHomeAddress(
75:                     "Marktstraße 5", "Leipzig",
76:                     FactoryMethodInvoker.instantiatePostalCode( "04109" ) ),
77:             FactoryMethodInvoker.instantiateHomeAddress(
78:                     "Rosenweg 14", "Dortmund",
79:                     FactoryMethodInvoker.instantiatePostalCode( "44135" ) ),
80:             FactoryMethodInvoker.instantiateHomeAddress(
81:                     "Wiesenstraße 6", "Essen",
82:                     FactoryMethodInvoker.instantiatePostalCode( "45127" ) )
83:     };
84: 
85:     public final static ClientType[] mockClients;
86: 
87:     public static final String EUR = "EUR";
88: 
89:     public static final Object[][] GOOD_DATA = new Object[][]{
90:             {UUID.randomUUID(), "TCD-34 v2.1", "Universelles Verbindungsstück für den einfachen Hausgebrauch bei der Schnellmontage",
91:                     1.5f, FactoryMethodInvoker.instantiateMoney( 5.0f, EUR ),
92:                     FactoryMethodInvoker.instantiateMoney( 10.0f, EUR )},
93:             {UUID.randomUUID(), "EFG-56", "Hochleistungsfähiger Kondensator für elektronische Schaltungen",
94:                     0.3f, FactoryMethodInvoker.instantiateMoney( 2.5f, EUR ),
95:                     FactoryMethodInvoker.instantiateMoney( 4.0f, EUR )},
96:             {UUID.randomUUID(), "MNP-89ff", "Langlebiger und robuster Motor für industrielle Anwendungen",
97:                     7.2f, FactoryMethodInvoker.instantiateMoney( 50.0f, EUR ),
98:                     FactoryMethodInvoker.instantiateMoney( 80.0f, EUR )},
99:             {UUID.randomUUID(), "Gh-25", "Kompakter und leichter Akku für mobile Geräte",
100:                     null, FactoryMethodInvoker.instantiateMoney( 6.0f, EUR ),
101:                     FactoryMethodInvoker.instantiateMoney( 8.0f, EUR )},
102:             {UUID.randomUUID(), "MultiBeast2", "Vielseitiger Adapter für verschiedene Steckertypen",
103:                     null, FactoryMethodInvoker.instantiateMoney( 0.6f, EUR ),
104:                     FactoryMethodInvoker.instantiateMoney( 1.0f, EUR )},
105:             {UUID.randomUUID(), "ABC-99 v4.2", "Leistungsstarker Prozessor für Computer und Server",
106:                     1.0f, FactoryMethodInvoker.instantiateMoney( 150.0f, EUR ),
107:                     FactoryMethodInvoker.instantiateMoney( 250.0f, EUR )},
108:             {UUID.randomUUID(), "Stuko22", "Ersatzteil Spitze für Präzisionswerkzeug zum Löten und Schrauben",
109:                     null, FactoryMethodInvoker.instantiateMoney( 0.3f, EUR ),
110:                     FactoryMethodInvoker.instantiateMoney( 0.5f, EUR )},
111:             {UUID.randomUUID(), "Btt2-Ah67", "Kraftstoffeffiziente und umweltfreundliche Hochleistungsbatterie",
112:                     6.0f, FactoryMethodInvoker.instantiateMoney( 80.0f, EUR ),
113:                     FactoryMethodInvoker.instantiateMoney( 120.0f, EUR )},
114:             {UUID.randomUUID(), "JKL-67", "Wasserdichtes Gehäuse",
115:                     3.0f, FactoryMethodInvoker.instantiateMoney( 1.0f, EUR ),
116:                     FactoryMethodInvoker.instantiateMoney( 1.2f, EUR )},
117:             {UUID.randomUUID(), "MNO-55-33", "Modulares Netzteil für flexible Stromversorgung",
118:                     5.5f, FactoryMethodInvoker.instantiateMoney( 25.0f, EUR ),
119:                     FactoryMethodInvoker.instantiateMoney( 45.0f, EUR )},
120:             {UUID.randomUUID(), "PQR-80", "Effizienter Kühler für verbesserte Wärmeableitung",
121:                     4.0f, FactoryMethodInvoker.instantiateMoney( 20.0f, EUR ),
122:                     FactoryMethodInvoker.instantiateMoney( 35.0f, EUR )},
123:             {UUID.randomUUID(), "STU-11 Ld", "Hochwertiger Grafikchip für leistungsstarke PCs",
124:                     null, FactoryMethodInvoker.instantiateMoney( 200.0f, EUR ),
125:                     FactoryMethodInvoker.instantiateMoney( 350.0f, EUR )},
126:             {UUID.randomUUID(), "VWX-90 FastWupps", "Schnellladegerät für eine Vielzahl von Geräten",
127:                     null, FactoryMethodInvoker.instantiateMoney( 15.0f, EUR ),
128:                     FactoryMethodInvoker.instantiateMoney( 25.0f, EUR )},
129:             {UUID.randomUUID(), "YZZ-22 v1.8", "Leichter und stabiler Rahmen aus Aluminium",
130:                     3.5f, FactoryMethodInvoker.instantiateMoney( 60.0f, EUR ),
131:                     FactoryMethodInvoker.instantiateMoney( 100.0f, EUR )}
132:     };
133: 
134:     private ClientRegistrationUseCases clientRegistrationUseCases;
135:     private GoodCatalogUseCases goodCatalogUseCases;
136:     private StockManagementUseCases stockManagementUseCases;
137:     private ShoppingBasketUseCases shoppingBasketUseCases;
138: 
139: 
140:     // good 0 is out of stock, good 1 and 2 have fixed quantities of 10 and 20, respectively, and the
141:     // others have a random stock between 5 and 100
142:     public static final Map<UUID, Integer> GOOD_STOCK = new HashMap<>();
143: 
144:     static {
145:         mockClients = new ClientType[CLIENT_NAME.length];
146:         for ( int i = 0; i < CLIENT_NAME.length; i++ ) {
147:             mockClients[i] = new MockClient(
148:                     CLIENT_NAME[i], CLIENT_EMAIL[i], CLIENT_ADDRESS[i]);
149:         }
150:         Random random = new Random();
151:         for ( Object[] goodData : GOOD_DATA ) {
152:             GOOD_STOCK.put( (UUID) goodData[0], random.nextInt( 100 ) + 20 );
153:         }
154:         GOOD_STOCK.put( (UUID) GOOD_DATA[0][0], 0 );
155:         GOOD_STOCK.put( (UUID) GOOD_DATA[1][0], 10 );
156:         GOOD_STOCK.put( (UUID) GOOD_DATA[2][0], 20 );
157:         GOOD_STOCK.put( (UUID) GOOD_DATA[3][0], 30 );
158: 
159:     }
160: 
161: 
162:     public enum InvalidReason {
163:         NULL, EMPTY;
164: 
165:         public Object getInvalidValue( Object originalValue ) {
166:             switch (this) {
167:                 case NULL:
168:                     return null;
169:                 case EMPTY:
170:                     return "";
171:                 default:
172:                     return null;
173:             }
174:         }
175:     }
176: 
177: 
178:     @Autowired
179:     public InitialMasterDataCreator(
180:             ClientRegistrationUseCases clientRegistrationUseCases,
181:             GoodCatalogUseCases goodCatalogUseCases,
182:             StockManagementUseCases stockManagementUseCases,
183:             ShoppingBasketUseCases shoppingBasketUseCases ) {
184:         this.clientRegistrationUseCases = clientRegistrationUseCases;
185:         this.goodCatalogUseCases = goodCatalogUseCases;
186:         this.stockManagementUseCases = stockManagementUseCases;
187:         this.shoppingBasketUseCases = shoppingBasketUseCases;
188:     }
189: 
190: 
191:     public void deleteAll() {
192:         shoppingBasketUseCases.deleteAllOrders();
193:         goodCatalogUseCases.deleteGoodCatalog();
194:         clientRegistrationUseCases.deleteAllClients();
195:     }
196: 
197: 
198:     public void registerAllClients() {
199:         for ( int i = 0; i < InitialMasterDataCreator.CLIENT_NAME.length; i++ ) {
200:             registerClient( InitialMasterDataCreator.CLIENT_NAME[i], CLIENT_EMAIL[i], CLIENT_ADDRESS[i] );
201:         }
202:     }
203: 
204: 
205:     public void registerClient( String name, EmailType email, HomeAddressType homeAddress ) {
206:         clientRegistrationUseCases.register( name, email, homeAddress );
207:     }
208: 
209:     public void addAllGoods() {
210:         for ( Object[] goodData : GOOD_DATA ) {
211:             addGoodDataToCatalog( goodData );
212:         }
213:     }
214: 
215:     public void addGoodDataToCatalog( Object[] goodData ) {
216:         goodCatalogUseCases.addGoodToCatalog( (UUID) goodData[0], (String) goodData[1], (String) goodData[2],
217:                 (Float) goodData[3], (MoneyType) goodData[4], (MoneyType) goodData[5] );
218:     }
219: 
220: 
221:     public Object[] getGoodDataInvalidAtIndex( int index, InvalidReason reason ) {
222:         Object[] goodData = GOOD_DATA[1];
223:         Object[] goodDataInvalid = new Object[goodData.length];
224:         System.arraycopy( goodData, 0, goodDataInvalid, 0, goodData.length );
225:         goodDataInvalid[index] = goodData[index].getClass().cast(
226:                 reason.getInvalidValue( goodData[index] ) );
227:         return goodDataInvalid;
228:     }
229: 
230: 
231:     public void stockUpAllGoods() {
232:         for ( Object[] goodData : GOOD_DATA ) {
233:             if ( GOOD_STOCK.get( goodData[0] ) > 0 )
234:                 stockManagementUseCases.addToStock( (UUID) goodData[0], GOOD_STOCK.get( goodData[0] ) );
235:         }
236:     }
237: }
238: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\masterdata\MockClient.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import lombok.Setter;
4: import thkoeln.archilab.ecommerce.usecases.ClientType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
7: 
8: import java.util.Objects;
9: 
10: @Setter
11: public class MockClient implements ClientType {
12:     private String name;
13:     private EmailType email;
14:     private HomeAddressType homeAddress;
15: 
16: 
17:     public MockClient( String name, EmailType email, HomeAddressType homeAddress) {
18:         this.name = name;
19:         this.email = email;
20:         this.homeAddress = homeAddress;
21:     }
22: 
23:     @Override
24:     public String getName() {
25:         return name;
26:     }
27: 
28:     @Override
29:     public EmailType getEmail() {
30:         return email;
31:     }
32: 
33:     @Override
34:     public HomeAddressType getHomeAddress() {
35:         return homeAddress;
36:     }
37: 
38:     @Override
39:     public boolean equals( Object o ) {
40:         if ( this == o ) return true;
41:         if ( !( o instanceof MockClient ) ) return false;
42:         MockClient that = (MockClient) o;
43:         return Objects.equals( getName(), that.getName() ) && Objects.equals( email, that.email ) && Objects.equals( homeAddress, that.homeAddress );
44:     }
45: 
46:     @Override
47:     public int hashCode() {
48:         return Objects.hash( getName(), email, homeAddress );
49:     }
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\masterdata\StartupListener.java ---
1: package thkoeln.archilab.ecommerce.masterdata;
2: 
3: import org.slf4j.Logger;
4: import org.slf4j.LoggerFactory;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.context.ApplicationListener;
7: import org.springframework.context.annotation.Profile;
8: import org.springframework.context.event.ContextRefreshedEvent;
9: import org.springframework.stereotype.Component;
10: 
11: @Component
12: @Profile("!test")
13: public class StartupListener implements ApplicationListener<ContextRefreshedEvent>  {
14:     private Logger logger = LoggerFactory.getLogger( StartupListener.class );
15: 
16:     private InitialMasterDataCreator initialMasterDataCreator;
17: 
18:     @Autowired
19:     public StartupListener( InitialMasterDataCreator initialMasterDataCreator ) {
20:         this.initialMasterDataCreator = initialMasterDataCreator;
21:     }
22: 
23:     @Override
24:     public void onApplicationEvent( ContextRefreshedEvent contextRefreshedEvent ) {
25:         logger.info( "Initializing master data..." );
26:         initialMasterDataCreator.registerAllClients();
27:     }
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\ProjectApplication.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: import org.springframework.boot.SpringApplication;
4: import org.springframework.boot.autoconfigure.SpringBootApplication;
5: 
6: 
7: @SpringBootApplication
8: public class ProjectApplication {
9: 
10: 	/**
11: 	 * Entry method
12: 	 * @param args
13: 	 */
14: 	public static void main(String[] args) {
15: 		SpringApplication.run(ProjectApplication.class, args);
16: 	}
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\ShopException.java ---
1: package thkoeln.archilab.ecommerce;
2: 
3: public class ShopException extends RuntimeException {
4:     public ShopException( String message ) {
5:         super( message );
6:     }
7: }
8: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\client\application\ClientRegistrationService.java ---
1: package thkoeln.archilab.ecommerce.solution.client.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Address;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
10: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
11: import thkoeln.archilab.ecommerce.usecases.ClientRegistrationUseCases;
12: import thkoeln.archilab.ecommerce.usecases.ClientType;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
15: 
16: import java.util.ArrayList;
17: import java.util.List;
18: 
19: @Service
20: public class ClientRegistrationService implements ClientRegistrationUseCases {
21: 
22:     private final ClientRepository clientRepository;
23:     List<Email> registeredMails = new ArrayList<>();
24: 
25:     @Autowired
26:     public ClientRegistrationService(@Lazy ClientRepository clientRepository) {
27:         this.clientRepository = clientRepository;
28:     }
29: 
30:     @Override
31:     public void register(String name, EmailType email, HomeAddressType homeAddress) {
32:         Client client = new Client();
33:         //Check if any of the Parameters is not valid else create client
34:         if (name == null || name.isEmpty()) {
35:             throw new ShopException("Name is missing or Null");
36:         }
37:         if (homeAddress == null) {
38:             throw new ShopException("HomeAddress of client can not be null");
39:         }
40:         if (email == null) {
41:             throw new ShopException("Email is missing or Null");
42:         } else if (clientRepository.findByEmail((Email) email) == null) {
43:             client.setEmail((Email) email);
44:             registeredMails.add((Email) email);
45:         } else {
46:             throw new ShopException("Email is in Use");
47:         }
48: 
49:         client.setName(name);
50:         client.setAddress((Address) homeAddress);
51:         clientRepository.save(client);
52:     }
53: 
54: 
55:     @Override
56:     public void changeAddress(EmailType clientEmail, HomeAddressType homeAddress) {
57:         for (Client client : clientRepository.findAll()) {
58:             if (client.getEmail().equals(clientEmail) && homeAddress != null) {
59:                 Address newAddress = (Address) homeAddress;
60:                 client.setAddress(newAddress);
61:                 return;
62:             }
63:         }
64:         throw new ShopException("Can not change Address for non existing Email");
65:     }
66: 
67:     @Override
68:     public ClientType getClientData(EmailType clientEmail) {
69:         for (Client client : clientRepository.findAll()) {
70:             if (client.getEmail().equals(clientEmail)) {
71:                 return client;//TODO cannot be cast to class ClientType????
72:             }
73:         }
74:         throw new ShopException("There is no client in the system with this email. NO DATA!");
75:     }
76: 
77:     @Override
78:     public void deleteAllClients() {
79:         clientRepository.deleteAll();
80:         registeredMails.clear();
81:     }
82: 
83:     public Client findByEmail(Email email){
84:         return clientRepository.findByEmail(email);
85:     }
86: }
87: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\client\domain\Client.java ---
1: package thkoeln.archilab.ecommerce.solution.client.domain;
2: 
3: import lombok.*;
4: import org.dom4j.tree.AbstractEntity;
5: import thkoeln.archilab.ecommerce.domainprimitives.Address;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.usecases.ClientType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
10: 
11: import javax.persistence.*;
12: import java.util.UUID;
13: 
14: @Entity
15: @Getter
16: @Setter
17: @NoArgsConstructor
18: @AllArgsConstructor
19: @Inheritance(strategy = InheritanceType.SINGLE_TABLE)
20: public class Client extends AbstractEntity implements ClientType {
21:     @Id
22:     @Setter(AccessLevel.NONE)
23:     @GeneratedValue(strategy = GenerationType.AUTO)
24:     private UUID clientId = UUID.randomUUID();
25: 
26:     private String name;
27: 
28:     @Embedded
29:     private Email email;
30: 
31:     @Embedded
32:     private Address address;
33: 
34:     public EmailType getEmail() {
35:         return email;
36:     }
37: 
38:     @Override
39:     public HomeAddressType getHomeAddress() {
40:         return address;
41:     }
42: }
43: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\client\domain\ClientRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.client.domain;
2: 
3: 
4: import org.springframework.data.jpa.repository.Query;
5: import org.springframework.data.repository.CrudRepository;
6: import org.springframework.stereotype.Repository;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: 
9: import java.util.UUID;
10: 
11: @Repository
12: public interface ClientRepository extends CrudRepository<Client, UUID> {
13:     @Query("SELECT c FROM Client c WHERE c.email = :email")
14:     Client findByEmail(Email email);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\client\domain\DeliveryRecipientClient.java ---
1: package thkoeln.archilab.ecommerce.solution.client.domain;
2: 
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Address;
7: import thkoeln.archilab.ecommerce.usecases.ClientType;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
10: 
11: import javax.persistence.Entity;
12: 
13: @Entity
14: @Getter
15: @Setter
16: @NoArgsConstructor
17: public class DeliveryRecipientClient extends Client implements ClientType {
18: 
19:     public static DeliveryRecipientClient create(ClientType deliveryRecipient) {
20:         DeliveryRecipientClient deliveryRecipientClient = new DeliveryRecipientClient();
21:         deliveryRecipientClient.setName(deliveryRecipient.getName());
22:         Address address = new Address(
23:                 deliveryRecipient.getHomeAddress().getPostalCode(),
24:                 deliveryRecipient.getHomeAddress().getCity(),
25:                 deliveryRecipient.getHomeAddress().getStreet()
26:         );
27:         deliveryRecipientClient.setAddress(address);
28:         return deliveryRecipientClient;
29:     }
30: 
31:     @Override
32:     public EmailType getEmail() {
33:         return super.getEmail();
34:     }
35: 
36:     @Override
37:     public HomeAddressType getHomeAddress() {
38:         return super.getAddress();
39:     }
40: }
41: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\client\domain\DeliveryRecipientClientRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.client.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: 
7: import java.util.UUID;
8: 
9: public interface DeliveryRecipientClientRepository extends CrudRepository<DeliveryRecipientClient, UUID> {
10:     @Query("SELECT d FROM DeliveryRecipientClient d WHERE d.email = :email")
11:     DeliveryRecipientClient findByEmail(Email email);
12: 
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\application\DeliveryService.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.solution.client.domain.DeliveryRecipientClient;
9: import thkoeln.archilab.ecommerce.solution.client.domain.DeliveryRecipientClientRepository;
10: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
11: import thkoeln.archilab.ecommerce.solution.delivery.domain.DeliveryRepository;
12: import thkoeln.archilab.ecommerce.usecases.ClientType;
13: import thkoeln.archilab.ecommerce.usecases.DeliveryUseCases;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
15: 
16: import java.util.HashMap;
17: import java.util.List;
18: import java.util.Map;
19: import java.util.UUID;
20: 
21: @Service
22: public class DeliveryService implements DeliveryUseCases {
23: 
24:     private final DeliveryRepository deliveryRepository;
25: 
26:     private final DeliveryRecipientClientRepository deliveryRecipientClientRepository;
27: 
28:     @Autowired
29:     public DeliveryService(
30:             @Lazy DeliveryRepository deliveryRepository,
31:             @Lazy DeliveryRecipientClientRepository deliveryRecipientClientRepository
32:     ) {
33:         this.deliveryRepository = deliveryRepository;
34:         this.deliveryRecipientClientRepository = deliveryRecipientClientRepository;
35:     }
36: 
37:     public void checkDeliveryQuantity(DeliveryRecipientClient deliveryRecipientClient, Map<UUID, Integer> deliveryContent) {
38:         int totalDeliveryQuantity = deliveryRepository.findAllByClientEmail((Email) deliveryRecipientClient.getEmail()).stream()
39:                 .flatMap(delivery -> delivery.getGoods().values().stream())
40:                 .reduce(0, Integer::sum);
41: 
42:         totalDeliveryQuantity += deliveryContent.values().stream().reduce(0, Integer::sum);
43: 
44:         if (totalDeliveryQuantity >= 21) {
45:             throw new ShopException("Delivery of Client exceeds maximum quantity of 21 items");
46:         }
47:     }
48: 
49:     private DeliveryRecipientClient createDeliveryRecipientClient(ClientType deliveryRecipient) {
50:         DeliveryRecipientClient deliveryRecipientClient;
51:         if (deliveryRecipientClientRepository.findByEmail((Email) deliveryRecipient.getEmail()) == null) {
52:             deliveryRecipientClient = DeliveryRecipientClient.create(deliveryRecipient);
53:             deliveryRecipientClientRepository.save(deliveryRecipientClient);
54:         } else {
55:             deliveryRecipientClient = deliveryRecipientClientRepository.findByEmail((Email) deliveryRecipient.getEmail());
56:         }
57:         return deliveryRecipientClient;
58:     }
59: 
60:     private void validateDeliveryRecipient(ClientType deliveryRecipient) {
61:         if (deliveryRecipient == null) {
62:             throw new ShopException("DeliveryRecipient email is missing");
63:         }
64:         if (deliveryRecipient.getName() == null || deliveryRecipient.getName().isEmpty()) {
65:             throw new ShopException("DeliveryRecipient name is missing");
66:         }
67:     }
68: 
69:     private void validateDeliverRecipientEmail(EmailType clientEmail) {
70:         if (clientEmail == null) {
71:             throw new ShopException("Client email is null or empty");
72:         }
73:     }
74: 
75:     @Override
76:     public UUID triggerDelivery(ClientType deliveryRecipient, Map<UUID, Integer> deliveryContent) {
77:         validateDeliveryRecipient(deliveryRecipient);
78:         //Create delivery if not exists
79:         DeliveryRecipientClient deliveryRecipientClient = createDeliveryRecipientClient(deliveryRecipient);
80:         checkDeliveryQuantity(deliveryRecipientClient, deliveryContent);
81:         Delivery delivery = new Delivery();
82:         delivery.setEmail((Email) deliveryRecipient.getEmail());
83:         delivery.setGoods(deliveryContent);
84:         deliveryRepository.save(delivery);
85:         return delivery.getDeliveryId();
86:     }
87: 
88:     @Override
89:     public Map<UUID, Integer> getDeliveryHistory(EmailType clientEmail) {
90:         validateDeliverRecipientEmail(clientEmail);
91:         Map<UUID, Integer> deliveryHistory = new HashMap<>();
92:         List<Delivery> deliveries = deliveryRepository.findAllByClientEmail((Email) clientEmail);
93:         for (Delivery delivery : deliveries) {
94:             Map<UUID, Integer> goods = delivery.getGoods();
95:             for (Map.Entry<UUID, Integer> entry : goods.entrySet()) {
96:                 UUID goodId = entry.getKey();
97:                 int quantity = entry.getValue();
98:                 if (deliveryHistory.containsKey(goodId)) {
99:                     quantity += deliveryHistory.get(goodId);
100:                 }
101:                 deliveryHistory.put(goodId, quantity);
102:             }
103:         }
104:         return deliveryHistory;
105:     }
106: 
107:     @Override
108:     public void deleteDeliveryHistory() {
109:         deliveryRepository.deleteAll();
110:     }
111: }
112: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\Delivery.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import org.dom4j.tree.AbstractEntity;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: 
10: import javax.persistence.*;
11: import java.util.HashMap;
12: import java.util.Map;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @Setter
18: @NoArgsConstructor
19: public class Delivery extends AbstractEntity {
20:     @Id
21:     @Setter(AccessLevel.NONE)
22:     @Column(name = "delivery_id", nullable = false)
23:     private UUID deliveryId = UUID.randomUUID();
24: 
25:     @Embedded
26:     private Email email;
27: 
28:     @ElementCollection
29:     @CollectionTable(name = "good_Delivery", joinColumns = {@JoinColumn(name = "deliveryId")})
30:     @MapKeyColumn(name = "good")
31:     @Column(name = "delivery")
32:     private Map<UUID, Integer> goods = new HashMap<>();
33: }
34: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\delivery\domain\DeliveryRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.delivery.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: 
7: import java.util.List;
8: import java.util.UUID;
9: 
10: public interface DeliveryRepository extends CrudRepository<Delivery, UUID> {
11:     @Query("SELECT d FROM Delivery d WHERE d.email = :email")
12:     List<Delivery> findAllByClientEmail(Email email);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodBuyableInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: public interface GoodBuyableInterface {
9: 
10:     boolean goodNotExists(UUID goodId);
11: 
12:     Good getGoodByGoodId(UUID goodId);
13: 
14:     MoneyType getSalesPrice(UUID goodId);
15: }
16: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\GoodCatalogService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.solution.good.domain.*;
8: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
10: 
11: import java.util.*;
12: 
13: 
14: @Service
15: public class GoodCatalogService implements GoodCatalogUseCases {
16: 
17:     private final CatalogRepository catalogRepository;
18: 
19:     private final GoodRepository goodRepository;
20: 
21:     private final WarehouseRepository warehouseRepository;
22: 
23:     @Autowired
24:     private GoodCatalogService(@Lazy CatalogRepository catalogRepository, @Lazy GoodRepository goodRepository, @Lazy WarehouseRepository warehouseRepository) {
25:         this.catalogRepository = catalogRepository;
26:         this.goodRepository = goodRepository;
27:         this.warehouseRepository = warehouseRepository;
28:     }
29: 
30:     @Override
31:     public void addGoodToCatalog(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType salesPrice) {
32:         validateGoodInformation(goodId, name, description, size, purchasePrice, salesPrice);
33:         Catalog catalog;
34:         Warehouse warehouse;
35:         List<Good> goodList = new ArrayList<>();
36: 
37:         if (warehouseRepository.count() == 0) {
38:             warehouse = new Warehouse();
39:             warehouseRepository.save(warehouse);
40:         } else {
41:             warehouse = warehouseRepository.findFirstByOrderByWarehouseIdAsc();
42:         }
43: 
44:         Good newGood = new Good(goodId, name, description, size, purchasePrice, salesPrice);
45:         newGood.setWarehouse(warehouse);
46:         goodRepository.save(newGood);
47:         //List<Good> test = goodRepository.findAll();
48:         if (catalogRepository.count() == 0) {
49:             catalog = new Catalog();
50:         } else {
51:             catalog = catalogRepository.findFirstByOrderByCatalogIdAsc();
52:             goodList = catalog.getGoods();
53:         }
54:         if (!goodList.contains(newGood)){
55:             goodList.add(newGood);
56:         }
57:         catalog.setGoods(goodList);
58:         catalogRepository.save(catalog);
59:         Map<UUID, Integer> goodIntegerMap = new HashMap<>();
60:         goodIntegerMap.put(newGood.getGoodId(), 0);
61:         warehouse.setGoods(goodIntegerMap);
62:         warehouseRepository.save(warehouse);
63: 
64:     }
65: 
66:     private void validateGoodInformation(UUID goodId, String name, String description, Float size, MoneyType purchasePrice, MoneyType salesPrice) {
67:         if (goodId == null) {
68:             throw new ShopException("GoodId is Null");
69:         }
70:         if (name == null || name.isEmpty()) {
71:             throw new ShopException("Good name is missing or Null");
72:         }
73:         if (description == null || description.isEmpty()) {
74:             throw new ShopException("Good description is missing or Null");
75:         }
76:         if (purchasePrice == null || purchasePrice.getAmount().isNaN()) {
77:             throw new ShopException("Good purchasePrice is missing or Null");
78:         }
79:         if (salesPrice == null || salesPrice.getAmount().isNaN() ) {
80:             throw new ShopException("Good salesPrice is missing or Null");
81:         }
82:      }
83: 
84:     @Override
85:     public void removeGoodFromCatalog(UUID goodId) {
86:         Good good = goodRepository.findById(goodId).orElseThrow(() -> new ShopException("The good id does not exist"));
87:         boolean goodInStock = warehouseRepository.findFirstByOrderByWarehouseIdAsc().getGoods().containsKey(good.getGoodId());
88:         if (goodInStock) {
89:             throw new ShopException("Good is still in Stock!");
90:         }
91:         warehouseRepository.findFirstByOrderByWarehouseIdAsc().getGoods().keySet().remove(good.getGoodId());
92:         goodRepository.deleteById(goodId);
93:     }
94: 
95:     @Override
96:     public MoneyType getSalesPrice(UUID goodId) {
97:         Good good = goodRepository.findById(goodId).orElseThrow(() -> new ShopException("There is no good with the given goodId"));
98:         return good.getSalesPrice();
99:     }
100: 
101:     @Override
102:     public void deleteGoodCatalog() {
103:         if (goodRepository.count() > 0) {
104:             goodRepository.deleteAll();
105:             catalogRepository.deleteAll();
106:         }
107:     }
108: 
109:     public boolean goodExists(UUID goodId) {
110:         for (Good good : goodRepository.findAll()) {
111:             if (good.getGoodId().equals(goodId)) {
112:                 return true;
113:             }
114:         }
115:         return false;
116:     }
117: 
118:     public Good getGoodByGoodId(UUID goodId) {
119:         for (Good good : goodRepository.findAll()) {
120:             if (good.getGoodId().equals(goodId)) {
121:                 return good;
122:             }
123:         }
124:         return null;
125:     }
126: }
127: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\ShoppingBasketreservableInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import java.util.UUID;
4: 
5: public interface ShoppingBasketreservableInterface {
6:     int getAllReservedGoods(UUID goodId);
7: 
8:     void adjustReservedGoodInShoppingbaskets(UUID goodId, int warehouseQuantityRemoved, int currentlyReservedGoods);
9: }
10: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\StockmanageableInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import java.util.UUID;
4: 
5: public interface StockmanageableInterface {
6:     int getAvailableStock(UUID goodId);
7: 
8:     void checkGoodQuantityInWarehouse(UUID goodId, int quantity);
9: 
10:     void removeFromStock(UUID goodId, int quantity);
11: 
12:     void addToStock(UUID goodId, int quantity);
13: 
14: }
15: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\StockManagementService.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.good.domain.Warehouse;
7: import thkoeln.archilab.ecommerce.solution.good.domain.WarehouseRepository;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: 
10: import java.util.HashMap;
11: import java.util.Map;
12: import java.util.UUID;
13: 
14: @Service
15: public class StockManagementService implements StockManagementUseCases {
16: 
17:     private final ShoppingBasketreservableInterface shoppingBasketreservableInterface;
18:     @Autowired
19:     GoodCatalogService goodCatalogService;
20:     Warehouse warehouse = new Warehouse();
21:     @Autowired
22:     private WarehouseRepository warehouseRepository;
23: 
24:     private StockManagementService(WarehouseRepository warehouseRepository,
25:                                    ShoppingBasketreservableInterface shoppingBasketreservableInterface) {
26:         this.warehouseRepository = warehouseRepository;
27:         this.shoppingBasketreservableInterface = shoppingBasketreservableInterface;
28:     }
29: 
30: 
31:     @Override
32:     public void addToStock(UUID goodId, int addedQuantity) {
33:         if (addedQuantity == 0) {
34:             throw new ShopException("Can not add 0 to Stock!");
35:         }
36:         Map<UUID, Integer> goodIntegerMap = new HashMap<>();
37: 
38:         //Create Warehouse if there is no Warehouse
39:         if (warehouseRepository.count() == 0) {
40:             warehouse.setGoods(goodIntegerMap);
41:             warehouseRepository.save(warehouse);
42:         }
43:         warehouse = warehouseRepository.findFirstByOrderByWarehouseIdAsc();
44: 
45:         //Check if GoodId is valid if so add else throw Exception
46:         if (!goodCatalogService.goodExists(goodId) || addedQuantity < 0) {
47:             throw new ShopException("The good with goodId " + goodId + " does not exist");
48:         }
49:         addGood(goodId, addedQuantity);
50:     }
51: 
52:     public void addGood(UUID goodId, int quantity) {
53:         Map<UUID, Integer> stock = warehouse.getGoods();
54: 
55:         //Check if good already exists in Map
56:         if (warehouse.getGoods().containsKey(goodId)) {
57:             int currentQuantityOfGood = warehouse.getLagerbestand(goodId);
58:             currentQuantityOfGood += quantity;
59:             stock.put(goodId, currentQuantityOfGood);
60:         } else {
61:             stock.put(goodId, quantity);
62:         }
63:         warehouse.setGoods(stock);
64:         warehouseRepository.save(warehouse);
65:     }
66: 
67:     @Override
68:     public void removeFromStock(UUID goodId, int removedQuantity) {
69:         //Check if Good exists and removed quantity is not negative
70:         if (!goodCatalogService.goodExists(goodId)) {
71:             throw new ShopException("Good does not exist in Stock! not Valid Good");
72:         }
73:         if (removedQuantity <= 0) {
74:             throw new ShopException("RemovedQuantity: " + removedQuantity + " is not valid");
75:         }
76:         int totalQuantityOfGoodInWarehouse = warehouse.getLagerbestand(goodId);
77:         int warehouseQuantityRemoved = totalQuantityOfGoodInWarehouse - removedQuantity;
78: 
79:         int currentlyReservedGoods = shoppingBasketreservableInterface.getAllReservedGoods(goodId);
80: 
81:         //Mange clientbaskets and change quantity if must
82:         shoppingBasketreservableInterface.adjustReservedGoodInShoppingbaskets(goodId, warehouseQuantityRemoved, currentlyReservedGoods);
83:         if (warehouse.getLagerbestand(goodId) >= removedQuantity) {
84:             warehouse.getGoods().put(goodId, warehouseQuantityRemoved);
85:             warehouseRepository.save(warehouse);
86:         } else if (warehouse.getLagerbestand(goodId) == 0) {
87:             throw new ShopException("Warehouse has no more Stock of Good: " + goodId);
88:         } else {
89:             throw new ShopException("Can not remove: " + removedQuantity + " while having: " + totalQuantityOfGoodInWarehouse);
90:         }
91:     }
92: 
93:     @Override
94:     public void changeStockTo(UUID goodId, int newTotalQuantity) {
95:         //Check if Good exsist and removed qantity is not negative
96:         if (!goodCatalogService.goodExists(goodId)) {
97:             throw new ShopException("Good does not exist in Stock not Valid Good");
98:         }
99:         if (newTotalQuantity < 0) {
100:             throw new ShopException("NewTotalQuantity: " + newTotalQuantity + " is not valid");
101:         }
102: 
103:         int currentlyReservedGoods = shoppingBasketreservableInterface.getAllReservedGoods(goodId);
104:         shoppingBasketreservableInterface.adjustReservedGoodInShoppingbaskets(goodId, newTotalQuantity, currentlyReservedGoods);
105:         warehouse.getGoods().put(goodId, newTotalQuantity);
106:         warehouseRepository.save(warehouse);
107:     }
108: 
109:     @Override
110:     public int getAvailableStock(UUID goodId) {
111:         Integer quantity = warehouse.getLagerbestand(goodId);
112:         if (quantity == null) {
113:             throw new ShopException("Could not find Good in Stock");
114:         }
115:         return quantity;
116:     }
117: }

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\application\WarehouseGetableInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.good.application;
2: 
3: import java.util.UUID;
4: 
5: public interface WarehouseGetableInterface {
6: 
7:     int getStorageOfGood(UUID goodId);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Catalog.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import lombok.*;
4: import org.dom4j.tree.AbstractEntity;
5: 
6: import javax.persistence.*;
7: import java.util.ArrayList;
8: import java.util.List;
9: import java.util.UUID;
10: 
11: @Entity
12: @Getter
13: @Setter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class Catalog extends AbstractEntity {
17:     @Id
18:     @Setter(AccessLevel.NONE)
19:     @GeneratedValue(strategy = GenerationType.AUTO)
20:     private UUID catalogId = UUID.randomUUID();
21: 
22:     @OneToMany(cascade = CascadeType.ALL)
23:     private List<Good> goods = new ArrayList<>();
24: }
25: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\CatalogRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: import org.springframework.stereotype.Repository;
5: 
6: import java.util.UUID;
7: 
8: @Repository
9: public interface CatalogRepository extends CrudRepository<Catalog, UUID> {
10:     Catalog findFirstByOrderByCatalogIdAsc();
11: }
12: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Good.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: 
4: import lombok.*;
5: import org.dom4j.tree.AbstractEntity;
6: import org.springframework.lang.Nullable;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.delivery.domain.Delivery;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
10: 
11: import javax.persistence.*;
12: import java.util.UUID;
13: 
14: @Entity
15: @Getter
16: @Setter
17: @NoArgsConstructor
18: @AllArgsConstructor
19: public class Good extends AbstractEntity {
20:     @Id
21:     @Setter(AccessLevel.NONE)
22:     private UUID goodId = UUID.randomUUID();
23: 
24:     private String name;
25: 
26:     private String description;
27: 
28:     private Float size = 0.0f;
29: 
30:     @Embedded
31:     private Money purchasePrice;
32: 
33:     @Embedded
34:     private Money salesPrice;
35: 
36:     @ManyToOne(cascade = {CascadeType.MERGE})
37:     private Warehouse warehouse;
38: 
39:     public Good(UUID goodId, String name, String description, Float size,
40:                 MoneyType purchasePrice, MoneyType salesPrice){
41:         this.goodId = goodId;
42:         this.name = name;
43:         this.description = description;
44:         this.size = size;
45:         this.purchasePrice = (Money) purchasePrice;
46:         this.salesPrice = (Money) salesPrice;
47:     }
48: 
49:     public Float getSalesPriceAmount() {
50:         return salesPrice.getAmount();
51:     }
52: }
53: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\GoodRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: import java.util.List;
10: import java.util.UUID;
11: 
12: @Repository
13: public interface GoodRepository extends CrudRepository<Good, UUID> {
14:     @Query("SELECT g FROM Good g WHERE g.goodId = :goodId")
15:     MoneyType findByGoodId(UUID goodId);
16: 
17:     List<Good> findAll();
18: 
19:     @Query("SELECT g FROM Good g WHERE g.goodId = :goodId")
20:     Good findGoodByGoodId(UUID goodId);
21: }
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\Warehouse.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: import lombok.*;
4: import org.dom4j.tree.AbstractEntity;
5: 
6: import javax.persistence.*;
7: import java.util.HashMap;
8: import java.util.Map;
9: import java.util.UUID;
10: 
11: @Entity
12: @Getter
13: @Setter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class Warehouse extends AbstractEntity {
17:     @Id
18:     @Setter(AccessLevel.NONE)
19:     @GeneratedValue(strategy = GenerationType.AUTO)
20:     private UUID warehouseId = UUID.randomUUID();
21: 
22:     @ElementCollection
23:     @CollectionTable(name = "good_quantity", joinColumns = {@JoinColumn(name = "warehouseId")})
24:     @MapKeyColumn(name = "good")
25:     @Column(name = "quantity")
26:     private Map<UUID, Integer> goods = new HashMap<>();
27: 
28:     public int getLagerbestand(UUID goodId) {
29:         return goods.getOrDefault(goodId, 0);
30:     }
31: }
32: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\good\domain\WarehouseRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.good.domain;
2: 
3: 
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: 
7: import java.util.UUID;
8: 
9: @Repository
10: public interface WarehouseRepository extends CrudRepository<Warehouse, UUID> {
11:     Warehouse findFirstByOrderByWarehouseIdAsc();
12: }
13: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: import lombok.AllArgsConstructor;
3: import lombok.Getter;
4: import lombok.NoArgsConstructor;
5: import lombok.Setter;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
8: import thkoeln.archilab.ecommerce.solution.orderPosition.application.OrderPositionDTO;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: 
11: import java.time.LocalDateTime;
12: import java.util.ArrayList;
13: import java.util.List;
14: import java.util.UUID;
15: 
16: @Getter
17: @Setter
18: @NoArgsConstructor
19: @AllArgsConstructor
20: public class OrderDTO {
21:     private UUID orderId;
22:     private Client client;
23:     private EmailType email;
24:     private Money price;
25:     private LocalDateTime submissionDate;
26:     private List<OrderPositionDTO> orderPositions = new ArrayList<>();
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderDTOMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
8: import thkoeln.archilab.ecommerce.solution.orderPosition.application.OrderPostionDTOMapperService;
9: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
10: 
11: import java.time.LocalDateTime;
12: 
13: @Service
14: public class OrderDTOMapperService {
15:     @Autowired
16:     OrderPostionDTOMapperService orderPostionDTOMapperService;
17: 
18:     ModelMapper modelMapper = new ModelMapper();
19: 
20:     public OrderDTO mapToDTO(Order order){
21:         OrderDTO orderDTO = new OrderDTO();
22:         orderDTO.setOrderId(order.getOrderId());
23:         orderDTO.setClient(order.getClient());
24:         Money price = new Money(order.getTotalOrderPrice().getAmount(), order.getTotalOrderPrice().getCurrency());
25:         orderDTO.setPrice(price);
26:         orderDTO.setEmail(order.getClient().getEmail());
27:         for (OrderPosition orderPosition : order.getOrderPositions()) {
28:             orderDTO.getOrderPositions().add(orderPostionDTOMapperService.mapToDTO(orderPosition));
29:         }
30:         orderDTO.setSubmissionDate(LocalDateTime.now());
31:         return orderDTO;
32:     }
33: 
34:     public Order mapToEntity(OrderDTO orderDTO) {
35:         Order order = new Order(orderDTO.getOrderId(),
36:                 orderDTO.getClient(),
37:                 orderDTO.getPrice(),
38:                 orderPostionDTOMapperService.mapListToEntity(orderDTO.getOrderPositions()));
39:         return order;
40:     }
41: 
42: 
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import lombok.AllArgsConstructor;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.http.HttpStatus;
6: import org.springframework.http.ResponseEntity;
7: import org.springframework.web.bind.annotation.GetMapping;
8: import org.springframework.web.bind.annotation.RequestParam;
9: import org.springframework.web.bind.annotation.RestController;
10: import thkoeln.archilab.ecommerce.domainprimitives.Email;
11: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
12: 
13: import javax.transaction.Transactional;
14: import java.time.LocalDate;
15: import java.time.LocalDateTime;
16: import java.util.ArrayList;
17: import java.util.List;
18: import java.util.UUID;
19: 
20: @RestController
21: @Transactional
22: public class OrderRESTController {
23: 
24:     @Autowired
25:     OrderService orderService;
26:     @Autowired
27:     OrderDTOMapperService orderDTOMapper;
28: 
29:     /*
30:     * (1) Find all orders for client with emailId, ordered by time	GET	/orders?email=...*/
31:     @GetMapping("/orders")
32:     public ResponseEntity<List<OrderDTO>> getOrdersByEmail(@RequestParam(value = "email", required = false) String email, @RequestParam(required = false) String filter ) {
33: 
34:         List<Order> orders = new ArrayList<>();
35:         List<OrderDTO> orderDTOs = new ArrayList<>();
36: 
37:         //check if email is valid
38:         if (email != null && Email.isValidFormat(email) ){
39:             orders = orderService.findAllByClientEmail(Email.of(email));
40:         } else if (email != null && !Email.isValidFormat(email) ){
41:             return new ResponseEntity(orderDTOs, HttpStatus.OK);
42:         }
43: 
44:         for (Order order: orders) {
45:            orderDTOs.add(orderDTOMapper.mapToDTO(order));
46:         }
47: 
48:         if ("latest".equals(filter)) {
49:             OrderDTO latestOrder = getLatestOrder(orderDTOs);
50:             List<OrderDTO> hier = new ArrayList<>();
51:             hier.add(latestOrder);
52:             return new ResponseEntity(hier, HttpStatus.OK);
53:         }
54: 
55:         // Return an empty array if no orders or an invalid filter is provided
56:         return new ResponseEntity(orderDTOs, HttpStatus.OK);
57:     }
58: 
59:     public OrderDTO getLatestOrder(List<OrderDTO> orderDTOs) {
60:         OrderDTO latestOrder = null;
61:         LocalDateTime latestDate = null;
62: 
63:         for (OrderDTO order : orderDTOs) {
64:             LocalDateTime submissionDate = order.getSubmissionDate();
65: 
66:             if (latestDate == null || submissionDate.isAfter(latestDate)) {
67:                 latestDate = submissionDate;
68:                 latestOrder = order;
69:             }
70:         }
71: 
72:         return latestOrder;
73:     }
74: }
75: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\application\OrderService.java ---
1: package thkoeln.archilab.ecommerce.solution.order.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
7: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
8: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
9: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
10: 
11: import java.util.List;
12: 
13: @Service
14: public class OrderService {
15: 
16:     private final OrderRepository orderRepository;
17:     private final ClientRepository clientRepository;
18: 
19:     @Autowired
20:     public OrderService(@Lazy OrderRepository orderRepository, @Lazy ClientRepository clientRepository) {
21:         this.orderRepository = orderRepository;
22:         this.clientRepository = clientRepository;
23:     }
24: 
25:     public List<Order> findAllByClientEmail(EmailType clientEmail){
26:         List<Order> allOrders = orderRepository.findAllByClientEmail(clientEmail);
27:         return allOrders;
28:     }
29:     public List<Order> findLatestForClient(EmailType clientEmail){
30:         List<Order> allOrders = orderRepository.findTopByClientEmailOrderByOrderIdAsc(clientEmail);
31:         return allOrders;
32:     }
33: }
34: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\Order.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import com.fasterxml.jackson.annotation.JsonProperty;
4: import lombok.*;
5: import org.dom4j.tree.AbstractEntity;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
8: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
9: 
10: import javax.persistence.*;
11: import java.util.ArrayList;
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Entity
16: @Getter
17: @Setter
18: @NoArgsConstructor
19: @AllArgsConstructor
20: @Table(name = "order_table")
21: public class Order extends AbstractEntity {
22:     @Id
23:     @Setter(AccessLevel.NONE)
24:     @GeneratedValue(strategy = GenerationType.AUTO)
25:     public UUID orderId = UUID.randomUUID();
26: 
27:     @ManyToOne(fetch = FetchType.LAZY)
28:     public Client client;
29: 
30:     @JsonProperty
31:     public Money totalOrderPrice;
32: 
33:     @OneToMany(cascade = CascadeType.ALL)
34:     public List<OrderPosition> orderPositions = new ArrayList<>();
35: 
36:     public Money getTotalOrderPrice() {
37:         // Check if the total order price is null and return a default value if necessary
38:         if (totalOrderPrice == null) {
39:             return new Money(0.0f, "EUR");
40:         }
41:         return totalOrderPrice;
42:     }
43: 
44: }
45: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\order\domain\OrderRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.order.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
7: 
8: import java.util.List;
9: import java.util.UUID;
10: 
11: @Repository
12: public interface OrderRepository extends CrudRepository<Order, UUID> {
13:     @Query("SELECT o FROM Order o WHERE o.client.clientId = :clientId")
14:     Order findByClientId(UUID clientId);
15: 
16:     @Query("SELECT o FROM Order o WHERE o.client.email = :email")
17:     Order findByClientEmail(EmailType email);
18: 
19:     @Query("SELECT o FROM Order o WHERE o.client.clientId = :clientId")
20:     List<Order> findAllByClientId(UUID clientId);
21: 
22:     @Query("SELECT o FROM Order o WHERE o.client.email = :email")
23:     List<Order> findAllByClientEmail(EmailType email);
24: 
25:     List<Order> findAllByClientEmailOrderByOrderId(EmailType email);
26: 
27:     List<Order> findTopByClientEmailOrderByOrderIdAsc(EmailType email);
28: }
29: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\orderPosition\application\OrderPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.orderPosition.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: 
9: import java.util.Map;
10: import java.util.UUID;
11: 
12: @Getter
13: @Setter
14: @NoArgsConstructor
15: @AllArgsConstructor
16: public class OrderPositionDTO {
17:     private UUID goodId;
18:     private Integer quantity;
19:     private Money totalAmount;
20:     private String comment;
21: }
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\orderPosition\application\OrderPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderPosition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.domainprimitives.Money;
6: import thkoeln.archilab.ecommerce.solution.good.application.GoodCatalogService;
7: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
8: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
9: 
10: import java.util.HashMap;
11: import java.util.Map;
12: import java.util.UUID;
13: 
14: @Service
15: public class OrderPositionService {
16: 
17:     @Autowired
18:     GoodCatalogService goodCatalogService;
19: 
20:     private final GoodRepository goodRepository;
21: 
22:     public OrderPositionService(GoodRepository goodRepository){
23:         this.goodRepository = goodRepository;
24:     }
25: 
26:     public OrderPosition createOrderPosition(UUID goodId, int quantity, String comment) {
27:         OrderPosition orderPosition = new OrderPosition();
28:         orderPosition.setComment(comment);
29:         Map<UUID, Integer> goods = new HashMap<>();
30:         goods.put(goodId, quantity);
31:         Float result = quantity * goodCatalogService.getSalesPrice(goodId).getAmount();
32:         Money totalPrice = new Money(result, "EUR");
33:         orderPosition.setTotalAmount(totalPrice);
34:         orderPosition.setGoods(goods);
35:         return orderPosition;
36:     }
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\orderPosition\application\OrderPostionDTOMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.orderPosition.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
6: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionDTO;
7: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
8: 
9: import java.util.*;
10: 
11: @Service
12: public class OrderPostionDTOMapperService {
13:     private ModelMapper modelMapper = new ModelMapper();
14: 
15:     public OrderPositionDTO mapToDTO(OrderPosition orderPosition){
16:         OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
17:         orderPositionDTO.setGoodId(orderPosition.getGoods().entrySet().stream().findFirst().get().getKey());
18:         orderPositionDTO.setComment(orderPosition.getComment());
19:         orderPositionDTO.setQuantity(orderPosition.getGoods().entrySet().stream().findFirst().get().getValue());
20:         orderPositionDTO.setTotalAmount(orderPosition.getTotalAmount());
21:         return orderPositionDTO;
22:     }
23: 
24:     public OrderPosition mapToEntity(OrderPositionDTO orderPositionDTO) {
25:         Map<UUID, Integer> goods = new HashMap<>();
26:         goods.put(orderPositionDTO.getGoodId(), orderPositionDTO.getQuantity());
27:         OrderPosition orderPosition = new OrderPosition(
28:                 orderPositionDTO.getGoodId(),
29:                 orderPositionDTO.getTotalAmount(),
30:                 orderPositionDTO.getComment(),
31:                 goods
32:                 );
33:         modelMapper.map(orderPositionDTO, orderPosition);
34:         return orderPosition;
35:     }
36: 
37: 
38:     public List<OrderPositionDTO> mapListToDTO(List<OrderPosition> orderPositions){
39:         if (orderPositions.size() == 0){
40:             return new ArrayList<>();
41:         }
42:         List<OrderPositionDTO> orderPositionDTOS = new ArrayList<>();
43:         for (OrderPosition orderPosition : orderPositions) {
44:             OrderPositionDTO orderPositionDTO = new OrderPositionDTO();
45:             orderPositionDTO.setGoodId(orderPosition.getGoods().entrySet().stream().findFirst().get().getKey());
46:             orderPositionDTO.setQuantity(orderPosition.getGoods().entrySet().stream().findFirst().get().getValue());
47:             orderPositionDTO.setComment(orderPosition.getComment());
48:             orderPositionDTO.setTotalAmount(orderPosition.getTotalAmount());
49:         }
50:         return orderPositionDTOS;
51:     }
52: 
53:     public List<OrderPosition> mapListToEntity(List<OrderPositionDTO> orderPositionDTOS){
54:         if (orderPositionDTOS.size() == 0){
55:             return new ArrayList<>();
56:         }
57:         List<OrderPosition> orderPositions = new ArrayList<>();
58:         for (OrderPositionDTO orderPositionDTO : orderPositionDTOS) {
59:             Map<UUID, Integer> goods = new HashMap<>();
60:             goods.put(orderPositionDTO.getGoodId(), orderPositionDTO.getQuantity());
61:             OrderPosition orderPosition = new OrderPosition(
62:                     orderPositionDTO.getGoodId(),
63:                     orderPositionDTO.getTotalAmount(),
64:                     orderPositionDTO.getComment(),
65:                     goods
66:                     );
67:             orderPositions.add(orderPosition);
68:         }
69:         return orderPositions;
70:     }
71: 
72: 
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\orderPosition\domain\OrderPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.orderPosition.domain;
2: 
3: import com.fasterxml.jackson.annotation.JsonProperty;
4: import lombok.*;
5: import org.dom4j.tree.AbstractEntity;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: 
8: import javax.persistence.*;
9: import java.util.HashMap;
10: import java.util.Map;
11: import java.util.UUID;
12: 
13: @Entity
14: @Getter
15: @Setter
16: @NoArgsConstructor
17: @AllArgsConstructor
18: public class OrderPosition extends AbstractEntity {
19:     @Id
20:     @Setter(AccessLevel.NONE)
21:     @GeneratedValue(strategy = GenerationType.AUTO)
22:     private UUID orderPositionId = UUID.randomUUID();
23: 
24:     @JsonProperty
25:     private Money totalAmount;
26: 
27:     @JsonProperty
28:     private String comment;
29: 
30:     @ElementCollection
31:     @CollectionTable(name = "good_orderPosition", joinColumns = {@JoinColumn(name = "orderPositionId")})
32:     @MapKeyColumn(name = "good")
33:     @Column(name = "orderPosition")
34:     private Map<UUID, Integer> goods = new HashMap<>();
35: 
36: }
37: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\orderPosition\domain\OrderPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.orderPosition.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
8: 
9: import java.util.List;
10: import java.util.UUID;
11: 
12: @Repository
13: public interface OrderPositionRepository extends CrudRepository<OrderPosition, UUID> {
14:     //@Query("SELECT op FROM OrderPosition op WHERE op.order.client.email = :email")
15:     //List<OrderPosition> findAllByOrderClientEmail(EmailType email);
16: 
17: }
18: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\AuthorizablePaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.shoppingbasket.application.AuthorizablePaymentInterface;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
8: 
9: @Service
10: public class AuthorizablePaymentService implements AuthorizablePaymentInterface {
11:     @Autowired
12:     PaymentService paymentService;
13: 
14:     @Override
15:     public void authorizePayment(EmailType email, MoneyType cartValue) {
16:         paymentService.authorizePayment(email, cartValue);
17:     }
18: }
19: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\payment\application\PaymentService.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
10: import thkoeln.archilab.ecommerce.solution.payment.domain.Payment;
11: import thkoeln.archilab.ecommerce.solution.payment.domain.PaymentRepository;
12: import thkoeln.archilab.ecommerce.usecases.PaymentUseCases;
13: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
14: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
15: 
16: import java.util.UUID;
17: 
18: @Service
19: public class PaymentService implements PaymentUseCases {
20: 
21:     private final ClientRepository clientRepository;
22: 
23:     private final PaymentRepository paymentRepository;
24: 
25:     @Autowired
26:     public PaymentService(
27:             @Lazy ClientRepository clientRepository,
28:             @Lazy PaymentRepository paymentRepository) {
29:         this.clientRepository = clientRepository;
30:         this.paymentRepository = paymentRepository;
31:     }
32: 
33:     @Override
34:     public UUID authorizePayment(EmailType clientEmail, MoneyType amount) {
35:         //Check all payment information
36:         if (clientEmail == null) {
37:             throw new ShopException("Client Email is invalid!");
38:         }
39:         if (clientRepository.findByEmail((Email) clientEmail) == null) {
40:             throw new ShopException("Client does not exist in our System!");
41:         }
42: 
43:         if (amount == null || amount.getAmount() <= 0.00f || amount.getAmount() > 500.00f) {
44:             throw new ShopException("Can not authorize payment. Invalid amount: " + amount);
45:         }
46: 
47:         //Create and save the Delivery
48:         Payment payment = new Payment();
49:         payment.setEmail((Email) clientEmail);
50:         payment.setAmount(amount.getAmount());
51:         paymentRepository.save(payment);
52:         return payment.getPaymentId();
53:     }
54: 
55:     @Override
56:     public MoneyType getPaymentTotal(EmailType clientEmail) {
57:         if (clientEmail == null) {
58:             throw new ShopException("Client Email is invalid!");
59:         }
60:         if (clientRepository.findByEmail((Email) clientEmail) == null) {
61:             throw new ShopException("Client does not exist in our System!");
62:         }
63:         Float totalAmount = 0.00f;
64:         for (Payment payment : paymentRepository.findAll()) {
65:             if (payment.getEmail().equals(clientEmail)) {
66:                 totalAmount += payment.getAmount();
67:             }
68:         }
69:         return new Money(totalAmount, "EUR");
70:     }
71: 
72:     @Override
73:     public void deletePaymentHistory() {
74:     }
75: }
76: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\Payment.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import lombok.AccessLevel;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import org.dom4j.tree.AbstractEntity;
8: import thkoeln.archilab.ecommerce.domainprimitives.Email;
9: 
10: import javax.persistence.Column;
11: import javax.persistence.Embedded;
12: import javax.persistence.Entity;
13: import javax.persistence.Id;
14: import java.util.UUID;
15: 
16: @Entity
17: @Getter
18: @Setter
19: @NoArgsConstructor
20: public class Payment extends AbstractEntity {
21:     @Id
22:     @Setter(AccessLevel.NONE)
23:     @Column(name = "payment_id", nullable = false)
24:     private UUID paymentId = UUID.randomUUID();
25: 
26:     @Embedded
27:     private Email email;
28: 
29:     private Float amount;
30: }
31: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\payment\domain\PaymentRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.payment.domain;
2: 
3: import org.springframework.data.repository.CrudRepository;
4: 
5: import java.util.UUID;
6: 
7: public interface PaymentRepository extends CrudRepository<Payment, UUID> {
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\AuthorizablePaymentInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: public interface AuthorizablePaymentInterface {
7:     void authorizePayment(EmailType email, MoneyType cartValue);
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\GoodBuyableService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.good.application.GoodBuyableInterface;
6: import thkoeln.archilab.ecommerce.solution.good.application.GoodCatalogService;
7: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
8: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: public class GoodBuyableService implements GoodBuyableInterface {
14: 
15:     @Autowired
16:     GoodCatalogService goodCatalogService;
17: 
18:     public boolean goodNotExists(UUID goodId) {
19:         return !goodCatalogService.goodExists(goodId);
20:     }
21: 
22:     @Override
23:     public Good getGoodByGoodId(UUID goodId) {
24:         return goodCatalogService.getGoodByGoodId(goodId);
25:     }
26: 
27: 
28:     public MoneyType getSalesPrice(UUID goodId) {
29:         return goodCatalogService.getSalesPrice(goodId);
30:     }
31: }
32: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingbasketDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import lombok.AllArgsConstructor;
4: import lombok.Getter;
5: import lombok.NoArgsConstructor;
6: import lombok.Setter;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionDTO;
10: 
11: import java.util.ArrayList;
12: import java.util.List;
13: import java.util.UUID;
14: 
15: @Getter
16: @Setter
17: @NoArgsConstructor
18: @AllArgsConstructor
19: public class ShoppingbasketDTO {
20:     private UUID id;
21:     private Email email;
22:     private Integer totalQuantity;
23:     private Money totalPrice;
24:     private List<ShoppingBasketPositionDTO> orderPositions = new ArrayList<>();
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingbasketDTOMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.domainprimitives.Email;
7: import thkoeln.archilab.ecommerce.solution.client.application.ClientRegistrationService;
8: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
9: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
10: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
11: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionDTOMapperService;
12: 
13: @Service
14: public class ShoppingbasketDTOMapperService {
15: 
16:     @Autowired
17:     ClientRegistrationService clientRegistrationService;
18:     @Autowired
19:     ShoppingBasketService shoppingBasketService;
20:     @Autowired
21:     public ShoppingBasketPositionDTOMapperService shoppingBasketPositionDTOMapper;
22: 
23:     public ShoppingbasketDTO mapToDTO(ShoppingBasket shoppingBasket){
24:         ShoppingbasketDTO shoppingbasketDTO = new ShoppingbasketDTO();
25:         shoppingbasketDTO.setId(shoppingBasket.getShoppingBasketId());
26:         shoppingbasketDTO.setEmail((Email) shoppingBasket.getClient().getEmail());
27:         shoppingbasketDTO.setTotalQuantity(shoppingBasket.getTotalAmount());
28:         shoppingbasketDTO.setTotalPrice(shoppingBasket.getTotalCost());
29:         for (ShoppingBasketPosition shoppingBasketPosition : shoppingBasket.getShoppingBasketPositions()) {
30:             shoppingbasketDTO.getOrderPositions().add(shoppingBasketPositionDTOMapper.mapToDTO(shoppingBasketPosition));
31:         }
32:         return shoppingbasketDTO;
33:     }
34: 
35:     public ShoppingBasket mapToEntity(ShoppingbasketDTO shoppingbasketDTO) {
36:         ShoppingBasket shoppingBasket = new ShoppingBasket(
37:                 shoppingbasketDTO.getId(),
38:                 clientRegistrationService.findByEmail(shoppingbasketDTO.getEmail()),
39:                 shoppingbasketDTO.getTotalQuantity(),
40:                 shoppingbasketDTO.getTotalPrice(),
41:                 shoppingBasketPositionDTOMapper.mapListToEntity(shoppingbasketDTO.getOrderPositions())
42:         );
43:         return shoppingBasket;
44:     }
45: }
46: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketHelperClassCleanCodeService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.stereotype.Service;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.domainprimitives.Email;
6: import thkoeln.archilab.ecommerce.domainprimitives.Money;
7: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
8: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
9: import thkoeln.archilab.ecommerce.solution.good.application.GoodBuyableInterface;
10: import thkoeln.archilab.ecommerce.solution.good.application.StockmanageableInterface;
11: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
12: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
13: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionableInterface;
14: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
15: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.CheckOutState;
16: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
17: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
18: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
19: 
20: import java.util.ArrayList;
21: import java.util.List;
22: import java.util.UUID;
23: 
24: @Service
25: public class ShoppingBasketHelperClassCleanCodeService {
26: 
27:     private final ClientRepository clientRepository;
28:     private final ShoppingBasketRepository shoppingBasketRepository;
29:     private final StockmanageableInterface stockmanageableInterface;
30:     private final ShoppingBasketPositionableInterface shoppingBasketPositionableInterface;
31:     private final GoodBuyableInterface goodBuyableInterface;
32: 
33: 
34: 
35:     public ShoppingBasketHelperClassCleanCodeService(ClientRepository clientRepository, ShoppingBasketRepository shoppingBasketRepository, StockmanageableInterface stockmanageableInterface, ShoppingBasketPositionableInterface shoppingBasketPositionableInterface, GoodBuyableInterface goodBuyableInterface) {
36:         this.clientRepository = clientRepository;
37:         this.shoppingBasketRepository = shoppingBasketRepository;
38:         this.stockmanageableInterface = stockmanageableInterface;
39:         this.shoppingBasketPositionableInterface = shoppingBasketPositionableInterface;
40:         this.goodBuyableInterface = goodBuyableInterface;
41:     }
42: 
43: 
44:     public ShoppingBasket createShoppingBasket(Client client) {
45:         ShoppingBasket shoppingBasket = new ShoppingBasket();
46:         List<ShoppingBasketPosition> shoppingBasketPositions = new ArrayList<>();
47:         //Check if client has a Basket, if so use existing Basket else create a new Basket
48:         if (shoppingBasketRepository.findByClientId(client.getClientId()) == null) {
49:             shoppingBasket.setClient(client);
50:             shoppingBasket.setTotalQuantity(0);
51:             shoppingBasket.setTotalCost(new Money(0.0f, "EUR"));
52:             shoppingBasket.setShoppingBasketPositions(shoppingBasketPositions);
53:             shoppingBasket.setState(CheckOutState.UNDEFINED_EMPTY);
54:             shoppingBasketRepository.save(shoppingBasket);
55:             clientRepository.save(client);
56:         }
57:         return shoppingBasket;
58:     }
59: 
60:     public void addToShoppingBasket(EmailType email, UUID goodId, int quantity) {
61:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByEmail(email);
62:         List<ShoppingBasketPosition> shoppingBasketPositions = shoppingBasket.getShoppingBasketPositions();
63:         ShoppingBasketPosition shoppingBasketPosition = null;
64: 
65:         for (ShoppingBasketPosition position : shoppingBasketPositions) {
66:             if (position.getGood().getGoodId().equals(goodId)) {
67:                 shoppingBasketPosition = position;
68:                 break;
69:             }
70:         }
71:         int availableStock = stockmanageableInterface.getAvailableStock(goodId);
72:         int newQuantity = quantity;
73:         if (shoppingBasketPosition != null) {
74:             newQuantity += shoppingBasketPosition.getQuantity();
75:         }
76:         if (shoppingBasketPosition == null) {
77:             shoppingBasketPosition = shoppingBasketPositionableInterface.createShoppingBasketPosition(goodBuyableInterface.getGoodByGoodId(goodId), newQuantity, null);
78:             shoppingBasketPositions.add(shoppingBasketPosition);
79:         } else {
80:             shoppingBasketPosition.setQuantity(newQuantity);
81:         }
82: 
83:         shoppingBasket.setShoppingBasketPositions(shoppingBasketPositions);
84: 
85:         // Berechnung des Gesamtpreises
86:         float f = 0.0f;
87:         for (ShoppingBasketPosition position : shoppingBasketPositions) {
88:             Float positionTotalPrice = position.getQuantity() * position.getGood().getSalesPrice().getAmount();
89:             f += positionTotalPrice;
90:         }
91:         Money totalPrice = new Money(f, "EUR");
92:         shoppingBasket.setTotalCost(totalPrice);
93:         shoppingBasket.setTotalQuantity(shoppingBasket.getTotalQuantity() + quantity);
94:         shoppingBasket.setState(CheckOutState.FILLED);
95:         shoppingBasketRepository.save(shoppingBasket);
96:     }
97: 
98:     public void removeGoodFromShoppingBasket(EmailType clientEmail, UUID goodId) {
99:         checkIfClientExsists((Email) clientEmail);
100:         if (goodBuyableInterface.goodNotExists(goodId) || stockmanageableInterface.getAvailableStock(goodId) < 0) {
101:             throw new ShopException("Con not remove nonexistent Good to clientShoppingBasket");
102:         }
103:         if (goodBuyableInterface.goodNotExists(goodId)) {
104:             throw new ShopException("Can not remove " + goodId + " good is not in basket");
105:         }
106: 
107:         Client client = clientRepository.findByEmail((Email) clientEmail);
108:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByClientId(client.getClientId());
109:         List<ShoppingBasketPosition> goodsFromBasket = shoppingBasket.getShoppingBasketPositions();
110:         boolean goodExists = false;
111:         for (ShoppingBasketPosition shoppingBasketPosition : goodsFromBasket) {
112:             if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
113:                 goodExists = true;
114:                 break;
115:             }
116:         }
117: 
118:         if (!goodExists) {
119:             throw new ShopException("Cannot remove Good which is not in clientShoppingBasket");
120:         }
121: 
122:         shoppingBasket.getShoppingBasketPositions().removeIf(shoppingBasketPosition -> shoppingBasketPosition.getGood().getGoodId().equals(goodId));
123: 
124:         // Update totalQuantity of the shopping basket
125:         int totalQuantity = shoppingBasket.getShoppingBasketPositions().stream()
126:                 .mapToInt(ShoppingBasketPosition::getQuantity)
127:                 .sum();
128:         shoppingBasket.setTotalQuantity(totalQuantity);
129:         shoppingBasketRepository.save(shoppingBasket);
130:     }
131: 
132: 
133:     public void checkIfClientExsists(Email clientEmail) {
134:         if (clientRepository.findByEmail(clientEmail) == null) {
135:             throw new ShopException("ShoppingBasket is empty or does not exist!");
136:         }
137:     }
138: 
139:     public void checkIfClientShoppingBasketExsists(EmailType clientEmail) {
140:         if (shoppingBasketRepository.findByEmail(clientEmail) == null) {
141:             throw new ShopException("ShoppingBasket is empty or does not exist!");
142:         }
143:     }
144: 
145:     public String getCommentForShoppingBasketPosition(ShoppingBasketPosition shoppingBasketPosition, UUID goodId, int quantity) {
146:         String comment = "";
147:         if (shoppingBasketPosition.getGood().getGoodId().equals(goodId) && shoppingBasketPosition.getQuantity().equals(quantity)){
148:             comment = shoppingBasketPosition.getComment();
149:         }
150:         return comment;
151:     }
152: 
153:     public void setShoppingBasketToInitalState(ShoppingBasket shoppingBasket) {
154:         shoppingBasket.setState(CheckOutState.UNDEFINED_EMPTY);
155:         shoppingBasket.getShoppingBasketPositions().clear();
156:         shoppingBasket.setTotalQuantity(0);
157:         shoppingBasketRepository.save(shoppingBasket);
158:     }
159: 
160:     public Order getOrCreateOrderForClientOrderPositions(Client client, List<OrderPosition> clientOrderPositions) {
161:         //Create a new Order for the Client
162:         Order order = new Order();
163:         order.setClient(client);
164:         order.setOrderPositions(clientOrderPositions);//27.06.23
165:         checkIfClientShoppingBasketExsists(client.getEmail());
166:         clientRepository.save(client);
167:         return order;
168:     }
169: 
170:     public int getGoodQuantityOfBasket(ShoppingBasket shoppingBasket) {
171:         int totalGoods = 0;
172:         for (ShoppingBasketPosition shoppingBasketPosition: shoppingBasket.getShoppingBasketPositions()) {
173:             totalGoods += shoppingBasketPosition.getQuantity();
174:         }
175:         return totalGoods;
176:     }
177: 
178:     public ShoppingBasket getShoppingBasketForMail(String email) {
179:         Email searchEmail = new Email(email);
180:         if (clientRepository.findByEmail(searchEmail) == null){
181:             return null;
182:         }
183:         if (clientRepository.findByEmail(searchEmail) != null && shoppingBasketRepository.findByEmail(searchEmail) == null ){
184:             ShoppingBasket shoppingbasket = createShoppingBasket(clientRepository.findByEmail(searchEmail));
185:             return shoppingBasketRepository.findByEmail(searchEmail);
186:         }
187:         return shoppingBasketRepository.findByEmail(searchEmail);
188:     }
189: 
190:     public ShoppingBasket saveShoppingBasket(ShoppingBasket shoppingBasket){
191:         return shoppingBasketRepository.save(shoppingBasket);
192:     }
193: 
194:     public ShoppingBasket getShoppingBasketById(UUID shoppingBasketId){
195:         return shoppingBasketRepository.findByShoppingBasketId(shoppingBasketId);
196:     }
197: }
198: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketPositionableService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
6: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionService;
7: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionableInterface;
8: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
9: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
10: 
11: import java.util.List;
12: import java.util.UUID;
13: 
14: @Service
15: public class ShoppingBasketPositionableService implements ShoppingBasketPositionableInterface {
16:     private final ShoppingBasketRepository shoppingBasketRepository;
17:     @Autowired
18:     ShoppingBasketPositionService shoppingBasketPositionService;
19: 
20:     public ShoppingBasketPositionableService(ShoppingBasketRepository shoppingBasketRepository) {
21:         this.shoppingBasketRepository = shoppingBasketRepository;
22:     }
23: 
24:     public ShoppingBasketPosition createShoppingBasketPosition(Good good, int quantity, String comment) {
25:         return shoppingBasketPositionService.createShoppingBasketPosition(good, quantity, comment);
26:     }
27: 
28:     @Override
29:     public List<ShoppingBasketPosition> getAllShoppingBasketPositionsForBasket(UUID shoppingBasketId) {
30:         return shoppingBasketRepository.findAllByShoppingBasketId(shoppingBasketId);
31:     }
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingbasketreservableService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.stereotype.Service;
4: import thkoeln.archilab.ecommerce.solution.good.application.ShoppingBasketreservableInterface;
5: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
6: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
7: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
8: 
9: import java.util.HashMap;
10: import java.util.List;
11: import java.util.Map;
12: import java.util.UUID;
13: 
14: @Service
15: public class ShoppingbasketreservableService implements ShoppingBasketreservableInterface {
16: 
17:     private final ShoppingBasketRepository shoppingBasketRepository;
18: 
19:     public ShoppingbasketreservableService(ShoppingBasketRepository shoppingBasketRepository) {
20:         this.shoppingBasketRepository = shoppingBasketRepository;
21:     }
22: 
23:     @Override
24:     public int getAllReservedGoods(UUID goodId) {
25:         Iterable<ShoppingBasket> shoppingBaskets = shoppingBasketRepository.findAll();
26:         int currentlyReservedGoods = 0;
27:         for (ShoppingBasket shoppingBasket : shoppingBaskets) {
28:             for (ShoppingBasketPosition shoppingBasketPosition: shoppingBasket.getShoppingBasketPositions()) {
29:                 if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
30:                     currentlyReservedGoods += shoppingBasketPosition.getQuantity();
31:                 }
32:             }
33:         }
34:         return currentlyReservedGoods;
35:     }
36: 
37:     @Override
38:     public void adjustReservedGoodInShoppingbaskets(UUID goodId, int warehouseQuantityRemoved, int currentlyReservedGoods) {
39:         Iterable<ShoppingBasket> shoppingBaskets = shoppingBasketRepository.findAll();
40:         int newAvailableQuantity = warehouseQuantityRemoved;
41:         if (warehouseQuantityRemoved < currentlyReservedGoods) {
42:             for (ShoppingBasket basket : shoppingBaskets) {
43:                 List<ShoppingBasketPosition> goodsFromBasket = basket.getShoppingBasketPositions();
44:                 for (ShoppingBasketPosition shoppingBasketPosition: goodsFromBasket) {
45:                     if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
46:                         int goodQuantityInBasket = shoppingBasketPosition.getQuantity();
47:                         if (newAvailableQuantity >= goodQuantityInBasket) {
48:                             newAvailableQuantity -= goodQuantityInBasket;
49:                             shoppingBasketPosition.setQuantity(goodQuantityInBasket);
50:                             //basket.setGoods(goodsFromBasket);
51:                             shoppingBasketRepository.save(basket);
52:                         } else {
53:                             shoppingBasketPosition.setQuantity(newAvailableQuantity);
54:                             //basket.setGoods(goodsFromBasket);
55:                             shoppingBasketRepository.save(basket);
56:                         }
57:                     }
58:                 }
59:             }
60:         }
61:     }
62: }
63: 
64: 
65: 
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketRESTController.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.http.HttpStatus;
5: import org.springframework.http.ResponseEntity;
6: import org.springframework.web.bind.annotation.*;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.good.application.GoodCatalogService;
10: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
11: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionDTO;
12: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionDTOMapperService;
13: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionService;
14: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
15: 
16: 
17: import javax.transaction.Transactional;
18: import java.util.ArrayList;
19: import java.util.List;
20: import java.util.UUID;
21: 
22: @RestController
23: @Transactional
24: public class ShoppingBasketRESTController {
25: 
26:     @Autowired
27:     ShoppingBasketService shoppingBasketService;
28:     @Autowired
29:     ShoppingBasketHelperClassCleanCodeService shoppingBasketHelperClassCleanCode;
30:     @Autowired
31:     ShoppingBasketPositionService shoppingBasketPositionService;
32:     @Autowired
33:     GoodCatalogService goodCatalogService;
34:     @Autowired
35:     StockmanageableService stockmanageableService;
36:     @Autowired
37:     ShoppingbasketDTOMapperService shoppingbasketDTOMapper;
38:     @Autowired
39:     ShoppingBasketPositionDTOMapperService shoppingBasketPositionDTOMapperService;
40: 
41:     @GetMapping("/shoppingBaskets")
42:     public ResponseEntity<ShoppingbasketDTO> getShoppingBasketsByEmail(@RequestParam(name = "email", required = false) String email) {
43:         if (!Email.isValidFormat(email)) {
44:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
45:         }
46:         ShoppingBasket shoppingBasket = shoppingBasketHelperClassCleanCode.getShoppingBasketForMail(email);
47:         if (shoppingBasket != null) {
48:             ShoppingbasketDTO shoppingbasketDTO = shoppingbasketDTOMapper.mapToDTO(shoppingBasket);
49:             return new ResponseEntity<>(shoppingbasketDTO, HttpStatus.OK);
50:         } else {
51:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
52:         }
53:     }
54: 
55: 
56:     @GetMapping("/shoppingBaskets/{shoppingBasketId}/shoppingBasketPositions/{goodId}")
57:     public ResponseEntity<ShoppingBasketPositionDTO> getShoppingBasketPosition(
58:             @PathVariable("shoppingBasketId") String shoppingBasketId,
59:             @PathVariable("goodId") String goodId) {
60: 
61:         if (shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId)) == null) {
62:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
63:         }
64: 
65: 
66:         ShoppingbasketDTO shoppingBasket = shoppingbasketDTOMapper.mapToDTO(shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId)));
67:         ShoppingBasketPositionDTO positionDTO = null;
68:         for (ShoppingBasketPositionDTO shoppingBasketPositionDTO : shoppingBasket.getOrderPositions()) {
69:             if (shoppingBasketPositionDTO.getGoodId().equals(UUID.fromString(goodId))) {
70:                 positionDTO = shoppingBasketPositionDTO;
71:                 break;
72:             }
73:         }
74:         if (positionDTO != null) {
75:             if (positionDTO.getQuantity() == 0) {
76:                 return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
77:             }
78:             return new ResponseEntity<>(positionDTO, HttpStatus.OK);
79:         } else {
80:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
81:         }
82:     }
83: 
84:     @PostMapping("/shoppingBaskets/{shoppingBasketId}/shoppingBasketPositions")
85:     public ResponseEntity<ShoppingbasketDTO> addRemoveQuantityOfGoods(
86:             @PathVariable("shoppingBasketId") String shoppingBasketId,
87:             @RequestBody ShoppingBasketPositionDTO shoppingBasketPositionDTO) {
88:         ShoppingBasket shoppingBasket = shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId));
89:         if (shoppingBasket == null) {// Überprüfen, ob der Einkaufswagen existiert
90:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
91:         }
92:         Good good = goodCatalogService.getGoodByGoodId(shoppingBasketPositionDTO.getGoodId());
93:         if (good == null) {//Kontrolliere ob es das Good überhaupt gibt
94:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
95:         }
96:         ShoppingbasketDTO shoppingBasketDTO = shoppingbasketDTOMapper.mapToDTO(shoppingBasket);
97:         List<ShoppingBasketPositionDTO> shoppingBasketPositionDTOS = shoppingBasketDTO.getOrderPositions();
98:         boolean found = false;
99:         // Durchsuchen der Liste der Einkaufswagenpositionen
100:         if (shoppingBasketPositionDTOS != null) {
101:             for (ShoppingBasketPositionDTO sho : shoppingBasketPositionDTOS) {
102:                 if (sho.getGoodId().equals(good.getGoodId())) {
103:                     if(sho.getGoodId().equals(good.getGoodId()) && sho.getQuantity() + shoppingBasketPositionDTO.getQuantity() > stockmanageableService.getAvailableStock(good.getGoodId())  ){
104:                         return ResponseEntity.status(HttpStatus.CONFLICT).body(shoppingBasketDTO);
105:                     }
106:                     ResponseEntity<ShoppingbasketDTO> responseOrDTO = getShoppingbasketDTOResponseEntity(shoppingBasketPositionDTO, shoppingBasketDTO, sho, sho.getQuantity() + shoppingBasketPositionDTO.getQuantity());
107:                     if (responseOrDTO != null) return responseOrDTO;
108:                     found = true;
109:                     break;
110:                 }
111:             }
112:         }
113:         if (!found && shoppingBasketPositionDTO.getQuantity() > 0) {// Position nicht gefunden und Menge ist größer als 0
114:             if (stockmanageableService.getAvailableStock(good.getGoodId()) < shoppingBasketPositionDTO.getQuantity()) {// Überprüfen, ob ausreichend Bestand verfügbar ist
115:                 return ResponseEntity.status(HttpStatus.CONFLICT).body(shoppingBasketDTO);
116:             }
117:             ShoppingBasketPositionDTO newShoppingBasketPositionDTO = createNewShoppingBasketPositionDTO(shoppingBasketPositionDTO);
118:             if (shoppingBasketPositionDTOS == null) {
119:                 shoppingBasketPositionDTOS = new ArrayList<>();
120:             }
121:             shoppingBasketPositionDTOS.add(newShoppingBasketPositionDTO);
122:         }
123:         float totalPrice = 0.0f;
124:         int totalQuantity = 0;
125:         for (ShoppingBasketPositionDTO basketPositionDTO : shoppingBasketDTO.getOrderPositions()) {
126:             totalPrice += basketPositionDTO.getQuantity() * getSalesPriceForPositionGood(basketPositionDTO);
127:             totalQuantity += basketPositionDTO.getQuantity();
128:         }
129:         shoppingBasketDTO.setTotalPrice(new Money(totalPrice, "EUR"));
130:         shoppingBasketDTO.setTotalQuantity(totalQuantity);
131:         shoppingBasketHelperClassCleanCode.saveShoppingBasket(shoppingbasketDTOMapper.mapToEntity(shoppingBasketDTO));
132:         return new ResponseEntity<>(shoppingBasketDTO, HttpStatus.CREATED);
133:     }
134: 
135: 
136:     @DeleteMapping("/shoppingBaskets/{shoppingBasketId}/shoppingBasketPositions/{goodId}")
137:     public ResponseEntity<String> deleteShoppingBasketPosition(
138:             @PathVariable("shoppingBasketId") String shoppingBasketId,
139:             @PathVariable("goodId") UUID goodId) {
140: 
141:         if (shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId)) == null) {
142:             return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
143:         }
144:         ShoppingBasket shoppingBasket = shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId));
145:         // Überprüfen, ob das Produkt im Warenkorb vorhanden ist
146:         if (shoppingBasket.getShoppingBasketPositions().stream().noneMatch(shoppingBasketPosition -> shoppingBasketPosition.getGood().getGoodId().equals(goodId))) {
147:             return ResponseEntity.status(HttpStatus.NOT_FOUND).body("Product not found in shopping basket");
148:         }
149:         shoppingBasketHelperClassCleanCode.removeGoodFromShoppingBasket(shoppingBasket.getClient().getEmail(),goodId);
150:         int test = shoppingBasket.getShoppingBasketQuantity(goodId);
151:         return new ResponseEntity(shoppingbasketDTOMapper.mapToDTO(shoppingBasket), HttpStatus.OK);
152:     }
153: 
154: 
155: 
156:     @PutMapping("/shoppingBaskets/{shoppingBasketId}/checkout")
157:     public ResponseEntity<String> checkoutShoppingBasket(@PathVariable("shoppingBasketId") String shoppingBasketId) {
158:         ShoppingBasket shoppingBasket = shoppingBasketHelperClassCleanCode.getShoppingBasketById(UUID.fromString(shoppingBasketId));
159: 
160:         //Überprüfen ob der Basket leer oder null ist
161:         if (shoppingBasket == null) {
162:             return ResponseEntity.status(HttpStatus.NOT_FOUND).body("ShoppingBasket does not exists!");
163:         } else if (shoppingBasket.getShoppingBasketPositions().isEmpty()) {
164:             return ResponseEntity.status(HttpStatus.CONFLICT).body("ShoppingBasket has no Positions to checkout");
165:         }
166: 
167:         // Überprüfen, ob der Gesamtbetrag das Zahlungslimit überschreitet
168:         if (!shoppingBasketService.isPaymentAuthorized(shoppingBasket.getClient().getEmail()) && shoppingBasket.getTotalQuantity() > 20) {
169:             return ResponseEntity.status(HttpStatus.CONFLICT).body("Der Warenkorb überschreitet das Zahlungslimit / Bestelllimit.");
170:         }
171: 
172:         ////////////
173: 
174:         if (shoppingBasket.getTotalCost().getAmount() > 500.0f) {
175:             return ResponseEntity.status(HttpStatus.CONFLICT).body("Der Warenkorb überschreitet das Zahlungslimit");
176:         } else {
177:             // return ResponseEntity.status(HttpStatus.CONFLICT).build();
178:         }
179:         //Wenn quantity von good == 0 dann löschen
180:         shoppingBasket.getShoppingBasketPositions().removeIf(position -> position.getQuantity() <= 0);
181:         ShoppingbasketDTO shoppingbasketDTO = shoppingbasketDTOMapper.mapToDTO(shoppingBasket);
182:         /////
183:         float totalCost = 0.0f;
184:         for (ShoppingBasketPositionDTO position: shoppingbasketDTO.getOrderPositions()) {
185:             totalCost += position.getQuantity() * goodCatalogService.getSalesPrice(position.getGoodId()).getAmount();
186:         }
187:         if (totalCost > 500) {
188:             return ResponseEntity.status(HttpStatus.CONFLICT).build();
189:         }
190:         shoppingBasketService.checkout(shoppingbasketDTO.getEmail());
191:         return new ResponseEntity(shoppingbasketDTO, HttpStatus.OK);
192:     }
193: 
194: 
195:     private float getSalesPriceForPositionGood(ShoppingBasketPositionDTO basketPositionDTO) {
196:         float salesPrice = goodCatalogService.getSalesPrice(basketPositionDTO.getGoodId()).getAmount();
197:         return salesPrice;
198:     }
199: 
200:     private ShoppingBasketPositionDTO createNewShoppingBasketPositionDTO(ShoppingBasketPositionDTO shoppingBasketPositionDTO) {
201:         ShoppingBasketPositionDTO newShoppingBasketPositionDTO = new ShoppingBasketPositionDTO(
202:                 shoppingBasketPositionDTO.getGoodId(),
203:                 shoppingBasketPositionDTO.getQuantity(),
204:                 shoppingBasketPositionDTO.getComment());
205:         return newShoppingBasketPositionDTO;
206:     }
207: 
208:     private ResponseEntity<ShoppingbasketDTO> getShoppingbasketDTOResponseEntity(ShoppingBasketPositionDTO shoppingBasketPositionDTO, ShoppingbasketDTO shoppingBasketDTO, ShoppingBasketPositionDTO sho, int newQuantity) {
209:         if (newQuantity == 0) {// Neue Menge ist 0, die Position wird entfernt
210:             sho.setQuantity(0);
211:             sho.setComment(null);
212:         } else if (newQuantity < 0) {// Neue Menge ist negativ, es gibt einen Konflikt
213:             sho.setQuantity(0);
214:             sho.setComment(null);
215:             return ResponseEntity.status(HttpStatus.CONFLICT).body(shoppingBasketDTO);
216:         } else {// Neue Menge wird gesetzt und Kommentar aktualisiert
217:             sho.setQuantity(newQuantity);
218:             sho.setComment(shoppingBasketPositionDTO.getComment());
219:         }
220:         return null;
221:     }
222: }
223: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\ShoppingBasketService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.ShopException;
7: import thkoeln.archilab.ecommerce.domainprimitives.Email;
8: import thkoeln.archilab.ecommerce.domainprimitives.Money;
9: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
10: import thkoeln.archilab.ecommerce.solution.client.domain.ClientRepository;
11: import thkoeln.archilab.ecommerce.solution.good.application.GoodBuyableInterface;
12: import thkoeln.archilab.ecommerce.solution.good.application.StockmanageableInterface;
13: import thkoeln.archilab.ecommerce.solution.good.application.WarehouseGetableInterface;
14: import thkoeln.archilab.ecommerce.solution.order.domain.Order;
15: import thkoeln.archilab.ecommerce.solution.order.domain.OrderRepository;
16: import thkoeln.archilab.ecommerce.solution.orderPosition.application.OrderPositionService;
17: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPosition;
18: import thkoeln.archilab.ecommerce.solution.orderPosition.domain.OrderPositionRepository;
19: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application.ShoppingBasketPositionableInterface;
20: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
21: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.CheckOutState;
22: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasket;
23: import thkoeln.archilab.ecommerce.solution.shoppingbasket.domain.ShoppingBasketRepository;
24: import thkoeln.archilab.ecommerce.usecases.ShoppingBasketUseCases;
25: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
26: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
27: 
28: import java.util.*;
29: 
30: @Service
31: public class ShoppingBasketService implements ShoppingBasketUseCases {
32:     private final ClientRepository clientRepository;
33:     private final ShoppingBasketRepository shoppingBasketRepository;
34:     private final OrderPositionRepository orderPositionRepository;
35:     private final OrderRepository orderRepository;
36:     private final StockmanageableInterface stockmanageableInterface;
37:     private final AuthorizablePaymentInterface authorizablePaymentInterface;
38:     private final GoodBuyableInterface goodBuyableInterface;
39:     private final WarehouseGetableInterface warehouseGetableInterface;
40:     private final ShoppingBasketPositionableInterface shoppingBasketPositionableInterface;
41:     @Autowired
42:     private OrderPositionService orderPositionService;
43:     @Autowired
44:     private ShoppingBasketHelperClassCleanCodeService shoppingBasketHelperClassCleanCode;
45: 
46:     @Autowired
47:     private ShoppingBasketService(@Lazy ClientRepository clientRepository,
48:                                   @Lazy ShoppingBasketRepository shoppingBasketRepository,
49:                                   @Lazy OrderRepository orderRepository,
50:                                   @Lazy OrderPositionRepository orderPositionRepository,
51:                                   StockmanageableInterface stockmanageableInterface,
52:                                   AuthorizablePaymentInterface authorizablePaymentInterface,
53:                                   GoodBuyableInterface goodBuyableInterface,
54:                                   WarehouseGetableInterface warehouseGetableInterface,
55:                                   ShoppingBasketPositionableInterface shoppingBasketPositionableInterface) {
56:         this.clientRepository = clientRepository;
57:         this.shoppingBasketRepository = shoppingBasketRepository;
58:         this.orderRepository = orderRepository;
59:         this.orderPositionRepository = orderPositionRepository;
60:         this.stockmanageableInterface = stockmanageableInterface;
61:         this.authorizablePaymentInterface = authorizablePaymentInterface;
62:         this.goodBuyableInterface = goodBuyableInterface;
63:         this.warehouseGetableInterface = warehouseGetableInterface;
64:         this.shoppingBasketPositionableInterface = shoppingBasketPositionableInterface;
65:     }
66: 
67:     @Override
68:     public void addGoodToShoppingBasket(EmailType clientEmail, UUID goodId, int quantity) {
69:         shoppingBasketHelperClassCleanCode.checkIfClientExsists((Email) clientEmail);
70:         if (goodBuyableInterface.goodNotExists(goodId) || stockmanageableInterface.getAvailableStock(goodId) < 0) {
71:             throw new ShopException("Can not add nonExisting Good to clientShoppingBasket");
72:         }
73:         if (stockmanageableInterface.getAvailableStock(goodId) == 0) {
74:             throw new ShopException("Good is outOfStock: " + stockmanageableInterface.getAvailableStock(goodId));
75:         }
76:         if (warehouseGetableInterface.getStorageOfGood(goodId) < quantity) {
77:             throw new ShopException("Can not add " + quantity + " of " + goodId + "to clientShoppingBasket, stock is to low");
78:         }
79:         if (quantity < 0) {
80:             throw new ShopException("Can not reserve " + quantity + "to ShoppingBasket");
81:         }
82:         //Get client and clientBasket
83:         Client client = clientRepository.findByEmail((Email) clientEmail);
84:         shoppingBasketHelperClassCleanCode.createShoppingBasket(client);
85: 
86:         if (goodBuyableInterface.getGoodByGoodId(goodId) == null) {
87:             throw new ShopException("The good with goodId " + goodId + " does not exist");
88:         }
89:         shoppingBasketHelperClassCleanCode.addToShoppingBasket(clientEmail, goodId, quantity);
90:     }
91: 
92:     @Override
93:     public void removeGoodFromShoppingBasket(EmailType clientEmail, UUID goodId, int quantity) {
94:         shoppingBasketHelperClassCleanCode.checkIfClientExsists((Email) clientEmail);
95:         if (goodBuyableInterface.goodNotExists(goodId) || stockmanageableInterface.getAvailableStock(goodId) < 0) {
96:             throw new ShopException("Con not add nonexistent Good to clientShoppingBasket");
97:         }
98:         if (goodBuyableInterface.goodNotExists(goodId) && stockmanageableInterface.getAvailableStock(goodId) < quantity) {
99:             throw new ShopException("Can not add " + quantity + " of " + goodId + " to clientShoppingBasket, stock is too low");
100:         }
101:         if (quantity < 0) {
102:             throw new ShopException("Can not reserve " + quantity + " to ShoppingBasket");
103:         }
104:         if (goodBuyableInterface.goodNotExists(goodId) || stockmanageableInterface.getAvailableStock(goodId) < 0) {
105:             throw new ShopException("Can not add nonexistent Good to clientShoppingBasket");
106:         }
107: 
108:         Client client = clientRepository.findByEmail((Email) clientEmail);
109:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByClientId(client.getClientId());
110:         List<ShoppingBasketPosition> goodsFromBasket = shoppingBasket.getShoppingBasketPositions();
111:         boolean goodExists = false;
112:         ShoppingBasketPosition lookingFor = null;
113:         for (ShoppingBasketPosition shoppingBasketPosition : goodsFromBasket) {
114:             if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
115:                 goodExists = true;
116:                 lookingFor = shoppingBasketPosition;
117:                 break;
118:             }
119:         }
120: 
121:         if (!goodExists) {
122:             throw new ShopException("Cannot remove Good which is not in clientShoppingBasket");
123:         }
124: 
125:         // Check if Quantity of the Good is not < removedQuantity if so throw exception
126:         int updatedQuantity = 0;
127:         if (lookingFor.getGood().getGoodId().equals(goodId) && lookingFor.getQuantity() < quantity) {
128:             throw new ShopException("Can not remove " + quantity + " from good in basket having " + lookingFor.getQuantity() + " Reserved");
129:         }
130:         updatedQuantity = lookingFor.getQuantity() - quantity;
131:         lookingFor.setQuantity(updatedQuantity);
132:         for (ShoppingBasketPosition shoppingBasketPosition : goodsFromBasket) {
133:             if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
134:                 shoppingBasketPosition.setQuantity(updatedQuantity);
135:             }
136:         }
137: 
138:         // Update totalQuantity of the shopping basket
139:         int totalQuantity = shoppingBasket.getShoppingBasketPositions().stream().mapToInt(ShoppingBasketPosition::getQuantity).sum();
140:         shoppingBasket.setTotalQuantity(totalQuantity);
141:         shoppingBasketRepository.save(shoppingBasket);
142:     }
143: 
144:     @Override
145:     public void setCommentForShoppingBasketPosition(EmailType clientEmail, UUID goodId, String comment) {
146:         validateClientEmail(clientEmail);
147:         validateGoodId(goodId);
148:         //check if good is in shoppingbasket else throw
149:         List<ShoppingBasketPosition> shoppingBasketPositions = shoppingBasketRepository.findByEmail(clientEmail).getShoppingBasketPositions();
150:         boolean found = false;
151:         for (ShoppingBasketPosition shoppingBasketPosition : shoppingBasketPositions) {
152:             if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
153:                 shoppingBasketPosition.setComment(comment);
154:                 found = true;
155:                 break;
156:             }
157:         }
158:         if (!found) {
159:             throw new ShopException("There is no Good in the Basket");
160:         }
161:     }
162: 
163:     @Override
164:     public String getCommentForShoppingBasketPosition(EmailType clientEmail, UUID goodId) {
165:         validateClientEmail(clientEmail);
166:         validateGoodId(goodId);
167:         List<ShoppingBasketPosition> positions = shoppingBasketRepository.findByEmail(clientEmail).getShoppingBasketPositions();
168:         ShoppingBasketPosition matchingPosition = null;
169:         for (ShoppingBasketPosition shoppingBasketPosition : positions) {
170:             if (shoppingBasketPosition.getGood().getGoodId().equals(goodId)) {
171:                 matchingPosition = shoppingBasketPosition;
172:                 break;
173:             }
174:         }
175: 
176:         if (matchingPosition == null || !positions.contains(matchingPosition)) {
177:             throw new ShopException("There is no Good in the Basket or it was removed!");
178:         }
179:         return matchingPosition.getComment();
180:     }
181: 
182: 
183:     @Override
184:     public Map<UUID, Integer> getShoppingBasketAsMap(EmailType clientEmail) {
185:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByEmail(clientEmail);
186:         Map<UUID, Integer> basketAsMap = new HashMap<>();
187:         for (ShoppingBasketPosition shoppingBasketPosition:  shoppingBasket.getShoppingBasketPositions()) {
188:             basketAsMap.put(shoppingBasketPosition.getGood().getGoodId(), shoppingBasketPosition.getQuantity());
189:         }
190:         return basketAsMap;
191:     }
192: 
193:     private void validateClientEmail(EmailType clientEmail) {
194:         if (clientRepository.findByEmail((Email) clientEmail) == null) {
195:             throw new ShopException("ClientEmail / Client does not exist!");
196:         }
197:     }
198: 
199:     private void validateGoodId(UUID goodId) {
200:         if (goodId == null) {
201:             throw new ShopException("There is no Good with the goodId: "+ goodId);
202:         }
203:         if (goodBuyableInterface.goodNotExists(goodId)) {
204:             throw new ShopException("There is no Good with the given GoodId: "+ goodId);
205:         }
206:     }
207: 
208:     public MoneyType getCartValue(EmailType clientEmail) {
209:         validateClientEmail(clientEmail);
210:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByEmail(clientEmail);
211:         float totalAmountOfBasket = 0.0f;
212:         String currency = "EUR";
213:         for (ShoppingBasketPosition shoppingBasketPosition : shoppingBasket.getShoppingBasketPositions()) {
214:             UUID goodId = shoppingBasketPosition.getGood().getGoodId();
215:             Integer quantity = shoppingBasketPosition.getQuantity();
216:             MoneyType salesPriceOfGood = goodBuyableInterface.getSalesPrice(goodId);
217:             totalAmountOfBasket += quantity * salesPriceOfGood.getAmount();
218:             currency = salesPriceOfGood.getCurrency();
219:         }
220:         return new Money(totalAmountOfBasket, currency);
221:     }
222: 
223:     @Override
224:     public MoneyType getShoppingBasketAsMoneyValue(EmailType clientEmail) {
225:         //Check if client exists
226:         validateClientEmail(clientEmail);
227:         Client client = clientRepository.findByEmail((Email) clientEmail);
228:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByClientId(client.getClientId());
229:         List<ShoppingBasketPosition> goodsFromBasket = shoppingBasket.getShoppingBasketPositions();
230: 
231:         //Check if client shoppingBasket has goods
232:         if (shoppingBasket.getShoppingBasketPositions().isEmpty()) {
233:             throw new ShopException("Client has no Goods in shoppingBasket");
234:         }
235: 
236:         //Check if client has basket, if so use existing basket else create new one
237:         if (goodsFromBasket.isEmpty()) {
238:             shoppingBasket.setClient(client);
239:             Money initalCosts = new Money(0.0f, "EUR");
240:             shoppingBasket.setTotalCost(initalCosts);
241:             shoppingBasket.setShoppingBasketPositions(goodsFromBasket);
242:             shoppingBasketRepository.save(shoppingBasket);
243:             clientRepository.save(client);
244:         }
245: 
246:         goodsFromBasket = shoppingBasket.getShoppingBasketPositions();
247:         float sumOfBasket = 0.0f;
248:         String currency = "EUR";
249:         //foreach good in basket get salesPrice and sumOfBasket += g.salesPrice
250:         for (ShoppingBasketPosition shoppingBasketPosition : goodsFromBasket) {
251:             UUID goodId = shoppingBasketPosition.getGood().getGoodId();
252:             int quantity = shoppingBasketPosition.getQuantity();
253:             sumOfBasket += quantity * goodBuyableInterface.getSalesPrice(goodId).getAmount();
254:             currency = goodBuyableInterface.getSalesPrice(goodId).getCurrency();
255:         }
256:         return new Money(sumOfBasket, currency);
257:     }
258: 
259:     @Override
260:     public int getReservedStockInShoppingBaskets(UUID goodId) {
261:         validateGoodId(goodId);
262:         int quantityOfGood = 0;
263:         // calculate the quantity of the good in all shopping baskets
264:         for (ShoppingBasket shoppingBasket : shoppingBasketRepository.findAll()) {
265:             quantityOfGood += shoppingBasket.getShoppingBasketQuantity(goodId);
266:         }
267:         return quantityOfGood;
268:     }
269: 
270:     @Override
271:     public boolean isEmpty(EmailType clientEmail) {
272:         //Check if client exists
273:         validateClientEmail(clientEmail);
274:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByEmail(clientEmail);
275:         return shoppingBasket == null || shoppingBasket.getShoppingBasketPositions().isEmpty();
276:     }
277: 
278:     @Override
279:     public boolean isPaymentAuthorized(EmailType clientEmail) {
280:         //Check if client exists
281:         validateClientEmail(clientEmail);
282:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByEmail(clientEmail);
283:         return shoppingBasket != null && shoppingBasket.getState() == CheckOutState.PAYMENT_AUTHORIZED
284:                 && getCartValue(clientEmail).getAmount() <= 500.0f;
285:     }
286: 
287:     @Override
288:     public void checkout(EmailType clientEmail) {
289:         validateClientEmail(clientEmail);
290:         shoppingBasketHelperClassCleanCode.checkIfClientExsists((Email) clientEmail);
291:         shoppingBasketHelperClassCleanCode.checkIfClientShoppingBasketExsists(clientEmail);
292:         if (shoppingBasketRepository.findByEmail(clientEmail).getState().equals(CheckOutState.FILLED)) {
293:             authorizablePaymentInterface.authorizePayment(clientEmail, getCartValue(clientEmail));
294:             shoppingBasketRepository.findByEmail(clientEmail).setState(CheckOutState.PAYMENT_AUTHORIZED);
295:         }
296:         if (shoppingBasketHelperClassCleanCode.getGoodQuantityOfBasket(shoppingBasketRepository.findByEmail(clientEmail)) <= 20) {
297:             shoppingBasketRepository.findByEmail(clientEmail).setState(CheckOutState.PAYMENT_AUTHORIZED);
298:         } else {
299:             throw new ShopException("Can not check out more than 20!");
300:         }
301:         ShoppingBasket shoppingBasket = shoppingBasketRepository.findByClientId(clientRepository.findByEmail((Email) clientEmail).getClientId());
302:         List<OrderPosition> clientOrderPositions = new ArrayList<>();
303:         Order order = shoppingBasketHelperClassCleanCode.getOrCreateOrderForClientOrderPositions(clientRepository.findByEmail((Email) clientEmail), clientOrderPositions);
304:         List<ShoppingBasketPosition> shoppingBasketPositions = shoppingBasket.getShoppingBasketPositions();
305:         if (shoppingBasketRepository.findByEmail(clientEmail).getState().equals(CheckOutState.PAYMENT_AUTHORIZED)) {
306:             shoppingBasket.getShoppingBasketPositions().removeIf(entry -> entry.getQuantity() == 0);
307:         }
308:         float total = 0.0f;
309:         for (ShoppingBasketPosition shoppingBasketPosition: shoppingBasketPositions) {
310:             UUID goodId = shoppingBasketPosition.getGood().getGoodId();
311:             int quantity = shoppingBasketPosition.getQuantity();
312:             stockmanageableInterface.checkGoodQuantityInWarehouse(goodId, quantity);
313:             String comment = shoppingBasketHelperClassCleanCode.getCommentForShoppingBasketPosition(shoppingBasketPosition, goodId, quantity);
314:             OrderPosition orderPosition = orderPositionService.createOrderPosition(goodId, quantity, comment );
315:             orderPositionRepository.save(orderPosition);
316:             order.getOrderPositions().add(orderPosition);
317:             total = order.getTotalOrderPrice().getAmount();
318:             for (OrderPosition position: order.getOrderPositions()) {
319:                 total += position.getTotalAmount().getAmount();
320:             }
321:             stockmanageableInterface.removeFromStock(goodId, quantity);
322:         }
323:         Money totalOrderPrice = new Money(total,"EUR");
324:         order.setTotalOrderPrice(totalOrderPrice);
325:         orderRepository.save(order);
326:         clientRepository.save(clientRepository.findByEmail((Email) clientEmail));
327:         shoppingBasketHelperClassCleanCode.setShoppingBasketToInitalState(shoppingBasket);
328:     }
329: 
330:     @Override
331:     public Map<UUID, Integer> getOrderHistory(EmailType clientEmail) {
332:         validateClientEmail(clientEmail);
333:         Map<UUID, Integer> orderedGood = new HashMap<>();
334:         List<Order> ordersOfClient = orderRepository.findAllByClientEmail(clientEmail);
335:         List<OrderPosition> orderPositions = new ArrayList<>();
336:         for (Order order: ordersOfClient) {
337:             orderPositions.addAll(order.getOrderPositions());
338:         }
339:         for (OrderPosition orderPosition : orderPositions) {
340:             Map<UUID, Integer> temp = new HashMap<>(orderPosition.getGoods());
341:             //If the Good already exists, add the new quantity to it else add new Good with its quantity
342:             for (Map.Entry<UUID, Integer> goodInPosition : temp.entrySet()) {
343:                 UUID goodId = goodInPosition.getKey();
344:                 Integer quantity = goodInPosition.getValue();
345:                 if (orderedGood.containsKey(goodId)) {
346:                     int oldVal = orderedGood.get(goodId);
347:                     orderedGood.put(goodId, oldVal + quantity);
348:                 }
349:                 orderedGood.put(goodId, quantity);
350:             }
351:         }
352:         return orderedGood;
353:     }
354: 
355:     @Override
356:     public void deleteAllOrders() {
357:         orderRepository.deleteAll();
358:     }
359: }
360: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\StockmanageableService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.stereotype.Service;
5: import thkoeln.archilab.ecommerce.ShopException;
6: import thkoeln.archilab.ecommerce.solution.good.application.StockManagementService;
7: import thkoeln.archilab.ecommerce.solution.good.application.StockmanageableInterface;
8: import thkoeln.archilab.ecommerce.solution.good.domain.WarehouseRepository;
9: 
10: import java.util.UUID;
11: 
12: @Service
13: public class StockmanageableService implements StockmanageableInterface {
14:     private final WarehouseRepository warehouseRepository;
15:     @Autowired
16:     private StockManagementService stockManagementService;
17: 
18:     public StockmanageableService(WarehouseRepository warehouseRepository) {
19:         this.warehouseRepository = warehouseRepository;
20:     }
21: 
22:     @Override
23:     public int getAvailableStock(UUID goodId) {
24:         Integer quantity = warehouseRepository.findFirstByOrderByWarehouseIdAsc().getLagerbestand(goodId);
25:         if (quantity == null) {
26:             throw new ShopException("Could not find Good in Stock");
27:         }
28:         return quantity;
29:     }
30: 
31:     @Override
32:     public void checkGoodQuantityInWarehouse(UUID goodId, int quantity) {
33:         int availableStock = getAvailableStock(goodId);
34:         if (availableStock < quantity) {
35:             throw new ShopException("Not enough stock available for good with id " + goodId);
36:         }
37:     }
38: 
39:     @Override
40:     public void removeFromStock(UUID goodId, int quantity) {
41:         stockManagementService.removeFromStock(goodId, quantity);
42:     }
43: 
44:     @Override
45:     public void addToStock(UUID goodId, int quantity) {
46:         stockManagementService.addToStock(goodId, quantity);
47:     }
48: 
49: 
50: }
51: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\application\WarehouseGetableService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.application;
2: 
3: import org.springframework.stereotype.Service;
4: import thkoeln.archilab.ecommerce.solution.good.application.WarehouseGetableInterface;
5: import thkoeln.archilab.ecommerce.solution.good.domain.WarehouseRepository;
6: 
7: import java.util.UUID;
8: 
9: @Service
10: public class WarehouseGetableService implements WarehouseGetableInterface {
11: 
12:     WarehouseRepository warehouseRepository;
13: 
14:     public WarehouseGetableService(WarehouseRepository warehouseRepository) {
15:         this.warehouseRepository = warehouseRepository;
16:     }
17: 
18:     @Override
19:     public int getStorageOfGood(UUID goodId) {
20:         return warehouseRepository.findFirstByOrderByWarehouseIdAsc().getLagerbestand(goodId);
21:     }
22: }
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\CheckOutState.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: public enum CheckOutState {
4:     UNDEFINED_EMPTY,
5:     FILLED,
6:     PAYMENT_AUTHORIZED,
7:     DELIVERY_TRIGGERED
8: }
9: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasket.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnore;
4: import com.fasterxml.jackson.annotation.JsonProperty;
5: import lombok.*;
6: import org.dom4j.tree.AbstractEntity;
7: import thkoeln.archilab.ecommerce.domainprimitives.Money;
8: import thkoeln.archilab.ecommerce.solution.client.domain.Client;
9: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
10: 
11: import javax.persistence.*;
12: import java.util.*;
13: 
14: @Entity
15: @Getter
16: @Setter
17: @NoArgsConstructor
18: @AllArgsConstructor
19: public class ShoppingBasket extends AbstractEntity {
20:     @Id
21:     @Setter(AccessLevel.NONE)
22:     @GeneratedValue(strategy = GenerationType.AUTO)
23:     @JsonProperty
24:     private UUID shoppingBasketId = UUID.randomUUID();
25: 
26:     @JsonProperty
27:     private Integer totalQuantity = 0;
28: 
29:     @JsonProperty
30:     private Money totalCost;
31: 
32:     @OneToMany(cascade = CascadeType.ALL)
33:     public List<ShoppingBasketPosition> shoppingBasketPositions = new ArrayList<>();
34: 
35:     private CheckOutState state = CheckOutState.UNDEFINED_EMPTY;
36:     @OneToOne(cascade = CascadeType.ALL)
37:     private Client client;
38: 
39:     public ShoppingBasket(UUID shoppingBasketId, Client client, Integer totalCost,Money totalPrice, List<ShoppingBasketPosition> shoppingBasketPositions){
40:         this.shoppingBasketId = shoppingBasketId;
41:         this.client = client;
42:         this.totalQuantity = totalCost;
43:         this.totalCost = totalPrice;
44:         this.shoppingBasketPositions = shoppingBasketPositions;
45:     }
46: 
47:     public int getShoppingBasketQuantity(UUID goodId) {
48:         int quantity = 0;
49:         for (ShoppingBasketPosition sho: shoppingBasketPositions) {
50:             if (sho.getGood().getGoodId().equals(goodId)){
51:                 quantity += sho.getQuantity();
52:             }
53:             return quantity;
54:         }
55:         return 0;
56:     }
57: 
58:     public int getTotalAmount() {
59:         int sum = 0;
60:         for (ShoppingBasketPosition shoppingBasketPosition: shoppingBasketPositions) {
61:             sum += shoppingBasketPosition.getQuantity();
62:         }
63:         return sum;
64:     }
65: 
66: 
67: }
68: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingbasket\domain\ShoppingBasketRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingbasket.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
7: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
8: 
9: import java.util.ArrayList;
10: import java.util.UUID;
11: 
12: @Repository
13: public interface ShoppingBasketRepository extends CrudRepository<ShoppingBasket, UUID> {
14:     @Query("SELECT b FROM ShoppingBasket b WHERE b.client.clientId = :clientId")
15:     ShoppingBasket findByClientId(UUID clientId);
16: 
17:     @Query("SELECT b FROM ShoppingBasket b WHERE b.client.email = :email")
18:     ShoppingBasket findByEmail(EmailType email);
19: 
20:     ShoppingBasket findByShoppingBasketId(UUID shoppingBasketId);
21: 
22:     @Query("SELECT sbp FROM ShoppingBasket sbp WHERE sbp.shoppingBasketId  = :shoppingbasketId")
23:     ArrayList<ShoppingBasketPosition> findAllByShoppingBasketId(UUID shoppingbasketId);
24: 
25: }
26: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\application\ShoppingBasketPositionableInterface.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application;
2: 
3: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
4: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
5: 
6: import java.util.List;
7: import java.util.UUID;
8: 
9: public interface ShoppingBasketPositionableInterface {
10:     ShoppingBasketPosition createShoppingBasketPosition(Good good, int quantity, String comment);
11: 
12:     List<ShoppingBasketPosition> getAllShoppingBasketPositionsForBasket(UUID shoppingBasketId);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\application\ShoppingBasketPositionDTO.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnore;
4: import lombok.AllArgsConstructor;
5: import lombok.Getter;
6: import lombok.NoArgsConstructor;
7: import lombok.Setter;
8: 
9: import java.util.UUID;
10: 
11: @Getter
12: @Setter
13: @NoArgsConstructor
14: @AllArgsConstructor
15: public class ShoppingBasketPositionDTO {
16:     private UUID goodId;
17:     private Integer quantity;
18:     private String comment;
19: }
20: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\application\ShoppingBasketPositionDTOMapperService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application;
2: 
3: import org.modelmapper.ModelMapper;
4: import org.springframework.beans.factory.annotation.Autowired;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.solution.good.domain.GoodRepository;
7: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
8: 
9: import java.util.ArrayList;
10: import java.util.List;
11: import java.util.UUID;
12: 
13: @Service
14: public class ShoppingBasketPositionDTOMapperService {
15: 
16:     private final GoodRepository goodRepository;
17: 
18:     @Autowired
19:     ShoppingBasketPositionService shoppingBasketPositionService;
20: 
21:     private ShoppingBasketPositionDTOMapperService(GoodRepository goodRepository){
22:         this.goodRepository = goodRepository;
23:     }
24:     public ShoppingBasketPositionDTO mapToDTO(ShoppingBasketPosition shoppingBasketPosition){
25:         ShoppingBasketPositionDTO shoppingBasketPositionDTO = new ShoppingBasketPositionDTO();
26:         shoppingBasketPositionDTO.setQuantity(shoppingBasketPosition.getQuantity());
27:         shoppingBasketPositionDTO.setGoodId(shoppingBasketPosition.getGood().getGoodId());
28:         shoppingBasketPositionDTO.setComment(shoppingBasketPosition.getComment());
29:         return shoppingBasketPositionDTO;
30:     }
31: 
32:     public List<ShoppingBasketPositionDTO> mapListToDTO(List<ShoppingBasketPosition> shoppingBasketPositions){
33:         if (shoppingBasketPositions.size() == 0){
34:             return new ArrayList<>();
35:         }
36:         List<ShoppingBasketPositionDTO> shoppingBasketPositionDTOS = new ArrayList<>();
37:         for (ShoppingBasketPosition shoppingBasketPosition : shoppingBasketPositions) {
38:             ShoppingBasketPositionDTO shoppingBasketPositionDTO = new ShoppingBasketPositionDTO();
39:             shoppingBasketPositionDTO.setQuantity(shoppingBasketPosition.getQuantity());
40:             shoppingBasketPositionDTO.setGoodId(shoppingBasketPosition.getGood().getGoodId());
41:             shoppingBasketPositionDTO.setComment(shoppingBasketPosition.getComment());
42:             shoppingBasketPositionDTOS.add(shoppingBasketPositionDTO);
43:         }
44:         return shoppingBasketPositionDTOS;
45:     }
46: 
47:     public ShoppingBasketPosition mapToEntity(ShoppingBasketPositionDTO shoppingBasketPositionDTO){
48:         ShoppingBasketPosition shoppingBasketPosition = new ShoppingBasketPosition(
49:                 UUID.randomUUID(),
50:                 shoppingBasketPositionDTO.getQuantity(),
51:                 shoppingBasketPositionDTO.getComment(),
52:                 goodRepository.findGoodByGoodId(shoppingBasketPositionDTO.getGoodId()));
53:         return  shoppingBasketPosition;
54:     }
55: 
56:     public List<ShoppingBasketPosition> mapListToEntity(List<ShoppingBasketPositionDTO> shoppingBasketPositionDTOS){
57:         if (shoppingBasketPositionDTOS.size() == 0){
58:             return new ArrayList<>();
59:         }
60:         List<ShoppingBasketPosition> shoppingBasketPositions = new ArrayList<>();
61:         for (ShoppingBasketPositionDTO shoppingBasketPositionDTO : shoppingBasketPositionDTOS) {
62:             ShoppingBasketPosition shoppingBasketPosition = new ShoppingBasketPosition(
63:                     UUID.randomUUID(),
64:                     shoppingBasketPositionDTO.getQuantity(),
65:                     shoppingBasketPositionDTO.getComment(),
66:                     goodRepository.findGoodByGoodId(shoppingBasketPositionDTO.getGoodId()));
67:             shoppingBasketPositions.add(shoppingBasketPosition);
68:             shoppingBasketPositionService.safeShoppingbasketPosition(shoppingBasketPosition);
69:         }
70:         return shoppingBasketPositions;
71:     }
72: }
73: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\application\ShoppingBasketPositionService.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.application;
2: 
3: import org.springframework.beans.factory.annotation.Autowired;
4: import org.springframework.context.annotation.Lazy;
5: import org.springframework.stereotype.Service;
6: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
7: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPosition;
8: import thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain.ShoppingBasketPositionRepository;
9: 
10: 
11: @Service
12: public class ShoppingBasketPositionService {
13: 
14:     private final ShoppingBasketPositionRepository shoppingBasketPositionRepository;
15: 
16:     @Autowired
17:     public ShoppingBasketPositionService(@Lazy ShoppingBasketPositionRepository shoppingBasketPositionRepository) {
18:         this.shoppingBasketPositionRepository = shoppingBasketPositionRepository;
19:     }
20: 
21:     public ShoppingBasketPosition createShoppingBasketPosition(Good good, int quantity, String comment) {
22:         ShoppingBasketPosition shoppingBasketPosition = new ShoppingBasketPosition();
23:         shoppingBasketPosition.setGood(good);
24:         shoppingBasketPosition.setQuantity(quantity);
25:         shoppingBasketPosition.setComment(comment);
26:         shoppingBasketPositionRepository.save(shoppingBasketPosition);
27:         return shoppingBasketPosition;
28:     }
29: 
30:     public void safeShoppingbasketPosition(ShoppingBasketPosition shoppingBasketPosition){
31:         shoppingBasketPositionRepository.save(shoppingBasketPosition);
32:     }
33: }
34: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\domain\ShoppingBasketPosition.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain;
2: 
3: import lombok.*;
4: import org.dom4j.tree.AbstractEntity;
5: import thkoeln.archilab.ecommerce.solution.good.domain.Good;
6: 
7: import javax.persistence.*;
8: import java.util.UUID;
9: 
10: @Entity
11: @Getter
12: @Setter
13: @NoArgsConstructor
14: @AllArgsConstructor
15: public class ShoppingBasketPosition extends AbstractEntity {
16:     @Id
17:     @Setter(AccessLevel.NONE)
18:     private UUID shoppingBasketPositionId = UUID.randomUUID();
19: 
20:     private Integer quantity;
21: 
22:     private String comment;
23: 
24:     @ManyToOne(cascade = {CascadeType.MERGE})
25:     private Good good;
26: }
27: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\solution\shoppingBasketPosition\domain\ShoppingBasketPositionRepository.java ---
1: package thkoeln.archilab.ecommerce.solution.shoppingBasketPosition.domain;
2: 
3: import org.springframework.data.jpa.repository.Query;
4: import org.springframework.data.repository.CrudRepository;
5: import org.springframework.stereotype.Repository;
6: 
7: import java.util.UUID;
8: 
9: @Repository
10: public interface ShoppingBasketPositionRepository extends CrudRepository<ShoppingBasketPosition, UUID> {
11:     @Query("SELECT sp FROM ShoppingBasketPosition sp WHERE sp.good.goodId = :goodId")
12:     ShoppingBasketPosition findByGoodId(UUID goodId);
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\ClientRegistrationUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
6: 
7: /**
8:  * This interface contains methods needed in the context of use cases dealing with registering a client.
9:  * The interface is probably incomplete, and will grow over time.
10:  */
11: public interface ClientRegistrationUseCases {
12:     /**
13:      * Registers a new client
14:      *
15:      * @param name
16:      * @param email
17:      * @param homeAddress
18:      * @throws ShopException if ...
19:      *      - name is null or empty
20:      *      - email is null
21:      *      - client with the given email already exists
22:      *      - homeAddress is null
23:      */
24:     public void register( String name, EmailType email, HomeAddressType homeAddress );
25: 
26: 
27:     /**
28:      * Changes the homeAddress of a client
29:      *
30:      * @param clientEmail
31:      * @param homeAddress
32:      * @throws ShopException if ...
33:      *      - email is null
34:      *      - client with the given email already exists
35:      *      - homeAddress is null
36:      */
37:     public void changeAddress( EmailType clientEmail, HomeAddressType homeAddress );
38: 
39: 
40:     /**
41:      * Returns the data of a client
42:      * @param clientEmail
43:      * @return the client data
44:      * @throws ShopException if ...
45:      *      - email is null
46:      *      - the client with the given email does not exist
47:      */
48:     public ClientType getClientData( EmailType clientEmail );
49: 
50: 
51: 
52:     /**
53:      * Deletes all clients, including all orders and shopping baskets
54:      */
55:     public void deleteAllClients();
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\ClientType.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
5: 
6: /**
7:  * This interface expresses the essence of a shop client
8:  */
9: public interface ClientType {
10:     public String getName();
11:     public EmailType getEmail();
12:     public HomeAddressType getHomeAddress();
13: }
14: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\DeliveryUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: 
6: import java.util.Map;
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with logistics,
11:  * i.e. the delivery of goods to a client. It is probably incomplete, and will grow over time.
12:  */
13: public interface DeliveryUseCases {
14:     /**
15:      * Delivers a good to a client. The good is identified by its id, and the client by
16:      * his/her name, street, city and postal code.
17:      * @param deliveryRecipient
18:      * @param deliveryContent - a map of good ids and quantities
19:      * @return the id of the delivery, if successfully triggered
20:      * @throws ShopException if ...
21:      *      - deliveryRecipient is null
22:      *      - any of the properties in deliveryRecipient (the getXxx(...) methods) return null or empty strings
23:      *      - deliveryContent is null or empty
24:      *      - the total number of goods in the delivery is > 20
25:      */
26:     public UUID triggerDelivery( ClientType deliveryRecipient, Map<UUID, Integer> deliveryContent );
27: 
28: 
29:     /**
30:      * Returns a map showing which goods have been delivered to a client, and how many of each good
31:      *
32:      * @param clientEmail
33:      * @return the delivery history of the client (map is empty if the client has not had any deliveries yet)
34:      * @throws ShopException if
35:      *      - email is null
36:      *      - the client with the given email does not exist
37:      */
38:     public Map<UUID, Integer> getDeliveryHistory( EmailType clientEmail );
39: 
40: 
41: 
42:     /**
43:      *  Deletes all delivery history.
44:      */
45:     public void deleteDeliveryHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\EmailType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface EmailType {
6:     /**
7:      * @return the email as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an email, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param emailAsString - the email as a string.
18:      *      We will use a much simplified validation method to check if the email is valid:
19:      *      - it must contain exactly one '@' character.
20:      *      - the part before the '@' and the part after the '@' must not be empty, contain of
21:      *        at least one of these characters (A..Z, a..z, or 0..9) and must not contain any whitespace characters
22:      *      - the parts before and after the '@' may contain one or several '.' as separators
23:      *      - two '.' characters must not be directly next to each other (so "test@this..example.com" is invalid)
24:      *      - the part after the '@' must end with ".de", ".at", ".ch", ".com", ".org"
25:      *        (for simplicity we do not allow any other domains)
26:      * @return a new EmailType object matching the given email
27:      * @throws ShopException if ...
28:      *      - emailAsString is null
29:      *      - emailAsString is not a valid email (see above)
30:      */
31:      // public static EmailType of( String emailAsString );
32: }
33: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\HomeAddressType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface HomeAddressType {
6:     /**
7:      * @return the street as a string
8:      */
9:     public String getStreet();
10: 
11:     /**
12:      * @return the city as a string
13:      */
14:     public String getCity();
15: 
16:     /**
17:      * @return the postal code
18:      */
19:     public PostalCodeType getPostalCode();
20: 
21:     /**
22:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
23:      * implementing class to provide a static factory method (simply named "of(...)"),
24:      * which creates an postal code, given as a string.
25:      * We specify this factory method here as a comment, using the Javadoc documentation style.
26:      *
27:      * @param street the street as a string
28:      * @param city the city as a string
29:      * @param postalCode the postal code
30:      * @return the homeAddress object matching the parameters
31:      * @throws ShopException if ...
32:      *      - street is null or empty
33:      *      - city is null or empty
34:      *      - postalCode is null
35:      */
36:      // public static HomeAddressType of( String street, String city, PostalCodeType postalCode );
37: }
38: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\MoneyType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface MoneyType {
6:     /**
7:      * @return the amount of money
8:      */
9:     public Float getAmount();
10: 
11: 
12:     /**
13:      * @return the currency of the money
14:      */
15:     public String getCurrency();
16: 
17: 
18:     /**
19:      * @param otherMoney
20:      * @return this + otherMoney, as a new object
21:      * @throws ShopException if ...
22:      *      - otherMoney is null
23:      *      - otherMoney.currency != this.currency
24:      */
25:     public MoneyType add( MoneyType otherMoney );
26: 
27: 
28:     /**
29:      * @param otherMoney
30:      * @return this - otherMoney, as a new object
31:      * @throws ShopException if ...
32:      *      - otherMoney is null
33:      *      - otherMoney.currency != this.currency
34:      *      - otherMoney > this
35:      */
36:     public MoneyType subtract( MoneyType otherMoney );
37: 
38: 
39:     /**
40:      * @param factor
41:      * @return this * factor, as a new object
42:      * @throws ShopException if ...
43:      *     - factor < 0
44:      */
45:     public MoneyType multiplyBy( int factor );
46: 
47:     /**
48:      * @param otherMoney
49:      * @return true, if this > otherMoney
50:      * @throws ShopException if ...
51:      *      - otherMoney is null
52:      *      - otherMoney.currency != this.currency
53:      */
54:     public boolean largerThan( MoneyType otherMoney );
55: 
56: 
57:     /**
58:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
59:      * implementing class to provide a static factory method (simply named "of(...)"),
60:      * which creates a money object from an amount and a currency (as string).
61:      * We specify this factory method here as a comment, using the Javadoc documentation style.
62:      *
63:      * @param amount the amount of money (must be >= 0)
64:      * @param currency the currency of the money (allowed values: "EUR", "CHF")
65:      * @return a new Money object with the given amount and currency
66:      * @throws ShopException if ...
67:      *   - amount is null
68:      *   - amount < 0
69:      *   - currency is null
70:      *   - currency is not one of the allowed values
71:      */
72:      // public static MoneyType of( Float amount, String currency );
73: }
74: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\domainprimitivetypes\PostalCodeType.java ---
1: package thkoeln.archilab.ecommerce.usecases.domainprimitivetypes;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: public interface PostalCodeType {
6:     /**
7:      * @return the postal code as a string
8:      */
9:     public String toString();
10: 
11:     /**
12:      * Unfortunately, Java interfaces cannot contain static methods. However, we expect the
13:      * implementing class to provide a static factory method (simply named "of(...)"),
14:      * which creates an postal code, given as a string.
15:      * We specify this factory method here as a comment, using the Javadoc documentation style.
16:      *
17:      * @param postalCodeAsString - the postal code as a string.
18:      *      We will use a much simplified validation method to check if the postal code is valid:
19:      *      - It must contain exactly 5 digits.
20:      *      - The last 4 digits must not be 0000 (i.e. 20000 is not a valid postal code, but 20001 is valid)
21:      * @return a new postal code object matching the given string
22:      * @throws ShopException if ...
23:      *      - postalCodeAsString is null
24:      *      - postalCodeAsString is not a valid postal code (see above)
25:      */
26:      // public static PostalCodeType of( String postalCodeAsString );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\GoodCatalogUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
5: 
6: import java.util.UUID;
7: 
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with managing the good catalog.
11:  * The interface is probably incomplete, and will grow over time.
12:  */
13: 
14: public interface GoodCatalogUseCases {
15:     /**
16:      * Adds a new good to the shop catalog
17:      * @param goodId
18:      * @param name
19:      * @param description
20:      * @param size
21:      * @param purchasePrice
22:      * @param salesPrice
23:      * @throws ShopException if ...
24:      *      - goodId is null,
25:      *      - the good with that id already exists,
26:      *      - name or description are null or empty,
27:      *      - the size is <= 0 (but can be null!),
28:      *      - the purchase price is null,
29:      *      - the sales price is null,
30:      *      - the sales price is lower than the purchase price
31:      */
32:     public void addGoodToCatalog( UUID goodId, String name, String description, Float size,
33:                                            MoneyType purchasePrice, MoneyType salesPrice );
34: 
35: 
36:     /**
37:      * Removes a good from the shop catalog
38:      * @param goodId
39:      * @throws ShopException if
40:      *      - goodId is null,
41:      *      - the good with that id does not exist
42:      *      - the good is still in stock
43:      *      - the good is still reserved in a shopping basket, or part of a completed order
44:      */
45:     public void removeGoodFromCatalog( UUID goodId );
46: 
47: 
48:     /**
49:      * Get the sales price of a given good
50:      * @param goodId
51:      * @return the sales price
52:      * @throws ShopException if ...
53:      *      - goodId is null,
54:      *      - the good with that id does not exist
55:      */
56:     public MoneyType getSalesPrice( UUID goodId );
57: 
58: 
59:     /**
60:      * Clears the good catalog, i.e. removes all goods from the catalog, including all the stock,
61:      * all the reservations and all the orders.
62:      */
63:     public void deleteGoodCatalog();
64: 
65: }
66: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\PaymentUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.UUID;
8: 
9: /**
10:  * This interface contains methods needed in the context of use cases dealing with payments.
11:  */
12: public interface PaymentUseCases {
13: 
14:     /**
15:      * Authorizes a payment from a credit card for a given amount
16:      *
17:      * @param clientEmail
18:      * @param moneyAmount
19:      * @return the id of the payment, if successfully authorized
20:      * @throws ShopException if ...
21:      *      - clientEmail is null
22:      *      - the amount is null
23:      *      - the amount is 0.00 EUR
24:      *      - the payment cannot be processed, because it is over the limit of 500.00 EUR
25:      */
26:     public UUID authorizePayment( EmailType clientEmail, MoneyType moneyAmount );
27: 
28: 
29:     /**
30:      * Returns the total amount of payments (over the complete history) for a client
31:      * (identified by his/her email)
32:      *
33:      * @param clientEmail
34:      * @return the total amount of payments made using this credit card, or 0.00 EUR if there
35:      *         weren't any payments yet.
36:      * @throws ShopException if ...
37:      *      - clientEmail is null
38:      */
39:     public MoneyType getPaymentTotal( EmailType clientEmail );
40: 
41: 
42:     /**
43:      * Deletes all payment history, for all clients.
44:      */
45:     public void deletePaymentHistory();
46: }
47: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\ShoppingBasketUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import java.util.Map;
8: import java.util.UUID;
9: 
10: /**
11:  * This interface contains methods needed in the context of use cases dealing with the shopping basket.
12:  * The interface is probably incomplete, and will grow over time.
13:  */
14: public interface ShoppingBasketUseCases {
15:     /**
16:      * Adds a good to the shopping basket of a client
17:      *
18:      * @param clientEmail
19:      * @param goodId
20:      * @param quantity
21:      * @throws ShopException if ...
22:      *      - the client with the given email does not exist,
23:      *      - the good does not exist,
24:      *      - the quantity <= 0,
25:      *      - the good is not available in the requested quantity
26:      */
27:     public void addGoodToShoppingBasket( EmailType clientEmail, UUID goodId, int quantity );
28: 
29: 
30:     /**
31:      * Removes a good from the shopping basket of a client
32:      *
33:      * @param clientEmail
34:      * @param goodId
35:      * @param quantity
36:      * @throws ShopException if ...
37:      *      - clientEmail is null,
38:      *      - the client with the given email does not exist,
39:      *      - the good does not exist
40:      *      - the quantity <= 0,
41:      *      - the good is not in the shopping basket in the requested quantity
42:      */
43:     public void removeGoodFromShoppingBasket( EmailType clientEmail, UUID goodId, int quantity );
44: 
45: 
46:     /**
47:      * Sets a comment in the shopping basket position containing a good
48:      *
49:      * @param clientEmail
50:      * @param goodId
51:      * @param comment (can be null)
52:      * @throws ShopException if ...
53:      *      - clientEmail is null,
54:      *      - the client with the given email does not exist,
55:      *      - the good does not exist
56:      *      - the good is not in the shopping basket
57:      */
58:     public void setCommentForShoppingBasketPosition( EmailType clientEmail, UUID goodId, String comment );
59: 
60: 
61:     /**
62:      * Returns the comment in the shopping basket position containing a good
63:      *
64:      * @param clientEmail
65:      * @param goodId
66:      * @return the comment (can be null)
67:      * @throws ShopException if ...
68:      *      - clientEmail is null,
69:      *      - the client with the given email does not exist,
70:      *      - the good does not exist
71:      *      - the good is not in the shopping basket
72:      */
73:     public String getCommentForShoppingBasketPosition( EmailType clientEmail, UUID goodId );
74: 
75: 
76:     /**
77:      * Returns a map showing which goods are in the shopping basket of a client and how many of each good
78:      *
79:      * @param clientEmail
80:      * @return the shopping basket of the client (map is empty if the shopping basket is empty)
81:      * @throws ShopException if ...
82:      *      - clientEmail is null,
83:      *      - the client with the given email does not exist
84:      */
85:     public Map<UUID, Integer> getShoppingBasketAsMap( EmailType clientEmail );
86: 
87: 
88:     /**
89:      * Returns the current value of all goods in the shopping basket of a client
90:      *
91:      * @param clientEmail
92:      * @return the value of shopping basket of the client
93:      * @throws ShopException if ...
94:      *      - clientEmail is null,
95:      *      - the client with the given email does not exist
96:      */
97:     public MoneyType getShoppingBasketAsMoneyValue( EmailType clientEmail );
98: 
99: 
100: 
101:     /**
102:      * Get the number units of a specific good that are currently reserved in the shopping baskets of all clients
103:      * @param goodId
104:      * @return the number of reserved goods of that type in all shopping baskets
105:      * @throws ShopException
106:      *      - goodId is null
107:      *      - if the good id does not exist
108:      */
109:     public int getReservedStockInShoppingBaskets( UUID goodId );
110: 
111: 
112:     /**
113:      * Checks if the shopping basket of a client is empty
114:      *
115:      * @param clientEmail
116:      * @return true if the shopping basket is empty, false otherwise
117:      * @throws ShopException if ...
118:      *    - clientEmail is null
119:      *    - the client with the given email does not exist
120:      */
121:     public boolean isEmpty( EmailType clientEmail );
122: 
123: 
124:     /**
125:      * Checks if the payment for a specific shopping basket of a client has been authorized to be paid,
126:      * i.e. the shopping basket is not empty, the client has given his/her payment details, and the payment
127:      * has been authorized (under the limits of the client's credit card). However, the order
128:      * has not yet been placed yet, and the logistics details have not yet been given.
129:      *
130:      * @param clientEmail
131:      * @return true if the payment has been authorized, false otherwise
132:      * @throws ShopException if ...
133:      *      - clientEmail is null
134:      *      - the client with the given email does not exist
135:      */
136:     public boolean isPaymentAuthorized( EmailType clientEmail );
137: 
138: 
139:     /**
140:      * Checks out the shopping basket of a client
141:      *
142:      * @param clientEmail
143:      * @throws ShopException if ... 
144:      * @throws ShopException if ...
145:      *      - clientEmail is null
146:      *      - the client with the given email does not exist
147:      *      - the shopping basket is empty
148:      */
149:     public void checkout( EmailType clientEmail );
150: 
151: 
152: 
153: 
154:     /**
155:      * Returns a map showing which goods have been ordered by a client, and how many of each good
156:      *
157:      * @param clientEmail
158:      * @return the order history of the client (map is empty if the client has not ordered anything yet)
159:      * @Deprecated Might be split into a dedicated OrderUseCases interface later (but still valid in this milestone)
160:      * @throws ShopException if
161:      *      - the email is null
162:      *      - the client with the given email does not exist
163:      */
164:     public Map<UUID, Integer> getOrderHistory( EmailType clientEmail );
165: 
166: 
167: 
168:     /**
169:      * Deletes all orders and shopping baskets in the system
170:      * @Deprecated Might be split into two methods later (delete orders and delete shopping baskets), with
171:      *             the order deletion moved to a dedicated OrderUseCases interface later
172:      *             (but still valid in this milestone)
173:      */
174:     public void deleteAllOrders();
175: }
176: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\main\java\thkoeln\archilab\ecommerce\usecases\StockManagementUseCases.java ---
1: package thkoeln.archilab.ecommerce.usecases;
2: 
3: import thkoeln.archilab.ecommerce.ShopException;
4: 
5: import java.util.UUID;
6: 
7: 
8: /**
9:  * This interface contains methods needed in the context of use cases dealing with managing the shop stock,
10:  * i.e. adding and removing goods in the warehouse. The interface is probably incomplete, and
11:  * will grow over time.
12:  */
13: public interface StockManagementUseCases {
14:     /**
15:      * Adds a certain quantity of a given good to the stock
16:      * @param goodId
17:      * @param addedQuantity
18:      * @throws ShopException if ...
19:      *      - goodId is null
20:      *      - the good with that id does not exist
21:      *      - addedQuantity <= 0
22:      */
23:     public void addToStock( UUID goodId, int addedQuantity );
24: 
25: 
26:     /**
27:      * Removes a certain quantity of a given good from the stock.
28:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
29:      * (in the clients' shopping baskets) are removed. This means that some of the reserved goods are lost for
30:      * the client. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
31:      * or some of the goods were stolen from the warehouse, are broken, etc.)
32:      * @param goodId
33:      * @param removedQuantity
34:      * @throws ShopException if ...
35:      *      - goodId is null
36:      *      - the good with that id does not exist
37:      *      - removedQuantity <= 0
38:      *      - the removed quantity is greater than the current stock and the currently reserved goods together
39:      */
40:     public void removeFromStock( UUID goodId, int removedQuantity );
41: 
42: 
43:     /**
44:      * Changes the total quantity of a given good in the stock.
45:      * If the new total quantity is lower than the currently reserved goods, some of currently reserved goods
46:      * (in the clients' shopping baskets) are removed. This means that some of the reserved goods are lost for
47:      * the client. (This is necessary because there probably was a mistake in the stock management, a mis-counting,
48:      * or some of the goods were stolen from the warehouse, are broken, etc.)
49:      * @param goodId
50:      * @param newTotalQuantity
51:      * @throws ShopException if ...
52:      *      - goodId is null
53:      *      - the good with that id does not exist
54:      *      - newTotalQuantity < 0
55:      */
56:     public void changeStockTo( UUID goodId, int newTotalQuantity );
57: 
58: 
59:     /**
60:      * Get the current total stock of a given good, including the currently reserved goods
61:      * @param goodId
62:      * @return the current total stock of the good
63:      * @throws ShopException if ...
64:      *      - goodId is null
65:      *      - the good with that id does not exist
66:      */
67:     public int getAvailableStock( UUID goodId );
68: }
69: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDOutsideSolutionRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: 
8: import static com.tngtech.archunit.library.Architectures.layeredArchitecture;
9: 
10: @ArchTag("layerRules")
11: @AnalyzeClasses(packages = "thkoeln")
12: @SuppressWarnings("PMD")
13: public class E3DDDOutsideSolutionRulesTest {
14: 
15:     @ArchTest
16:     static final ArchRule noClassesOutsideSolutionAndDomainprimitives =
17:             layeredArchitecture()
18:                     .consideringAllDependencies()
19:                     .layer( "Domainprimitives" ).definedBy( "thkoeln.archilab.ecommerce.domainprimitives.." )
20:                     .layer( "SolutionClasses" ).definedBy( "thkoeln.archilab.ecommerce.solution.." )
21:                     .layer( "Test1" ).definedBy( "thkoeln.archilab.ecommerce.codereview.." )
22:                     .layer( "Test2" ).definedBy( "thkoeln.archilab.ecommerce.e1e2resttests.." )
23:                     .layer( "Test3" ).definedBy( "thkoeln.archilab.ecommerce.regression.." )
24: 
25:                     .whereLayer( "Domainprimitives" ).mayOnlyBeAccessedByLayers( "SolutionClasses", "Test1", "Test2", "Test3" )
26:                     .whereLayer( "SolutionClasses" ).mayOnlyBeAccessedByLayers( "Test1", "Test2", "Test3" );
27: }
28: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\codereview\E3DDDRulesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.junit.AnalyzeClasses;
4: import com.tngtech.archunit.junit.ArchTag;
5: import com.tngtech.archunit.junit.ArchTest;
6: import com.tngtech.archunit.lang.ArchRule;
7: import org.springframework.data.repository.CrudRepository;
8: import org.springframework.stereotype.Service;
9: 
10: import javax.persistence.Entity;
11: import javax.persistence.Id;
12: 
13: import java.util.UUID;
14: 
15: import static com.tngtech.archunit.core.domain.JavaMember.Predicates.declaredIn;
16: import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.*;
17: 
18: @ArchTag("layerRules")
19: @AnalyzeClasses(packages = "thkoeln.archilab.ecommerce.solution")
20: @SuppressWarnings("PMD")
21: public class E3DDDRulesTest {
22: 
23:     @ArchTest
24:     static final ArchRule domainClassesMayOnlyCallOtherDomainClasses =
25:             noClasses().that().resideInAPackage("..domain..")
26:                     .should().dependOnClassesThat().resideInAPackage("..application..");
27: 
28:     @ArchTest
29:     static final ArchRule entitiesMustResideInADomainPackage =
30:             classes().that().areAnnotatedWith( Entity.class ).should().resideInAPackage("..domain..")
31:                     .as("Entities must reside in a package '..domain..'");
32: 
33:     @ArchTest
34:     static final ArchRule entitiesMustNotAccessRepositories =
35:             noClasses().that().areAnnotatedWith( Entity.class )
36:                     .should().dependOnClassesThat().areAssignableTo( CrudRepository.class );
37: 
38:     @ArchTest
39:     static final ArchRule repositoriesMustResideInADomainPackage =
40:             classes().that().areAssignableTo( CrudRepository.class ).should().resideInAPackage("..domain..")
41:                     .as("Repositories must reside in a package '..domain..'");
42: 
43:     @ArchTest
44:     static final ArchRule repositoryNamesMustHaveProperSuffix =
45:             classes().that().areAssignableTo( CrudRepository.class )
46:                     .should().haveSimpleNameEndingWith("Repository");
47: 
48:     @ArchTest
49:     static final ArchRule servicesMustResideInAnApplicationPackage =
50:             classes().that().areAnnotatedWith( Service.class ).should().resideInAPackage("..application..")
51:                     .as("Application Services must reside in a package '..application..'");
52: 
53:     @ArchTest
54:     static final ArchRule serviceNamesMustHaveProperSuffix =
55:             classes().that().areAnnotatedWith( Service.class )
56:                     .should().haveSimpleNameEndingWith("Service");
57: 
58:     @ArchTest
59:     static final ArchRule noClassesOnTopLevel =
60:             classes().should().resideInAPackage( "..solution.*.." );
61: 
62:     @ArchTest
63:     static final ArchRule noNonIdFieldsOfTypeIUUID =
64:             fields()
65:                     .that().areDeclaredInClassesThat().areAnnotatedWith( Entity.class )
66:                     .and().areNotAnnotatedWith( Id.class )
67:                     .and().areDeclaredInClassesThat().doNotHaveSimpleName( "Good" )
68:                     .should().notHaveRawType( UUID.class );
69: }
70: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\codereview\E3NoCycleTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClass;
4: import com.tngtech.archunit.core.domain.JavaClasses;
5: import com.tngtech.archunit.core.importer.ClassFileImporter;
6: import com.tngtech.archunit.lang.ArchRule;
7: import com.tngtech.archunit.library.dependencies.SliceAssignment;
8: import com.tngtech.archunit.library.dependencies.SliceIdentifier;
9: import org.junit.jupiter.api.Test;
10: 
11: import static com.tngtech.archunit.library.dependencies.SlicesRuleDefinition.slices;
12: 
13: public class E3NoCycleTest {
14:     private JavaClasses importedClasses = new ClassFileImporter().importPackages("thkoeln.archilab.ecommerce.solution");
15: 
16:     private SliceAssignment inAllClasses() {
17:         return new SliceAssignment() {
18:             @Override
19:             public String getDescription() {
20:                 return "every class in it's own slice";
21:             }
22: 
23:             @Override
24:             public SliceIdentifier getIdentifierOf(JavaClass javaClass) {
25:                 return SliceIdentifier.of("In-All-Classes", javaClass.getPackageName(), javaClass.getName());
26:             }
27:         };
28:     }
29: 
30:     @Test
31:     public void testNoCyclicDependenciesBetweenClasses() {
32:         slices().assignedFrom(inAllClasses())
33:                 .namingSlices("$1[$2.$3]")
34:                 .should().beFreeOfCycles()
35:                 .check(importedClasses);
36:     }
37: 
38:     @Test
39:     public void testNoCyclicDependenciesBetweenPackages() {
40:         ArchRule rule = slices().matching("..solution.(*)..").should().beFreeOfCycles();
41:         rule.check(importedClasses);
42:     }
43: }
44: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\codereview\E3PackageStructureTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import com.tngtech.archunit.core.domain.JavaClasses;
4: import com.tngtech.archunit.core.importer.ClassFileImporter;
5: import org.junit.jupiter.api.BeforeEach;
6: import org.junit.jupiter.api.Test;
7: 
8: import static org.assertj.core.api.Assertions.assertThat;
9: import static org.junit.jupiter.api.Assertions.assertTrue;
10: 
11: public class E3PackageStructureTest {
12: 
13:     private static final String[] REQUIRED_PACKAGES = {"client", "shoppingbasket", "good", "order"};
14:     private static final String BASE_PACKAGE = "thkoeln.archilab.ecommerce.solution";
15:     private JavaClasses importedClasses;
16: 
17: 
18:     @BeforeEach
19:     public void setUp() {
20:         importedClasses = new ClassFileImporter().importPackages( "thkoeln.archilab.ecommerce.solution" );
21:     }
22: 
23:     @Test
24:     void testRequiredPackagesAreThere() {
25:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
26:             String packageName = BASE_PACKAGE + "." + requiredPackage;
27:             assertThat( importedClasses.containPackage( packageName ) )
28:                     .as( "Expected package %s not found!", packageName )
29:                     .isTrue();
30:         }
31:     }
32: 
33:     @Test
34:     void testRequiredDomainPackagesAreThere() {
35:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
36:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".domain";
37:             assertThat( importedClasses.containPackage( packageName ) )
38:                     .as( "Expected domain sub-package %s not found!", packageName )
39:                     .isTrue();
40:         }
41:     }
42: 
43:     @Test
44:     void testRequiredApplicationPackagesAreThere() {
45:         for ( String requiredPackage : REQUIRED_PACKAGES ) {
46:             String packageName = BASE_PACKAGE + "." + requiredPackage + ".application";
47:             assertThat( importedClasses.containPackage( packageName ) )
48:                     .as( "Expected application sub-package %s not found!", packageName )
49:                     .isTrue();
50:         }
51:     }
52: 
53: }
54: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\codereview\E3RequiredClassesTest.java ---
1: package thkoeln.archilab.ecommerce.codereview;
2: 
3: import org.junit.jupiter.api.Test;
4: import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
5: import org.springframework.core.type.classreading.CachingMetadataReaderFactory;
6: import org.springframework.core.type.classreading.MetadataReader;
7: import org.springframework.core.type.classreading.MetadataReaderFactory;
8: 
9: import java.io.IOException;
10: import java.util.Arrays;
11: import java.util.HashSet;
12: import java.util.Set;
13: 
14: import static org.junit.jupiter.api.Assertions.assertTrue;
15: 
16: public class E3RequiredClassesTest {
17: 
18: 
19:     private static final String[] REQUIRED_CLASSES = {
20:             "Client",
21:             "ClientRepository",
22:             "Order",
23:             "OrderRepository",
24:             "ShoppingBasket",
25:             "ShoppingBasketRepository",
26:             "Good",
27:             "GoodRepository"
28:     };
29: 
30:     @Test
31:     public void testRequiredClassesDeclared() throws IOException {
32:         String basePackage = "thkoeln.archilab.ecommerce";
33:         String packageSearchPath = "classpath*:" + basePackage.replace( '.', '/' ) + "/**/*.class";
34: 
35:         PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
36:         MetadataReaderFactory readerFactory = new CachingMetadataReaderFactory( resolver );
37: 
38:         Set<String> foundClasses = new HashSet<>();
39: 
40:         Arrays.stream( resolver.getResources( packageSearchPath ) ).forEach( resource -> {
41:             try {
42:                 MetadataReader reader = readerFactory.getMetadataReader( resource );
43:                 foundClasses.add( reader.getClassMetadata().getClassName() );
44:             } catch (IOException e) {
45:                 e.printStackTrace();
46:             }
47:         } );
48: 
49:         Arrays.stream(REQUIRED_CLASSES).forEach(requiredClass -> {
50:             boolean found = foundClasses.stream().anyMatch(className ->
51:                     className.startsWith(basePackage) && className.endsWith("." + requiredClass)
52:             );
53:             assertTrue(found, "Expected class not found: " + basePackage + ".*." + requiredClass);
54:         });
55:     }
56: }
57: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E1OrdertRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
22: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
23: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CLIENT_EMAIL;
24: 
25: @SpringBootTest
26: @Transactional
27: @AutoConfigureMockMvc
28: @ActiveProfiles("test")
29: public class E1OrdertRESTTest {
30: 
31:     @Autowired
32:     private InitialMasterDataCreator initialMasterDataCreator;
33:     @Autowired
34:     private MockMvc mockMvc;
35: 
36:     private RESTHelper restHelper;
37:     private EmailType nonExistingEmail;
38: 
39: 
40:     @BeforeEach
41:     public void setUp() {
42:         initialMasterDataCreator.deleteAll();
43: 
44:         initialMasterDataCreator.addAllGoods();
45:         initialMasterDataCreator.stockUpAllGoods();
46:         initialMasterDataCreator.registerAllClients();
47: 
48:         restHelper = new RESTHelper( mockMvc );
49:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
50:     }
51: 
52: 
53:     @Test
54:     public void testGetNoOrders() throws Exception {
55:         // given
56:         // when
57:         // then
58:         mockMvc.perform( get( "/orders" ) )
59:                 .andExpect( status().isOk() )
60:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
61:         mockMvc.perform( get( "/orders?email=" + nonExistingEmail ) )
62:                 .andExpect( status().isOk() )
63:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
64:         mockMvc.perform( get( "/orders?email=invalidEmailString" ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
67:         mockMvc.perform( get( "/orders?email=" + CLIENT_EMAIL[3].toString() ) )
68:                 .andExpect( status().isOk() )
69:                 .andExpect( jsonPath( "$.length()" ).value( 0 ) );
70:     }
71: 
72: 
73:     @Test void testMakeThreeOrders() throws Exception {
74:         // given
75:         String emailString = CLIENT_EMAIL[6].toString();
76: 
77:         UUID goodId2 = (UUID) GOOD_DATA[2][0];
78:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
79:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
80:         Float goodMoneyAmount2 = ((MoneyType) GOOD_DATA[2][5]).getAmount() * 2;
81:         Float goodMoneyAmount4 = ((MoneyType) GOOD_DATA[4][5]).getAmount() * 4;
82:         Float goodMoneyAmount6 = ((MoneyType) GOOD_DATA[6][5]).getAmount() * 6;
83: 
84:         String uriAllOrders = "/orders?email=" + emailString;
85:         String uriLatestOrder = uriAllOrders + "&filter=latest";
86: 
87:         // when
88:         restHelper.makeOrderForClient( emailString, goodId2, 2 );
89:         restHelper.makeOrderForClient( emailString, goodId4, 4 );
90:         restHelper.makeOrderForClient( emailString, goodId6, 6 );
91: 
92:         // then get all orders ...
93:         mockMvc.perform( get( uriAllOrders ) )
94:                 .andExpect( status().isOk() )
95:                 .andExpect( jsonPath( "$.length()" ).value( 3 ) )
96: 
97:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( emailString ) )
98:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount2 ) )
99: 
100:                 .andExpect( jsonPath( "$[1].email.emailString" ).value( emailString ) )
101:                 .andExpect( jsonPath( "$[1].price.amount" ).value( goodMoneyAmount4 ) )
102: 
103:                 .andExpect( jsonPath( "$[2].email.emailString" ).value( emailString ) )
104:                 .andExpect( jsonPath( "$[2].price.amount" ).value( goodMoneyAmount6 ) );
105: 
106:         // ... and the latest order
107:         mockMvc.perform( get( uriLatestOrder ) )
108:                 .andExpect( status().isOk() )
109:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) );
110:                 //.andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount6 ) );
111:     }
112: 
113: 
114:     @Test
115:     public void testIfMoneySumInOrderIsCorrect() throws Exception {
116:         // given
117:         String emailString = CLIENT_EMAIL[3].toString();
118:         UUID goodId3 = (UUID) GOOD_DATA[3][0];
119:         UUID goodId4 = (UUID) GOOD_DATA[4][0];
120:         Integer quantity3 = 14;
121:         Integer quantity4 = 5;
122:         Float goodMoneyAmount =
123:                 ((MoneyType) GOOD_DATA[3][5]).getAmount() * quantity3 +
124:                 ((MoneyType) GOOD_DATA[4][5]).getAmount() * quantity4;
125: 
126:         // when
127:         UUID shoppingBasketId = restHelper.getShoppingBasketId( emailString );
128:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId3, quantity3 );
129:         restHelper.addGoodToShoppingBasket( shoppingBasketId, goodId4, quantity4 );
130:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
131:                 .andExpect( status().isOk() );
132: 
133:         // then
134:         mockMvc.perform( get(
135:                 "/orders?email=" + emailString + "&filter=latest") )
136:                 .andExpect( status().isOk() )
137:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
138:                 .andExpect( jsonPath( "$[0].price.amount" ).value( goodMoneyAmount ) );
139:     }
140: 
141: 
142: 
143: }
144: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\E2ShoppingBasketRESTTest.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import org.springframework.test.context.ActiveProfiles;
9: import org.springframework.test.web.servlet.MockMvc;
10: import org.springframework.test.web.servlet.ResultMatcher;
11: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: import java.util.UUID;
16: 
17: import static org.springframework.http.MediaType.APPLICATION_JSON;
18: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
20: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
21: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CONFLICT;
22: import static thkoeln.archilab.ecommerce.e1e2resttests.RESTHelper.CREATED;
23: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
24: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
25: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CLIENT_EMAIL;
26: 
27: @SpringBootTest
28: @Transactional
29: @AutoConfigureMockMvc
30: @ActiveProfiles("test")
31: public class E2ShoppingBasketRESTTest {
32: 
33:     @Autowired
34:     private InitialMasterDataCreator initialMasterDataCreator;
35:     @Autowired
36:     private MockMvc mockMvc;
37: 
38:     private RESTHelper restHelper;
39:     private EmailType nonExistingEmail;
40: 
41: 
42:     @BeforeEach
43:     public void setUp() {
44:         initialMasterDataCreator.deleteAll();
45: 
46:         initialMasterDataCreator.addAllGoods();
47:         initialMasterDataCreator.stockUpAllGoods();
48:         initialMasterDataCreator.registerAllClients();
49: 
50:         restHelper = new RESTHelper( mockMvc );
51:         nonExistingEmail = instantiateEmail( "harry@sally.de" );
52:     }
53: 
54: 
55:     @Test
56:     public void testEmptyShoppingBasket() throws Exception {
57:         // given
58:         String validUri = "/shoppingBaskets?email=" + CLIENT_EMAIL[4].toString();
59:         String invalidUri1 = "/shoppingBaskets?email=" + nonExistingEmail.toString();
60:         String invalidUri2 = "/shoppingBaskets?email=justaninvalidemailaddress";
61: 
62:         // when
63:         // then
64:         mockMvc.perform( get( validUri ) )
65:                 .andExpect( status().isOk() )
66:                 .andExpect( jsonPath( "$.totalQuantity" ).value( 0 ) );
67:         mockMvc.perform( get( invalidUri1 ) )
68:                 .andExpect( status().isNotFound() );
69:         mockMvc.perform( get( invalidUri2 ) )
70:                 .andExpect( status().isNotFound() );
71:     }
72: 
73: 
74:     @Test
75:     public void testInvalidUris() throws Exception {
76:         // given
77:         UUID goodId = (UUID) GOOD_DATA[3][0];
78:         String clientEmailString = CLIENT_EMAIL[4].toString();
79:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
80: 
81:         String invalidPostUri = "/shoppingBaskets/" + UUID.randomUUID() + "/shoppingBasketPositions";
82:         String invalidPatchGetDeleteUri1 =
83:                 "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + UUID.randomUUID();
84:         String invalidPatchGetDeleteUri2 =
85:                 "/shoppingBaskets/" + UUID.randomUUID().toString() + "/shoppingBasketPositions/" + goodId;
86:         String invalidCheckoutUri1 = "/shoppingBaskets/" + shoppingBasketId + "/chekkout";
87:         String invalidCheckoutUri2 = "/shoppingBaskets/" + UUID.randomUUID() + "/checkout";
88: 
89:         // when
90:         // then
91:         mockMvc.perform( post( invalidPostUri )
92:                 .contentType( APPLICATION_JSON ).content( "[]" ) ).andExpect( status().is4xxClientError() );
93: 
94:         mockMvc.perform( delete( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
95:         mockMvc.perform( get( invalidPatchGetDeleteUri1 ) ).andExpect( status().isNotFound() );
96: 
97:         mockMvc.perform( delete( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
98:         mockMvc.perform( get( invalidPatchGetDeleteUri2 ) ).andExpect( status().isNotFound() );
99: 
100:         mockMvc.perform( put( invalidCheckoutUri1 ) ).andExpect( status().isNotFound() );
101:         mockMvc.perform( put( invalidCheckoutUri2 ) ).andExpect( status().isNotFound() );
102:     }
103: 
104: 
105:     @Test
106:     public void testQueryNonExistingGood() throws Exception {
107:         // given
108:         UUID goodId = (UUID) GOOD_DATA[3][0];
109:         String clientEmailString = CLIENT_EMAIL[7].toString();
110:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
111:         String invalidUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/" + goodId;
112: 
113:         // when
114:         // then
115:         mockMvc.perform( get( invalidUri ) ).andExpect( status().isNotFound() );
116:     }
117: 
118: 
119:     @Test
120:     public void testDeleteFromShoppingBasket() throws Exception {
121:         // given
122:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
123:         String clientEmailString9 = CLIENT_EMAIL[9].toString();
124:         String clientEmailString7 = CLIENT_EMAIL[7].toString();
125: 
126:         UUID shoppingBasketId9 = restHelper.getShoppingBasketId( clientEmailString9 );
127:         UUID shoppingBasketId7 = restHelper.getShoppingBasketId( clientEmailString7 );
128: 
129:         String baseUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/shoppingBasketPositions/";
130:         String checkoutUri9 = "/shoppingBaskets/" + shoppingBasketId9 + "/checkout";
131:         String checkoutUri7 = "/shoppingBaskets/" + shoppingBasketId7 + "/checkout";
132: 
133:         // when
134:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString9,
135:                 new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6}, new String[]{"c1", "c4", "c6"} );
136:         restHelper.checkMultipleShoppingBasketPositions(
137:                 clientEmailString9, new Integer[]{1, 4, 6}, new Integer[]{1, 4, 6},
138:                 new String[]{"c1", "c4", "c6"} );
139:         mockMvc.perform( delete( baseUri9 + goodId1 ) )
140:                 .andExpect( status().isOk() );
141:         restHelper.checkMultipleShoppingBasketPositions(
142:                 clientEmailString9, new Integer[]{1, 4, 6}, new Integer[]{null, 4, 6},
143:                 new String[]{null, "c4", "c6"}, new Boolean[]{false, true, true} );
144:         // ... and another customer can still buy 10 of the "Nr. 1" good
145:         restHelper.addGoodToShoppingBasket( shoppingBasketId7, goodId1, 10,
146:                 "still10", null );
147: 
148:         // then
149:         mockMvc.perform( put( checkoutUri9 ) ).andExpect( status().isOk() );
150:         restHelper.checkMultipleOrderPositionsInLatestOrder( clientEmailString9,
151:                 new Integer[]{4, 6}, new Integer[]{4, 6}, new String[]{"c4", "c6"} );
152:         mockMvc.perform( put( checkoutUri7 ) ).andExpect( status().isOk() );
153:         restHelper.checkMultipleOrderPositionsInLatestOrder( clientEmailString7,
154:                 new Integer[]{1}, new Integer[]{10}, new String[]{"still10"} );
155:     }
156: 
157: 
158:     @Test
159:     public void testAddToAndRemoveFromShoppingBasket() throws Exception {
160:         // given
161:         String clientEmailString = CLIENT_EMAIL[2].toString();
162:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
163:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
164: 
165:         // when
166:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
167:                 new Integer[]{2, 4, 2, 4, 6, 2}, new Integer[]{2, 3, 4, -1, 3, -6},
168:                 new String[]{null, "c4a", "c2a", "c4b", "c6", null} );
169:         restHelper.checkMultipleShoppingBasketPositions(
170:                 clientEmailString, new Integer[]{2, 4, 6}, new Integer[]{null, 2, 3},
171:                 new String[]{null, "c4b", "c6"}, new Boolean[]{false, true, true} );
172: 
173:         // then
174:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
175:         restHelper.checkMultipleOrderPositionsInLatestOrder( clientEmailString,
176:                 new Integer[]{4, 6}, new Integer[]{2, 3}, new String[]{"c4b", "c6"} );
177:     }
178: 
179: 
180:     @Test
181:     public void testRemoveMoreThanThereIsInShoppingBasket() throws Exception {
182:         // given
183:         String clientEmailString = CLIENT_EMAIL[2].toString();
184: 
185:         // when
186:         // then
187:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
188:                 new Integer[]{2, 4, 2}, new Integer[]{2, 3, -3}, new String[]{null, null, null},
189:                 new ResultMatcher[]{CREATED, CREATED, CONFLICT} );
190:     }
191: 
192: 
193:     @Test
194:     public void testAddMoreThanIsInStock() throws Exception {
195:         // given
196:         String clientEmailString = CLIENT_EMAIL[7].toString();
197: 
198:         // when
199:         // then
200:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
201:                 new Integer[]{1, 1, 1, 1}, new Integer[]{2, 3, 4, 2}, new String[]{null, null, null, null},
202:                 new ResultMatcher[]{CREATED, CREATED, CREATED, CONFLICT} );
203:     }
204: 
205: 
206:     @Test
207:     public void testSuccessfulCheckoutJustWithinPaymentLimit() throws Exception {
208:         // given
209:         String clientEmailString = CLIENT_EMAIL[5].toString();
210:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
211:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
212: 
213:         // when
214:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
215:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
216: 
217:         // then
218:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isOk() );
219:         restHelper.checkMultipleOrderPositionsInLatestOrder( clientEmailString,
220:                 new Integer[]{11, 13, 10, 6}, new Integer[]{1, 1, 1, 17}, new String[]{"350€", "100€", "35€", "8.50€"} );
221:     }
222: 
223: 
224: 
225:     @Test
226:     public void testUnsuccessfulCheckoutAbovePaymentLimit() throws Exception {
227:         // given
228:         String clientEmailString = CLIENT_EMAIL[1].toString();
229:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
230:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
231: 
232:         // when
233:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
234:                 new Integer[]{13, 10}, new Integer[]{4, 3}, new String[]{"400€", "105€"} );
235: 
236:         // then
237:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
238:     }
239: 
240: 
241:     @Test
242:     public void testUnsuccessfulCheckoutAboveDeliveryLimit() throws Exception {
243:         // given
244:         String clientEmailString = CLIENT_EMAIL[8].toString();
245:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
246:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
247: 
248:         // when
249:         restHelper.addMultipleGoodsToShoppingBasket( clientEmailString,
250:                 new Integer[]{13, 6}, new Integer[]{3, 18}, new String[]{"300€", "9€"} );
251: 
252:         // then
253:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
254:     }
255: 
256: 
257:     @Test
258:     public void testNoCheckoutForEmptyShoppingBasket() throws Exception {
259:         // given
260:         String clientEmailString = CLIENT_EMAIL[9].toString();
261:         UUID shoppingBasketId = restHelper.getShoppingBasketId( clientEmailString );
262:         String checkoutUri = "/shoppingBaskets/" + shoppingBasketId + "/checkout";
263: 
264:         // when
265:         // then
266:         mockMvc.perform( put( checkoutUri ) ).andExpect( status().isConflict() );
267:     }
268: }
269: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\RESTHelper.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests;
2: 
3: import com.fasterxml.jackson.databind.ObjectMapper;
4: import org.springframework.test.web.servlet.MockMvc;
5: import org.springframework.test.web.servlet.MvcResult;
6: import org.springframework.test.web.servlet.ResultActions;
7: import org.springframework.test.web.servlet.ResultMatcher;
8: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.IdDTO;
9: import thkoeln.archilab.ecommerce.e1e2resttests.testdtos.QuantityAndCommentDTO;
10: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
11: 
12: import java.util.HashMap;
13: import java.util.Map;
14: import java.util.UUID;
15: 
16: import static org.springframework.http.MediaType.APPLICATION_JSON;
17: import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
18: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
19: import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
21: 
22: public class RESTHelper {
23:     private MockMvc mockMvc;
24: 
25:     public static final ResultMatcher NOT_FOUND = status().isNotFound();
26:     public static final ResultMatcher OK = status().isOk();
27:     public static final ResultMatcher CREATED = status().isCreated();
28:     public static final ResultMatcher UNPROCESSABLE_ENTITY = status().isUnprocessableEntity();
29:     public static final ResultMatcher CONFLICT = status().isConflict();
30: 
31:     public RESTHelper( MockMvc mockMvc ) {
32:         this.mockMvc = mockMvc;
33:     }
34: 
35:     public void makeOrderForClient( String emailString, UUID goodId, Integer quantity ) throws Exception {
36:         UUID shoppingBasketId = getShoppingBasketId( emailString );
37:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity );
38:         mockMvc.perform( put( "/shoppingBaskets/" + shoppingBasketId.toString() + "/checkout" ) )
39:                 .andExpect( OK );
40:     }
41: 
42:     public UUID getShoppingBasketId( String emailString ) throws Exception {
43:         // get the shopping basket and extract its id ...
44:         MvcResult shoppingBasket = mockMvc.perform( get( "/shoppingBaskets?email=" + emailString ) )
45:                 .andExpect( OK )
46:                 .andExpect( jsonPath( "$.id" ).isNotEmpty() )
47:                 .andReturn();
48:         ObjectMapper objectMapper = new ObjectMapper();
49:         IdDTO idDTO = objectMapper.readValue( shoppingBasket.getResponse().getContentAsString(), IdDTO.class );
50:         return idDTO.getId();
51:     }
52: 
53:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity,
54:                                                  String comment, ResultMatcher expectedStatus )
55:                                                 throws Exception {
56:         ResultMatcher status = expectedStatus == null ? CREATED : expectedStatus;
57:         ObjectMapper objectMapper = new ObjectMapper();
58:         QuantityAndCommentDTO dto = new QuantityAndCommentDTO( goodId, quantity, comment );
59:         String quantityJson = objectMapper.writeValueAsString( dto );
60:         mockMvc.perform( post( "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions" )
61:                 .contentType( APPLICATION_JSON ).content( quantityJson ) )
62:                 .andExpect( status );
63:     }
64: 
65: 
66:     public void addGoodToShoppingBasket( UUID shoppingBasketId, UUID goodId, Integer quantity )
67:             throws Exception {
68:         addGoodToShoppingBasket( shoppingBasketId, goodId, quantity, null, null );
69:     }
70: 
71: 
72: 
73:     public void addMultipleGoodsToShoppingBasket(
74:             String clientEmailString, Integer[] goodIndices, Integer[] quantities, String[] comments,
75:             ResultMatcher[] expectedAddStatuses ) throws Exception {
76:         UUID shoppingBasketId = getShoppingBasketId( clientEmailString );
77:         String shoppingBasketUri = "shoppingBaskets?email=" + clientEmailString;
78:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
79: 
80:         // add all the goods to the shopping basket ...
81:         Map<Integer, Integer> quantityMap = new HashMap<>();
82:         Map<Integer, String> commentMap = new HashMap<>();
83:         for ( int i = 0; i < goodIndices.length; i++ ) {
84:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
85:             addGoodToShoppingBasket( shoppingBasketId, goodId, quantities[i], comments[i], expectedAddStatuses[i] );
86:             if ( expectedAddStatuses[i] != null || expectedAddStatuses[i] == CREATED || expectedAddStatuses[i] == OK ) {
87:                 quantityMap.put( goodIndices[i],
88:                         quantities[i] + quantityMap.getOrDefault( goodIndices[i], 0 ) );
89:                 commentMap.put( goodIndices[i], comments[i] );
90:             }
91:         }
92:     }
93: 
94: 
95:     public void addMultipleGoodsToShoppingBasket(
96:             String clientEmailString, Integer[] goodIndices, Integer[] quantities,
97:             String[] comments ) throws Exception {
98:         ResultMatcher[] expectedAddStatuses = new ResultMatcher[goodIndices.length];
99:         for ( int i = 0; i < goodIndices.length; i++ ) {
100:             expectedAddStatuses[i] = CREATED;
101:         }
102:         addMultipleGoodsToShoppingBasket( clientEmailString, goodIndices, quantities,
103:                 comments, expectedAddStatuses );
104:     }
105: 
106: 
107:     public void checkMultipleShoppingBasketPositions( String clientEmailString,
108:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
109:                                                          String[] expectedComments, Boolean[] expectedToBeFound ) throws Exception {
110:         UUID shoppingBasketId = getShoppingBasketId( clientEmailString );
111:         String shoppingBasketUri = "/shoppingBaskets?email=" + clientEmailString;
112:         String baseUri = "/shoppingBaskets/" + shoppingBasketId + "/shoppingBasketPositions/";
113: 
114:         // check that the shopping basket contains all the goods ...
115:         int totalQuantity = 0;
116:         for ( int i = 0; i < goodIndices.length; i++ ) {
117:             if ( expectedQuantities[i] != null ) {
118:                 totalQuantity += expectedQuantities[i];
119:             }
120:         }
121:         mockMvc.perform( get( shoppingBasketUri ) )
122:                 .andExpect( OK )
123:                 .andExpect( jsonPath( "$.totalQuantity" ).value( totalQuantity ) );
124: 
125:         // check that each good has the correct quantity and comment ...
126:         for ( int i = 0; i < goodIndices.length; i++ ) {
127:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
128:             if ( expectedToBeFound[i] ) {
129:                 mockMvc.perform( get( baseUri + goodId ) )
130:                         .andExpect( OK )
131:                         .andExpect( jsonPath( "$.quantity" ).value( expectedQuantities[i] ) )
132:                         .andExpect( jsonPath( "$.comment" ).value( expectedComments[i] ) );
133:             } else {
134:                 mockMvc.perform( get( baseUri + goodId ) )
135:                         .andExpect( NOT_FOUND );
136:             }
137:         }
138:     }
139: 
140: 
141:     public void checkMultipleShoppingBasketPositions( String clientEmailString,
142:                                                          Integer[] goodIndices, Integer[] expectedQuantities,
143:                                                          String[] expectedComments ) throws Exception {
144:         Boolean[] expectedToBeFound = new Boolean[goodIndices.length];
145:         for ( int i = 0; i < goodIndices.length; i++ ) {
146:             expectedToBeFound[i] = true;
147:         }
148:         checkMultipleShoppingBasketPositions( clientEmailString, goodIndices, expectedQuantities,
149:                 expectedComments, expectedToBeFound );
150:     }
151: 
152: 
153: 
154:     public void checkMultipleOrderPositionsInLatestOrder(
155:             String clientEmailString, Integer[] goodIndices, Integer[] expectedQuantities,
156:             String[] expectedComments ) throws Exception {
157:         String latestOrderUri = "/orders?email=" + clientEmailString + "&filter=latest";
158: 
159:         // Calculate the total price of the order ...
160:         float totalPrice = 0f;
161:         for ( int i = 0; i < goodIndices.length; i++ ) {
162:             totalPrice += expectedQuantities[i] * ((MoneyType) GOOD_DATA[goodIndices[i]][5]).getAmount();
163:         }
164: 
165:         // ... and check that the order has the correct total price (and other data)
166:         ResultActions resultActions = mockMvc.perform( get( latestOrderUri ) ).andExpect( OK )
167:                 .andExpect( jsonPath( "$.length()" ).value( 1 ) )
168:                 .andExpect( jsonPath( "$[0].price.amount" ).value( totalPrice ) )
169:                 .andExpect( jsonPath( "$[0].email.emailString" ).value( clientEmailString ) );
170: 
171:         // Now check that all the expected parts are there
172:         for ( int i = 0; i < goodIndices.length; i++ ) {
173:             UUID goodId = (UUID) GOOD_DATA[goodIndices[i]][0];
174:             resultActions.andExpect(
175:                     jsonPath( "$[0].orderPositions.length()" ).value( goodIndices.length ) );
176:             resultActions.andExpect(
177:                     jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].quantity" )
178:                             .value( expectedQuantities[i] ) );
179:             if ( expectedComments[i] != null ) {
180:                 resultActions.andExpect(
181:                         jsonPath( "$[0].orderPositions[?(@.goodId == '" + goodId + "')].comment" )
182:                                 .value( expectedComments[i] ) );
183:             }
184:         }
185:     }
186: 
187: }
188: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\CommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a comment, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class CommentDTO {
19:     private UUID goodId;
20:     private String comment;
21: }
22: 
23: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\IdDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just the id of an entity, used in testing.
10:  */
11: 
12: @AllArgsConstructor
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class IdDTO {
19:     private UUID id;
20: }
21: 
22: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\e1e2resttests\testdtos\QuantityAndCommentDTO.java ---
1: package thkoeln.archilab.ecommerce.e1e2resttests.testdtos;
2: 
3: import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
4: import lombok.*;
5: 
6: import java.util.UUID;
7: 
8: /**
9:  * A DTO containing just a quantity, used in testing.
10:  */
11: 
12: 
13: @NoArgsConstructor
14: @Setter
15: @Getter
16: @ToString
17: @JsonIgnoreProperties(ignoreUnknown = true)
18: public class QuantityAndCommentDTO {
19:     private UUID goodId;
20:     private Integer quantity;
21:     private String comment;
22: 
23:     public QuantityAndCommentDTO( UUID goodId, Integer quantity, String comment ) {
24:         this.goodId = goodId;
25:         this.quantity = quantity;
26:         this.comment = comment;
27:     }
28: }
29: 
30: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionEmailTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionEmailTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "test@example.com";
16: 
17:         // when
18:         EmailType instance = instantiateEmail( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiateEmail( "test@example.com" ) );
30:         assertDoesNotThrow( () -> instantiateEmail( "99Z@example.com" ) );
31:         assertDoesNotThrow( () -> instantiateEmail( "GGGhh@s77.com" ) );
32:         assertDoesNotThrow( () -> instantiateEmail( "a@4.com" ) );
33:         assertDoesNotThrow( () -> instantiateEmail( "Max.Hammer@example.com" ) );
34:         assertDoesNotThrow( () -> instantiateEmail( "Max.Gideon.Hammer@example.com" ) );
35:         assertDoesNotThrow( () -> instantiateEmail( "test@example.this.com" ) );
36:         assertDoesNotThrow( () -> instantiateEmail( "test@example.de" ) );
37:         assertDoesNotThrow( () -> instantiateEmail( "test@example.at" ) );
38:         assertDoesNotThrow( () -> instantiateEmail( "test@example.ch" ) );
39:         assertDoesNotThrow( () -> instantiateEmail( "test@example.org" ) );
40:     }
41: 
42:     @Test
43:     public void testFactoryMethodInvalid() {
44:         // given
45:         // when
46:         // then
47:         assertThrows( ShopException.class, () -> instantiateEmail( null ) );
48:         assertThrows( ShopException.class, () -> instantiateEmail( "testexample.com" ) );
49:         assertThrows( ShopException.class, () -> instantiateEmail( "test@" ) );
50:         assertThrows( ShopException.class, () -> instantiateEmail( "@example.com" ) );
51:         assertThrows( ShopException.class, () -> instantiateEmail( "Max..Gideon.Hammer@example.com" ) );
52:         assertThrows( ShopException.class, () -> instantiateEmail( "test@examplecom" ) );
53:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example..com" ) );
54:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example@that.com" ) );
55:         assertThrows( ShopException.class, () -> instantiateEmail( "test example@that.com" ) );
56:         assertThrows( ShopException.class, () -> instantiateEmail( "test#example@that.com" ) );
57:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
58:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.biz" ) );
59:         assertThrows( ShopException.class, () -> instantiateEmail( "test@example.42" ) );
60:     }
61: 
62:     @Test
63:     public void testValueObjectEquality() {
64:         // given
65:         // when
66:         EmailType instance1 = instantiateEmail( "test@example.com" );
67:         EmailType instance2 = instantiateEmail( "test@example.com" );
68:         EmailType instance3 = instantiateEmail( "different@example.com" );
69: 
70:         // then
71:         assertEquals( instance1, instance2 );
72:         assertNotEquals( instance1, instance3 );
73:     }
74: 
75:     @Test
76:     public void testImmutability() {
77:         // given
78:         // when
79:         EmailType instance = instantiateEmail( "test@example.com" );
80: 
81:         // then
82:         try {
83:             instance.getClass().getMethod( "setEmail", String.class );
84:             fail( "setEmail method should not exist" );
85:         } catch (NoSuchMethodException e) {
86:             // Success: the object is immutable
87:         }
88:     }
89: }
90: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionHomeAddressTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.HomeAddressType;
6: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
7: 
8: import static org.junit.jupiter.api.Assertions.*;
9: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
10: 
11: class RegressionHomeAddressTest {
12: 
13:     @Test
14:     public void testGetterMethods() {
15:         // given
16:         String street = "Irgendeinestraße 42";
17:         String city = "Irgendeinestadt";
18:         PostalCodeType plz = instantiatePostalCode( "12345" );
19: 
20:         // when
21:         HomeAddressType instance = instantiateHomeAddress( street, city, plz );
22: 
23:         // then
24:         assertEquals( street, instance.getStreet() );
25:         assertEquals( city, instance.getCity() );
26:         assertEquals( plz, instance.getPostalCode() );
27:     }
28: 
29:     @Test
30:     public void testFactoryMethodValid() {
31:         // given
32:         String street = "Irgendeinestraße 42";
33:         String city = "Irgendeinestadt";
34:         PostalCodeType plz = instantiatePostalCode( "12345" );
35: 
36:         // when
37:         // then
38:         assertDoesNotThrow( () -> instantiateHomeAddress( street, city, plz ) );
39:     }
40: 
41:     @Test
42:     public void testFactoryMethodInvalid() {
43:         // given
44:         String street = "Irgendeinestraße 42";
45:         String city = "Irgendeinestadt";
46:         PostalCodeType plz = instantiatePostalCode( "12345" );
47: 
48:         // when
49:         // then
50:         assertThrows( ShopException.class, () -> instantiateHomeAddress( null, city, plz ) );
51:         assertThrows( ShopException.class, () -> instantiateHomeAddress( "", city, plz ) );
52:         assertThrows( ShopException.class, () -> instantiateHomeAddress( street, null, plz ) );
53:         assertThrows( ShopException.class, () -> instantiateHomeAddress( street, "", plz ) );
54:         assertThrows( ShopException.class, () -> instantiateHomeAddress( street, city, null ) );
55:     }
56: 
57:     @Test
58:     public void testValueObjectEquality() {
59:         // given
60:         String street = "Irgendeinestraße 42";
61:         String city = "Irgendeinestadt";
62:         PostalCodeType plz = instantiatePostalCode( "12345" );
63: 
64:         // when
65:         HomeAddressType instance1 = instantiateHomeAddress( street, city, plz );
66:         HomeAddressType instance2 = instantiateHomeAddress( street, city, plz );
67:         HomeAddressType instance3 = instantiateHomeAddress( "Anderestr. 12", city, plz );
68:         HomeAddressType instance4 = instantiateHomeAddress( street, "AndereStadt", plz );
69:         HomeAddressType instance5 = instantiateHomeAddress( street, city, instantiatePostalCode( "54321" ) );
70: 
71:         // then
72:         assertEquals( instance1, instance2 );
73:         assertNotEquals( instance1, instance3 );
74:         assertNotEquals( instance1, instance4 );
75:         assertNotEquals( instance1, instance5 );
76:     }
77: 
78:     @Test
79:     public void testImmutability() {
80:         // given
81:         String street = "Irgendeinestraße 42";
82:         String city = "Irgendeinestadt";
83:         PostalCodeType plz = instantiatePostalCode( "12345" );
84: 
85:         // when
86:         HomeAddressType instance = instantiateHomeAddress( street, city, plz );
87: 
88:         // then
89:         try {
90:             instance.getClass().getMethod( "setStreet", String.class );
91:             fail( "setStreet method should not exist" );
92:         } catch (NoSuchMethodException e) {
93:             // Success: the object is immutable
94:         }
95:         try {
96:             instance.getClass().getMethod( "setCity", String.class );
97:             fail( "setCity method should not exist" );
98: 
99:         } catch (NoSuchMethodException e) {
100:             // Success: the object is immutable
101:         }
102:         try {
103:             instance.getClass().getMethod( "setPostalCode", PostalCodeType.class );
104:             fail( "setPostalCode method should not exist" );
105:         } catch (NoSuchMethodException e) {
106:             // Success: the object is immutable
107:         }
108:     }
109: }
110: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionMoneyTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionMoneyTest {
11: 
12:     @Test
13:     public void testGetAmount() {
14:         // given
15:         Float inputAmount = 10.0f;
16: 
17:         // when
18:         MoneyType instance = instantiateMoney( inputAmount, "EUR" );
19: 
20:         // then
21:         assertEquals( inputAmount, instance.getAmount() );
22:     }
23: 
24:     @Test
25:     public void testGetCurrency() {
26:         // given
27:         String inputCurrency = "EUR";
28: 
29:         // when
30:         MoneyType instance = instantiateMoney( 10.0f, inputCurrency );
31: 
32:         // then
33:         assertEquals( inputCurrency, instance.getCurrency() );
34:     }
35: 
36:     @Test
37:     public void testAddTo() {
38:         // given
39:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
40:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
41:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
42: 
43:         // when
44:         MoneyType result12 = instance1.add( instance2 );
45:         MoneyType result13 = instance1.add( instance3 );
46: 
47:         // then
48:         assertEquals( 30.0f, result12.getAmount() );
49:         assertEquals( "EUR", result12.getCurrency() );
50:         assertEquals( 10.0f, result13.getAmount() );
51:         assertEquals( "EUR", result12.getCurrency() );
52:     }
53: 
54:     @Test
55:     public void testInvalidAddTo() {
56:         // given
57:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
58:         MoneyType instance2 = instantiateMoney( 20.0f, "CHF" );
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () -> instance1.add( instance2 ) );
63:     }
64: 
65:     @Test
66:     public void testSubtractFrom() {
67:         // given
68:         MoneyType instance1 = instantiateMoney( 30.0f, "EUR" );
69:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
70:         MoneyType instance3 = instantiateMoney( 0.0f, "EUR" );
71:         MoneyType instance4 = instantiateMoney( 30.0f, "EUR" );
72: 
73:         // when
74:         MoneyType result12 = instance1.subtract( instance2 );
75:         MoneyType result13 = instance1.subtract( instance3 );
76:         MoneyType result14 = instance1.subtract( instance4 );
77: 
78:         // then
79:         assertEquals( 10.0f, result12.getAmount() );
80:         assertEquals( "EUR", result12.getCurrency() );
81:         assertEquals( 30.0f, result13.getAmount() );
82:         assertEquals( "EUR", result13.getCurrency() );
83:         assertEquals( 0.0f, result14.getAmount() );
84:         assertEquals( "EUR", result14.getCurrency() );
85:     }
86: 
87:     @Test
88:     public void testInvalidSubtractFrom() {
89:         // given
90:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
91:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
92:         MoneyType instance3 = instantiateMoney( 5.0f, "CHF" );
93: 
94:         // when
95:         // then
96:         assertThrows( ShopException.class, () -> instance1.subtract( instance2 ) );
97:         assertThrows( ShopException.class, () -> instance1.subtract( instance3 ) );
98:     }
99: 
100:     @Test
101:     public void testMultiplyBy() {
102:         // given
103:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
104: 
105:         // when
106:         MoneyType result = instance.multiplyBy( 3 );
107: 
108:         // then
109:         assertEquals( 30.0f, result.getAmount() );
110:         assertEquals( "EUR", result.getCurrency() );
111:     }
112: 
113:     @Test
114:     public void testFactoryMethodValid() {
115:         // given
116:         // when
117:         // then
118:         assertDoesNotThrow( () -> instantiateMoney( 10.0f, "EUR" ) );
119:     }
120: 
121:     @Test
122:     public void testFactoryMethodInvalid() {
123:         // given
124:         // when
125:         // then
126:         assertThrows( ShopException.class, () -> instantiateMoney( -10.0f, "EUR" ) );
127:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, "USD" ) );
128:         assertThrows( ShopException.class, () -> instantiateMoney( null, "EUR" ) );
129:         assertThrows( ShopException.class, () -> instantiateMoney( 10.0f, null ) );
130:     }
131: 
132:     @Test
133:     public void testLargerThan() {
134:         // given
135:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
136:         MoneyType instance2 = instantiateMoney( 20.0f, "EUR" );
137:         MoneyType instance3 = instantiateMoney( 10.0f, "EUR" );
138:         MoneyType instance4 = instantiateMoney( 10.0f, "CHF" );
139: 
140:         // when
141:         // then
142:         assertTrue( instance2.largerThan( instance1 ) );
143:         assertFalse( instance1.largerThan( instance2 ) );
144:         assertFalse( instance1.largerThan( instance3 ) );
145:         assertThrows( ShopException.class, () -> instance1.largerThan( instance4 ) );
146:     }
147: 
148: 
149:     @Test
150:     public void testValueObjectEquality() {
151:         // given
152:         // when
153:         MoneyType instance1 = instantiateMoney( 10.0f, "EUR" );
154:         MoneyType instance2 = instantiateMoney( 10.0f, "EUR" );
155:         MoneyType instance3 = instantiateMoney( 20.0f, "EUR" );
156: 
157:         // then
158:         assertEquals( instance1, instance2 );
159:         assertNotEquals( instance1, instance3 );
160:     }
161: 
162:     @Test
163:     public void testImmutability() {
164:         // given
165:         // when
166:         MoneyType instance = instantiateMoney( 10.0f, "EUR" );
167: 
168:         // then
169:         try {
170:             instance.getClass().getMethod( "setAmount", Float.class );
171:             fail( "setAmount method should not exist" );
172:         } catch (NoSuchMethodException e) {
173:             // Success: the object is immutable
174:         }
175: 
176:         try {
177:             instance.getClass().getMethod( "setCurrency", String.class );
178:             fail( "setCurrency method should not exist" );
179:         } catch (NoSuchMethodException e) {
180:             // Success: the object is immutable
181:         }
182:     }
183: }
184: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\domainprimitives\RegressionPostalCodeTest.java ---
1: package thkoeln.archilab.ecommerce.regression.domainprimitives;
2: 
3: import org.junit.jupiter.api.Test;
4: import thkoeln.archilab.ecommerce.ShopException;
5: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.PostalCodeType;
6: 
7: import static org.junit.jupiter.api.Assertions.*;
8: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.*;
9: 
10: class RegressionPostalCodeTest {
11: 
12:     @Test
13:     public void testToString() {
14:         // given
15:         String input = "12345";
16: 
17:         // when
18:         PostalCodeType instance = instantiatePostalCode( input );
19: 
20:         // then
21:         assertEquals( input, instance.toString() );
22:     }
23: 
24:     @Test
25:     public void testFactoryMethodValid() {
26:         // given
27:         // when
28:         // then
29:         assertDoesNotThrow( () -> instantiatePostalCode( "12345" ) );
30:     }
31: 
32:     @Test
33:     public void testFactoryMethodInvalid() {
34:         // given
35:         // when
36:         // then
37:         assertThrows( ShopException.class, () -> instantiatePostalCode( "123456" ) );
38:         assertThrows( ShopException.class, () -> instantiatePostalCode( "1234" ) );
39:         assertThrows( ShopException.class, () -> instantiatePostalCode( "20000" ) );
40:         assertThrows( ShopException.class, () -> instantiatePostalCode( null ) );
41:     }
42: 
43:     @Test
44:     public void testValueObjectEquality() {
45:         // given
46:         // when
47:         PostalCodeType instance1 = instantiatePostalCode( "12345" );
48:         PostalCodeType instance2 = instantiatePostalCode( "12345" );
49:         PostalCodeType instance3 = instantiatePostalCode( "54321" );
50: 
51:         // then
52:         assertEquals( instance1, instance2 );
53:         assertNotEquals( instance1, instance3 );
54:     }
55: 
56:     @Test
57:     public void testImmutability() {
58:         // given
59:         // when
60:         PostalCodeType instance = instantiatePostalCode( "12345" );
61: 
62:         // then
63:         try {
64:             instance.getClass().getMethod( "setpostalCode", String.class );
65:             fail( "setpostalCode method should not exist" );
66:         } catch (NoSuchMethodException e) {
67:             // Success: the object is immutable
68:         }
69:     }
70: }
71: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionClientRegistrationTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.Assertions;
4: import org.junit.jupiter.api.BeforeEach;
5: import org.junit.jupiter.api.Test;
6: import org.springframework.beans.factory.annotation.Autowired;
7: import org.springframework.boot.test.context.SpringBootTest;
8: import thkoeln.archilab.ecommerce.ShopException;
9: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
10: import thkoeln.archilab.ecommerce.usecases.ClientRegistrationUseCases;
11: import thkoeln.archilab.ecommerce.usecases.ClientType;
12: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.EmailType;
13: 
14: import javax.transaction.Transactional;
15: 
16: import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
17: import static org.junit.jupiter.api.Assertions.assertThrows;
18: import static thkoeln.archilab.ecommerce.masterdata.FactoryMethodInvoker.instantiateEmail;
19: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CLIENT_ADDRESS;
20: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.CLIENT_EMAIL;
21: 
22: @SpringBootTest
23: @Transactional
24: public class RegressionClientRegistrationTest {
25: 
26:     @Autowired
27:     private ClientRegistrationUseCases clientRegistrationUseCases;
28:     @Autowired
29:     private InitialMasterDataCreator initialMasterDataCreator;
30: 
31:     private EmailType nonExistingEmail;
32: 
33:     @BeforeEach
34:     public void setUp() {
35:         initialMasterDataCreator.deleteAll();
36:         nonExistingEmail = instantiateEmail( "this@nononono.de" );
37:     }
38: 
39: 
40:     @Test
41:     public void testAllClientsRegistered() {
42:         // given
43:         initialMasterDataCreator.registerAllClients();
44: 
45:         // when
46:         ClientType client3 = clientRegistrationUseCases.getClientData( CLIENT_EMAIL[3] );
47: 
48:         // then
49:         Assertions.assertEquals( initialMasterDataCreator.CLIENT_NAME[3], client3.getName() );
50:         Assertions.assertEquals( CLIENT_EMAIL[3], client3.getEmail() );
51:         Assertions.assertEquals( CLIENT_ADDRESS[3], client3.getHomeAddress() );
52:     }
53: 
54: 
55:     @Test
56:     public void testRegisterClientWithDuplicateEmail() {
57:         // given
58:         initialMasterDataCreator.registerAllClients();
59: 
60:         // when
61:         // then
62:         assertThrows( ShopException.class, () ->
63:                 clientRegistrationUseCases.register( "Gandalf The Grey", CLIENT_EMAIL[5],
64:                         CLIENT_ADDRESS[5] ) );
65:     }
66: 
67:     @Test
68:     public void testRegisterClientWithDuplicateNameOrHomeAddress() {
69:         // given
70:         initialMasterDataCreator.registerAllClients();
71:         EmailType newEmail = instantiateEmail( "some@this.de" );
72: 
73:         // when
74:         // then
75:         assertDoesNotThrow(() ->
76:                 clientRegistrationUseCases.register( initialMasterDataCreator.CLIENT_NAME[2], newEmail,
77:                         CLIENT_ADDRESS[2] ) );
78:     }
79: 
80: 
81:     @Test
82:     public void testDeleteClientsNoMoreClients() {
83:         // given
84:         initialMasterDataCreator.registerAllClients();
85: 
86:         // when
87:         clientRegistrationUseCases.deleteAllClients();
88: 
89:         // then
90:         assertThrows( ShopException.class, () -> clientRegistrationUseCases.getClientData( CLIENT_EMAIL[0] ) );
91:     }
92: 
93: }
94: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionGoodCatalogTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.ShopException;
8: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
9: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
10: import thkoeln.archilab.ecommerce.usecases.GoodCatalogUseCases;
11: import thkoeln.archilab.ecommerce.usecases.domainprimitivetypes.MoneyType;
12: 
13: import javax.transaction.Transactional;
14: import java.util.UUID;
15: 
16: import static org.junit.jupiter.api.Assertions.*;
17: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
18: 
19: @SpringBootTest
20: @Transactional
21: public class RegressionGoodCatalogTest {
22: 
23:     @Autowired
24:     private GoodCatalogUseCases goodCatalogUseCases;
25:     @Autowired
26:     private StockManagementUseCases stockManagementUseCases;
27:     @Autowired
28:     private InitialMasterDataCreator initialMasterDataCreator;
29: 
30:     @BeforeEach
31:     public void setUp() {
32:         initialMasterDataCreator.deleteAll();
33:     }
34: 
35: 
36: 
37:     @Test
38:     public void testAddGoodToCatalog() {
39:         // given
40:         initialMasterDataCreator.addAllGoods();
41: 
42:         // when
43:         MoneyType salesPrice = goodCatalogUseCases.getSalesPrice( (UUID) GOOD_DATA[4][0] );
44: 
45:         // then
46:         assertEquals( GOOD_DATA[4][5], salesPrice );
47:     }
48: 
49:     @Test
50:     public void testRemoveGoodFromCatalog() {
51:         // given
52:         initialMasterDataCreator.addAllGoods();
53:         UUID goodId = (UUID) GOOD_DATA[4][0];
54: 
55:         // when
56:         assertDoesNotThrow( () -> goodCatalogUseCases.getSalesPrice( goodId ) );
57:         goodCatalogUseCases.removeGoodFromCatalog( goodId );
58: 
59:         // then
60:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSalesPrice( goodId ) );
61:     }
62: 
63: 
64: 
65: 
66:     @Test
67:     public void testRemoveGoodThatIsInStock() {
68:         // given
69:         initialMasterDataCreator.addAllGoods();
70:         UUID goodId = (UUID) GOOD_DATA[4][0];
71:         stockManagementUseCases.addToStock( goodId, 3 );
72: 
73:         // when
74:         // then
75:         assertThrows( ShopException.class, () -> goodCatalogUseCases.removeGoodFromCatalog( goodId ) );
76:     }
77: 
78: 
79:     @Test
80:     public void testClearGoodCatalog() {
81:         // given
82:         initialMasterDataCreator.addAllGoods();
83: 
84:         // when
85:         goodCatalogUseCases.deleteGoodCatalog();
86: 
87:         // then
88:         assertThrows( ShopException.class, () -> goodCatalogUseCases.getSalesPrice( (UUID) GOOD_DATA[4][0] ) );
89:     }
90: 
91: }
92: 

--- FILE: C:\workspace\Masterarbeit\Repositories\ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317\src\test\java\thkoeln\archilab\ecommerce\regression\RegressionStockManagementTest.java ---
1: package thkoeln.archilab.ecommerce.regression;
2: 
3: import org.junit.jupiter.api.BeforeEach;
4: import org.junit.jupiter.api.Test;
5: import org.springframework.beans.factory.annotation.Autowired;
6: import org.springframework.boot.test.context.SpringBootTest;
7: import thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator;
8: import thkoeln.archilab.ecommerce.usecases.StockManagementUseCases;
9: 
10: import javax.transaction.Transactional;
11: import java.util.UUID;
12: 
13: import static org.junit.jupiter.api.Assertions.assertEquals;
14: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_STOCK;
15: import static thkoeln.archilab.ecommerce.masterdata.InitialMasterDataCreator.GOOD_DATA;
16: 
17: @SpringBootTest
18: @Transactional
19: public class RegressionStockManagementTest {
20: 
21:     @Autowired
22:     private StockManagementUseCases stockManagementUseCases;
23:     @Autowired
24:     private InitialMasterDataCreator initialMasterDataCreator;
25: 
26: 
27:     @BeforeEach
28:     public void setUp() {
29:         initialMasterDataCreator.deleteAll();
30:         initialMasterDataCreator.addAllGoods();
31:     }
32: 
33: 
34: 
35:     @Test
36:     public void testAddToStock() {
37:         // given
38:         initialMasterDataCreator.stockUpAllGoods();
39:         UUID goodId8 = (UUID) GOOD_DATA[8][0];
40: 
41:         // when
42:         int stock8before = stockManagementUseCases.getAvailableStock( goodId8 );
43:         assertEquals( GOOD_STOCK.get( goodId8 ), stock8before );
44:         stockManagementUseCases.addToStock( goodId8, 22 );
45:         int stock8after = stockManagementUseCases.getAvailableStock( goodId8 );
46:         stockManagementUseCases.addToStock( goodId8, 1 );
47:         int stock8after2 = stockManagementUseCases.getAvailableStock( goodId8 );
48: 
49:         // then
50:         assertEquals( stock8before + 22, stock8after );
51:         assertEquals( stock8after + 1, stock8after2 );
52:     }
53: 
54: 
55:     @Test
56:     public void testRemoveFromStock() {
57:         // given
58:         initialMasterDataCreator.stockUpAllGoods();
59:         UUID goodId6 = (UUID) GOOD_DATA[6][0];
60:         int stock6before = GOOD_STOCK.get( goodId6 );
61:         UUID goodId9 = (UUID) GOOD_DATA[9][0];
62:         int stock9before = GOOD_STOCK.get( goodId9 );
63:         UUID goodId1 = (UUID) GOOD_DATA[1][0];
64:         int stock1before = GOOD_STOCK.get( goodId1 );
65: 
66:         // when
67:         stockManagementUseCases.removeFromStock( goodId6, 1 );
68:         int stock6after = stockManagementUseCases.getAvailableStock( goodId6 );
69:         stockManagementUseCases.removeFromStock( goodId1, 3 );
70:         int stock1after = stockManagementUseCases.getAvailableStock( goodId1 );
71:         stockManagementUseCases.removeFromStock( goodId9, stock9before );
72:         int stock9after = stockManagementUseCases.getAvailableStock( goodId9 );
73: 
74:         // then
75:         assertEquals( stock6before - 1, stock6after );
76:         assertEquals( stock1before - 3, stock1after );
77:         assertEquals( 0, stock9after );
78:     }
79: 
80: }
81: 

[RESPONSE]:
```json
{
  "projektName": "ST2M4_group_13fb5450-bcb2-4392-bce6-c331d6d2b317",
  "llm": "StrictJavaAuditor",
  "codeSmells": [
    {
      "class": "Email",
      "duplication": [
        {
          "line": "23",
          "reasoning": "RegEx-Pattern für Email-Validierung ist dupliziert in Zeile 40."
        },
        {
          "line": "40",
          "reasoning": "RegEx-Pattern für Email-Validierung ist identisch mit Zeile 23."
        }
      ],
      "deadCode": [
        {
          "line": "30-32",
          "reasoning": "Methode 'asString' wird im gesamten Projekt nicht aufgerufen (Verdacht)."
        }
      ]
    },
    {
      "class": "FactoryMethodInvoker",
      "duplication": [
        {
          "line": "23-48",
          "reasoning": "Reflection-Logik zur Instanziierung von EmailType ist dupliziert in ähnlichen Methoden für HomeAddressType (Zeile 51-79), PostalCodeType (Zeile 82-107) und MoneyType (Zeile 110-135)."
        },
        {
          "line": "51-79",
          "reasoning": "Reflection-Logik zur Instanziierung von HomeAddressType ist dupliziert (siehe Zeile 23-48)."
        },
        {
          "line": "82-107",
          "reasoning": "Reflection-Logik zur Instanziierung von PostalCodeType ist dupliziert (siehe Zeile 23-48)."
        },
        {
          "line": "110-135",
          "reasoning": "Reflection-Logik zur Instanziierung von MoneyType ist dupliziert (siehe Zeile 23-48)."
        }
      ]
    },
    {
      "class": "ClientRegistrationService",
      "deadCode": [
        {
          "line": "83-85",
          "reasoning": "Methode 'findByEmail' wird in dieser Klasse nicht aufgerufen (Verdacht)."
        }
      ]
    },
    {
      "class": "Client",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    },
    {
      "class": "DeliveryRecipientClient",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und eine Factory-Methode, aber keine Domänenlogik."
    },
    {
      "class": "Delivery",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    },
    {
      "class": "Catalog",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    },
    {
      "class": "Good",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keinen Domänenlogik (abgesehen von einfachen Gettern)."
    },
    {
      "class": "Warehouse",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und eine einfache Abfragemethode, jedoch keine Domänenlogik."
    },
    {
      "class": "Order",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und eine einfache Getter-Logik, jedoch keine Domänenlogik."
    },
    {
      "class": "OrderPosition",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    },
    {
      "class": "Payment",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    },
    {
      "class": "ShoppingBasketPosition",
      "anemicEntity": "Domain Entity enthält nur Getter/Setter und keine Domänenlogik."
    }
  ]
}
```
Generated by deepseek-reasoner
-----------------------------------